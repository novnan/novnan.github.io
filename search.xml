<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Hexoç‰ˆæœ¬å‡çº§æŒ‡å—</title>
    <url>/Hexo/update_hexo/</url>
    <content><![CDATA[<p>Hexo å‡çº§æ¯”è¾ƒç®€å•ï¼Œè€æ–¹æ³• <code>npm-check</code>ã€<code>npm-upgrade</code>ã€<code>npm-update</code> ä¸€é”®ä¸‰è¿ã€‚æŒ‰ä»¥ä¸‹é¡ºåºé€æ­¥æ‰§è¡Œå®Œæˆåï¼ŒHexo ç‰ˆæœ¬åŠç³»ç»Ÿæ’ä»¶å‡ä¼šå‡çº§åˆ°æœ€æ–°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//ä»¥ä¸‹æŒ‡ä»¤å‡åœ¨Hexoç›®å½•ä¸‹æ“ä½œï¼Œå…ˆå®šä½åˆ°Hexoç›®å½•</span><br><span class="line">//æŸ¥çœ‹å½“å‰ç‰ˆæœ¬ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦å‡çº§</span><br><span class="line">&gt; hexo version</span><br><span class="line"></span><br><span class="line">//å…¨å±€å‡çº§hexo-cli</span><br><span class="line">&gt; npm i hexo-cli -g</span><br><span class="line"></span><br><span class="line">//å†æ¬¡æŸ¥çœ‹ç‰ˆæœ¬ï¼Œçœ‹hexo-cliæ˜¯å¦å‡çº§æˆåŠŸ</span><br><span class="line">&gt; hexo version</span><br><span class="line"></span><br><span class="line">//å®‰è£…npm-checkï¼Œè‹¥å·²å®‰è£…å¯ä»¥è·³è¿‡</span><br><span class="line">&gt; npm install -g npm-check</span><br><span class="line"></span><br><span class="line">//æ£€æŸ¥ç³»ç»Ÿæ’ä»¶æ˜¯å¦éœ€è¦å‡çº§</span><br><span class="line">&gt; npm-check</span><br><span class="line"></span><br><span class="line">//å®‰è£…npm-upgradeï¼Œè‹¥å·²å®‰è£…å¯ä»¥è·³è¿‡</span><br><span class="line">&gt; npm install -g npm-upgrade</span><br><span class="line"></span><br><span class="line">//æ›´æ–°package.json</span><br><span class="line">&gt; npm-upgrade</span><br><span class="line"></span><br><span class="line">//æ›´æ–°å…¨å±€æ’ä»¶</span><br><span class="line">&gt; npm update -g</span><br><span class="line"></span><br><span class="line">//æ›´æ–°ç³»ç»Ÿæ’ä»¶</span><br><span class="line">&gt; npm update --save</span><br><span class="line"></span><br><span class="line">//å†æ¬¡æŸ¥çœ‹ç‰ˆæœ¬ï¼Œåˆ¤æ–­æ˜¯å¦å‡çº§æˆåŠŸ</span><br><span class="line">&gt; hexo version</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>è®© Hexo NexT æ”¯æŒ emoji è¡¨æƒ…</title>
    <url>/Hexo/emojis-for-hexo-next/</url>
    <content><![CDATA[<p>å°† markdown è½¬åŒ–ä¸º html çš„è½¬åŒ–å™¨å«åš markdown æ¸²æŸ“å™¨ã€‚</p>
<p>åœ¨ Hexo ä¸­é»˜è®¤çš„ markdown æ¸²æŸ“å™¨æ˜¯ <code>hexo-renderer-marked</code> ï¼Œè¿™ä¸ªæ¸²æŸ“å™¨æ˜¯ä¸æ”¯æŒ emoji è¡¨æƒ…çš„ã€‚</p>
<p>åœ¨ NexT çš„ <a href="https://github.com/iissnan/hexo-theme-next/issues/390">issue</a> ä¸Šæœ‰æ¨èä½¿ç”¨ <a href="https://github.com/sergiolepore/hexo-tag-emojis">hexo-tag-emojis</a> è¿™ä¸ªæ’ä»¶æ¥æ”¯æŒ emoji è¡¨æƒ…ï¼Œä½†å¯æƒœçš„æ˜¯è¿™ä¸ªæ’ä»¶å·²ç»ä¸å†ç»´æŠ¤ï¼Œå·²ç»ä¸æ”¯æŒ <code>Hexo v3+</code> äº†ã€‚è¿˜å¥½åœ¨ Hexo çš„ <a href="https://hexo.io/plugins/">plugins</a> é¡µï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†å¦å¤–ä¸€ä¸ª emoji æ’ä»¶ <a href="https://github.com/crimx/hexo-filter-github-emojis">hexo-filter-github-emojis</a>ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬å°±æ¥å®ç° Hexo NexT å¯¹ emoji çš„æ”¯æŒã€‚</p>
<h2 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h2><div class="note info"><p>Hexo 3.3.9<br>NexT 5.1.2</p>
</div>

<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm install hexo-filter-github-emojis --save</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>æ‰“å¼€ <code>ç«™ç‚¹é…ç½®æ–‡ä»¶</code>ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">githubEmojis:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">className:</span> <span class="string">github-emoji</span></span><br><span class="line">  <span class="attr">unicode:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">styles:</span></span><br><span class="line">  <span class="attr">localEmojis:</span></span><br></pre></td></tr></table></figure>

<p>å…·ä½“çš„æ¯ä¸ªé…ç½®é¡¹å«ä¹‰å¯ä»¥çœ‹æ’ä»¶çš„<a href="https://github.com/crimx/hexo-filter-github-emojis">æ–‡æ¡£</a>ã€‚</p>
<span id="more"></span>

<h2 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h2><ol>
<li>åœ¨ <a href="https://www.webpagefx.com/tools/emoji-cheat-sheet/">Emoji Cheat Sheet</a> ä¸­æ‰¾åˆ°ä½ æƒ³è¦çš„è¡¨æƒ…ï¼Œç„¶åç‚¹å‡»å³å¯å¤åˆ¶ã€‚</li>
<li>ä½¿ç”¨æ–¹æ³•å’Œ GitHub ä¸€æ ·ï¼Œæ¯”å¦‚ä½ æƒ³å‘ä¸€ä¸ªç¬‘è„¸ ğŸ˜Š ç›´æ¥è¾“å…¥ç¬‘è„¸å¯¹åº”çš„ emoji ç¼–ç  <code>:smileï¼š</code> å°±å¯ä»¥ã€‚</li>
<li>é»˜è®¤é…ç½®ä¸‹æ˜¯ä½¿ç”¨å›¾ç‰‡è¡¨æƒ…ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ Unicode è¡¨æƒ…ï¼Œå¯ä»¥å°†ä¸Šé¢é…ç½®ä¸­çš„ <code>unicode</code> è®¾ç½®ä¸º <code>true</code>ï¼Œå°±ä¼šæ¸²æŸ“å¦‚ ğŸ˜„ ğŸ˜ ğŸ˜Œ</li>
</ol>
<h2 id="å…¼å®¹-Hexo-NexT-å¤„ç†"><a href="#å…¼å®¹-Hexo-NexT-å¤„ç†" class="headerlink" title="å…¼å®¹ Hexo NexT å¤„ç†"></a>å…¼å®¹ Hexo NexT å¤„ç†</h2><p>hexo NexT ä½¿ç”¨ <code>FancyBox</code> è¿™ä¸ªå›¾ç‰‡æ’ä»¶ï¼Œåœ¨ <code>themes/next/source/js/src/utils.js</code> ä¸­ï¼š</p>
<p><img src="/images/Hexo/emojis-for-hexo-next/bd9f206bgy1fjlw5misekj21320sq77a.png"></p>
<p>çœ‹çº¢æ¡†ä¸­çš„ä»£ç å¯ä»¥çŸ¥é“åœ¨æ–‡ç« ä¸­ <code>img</code> æ ‡ç­¾æ²¡æœ‰è¢« <code>a</code> æ ‡ç­¾åŒ…å«æ—¶ï¼Œä¼šåŠ ä¸Š <code>a</code> æ ‡ç­¾ï¼Œæ‰€ä»¥åœ¨æ¸²æŸ“ emoji è¡¨æƒ…æ—¶ï¼Œä¼šè¢«è‡ªåŠ¨åŠ ä¸Š <code>a</code> æ ‡ç­¾ã€‚</p>
<p><img src="/images/Hexo/emojis-for-hexo-next/bd9f206bgy1fjlwogzvn4j21m00p746w.png"></p>
<p>è¿™æ ·å°±å¯¼è‡´æ¸²æŸ“é”™è¯¯ã€‚æˆ‘ä»¬ä¿®æ”¹ <code>themes/next/layout/_partials/head.swig</code>ï¼š</p>
<figure class="highlight twig"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">id</span>=<span class="string">&quot;hexo.configurations&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">var</span> <span class="title class_">NexT</span> = <span class="variable language_">window</span>.<span class="property">NexT</span> || &#123;&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">var</span> <span class="variable constant_">CONFIG</span> = &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">root</span>: <span class="string">&#x27;</span></span></span><span class="template-variable">&#123;&#123; theme.root &#125;&#125;</span><span class="language-xml">&#x27;,</span></span><br><span class="line"><span class="language-xml">    scheme: &#x27;</span><span class="template-variable">&#123;&#123; theme.scheme &#125;&#125;</span><span class="language-xml">&#x27;,</span></span><br><span class="line"><span class="language-xml">    sidebar: </span><span class="template-variable">&#123;&#123; theme.sidebar | json_encode &#125;&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">    fancybox: </span><span class="template-variable">&#123;&#123; theme.fancybox &#125;&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">    tabs: </span><span class="template-variable">&#123;&#123; theme.tabs.enable &#125;&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">    motion: </span><span class="template-variable">&#123;&#123; theme.use_motion &#125;&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">    duoshuo: &#123;</span></span><br><span class="line"><span class="language-xml">      userId: &#x27;</span><span class="template-variable">&#123;&#123; theme.duoshuo_info.user_id | default() &#125;&#125;</span><span class="language-xml">&#x27;,</span></span><br><span class="line"><span class="language-xml">      author: &#x27;</span><span class="template-variable">&#123;&#123; theme.duoshuo_info.admin_nickname | default(__(<span class="string">&#x27;author&#x27;</span>))&#125;&#125;</span><span class="language-xml">&#x27;</span></span><br><span class="line"><span class="language-xml">    &#125;,</span></span><br><span class="line"><span class="language-xml">    algolia: &#123;</span></span><br><span class="line"><span class="language-xml">      applicationID: &#x27;</span><span class="template-variable">&#123;&#123; theme.algolia.applicationID &#125;&#125;</span><span class="language-xml">&#x27;,</span></span><br><span class="line"><span class="language-xml">      apiKey: &#x27;</span><span class="template-variable">&#123;&#123; theme.algolia.apiKey &#125;&#125;</span><span class="language-xml">&#x27;,</span></span><br><span class="line"><span class="language-xml">      indexName: &#x27;</span><span class="template-variable">&#123;&#123; theme.algolia.indexName &#125;&#125;</span><span class="language-xml">&#x27;,</span></span><br><span class="line"><span class="language-xml">      hits: </span><span class="template-variable">&#123;&#123; theme.algolia_search.hits | json_encode &#125;&#125;</span><span class="language-xml">,</span></span><br><span class="line"><span class="language-xml">      labels: </span><span class="template-variable">&#123;&#123; theme.algolia_search.labels | json_encode &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    &#125;,</span></span><br><span class="line"><span class="language-xml">    </span><span class="comment">&#123;# â†“ åœ¨è¿™é‡Œä¿®æ”¹ï¼Œå…¶ä»–æœªåŠ¨ â†“ #&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="comment">&#123;# æ·»åŠ  emojis å‚æ•° #&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    emojis: &#123;</span></span><br><span class="line"><span class="language-xml">      className: &#x27;</span><span class="template-variable">&#123;&#123; config.githubEmojis.className | default(<span class="string">&#x27;github-emoji&#x27;</span>) &#125;&#125;</span><span class="language-xml">&#x27;</span></span><br><span class="line"><span class="language-xml">    &#125;</span></span><br><span class="line"><span class="language-xml">  &#125;;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ <code>themes/next/source/js/src/utils.js</code>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ³¨æ„çœ‹ CONFIG.emojis.className é‚£ä¸€è¡Œï¼Œå…¶ä»–æœªåŠ¨</span></span><br><span class="line">$(<span class="string">&#x27;.content img&#x27;</span>)</span><br><span class="line">  .<span class="title function_">not</span>(<span class="string">&#x27;[hidden]&#x27;</span>)</span><br><span class="line">  .<span class="title function_">not</span>(<span class="string">&#x27;.group-picture img, .post-gallery img, img.&#x27;</span> + <span class="variable constant_">CONFIG</span>.<span class="property">emojis</span>.<span class="property">className</span>)</span><br><span class="line">  .<span class="title function_">each</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> $image = $(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="keyword">var</span> imageTitle = $image.<span class="title function_">attr</span>(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> $imageWrapLink = $image.<span class="title function_">parent</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($imageWrapLink.<span class="title function_">size</span>() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> imageLink = ($image.<span class="title function_">attr</span>(<span class="string">&#x27;data-original&#x27;</span>)) ? <span class="variable language_">this</span>.<span class="title function_">getAttribute</span>(<span class="string">&#x27;data-original&#x27;</span>) : <span class="variable language_">this</span>.<span class="title function_">getAttribute</span>(<span class="string">&#x27;src&#x27;</span>);</span><br><span class="line">      $imageWrapLink = $image.<span class="title function_">wrap</span>(<span class="string">&#x27;&lt;a href=&quot;&#x27;</span> + imageLink + <span class="string">&#x27;&quot;&gt;&lt;/a&gt;&#x27;</span>).<span class="title function_">parent</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $imageWrapLink.<span class="title function_">addClass</span>(<span class="string">&#x27;fancybox fancybox.image&#x27;</span>);</span><br><span class="line">    $imageWrapLink.<span class="title function_">attr</span>(<span class="string">&#x27;rel&#x27;</span>, <span class="string">&#x27;group&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (imageTitle) &#123;</span><br><span class="line">      $imageWrapLink.<span class="title function_">append</span>(<span class="string">&#x27;&lt;p class=&quot;image-caption&quot;&gt;&#x27;</span> + imageTitle + <span class="string">&#x27;&lt;/p&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//make sure img title tag will show correctly in fancybox</span></span><br><span class="line">      $imageWrapLink.<span class="title function_">attr</span>(<span class="string">&#x27;title&#x27;</span>, imageTitle);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="string">&#x27;.fancybox&#x27;</span>).<span class="title function_">fancybox</span>(&#123;</span><br><span class="line">  <span class="attr">helpers</span>: &#123;</span><br><span class="line">    <span class="attr">overlay</span>: &#123;</span><br><span class="line">      <span class="attr">locked</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ä¿®æ”¹å®Œå°±å…¨éƒ¨æ˜¾ç¤ºæ­£å¸¸äº†ã€‚</p>
<h2 id="æœ€åä¸€ç‚¹ç‚¹æ”¹è¿›"><a href="#æœ€åä¸€ç‚¹ç‚¹æ”¹è¿›" class="headerlink" title="æœ€åä¸€ç‚¹ç‚¹æ”¹è¿›"></a>æœ€åä¸€ç‚¹ç‚¹æ”¹è¿›</h2><p>å›¾ç‰‡ emoji è¡¨æƒ…çš„é«˜å®½éƒ½æ˜¯å›ºå®šè®¾å®šä¸º 20ï¼Œçœ‹èµ·æ¥å¤ªå°äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸‹æ ·å¼ï¼Œä½†æ˜¯è‡ªå®šä¹‰æ ·å¼å‡ºç°ä¸€ä¸ªé—®é¢˜ã€‚</p>
<p>åœ¨ <code>ç«™ç‚¹é…ç½®æ–‡ä»¶</code> ä¸­ï¼Œæˆ‘ä»¬é…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">githubEmojis:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">className:</span> <span class="string">github-emoji</span></span><br><span class="line">  <span class="attr">unicode:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">styles:</span></span><br><span class="line">  <span class="attr">localEmojis:</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çœ‹åˆ° <code>className</code> çš„å€¼ä¸º <code>github-emoji</code>ï¼Œè¿™ä¸ªå€¼æ˜¯åœ¨æ¸²æŸ“ emoji å›¾ç‰‡è¡¨æƒ…æ—¶ï¼Œ<code>img</code> æ ‡ç­¾ä¸Šçš„ <code>class</code>ï¼Œå¦‚ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;github-emoji&quot;</span> <span class="attr">title</span>=<span class="string">&quot;smile&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;smile&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://assets-cdn.github.com/images/icons/emoji/unicode/1f604.png?v7&quot;</span> <span class="attr">height</span>=<span class="string">&quot;20&quot;</span> <span class="attr">width</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå€¼æ˜¯å¯ä»¥åŠ¨æ€é…ç½®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å†™æ ·å¼çš„å°±å¿…é¡»åŠ¨æ€çš„å»è·å– <code>className</code> çš„å€¼ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦åœ¨ <code>themes/next/source/css/_variables/base.styl</code> å®šä¹‰ä¸€ä¸ªå˜é‡å»è·å– <code>className</code> çš„å€¼ï¼Œ<code>*.styl</code> æ–‡ä»¶æ˜¯ä½¿ç”¨ <a href="https://github.com/hexojs/hexo-renderer-stylus">hexo-renderer-stylus</a> æ’ä»¶ï¼Œè¿™ä¸ªæ’ä»¶åªæœ‰ <code>hexo-config</code> è¿™ä¸ªæ–¹æ³•å»è·å– <code>ä¸»é¢˜é…ç½®æ–‡ä»¶</code> ä¸­çš„å€¼ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ <code>className</code> æ˜¯å†™åœ¨ <code>ç«™ç‚¹é…ç½®æ–‡ä»¶</code> ä¸­ï¼Œæ˜¯æ²¡åŠæ³•è·å–åˆ°çš„ã€‚</p>
<p>è¿˜å¥½åœ¨è¿™ä¸ª <a href="https://github.com/hexojs/hexo-renderer-stylus/issues/11">issue</a> æœ‰è¯´åˆ°ä¸€ä¸ªè§£å†³åŠæ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›¿æ¢ <code>hexo-renderer-stylus</code> æ’ä»¶ ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm un hexo-renderer-stylus --save</span><br><span class="line">$ npm i hexo-renderer-stylus-plus --save</span><br></pre></td></tr></table></figure>

<p>å°±å¯ä»¥åœ¨ <code>themes/next/source/css/_variables/base.styl</code> ä¸­ä½¿ç”¨ <code>hexo-site-config</code> æ–¹æ³•è·å– <code>ç«™ç‚¹é…ç½®æ–‡ä»¶</code> ä¸­çš„å€¼ï¼Œæˆ‘ä»¬æ·»åŠ ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Github emojis class name</span></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">get_emoji_class</span><span class="params">()</span></span> &#123;</span><br><span class="line">  emoji_class = <span class="built_in">hexo-site-config</span>(<span class="string">&#x27;githubEmojis.className&#x27;</span>)</span><br><span class="line">  return emoji_class ? emoji_class : <span class="string">&#x27;github-emoji&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$github</span>-emojis-class-name   = <span class="built_in">get_emoji_class</span>()</span><br></pre></td></tr></table></figure>

<p>æœ€ååœ¨è‡ªå®šä¹‰æ ·å¼æ–‡ä»¶ <code>themes/next/source/css/_custom/custom.styl</code> ä¸­æ·»åŠ ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">img</span>.&#123;<span class="variable">$github</span>-emojis-class-name&#125; &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1.7em</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1.7em</span>;</span><br><span class="line">  <span class="attribute">vertical-align</span>: -<span class="number">0.4em</span>;</span><br><span class="line">  <span class="attribute">border</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ä¸€åˆ‡å®Œç¾äº†ã€‚Enjoy itï¼âœ¨</p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>NexT</tag>
        <tag>emoji</tag>
      </tags>
  </entry>
  <entry>
    <title>å°†ç©ºç›®å½•æ·»åŠ è‡³ Git ç‰ˆæœ¬åº“</title>
    <url>/Git/add-an-empty-directory-to-a-git-repository/</url>
    <content><![CDATA[<p>git æ²¡æœ‰è·Ÿè¸ªç©ºç›®å½•ï¼Œæ‰€ä»¥éœ€è¦è·Ÿè¸ªé‚£ä¹ˆå°±éœ€è¦æ·»åŠ æ–‡ä»¶ï¼Œå°±æ˜¯åœ¨ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª <code>.gitkeep</code> æ–‡ä»¶ï¼ˆæ–‡ä»¶åå…¶å®éšæ„ï¼Œä¸è¿‡å¸¸è§çš„æ˜¯ <code>.gitkeep</code> å’Œ <code>.keep</code>ï¼‰æ–¹æ³•å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">find . -type d -empty -exec touch &#123;&#125;/.gitkeep \;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Goè¯­è¨€ä¸­ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æŒ‡é’ˆ</title>
    <url>/GO/Go%E8%AF%AD%E8%A8%80%E4%B8%AD%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E4%BD%BF%E7%94%A8%E6%8C%87%E9%92%88/</url>
    <content><![CDATA[<p><strong>è¯´æ˜ï¼š</strong>ç†è§£æœ¬æ–‡çš„å‰ææ˜¯ä½ å¯¹Goè¯­è¨€å·²æœ‰ä¸€å®šçš„åŸºç¡€äº†è§£ã€‚</p>
<p><strong>ä»€ä¹ˆæ˜¯æŒ‡é’ˆï¼š</strong>å³ä¸€ä¸ªæŒ‡é’ˆå˜é‡æŒ‡å‘ä¸€ä¸ªå€¼çš„å†…å­˜åœ°å€ã€‚</p>
<p><strong>ä½¿ç”¨å€¼ç±»å‹å’ŒæŒ‡é’ˆç±»å‹çš„åŒºåˆ«</strong><br>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªè®¡ç®—é¢ç§¯çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Rect <span class="keyword">struct</span> &#123;                               <span class="comment">//å®šä¹‰ä¸€ä¸ªç»“æ„ä½“</span></span><br><span class="line">    width  <span class="type">float64</span></span><br><span class="line">    length <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rect Rect)</span></span> area() <span class="type">float64</span> &#123;               <span class="comment">//å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼ŒæŒ‰å€¼ä¼ é€’</span></span><br><span class="line">	<span class="keyword">return</span> rect.width * rect.length</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rect *Rect)</span></span> area1() <span class="type">float64</span> &#123;            <span class="comment">//å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼ŒæŒ‰æŒ‡é’ˆä¼ é€’</span></span><br><span class="line">    rect.width *= <span class="number">2</span></span><br><span class="line">    rect.length *= <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> rect.width * rect.length</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> rect = <span class="built_in">new</span>(Rect)     <span class="comment">//ä½¿ç”¨newå‡½æ•°åˆ›å»ºä¸€ä¸ªç»“æ„ä½“æŒ‡é’ˆrectï¼Œä¹Ÿå°±æ˜¯è¯´rectçš„ç±»å‹æ˜¯*Rect</span></span><br><span class="line">    rect.width = <span class="number">100</span></span><br><span class="line">    rect.length = <span class="number">200</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Width:&quot;</span>, rect.width, <span class="string">&quot;Length:&quot;</span>, rect.length,<span class="string">&quot;Area:&quot;</span>, rect.area())  <span class="comment">//é€šè¿‡ç»“æ„ä½“æŒ‡é’ˆç±»å‹çš„å˜é‡è°ƒç”¨area()æ–¹æ³•</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Width:&quot;</span>, rect.width, <span class="string">&quot;Length:&quot;</span>, rect.length,<span class="string">&quot;Area:&quot;</span>, rect.area1())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨Goè¯­è¨€ä¸­ï¼Œé»˜è®¤æ˜¯æŒ‰å€¼ä¼ é€’ã€‚å½“ä¸€ä¸ªå˜é‡å½“ä½œå‚æ•°ä¼ é€’çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå˜é‡çš„å‰¯æœ¬ï¼Œç„¶åä¼ é€’ç»™å‡½æ•°æˆ–è€…æ–¹æ³•ï¼Œä½ å¯ä»¥çœ‹åˆ°è¿™ä¸ªå‰¯æœ¬çš„åœ°å€å’Œå˜é‡çš„åœ°å€æ˜¯ä¸ä¸€æ ·çš„ã€‚å½“å˜é‡å½“åšæŒ‡é’ˆè¢«ä¼ é€’çš„æ—¶å€™ï¼Œä¸€ä¸ªæ–°çš„æŒ‡é’ˆè¢«åˆ›å»ºï¼Œå®ƒæŒ‡å‘å˜é‡åŒæ ·çš„å†…å­˜åœ°å€ï¼Œæ‰€ä»¥ä½ å¯ä»¥å°†è¿™ä¸ªæŒ‡é’ˆçœ‹æˆåŸå§‹å˜é‡æŒ‡é’ˆçš„å‰¯æœ¬ã€‚</p>
<span id="more"></span>

<p><strong>æ•…æ­¤</strong><br>1.æ˜¯å¦ä½¿ç”¨ç»“æ„ä½“æŒ‡é’ˆï¼Œå–å†³äºæ˜¯å¦è¦åœ¨å‡½æ•°å†…éƒ¨æ”¹å˜ä¼ é€’è¿›æ¥çš„å‚æ•°çš„å€¼ã€‚å¦‚æœä½ çš„structè¶³å¤Ÿå¤§ï¼Œä½¿ç”¨æŒ‡é’ˆå¯ä»¥åŠ å¿«æ•ˆç‡ã€‚å¦‚æœä¸ä½¿ç”¨æŒ‡é’ˆï¼Œåœ¨å‡½æ•°å†…éƒ¨åˆ™æ— æ³•ä¿®æ”¹structä¸­çš„å€¼ã€‚<br>2.ç»“æ„ä½“èµ‹å€¼é»˜è®¤æ˜¯æŒ‰å€¼ä¼ é€’ï¼Œä½ è¦æ”¹å˜åŸæ¥çš„é‚£ä¸ªå€¼ï¼Œè¦ä½¿ç”¨æŒ‡é’ˆï¼ˆå³å¦‚æœä½ è¦ä¿®æ”¹å¯¹è±¡æœ¬èº«ï¼Œé‚£å°±è¦ä¼ æŒ‡é’ˆï¼Œå¦åˆ™ä¿®æ”¹çš„æ˜¯å‰¯æœ¬ï¼‰ã€‚</p>
<p>å†æ¥æ¯”è¾ƒä¸‹ä½¿ç”¨æŒ‡é’ˆä¿®æ”¹åŸå§‹å˜é‡çš„å€¼ã€‚ä»£ç ç¤ºä¾‹</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span>(</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123; </span><br><span class="line">    i := <span class="number">1</span>      <span class="comment">// içš„ç±»å‹æ˜¯intå‹,å€¼ä¸º1</span></span><br><span class="line">    <span class="keyword">var</span> p *<span class="type">int</span>     <span class="comment">// p çš„ç±»å‹æ˜¯intå‹çš„æŒ‡é’ˆ</span></span><br><span class="line">    p=&amp;i         <span class="comment">// p çš„å€¼ä¸ºiçš„å†…å­˜åœ°å€</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;i=%d;p=%d;*p=%d\n&quot;</span>,i,p,*p)</span><br><span class="line"> </span><br><span class="line">    *p=<span class="number">2</span>    <span class="comment">// *p çš„å€¼ä¸ºiå˜é‡åœ°å€çš„æŒ‡é’ˆ ï¼Œè¿™è¡Œä»£ç ä¹Ÿå°±ç­‰ä»·äº i := 2ï¼Œä½¿ç”¨æŒ‡é’ˆä¿®æ”¹å˜é‡æœ¬èº«</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;i=%d;p=%d;*p=%d\n&quot;</span>,i,p,*p)</span><br><span class="line"> </span><br><span class="line">    i := <span class="number">3</span>     <span class="comment">// éªŒè¯æƒ³æ³•</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;i=%d;p=%d;*p=%d\n&quot;</span>,i,p,*p)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šè¾“å‡ºç»“æœä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">i=1;p=824633802904;*p=1</span><br><span class="line">i=2;p=824633802904;*p=2</span><br><span class="line">i=3;p=824633802904;*p=3</span><br></pre></td></tr></table></figure>

<p><strong>å‘å‡½æ•°ä¼ é€’æŒ‡é’ˆå‚æ•°</strong><br>Go è¯­è¨€å…è®¸å‘å‡½æ•°ä¼ é€’æŒ‡é’ˆï¼Œåªéœ€è¦åœ¨å‡½æ•°å®šä¹‰çš„å‚æ•°ä¸Šè®¾ç½®ä¸ºæŒ‡é’ˆç±»å‹å³å¯ã€‚ä»¥ä¸‹å®ä¾‹æ¼”ç¤ºäº†å¦‚ä½•å‘å‡½æ•°ä¼ é€’æŒ‡é’ˆï¼Œå¹¶åœ¨å‡½æ•°è°ƒç”¨åä¿®æ”¹å‡½æ•°å†…çš„å€¼ï¼Œï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">/* å®šä¹‰å±€éƒ¨å˜é‡ */</span></span><br><span class="line">   <span class="keyword">var</span> a <span class="type">int</span> = <span class="number">100</span></span><br><span class="line">   <span class="keyword">var</span> b <span class="type">int</span>= <span class="number">200</span></span><br><span class="line"></span><br><span class="line">   fmt.Printf(<span class="string">&quot;äº¤æ¢å‰ a çš„å€¼ : %d\n&quot;</span>, a )</span><br><span class="line">   fmt.Printf(<span class="string">&quot;äº¤æ¢å‰ b çš„å€¼ : %d\n&quot;</span>, b )</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* è°ƒç”¨å‡½æ•°ç”¨äºäº¤æ¢å€¼</span></span><br><span class="line"><span class="comment">   * &amp;a æŒ‡å‘ a å˜é‡çš„åœ°å€</span></span><br><span class="line"><span class="comment">   * &amp;b æŒ‡å‘ b å˜é‡çš„åœ°å€</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">   swap(&amp;a, &amp;b);</span><br><span class="line"></span><br><span class="line">   fmt.Printf(<span class="string">&quot;äº¤æ¢å a çš„å€¼ : %d\n&quot;</span>, a )</span><br><span class="line">   fmt.Printf(<span class="string">&quot;äº¤æ¢å b çš„å€¼ : %d\n&quot;</span>, b )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap</span><span class="params">(x *<span class="type">int</span>, y *<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> temp <span class="type">int</span></span><br><span class="line">   temp = *x    <span class="comment">/* ä¿å­˜ x åœ°å€çš„å€¼ */</span></span><br><span class="line">   *x = *y      <span class="comment">/* å°† y èµ‹å€¼ç»™ x */</span></span><br><span class="line">   *y = temp    <span class="comment">/* å°† temp èµ‹å€¼ç»™ y */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">äº¤æ¢å‰ a çš„å€¼ : 100</span><br><span class="line">äº¤æ¢å‰ b çš„å€¼ : 200</span><br><span class="line">äº¤æ¢å a çš„å€¼ : 200</span><br><span class="line">äº¤æ¢å b çš„å€¼ : 100</span><br></pre></td></tr></table></figure>

<p><strong>goä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨æŒ‡é’ˆ</strong></p>
<ul>
<li>æ¨èåœ¨æ–¹æ³•ä¸Šä½¿ç”¨æŒ‡é’ˆï¼ˆå‰ææ˜¯è¿™ä¸ªç±»å‹ä¸æ˜¯ mapã€slice ç­‰å¼•ç”¨ç±»å‹ï¼‰</li>
<li>å½“ç»“æ„ä½“è¾ƒå¤§çš„æ—¶å€™ä½¿ç”¨æŒ‡é’ˆä¼šæ›´é«˜æ•ˆï¼Œå¯ä»¥é¿å…å†…å­˜æ‹·è´ï¼Œâ€œç»“æ„è¾ƒå¤§â€ åˆ°åº•å¤šå¤§æ‰ç®—å¤§å¯èƒ½éœ€è¦è‡ªå·±æˆ–å›¢é˜Ÿè¡¡é‡ï¼Œå¦‚è¶…è¿‡ 5 ä¸ªå­—æ®µæˆ–è€…æ ¹æ®ç»“æ„ä½“å†…å­˜å ç”¨æ¥è®¡ç®—</li>
<li>å¦‚æœè¦ä¿®æ”¹ç»“æ„ä½“å†…éƒ¨çš„æ•°æ®æˆ–çŠ¶æ€å¿…é¡»ä½¿ç”¨æŒ‡é’ˆ</li>
<li>å¦‚æœæ–¹æ³•çš„receiveræ˜¯mapã€slice ã€channelç­‰å¼•ç”¨ç±»å‹ä¸è¦ä½¿ç”¨æŒ‡é’ˆ</li>
<li>å°æ•°æ®ç±»å‹å¦‚ boolã€int ç­‰æ²¡å¿…è¦ä½¿ç”¨æŒ‡é’ˆä¼ é€’</li>
<li>å¦‚æœè¯¥å‡½æ•°ä¼šä¿®æ”¹receiveræˆ–å˜é‡ç­‰ï¼Œä½¿ç”¨æŒ‡é’ˆ</li>
</ul>
]]></content>
      <categories>
        <category>GO</category>
      </categories>
      <tags>
        <tag>GO</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¦æ­¢ Git è‡ªåŠ¨ä¿å­˜è´¦å·å¯†ç </title>
    <url>/Git/donot-make-git-remember-my-credentials/</url>
    <content><![CDATA[<h2 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h2><div class="note info"><p>git version 2.14.1.windows.1</p>
</div>

<p>é»˜è®¤æƒ…å†µä¸‹ git ä½¿ç”¨ https åœ¨è¾“å…¥è´¦å·å¯†ç åä¼šä¿å­˜åˆ° windows å‡­æ®ä¸‹ã€‚</p>
<h2 id="æŸ¥çœ‹é…ç½®ä¿¡æ¯"><a href="#æŸ¥çœ‹é…ç½®ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹é…ç½®ä¿¡æ¯"></a>æŸ¥çœ‹é…ç½®ä¿¡æ¯</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git config --global -l</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">core.symlinks=false</span><br><span class="line">core.autocrlf=input</span><br><span class="line">core.fscache=true</span><br><span class="line">color.diff=auto</span><br><span class="line">color.status=auto</span><br><span class="line">color.branch=auto</span><br><span class="line">color.interactive=true</span><br><span class="line">help.format=html</span><br><span class="line">rebase.autosquash=true</span><br><span class="line">http.sslcainfo=D:/Program Files (x86)/Git/mingw64/ssl/certs/ca-bundle.crt</span><br><span class="line">diff.astextplain.textconv=astextplain</span><br><span class="line">filter.lfs.clean=git-lfs clean -- %f</span><br><span class="line">filter.lfs.smudge=git-lfs smudge -- %f</span><br><span class="line">filter.lfs.required=true</span><br><span class="line">filter.lfs.process=git-lfs filter-process</span><br><span class="line">credential.helper=manager  // é‡ç‚¹çœ‹è¿™ä¸ª</span><br></pre></td></tr></table></figure>

<h2 id="ç¦æ­¢è‡ªåŠ¨ä¿å­˜å¯†ç "><a href="#ç¦æ­¢è‡ªåŠ¨ä¿å­˜å¯†ç " class="headerlink" title="ç¦æ­¢è‡ªåŠ¨ä¿å­˜å¯†ç "></a>ç¦æ­¢è‡ªåŠ¨ä¿å­˜å¯†ç </h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git config --global --<span class="built_in">unset</span> credential.helper</span><br><span class="line"></span><br><span class="line">æˆ–</span><br><span class="line"></span><br><span class="line">$ git config --system --<span class="built_in">unset</span> credential.helper</span><br></pre></td></tr></table></figure>

<h2 id="æ¢å¤è‡ªåŠ¨ä¿å­˜å¯†ç "><a href="#æ¢å¤è‡ªåŠ¨ä¿å­˜å¯†ç " class="headerlink" title="æ¢å¤è‡ªåŠ¨ä¿å­˜å¯†ç "></a>æ¢å¤è‡ªåŠ¨ä¿å­˜å¯†ç </h2><p>åˆ é™¤æ‰ä¿å­˜å¯†ç çš„é…ç½®å°±è¡Œã€‚å¦‚æœéœ€è¦ä¿å­˜çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git config --global credential.helper manager</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>å®å¡”Linuxé¢æ¿å°å†…å­˜æœåŠ¡å™¨ç¼–è¯‘å®‰è£… MySQL 8.0</title>
    <url>/Linux/bt-panel-install-mysql%208.0-on-low-memory-server/</url>
    <content><![CDATA[<div class="note primary"><p>å¦‚æœ 1G å†…å­˜è¦è£… MySQL 5.7ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿæ˜¯é€‚ç”¨çš„ã€‚</p>
</div>

<div class="note info"><p>å®å¡” 6.9.8</p>
</div>

<p>å®å¡”é¢æ¿åœ¨ç¼–è¯‘å®‰è£… MySQL 8.0 æ—¶ï¼Œè¦æ±‚ 4ä¸ªæ ¸å¿ƒçš„ CPUï¼Œ8G å†…å­˜ï¼Œå®åœ¨æ˜¯å¤ªé«˜äº†ï¼Œå°ç«™é•¿çš„æœåŠ¡å™¨ä¸€èˆ¬éƒ½ä¸ä¼šæœ‰å¦‚æ­¤é«˜çš„é…ç½®ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ MySQL 8.0ï¼Œå¯ä»¥é€‰æ‹©æé€Ÿå®‰è£…ï¼Œæˆ–è€…ï¼Œå¦‚æœä¸€å®šè¦è‡ªå·±ç¼–è¯‘çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œæ¥è·³è¿‡é…ç½®æ£€æµ‹ã€‚ä¸è¿‡ï¼ŒMySQL ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ 5G ä»¥ä¸Šçš„å†…å­˜ï¼Œä»¥åŠ 9G ä»¥ä¸Šçš„æ•°æ®ç›˜ç©ºé—´ã€‚å¦‚æœæˆ‘ä»¬çš„å†…å­˜å®åœ¨ä¸å¤Ÿï¼Œå¯ä»¥åˆ›å»º swap è™šæ‹Ÿå†…å­˜ã€‚</p>
<p>åœ¨å®å¡”é¢æ¿é‡Œçš„ <strong>Linux å·¥å…·ç®±</strong>(å¦‚æœæ²¡æœ‰å¯ä»¥å»è½¯ä»¶å•†åº—é‡Œé¢å®‰è£…) ä¿®æ”¹ Swap&#x2F;è™šæ‹Ÿå†…å­˜ï¼Œè¾“å…¥ 0ï¼Œç„¶åæ‰‹åŠ¨è®¾ç½® swap åˆ°ç³»ç»Ÿç›˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fallocate -l 4G /swap</span><br><span class="line"><span class="built_in">chown</span> root:root /swap </span><br><span class="line"><span class="built_in">chmod</span> 0600 /swap</span><br><span class="line">mkswap /swap</span><br><span class="line">swapon /swap</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;/swap    swap    swap    defaults    0 0&#x27;</span> &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ä¸€ä¸‹ swap æ˜¯å¦å¼€å¯æˆåŠŸï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">swapon -s</span><br><span class="line"></span><br><span class="line">Filename                                Type            Size    Used    Priority</span><br><span class="line">/swap                                   file    4194300 9480    -2</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å†…å­˜æœ‰ 5933Mï¼Œåº”è¯¥å¤Ÿäº†ï¼Œæˆ‘ä»¬è¿˜è¦æ£€æŸ¥ä¸€ä¸‹ï¼Œ&#x2F;www æ‰€åœ¨çš„ç£ç›˜å¤Ÿä¸å¤Ÿï¼Œå»ºè®®å‰©ä½™ç©ºé—´ä¸å°äº 10Gã€‚å¦‚æœä¸å¤Ÿï¼ŒæŠŠä¸éœ€è¦çš„æ–‡ä»¶åˆ ä¸€ä¸‹ï¼Œæˆ–è€…æ‰©å®¹ç£ç›˜ï¼Œè¿™é‡Œä¸èµ˜è¿°ã€‚</p>
<span id="more"></span>

<p>ç°åœ¨ç£ç›˜ä¹Ÿå¤Ÿäº†ï¼Œå†æ£€æŸ¥ä¸€ä¸‹ä½ çš„ä¸´æ—¶æ–‡ä»¶å¤¹ &#x2F;tmpï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªè·¯å¾„åœ¨ç³»ç»Ÿç›˜ï¼Œå…±äº«ä½ ç³»ç»Ÿç›˜çš„ç©ºé—´ã€‚ä¸è¿‡ï¼ŒæŸäº›æœåŠ¡å™¨çš„ &#x2F;tmp æ˜¯å•ç‹¬æŒ‚è½½çš„ï¼Œç©ºé—´ä¹Ÿéå¸¸å°ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œè¦æŠŠå®ƒä¹Ÿå¢å¤§ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ ·è°ƒæ•´åˆ° 10Gã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;tmpfs   /tmp  tmpfs   defaults,size=10G    0 0&#x27;</span> &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure>

<p>é‡å¯ç³»ç»Ÿï¼Œæ£€æŸ¥ä¸€ä¸‹å„è·¯å¾„çš„å¤§å°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">df</span> -h</span><br><span class="line"></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/vda1        20G  7.2G   12G  39% /</span><br><span class="line">devtmpfs        909M     0  909M   0% /dev</span><br><span class="line">tmpfs           919M  5.9M  914M   1% /dev/shm</span><br><span class="line">tmpfs           919M  584K  919M   1% /run</span><br><span class="line">tmpfs           919M     0  919M   0% /sys/fs/cgroup</span><br><span class="line">/dev/vdb1        20G  6.3G   13G  34% /www</span><br><span class="line">tmpfs            10G  336K   10G   1% /tmp</span><br><span class="line">tmpfs           184M     0  184M   0% /run/user/0</span><br></pre></td></tr></table></figure>

<p>è¿™å›è‚¯å®šå¤Ÿç”¨äº†ã€‚</p>
<p>ç”±äºæœåŠ¡å™¨é…ç½®è¾ƒä½ï¼Œç¼–è¯‘è¿‡ç¨‹è€—æ—¶å¯èƒ½è¶…è¿‡ä¸¤å°æ—¶ï¼Œä¸ºäº†é˜²æ­¢æ„å¤–æ–­ç½‘åœæ­¢ç¼–è¯‘ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ screenï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install screen -y &amp;&amp; screen -S mysql</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨çª—å£ç©ºç™½äº†ï¼Œå…¶å®è¿™æ˜¯ä¸€ä¸ªæ–°çš„çª—å£ã€‚</p>
<p>è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç¼–è¯‘å®‰è£… MySQL 8.0ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /www/server/panel/install</span><br><span class="line">bash mysql.sh install 8.0</span><br></pre></td></tr></table></figure>

<p>æ…¢æ…¢ç­‰ï¼Œå®åœ¨ç­‰ä¸ä¸‹å»çš„æ—¶å€™ï¼Œæ–°å»ºä¸€ä¸ªç»ˆç«¯ä¼šè¯ï¼Œè¾“å…¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">screen -d mysql</span><br></pre></td></tr></table></figure>

<p>è®©å®ƒè‡ªå·±æ…¢æ…¢è£…ï¼Œå¤§æ¦‚ä¸¤å°æ—¶åï¼Œè¾“å…¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">screen -r mysql</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ° doneï¼Œå°±æˆåŠŸäº†ã€‚</p>
<hr>
<p>ä»Šå¤©å‘ç°ä¸€ä¸ªåé—ç—‡ï¼Œå®å¡”æ•°æ®åº“å·¥å…·é¡µé¢ç©ºç™½ï¼Œä¸æ˜¾ç¤ºæ•°æ®è¡¨ã€‚è¯·å®å¡”å¼€å‘è€…æ’æŸ¥äº†ä¸€ä¸‹ï¼Œè¯´æ˜¯ mysqldb åº“å†…éƒ¨ç¼–ç è½¬æ¢å‡ºé”™ï¼Œäºæ˜¯å¼ºåˆ¶é‡è£… mysql-python</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install mysql-python --force</span><br></pre></td></tr></table></figure>

<p>ç»“æœé‡åˆ°æŠ¥é”™</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">_mysql.c:44:23: fatal error: my_config.h: No such file or directory</span><br></pre></td></tr></table></figure>

<p>æœç´¢å¾—åˆ°çš„è§£å†³æ–¹æ¡ˆæ˜¯å®‰è£… mysql-develï¼Œä¸è¿‡æˆ‘è¿™è¾¹ä¹‹å‰å·²ç»å®‰è£…è¿‡äº†ï¼Œäºæ˜¯å°è¯•é‡æ–°å®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum reinstall mysql-devel -y &amp;&amp; pip install mysql-python --force</span><br></pre></td></tr></table></figure>

<p>è¿™æ¬¡é¡ºåˆ©å®Œæˆã€‚</p>
<p>ä¸è¿‡ï¼Œé—®é¢˜ä»ç„¶æœªè§£å†³ã€‚æ— å¥ˆä¹‹ä¸‹ï¼Œæ‰“ç®—é‡å¯é¢æ¿è¯•è¯•ã€‚ä¸è¿‡è½¬å¿µä¸€æƒ³ï¼Œä¿®å¤é¢æ¿ä¹Ÿä¼šè‡ªåŠ¨é‡å¯ï¼Œé¡ºä¾¿è¿˜èƒ½ä¿®å¤å…¶ä»–é—®é¢˜ï¼Œæ¯”å¦‚å®å¡”æœ¬å‘¨ä¿®å¤çš„ä¸€äº›å·²çŸ¥é—®é¢˜ã€‚äºæ˜¯å°è¯•ä¿®å¤é¢æ¿ï¼Œä¿®å¤å®Œæˆåï¼Œé—®é¢˜è§£å†³ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>BT Panel</tag>
        <tag>mysql 8.0</tag>
      </tags>
  </entry>
  <entry>
    <title>æœ¬åšå®¢å½“å‰ä½¿ç”¨çš„æ’ä»¶æ€»ç»“</title>
    <url>/Hexo/plugins-used-in-this-blog/</url>
    <content><![CDATA[<h2 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h2><div class="note info"><p>Hexo 5.2.0<br>NexT 8.0.1</p>
</div>

<p>è¿™å‡ å¤©å°†åšå®¢ä¸»é¢˜ä» NexT-7.7.0 å‡çº§åˆ°äº† 8.0.1ï¼Œåœ¨é‡æ–°å®‰è£…æ’ä»¶çš„æ—¶å€™é¡ºä¾¿è®°å½•äº†æœ¬åšå®¢å½“å‰ä½¿ç”¨çš„æ’ä»¶</p>
<h2 id="é¼ æ ‡ç‚¹å‡»ç‰¹æ•ˆ"><a href="#é¼ æ ‡ç‚¹å‡»ç‰¹æ•ˆ" class="headerlink" title="é¼ æ ‡ç‚¹å‡»ç‰¹æ•ˆ"></a>é¼ æ ‡ç‚¹å‡»ç‰¹æ•ˆ</h2><p>ä¸‹é¢æ˜¯å››ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„é¼ æ ‡ç‚¹å‡»ç‰¹æ•ˆè„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬æ”¾ç½®åœ¨ <code>source/js/cursor/</code> ç›®å½•ä¸‹ï¼š</p>
<ul>
<li>ç¤¼èŠ±ç‰¹æ•ˆä»£ç ï¼š</li>
</ul>
<span id="more"></span>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">&#123; origin, speed, color, angle, context &#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">origin</span> = origin</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">position</span> = &#123; ...<span class="variable language_">this</span>.<span class="property">origin</span> &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">color</span> = color</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">speed</span> = speed</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">angle</span> = angle</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">context</span> = context</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">renderCount</span> = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">context</span>.<span class="property">fillStyle</span> = <span class="variable language_">this</span>.<span class="property">color</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">beginPath</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">arc</span>(<span class="variable language_">this</span>.<span class="property">position</span>.<span class="property">x</span>, <span class="variable language_">this</span>.<span class="property">position</span>.<span class="property">y</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">fill</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">move</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">position</span>.<span class="property">x</span> = (<span class="title class_">Math</span>.<span class="title function_">sin</span>(<span class="variable language_">this</span>.<span class="property">angle</span>) * <span class="variable language_">this</span>.<span class="property">speed</span>) + <span class="variable language_">this</span>.<span class="property">position</span>.<span class="property">x</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">position</span>.<span class="property">y</span> = (<span class="title class_">Math</span>.<span class="title function_">cos</span>(<span class="variable language_">this</span>.<span class="property">angle</span>) * <span class="variable language_">this</span>.<span class="property">speed</span>) + <span class="variable language_">this</span>.<span class="property">position</span>.<span class="property">y</span> + (<span class="variable language_">this</span>.<span class="property">renderCount</span> * <span class="number">0.3</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">renderCount</span>++</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Boom</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span> (&#123; origin, context, circleCount = <span class="number">16</span>, area &#125;) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">origin</span> = origin</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">context</span> = context</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">circleCount</span> = circleCount</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">area</span> = area</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">stop</span> = <span class="literal">false</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">circles</span> = []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">randomArray</span>(<span class="params">range</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> length = range.<span class="property">length</span></span><br><span class="line">    <span class="keyword">const</span> randomIndex = <span class="title class_">Math</span>.<span class="title function_">floor</span>(length * <span class="title class_">Math</span>.<span class="title function_">random</span>())</span><br><span class="line">    <span class="keyword">return</span> range[randomIndex]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">randomColor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> range = [<span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;#&#x27;</span> + <span class="variable language_">this</span>.<span class="title function_">randomArray</span>(range) + <span class="variable language_">this</span>.<span class="title function_">randomArray</span>(range) + <span class="variable language_">this</span>.<span class="title function_">randomArray</span>(range) + <span class="variable language_">this</span>.<span class="title function_">randomArray</span>(range) + <span class="variable language_">this</span>.<span class="title function_">randomArray</span>(range) + <span class="variable language_">this</span>.<span class="title function_">randomArray</span>(range)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">randomRange</span>(<span class="params">start, end</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (end - start) * <span class="title class_">Math</span>.<span class="title function_">random</span>() + start</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">circleCount</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> circle = <span class="keyword">new</span> <span class="title class_">Circle</span>(&#123;</span><br><span class="line">        <span class="attr">context</span>: <span class="variable language_">this</span>.<span class="property">context</span>,</span><br><span class="line">        <span class="attr">origin</span>: <span class="variable language_">this</span>.<span class="property">origin</span>,</span><br><span class="line">        <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="title function_">randomColor</span>(),</span><br><span class="line">        <span class="attr">angle</span>: <span class="variable language_">this</span>.<span class="title function_">randomRange</span>(<span class="title class_">Math</span>.<span class="property">PI</span> - <span class="number">1</span>, <span class="title class_">Math</span>.<span class="property">PI</span> + <span class="number">1</span>),</span><br><span class="line">        <span class="attr">speed</span>: <span class="variable language_">this</span>.<span class="title function_">randomRange</span>(<span class="number">1</span>, <span class="number">6</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">circles</span>.<span class="title function_">push</span>(circle)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">move</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">circles</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">circle, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (circle.<span class="property">position</span>.<span class="property">x</span> &gt; <span class="variable language_">this</span>.<span class="property">area</span>.<span class="property">width</span> || circle.<span class="property">position</span>.<span class="property">y</span> &gt; <span class="variable language_">this</span>.<span class="property">area</span>.<span class="property">height</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">circles</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      circle.<span class="title function_">move</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">circles</span>.<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">stop</span> = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">circles</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">circle</span> =&gt;</span> circle.<span class="title function_">draw</span>())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CursorSpecialEffects</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">computerCanvas</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">renderCanvas</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">computerContext</span> = <span class="variable language_">this</span>.<span class="property">computerCanvas</span>.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">renderContext</span> = <span class="variable language_">this</span>.<span class="property">renderCanvas</span>.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">globalWidth</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">globalHeight</span> = <span class="variable language_">window</span>.<span class="property">innerHeight</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">booms</span> = []</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">running</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">handleMouseDown</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> boom = <span class="keyword">new</span> <span class="title class_">Boom</span>(&#123;</span><br><span class="line">      <span class="attr">origin</span>: &#123; <span class="attr">x</span>: e.<span class="property">clientX</span>, <span class="attr">y</span>: e.<span class="property">clientY</span> &#125;,</span><br><span class="line">      <span class="attr">context</span>: <span class="variable language_">this</span>.<span class="property">computerContext</span>,</span><br><span class="line">      <span class="attr">area</span>: &#123;</span><br><span class="line">        <span class="attr">width</span>: <span class="variable language_">this</span>.<span class="property">globalWidth</span>,</span><br><span class="line">        <span class="attr">height</span>: <span class="variable language_">this</span>.<span class="property">globalHeight</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    boom.<span class="title function_">init</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">booms</span>.<span class="title function_">push</span>(boom)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">running</span> || <span class="variable language_">this</span>.<span class="title function_">run</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">handlePageHide</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">booms</span> = []</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">running</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> style = <span class="variable language_">this</span>.<span class="property">renderCanvas</span>.<span class="property">style</span></span><br><span class="line">    style.<span class="property">position</span> = <span class="string">&#x27;fixed&#x27;</span></span><br><span class="line">    style.<span class="property">top</span> = style.<span class="property">left</span> = <span class="number">0</span></span><br><span class="line">    style.<span class="property">zIndex</span> = <span class="string">&#x27;999999999999999999999999999999999999999999&#x27;</span></span><br><span class="line">    style.<span class="property">pointerEvents</span> = <span class="string">&#x27;none&#x27;</span></span><br><span class="line"></span><br><span class="line">    style.<span class="property">width</span> = <span class="variable language_">this</span>.<span class="property">renderCanvas</span>.<span class="property">width</span> = <span class="variable language_">this</span>.<span class="property">computerCanvas</span>.<span class="property">width</span> = <span class="variable language_">this</span>.<span class="property">globalWidth</span></span><br><span class="line">    style.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">renderCanvas</span>.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">computerCanvas</span>.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">globalHeight</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">append</span>(<span class="variable language_">this</span>.<span class="property">renderCanvas</span>)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousedown&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleMouseDown</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>))</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;pagehide&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handlePageHide</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">running</span> = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">booms</span>.<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">running</span> = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(<span class="variable language_">this</span>.<span class="property">run</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>))</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">computerContext</span>.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">globalWidth</span>, <span class="variable language_">this</span>.<span class="property">globalHeight</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">renderContext</span>.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">globalWidth</span>, <span class="variable language_">this</span>.<span class="property">globalHeight</span>)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">booms</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">boom, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (boom.<span class="property">stop</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">booms</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      boom.<span class="title function_">move</span>()</span><br><span class="line">      boom.<span class="title function_">draw</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">renderContext</span>.<span class="title function_">drawImage</span>(<span class="variable language_">this</span>.<span class="property">computerCanvas</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">globalWidth</span>, <span class="variable language_">this</span>.<span class="property">globalHeight</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cursorSpecialEffects = <span class="keyword">new</span> <span class="title class_">CursorSpecialEffects</span>()</span><br><span class="line">cursorSpecialEffects.<span class="title function_">init</span>()</span><br></pre></td></tr></table></figure>

<ul>
<li>çˆ†ç‚¸ç‰¹æ•ˆä»£ç ï¼š</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;<span class="keyword">function</span> <span class="title function_">updateCoords</span>(<span class="params">e</span>)&#123;pointerX=(e.<span class="property">clientX</span>||e.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">clientX</span>)-canvasEl.<span class="title function_">getBoundingClientRect</span>().<span class="property">left</span>,pointerY=e.<span class="property">clientY</span>||e.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">clientY</span>-canvasEl.<span class="title function_">getBoundingClientRect</span>().<span class="property">top</span>&#125;<span class="keyword">function</span> <span class="title function_">setParticuleDirection</span>(<span class="params">e</span>)&#123;<span class="keyword">var</span> t=anime.<span class="title function_">random</span>(<span class="number">0</span>,<span class="number">360</span>)*<span class="title class_">Math</span>.<span class="property">PI</span>/<span class="number">180</span>,a=anime.<span class="title function_">random</span>(<span class="number">50</span>,<span class="number">180</span>),n=[-<span class="number">1</span>,<span class="number">1</span>][anime.<span class="title function_">random</span>(<span class="number">0</span>,<span class="number">1</span>)]*a;<span class="keyword">return</span>&#123;<span class="attr">x</span>:e.<span class="property">x</span>+n*<span class="title class_">Math</span>.<span class="title function_">cos</span>(t),<span class="attr">y</span>:e.<span class="property">y</span>+n*<span class="title class_">Math</span>.<span class="title function_">sin</span>(t)&#125;&#125;<span class="keyword">function</span> <span class="title function_">createParticule</span>(<span class="params">e,t</span>)&#123;<span class="keyword">var</span> a=&#123;&#125;;<span class="keyword">return</span> a.<span class="property">x</span>=e,a.<span class="property">y</span>=t,a.<span class="property">color</span>=colors[anime.<span class="title function_">random</span>(<span class="number">0</span>,colors.<span class="property">length</span>-<span class="number">1</span>)],a.<span class="property">radius</span>=anime.<span class="title function_">random</span>(<span class="number">16</span>,<span class="number">32</span>),a.<span class="property">endPos</span>=<span class="title function_">setParticuleDirection</span>(a),a.<span class="property">draw</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;ctx.<span class="title function_">beginPath</span>(),ctx.<span class="title function_">arc</span>(a.<span class="property">x</span>,a.<span class="property">y</span>,a.<span class="property">radius</span>,<span class="number">0</span>,<span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>,!<span class="number">0</span>),ctx.<span class="property">fillStyle</span>=a.<span class="property">color</span>,ctx.<span class="title function_">fill</span>()&#125;,a&#125;<span class="keyword">function</span> <span class="title function_">createCircle</span>(<span class="params">e,t</span>)&#123;<span class="keyword">var</span> a=&#123;&#125;;<span class="keyword">return</span> a.<span class="property">x</span>=e,a.<span class="property">y</span>=t,a.<span class="property">color</span>=<span class="string">&quot;#F00&quot;</span>,a.<span class="property">radius</span>=<span class="number">.1</span>,a.<span class="property">alpha</span>=<span class="number">.5</span>,a.<span class="property">lineWidth</span>=<span class="number">6</span>,a.<span class="property">draw</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;ctx.<span class="property">globalAlpha</span>=a.<span class="property">alpha</span>,ctx.<span class="title function_">beginPath</span>(),ctx.<span class="title function_">arc</span>(a.<span class="property">x</span>,a.<span class="property">y</span>,a.<span class="property">radius</span>,<span class="number">0</span>,<span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>,!<span class="number">0</span>),ctx.<span class="property">lineWidth</span>=a.<span class="property">lineWidth</span>,ctx.<span class="property">strokeStyle</span>=a.<span class="property">color</span>,ctx.<span class="title function_">stroke</span>(),ctx.<span class="property">globalAlpha</span>=<span class="number">1</span>&#125;,a&#125;<span class="keyword">function</span> <span class="title function_">renderParticule</span>(<span class="params">e</span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> t=<span class="number">0</span>;t&lt;e.<span class="property">animatables</span>.<span class="property">length</span>;t++)e.<span class="property">animatables</span>[t].<span class="property">target</span>.<span class="title function_">draw</span>()&#125;<span class="keyword">function</span> <span class="title function_">animateParticules</span>(<span class="params">e,t</span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> a=<span class="title function_">createCircle</span>(e,t),n=[],i=<span class="number">0</span>;i&lt;numberOfParticules;i++)n.<span class="title function_">push</span>(<span class="title function_">createParticule</span>(e,t));anime.<span class="title function_">timeline</span>().<span class="title function_">add</span>(&#123;<span class="attr">targets</span>:n,<span class="attr">x</span>:<span class="keyword">function</span>(<span class="params">e</span>)&#123;<span class="keyword">return</span> e.<span class="property">endPos</span>.<span class="property">x</span>&#125;,<span class="attr">y</span>:<span class="keyword">function</span>(<span class="params">e</span>)&#123;<span class="keyword">return</span> e.<span class="property">endPos</span>.<span class="property">y</span>&#125;,<span class="attr">radius</span>:<span class="number">.1</span>,<span class="attr">duration</span>:anime.<span class="title function_">random</span>(<span class="number">1200</span>,<span class="number">1800</span>),<span class="attr">easing</span>:<span class="string">&quot;easeOutExpo&quot;</span>,<span class="attr">update</span>:renderParticule&#125;).<span class="title function_">add</span>(&#123;<span class="attr">targets</span>:a,<span class="attr">radius</span>:anime.<span class="title function_">random</span>(<span class="number">80</span>,<span class="number">160</span>),<span class="attr">lineWidth</span>:<span class="number">0</span>,<span class="attr">alpha</span>:&#123;<span class="attr">value</span>:<span class="number">0</span>,<span class="attr">easing</span>:<span class="string">&quot;linear&quot;</span>,<span class="attr">duration</span>:anime.<span class="title function_">random</span>(<span class="number">600</span>,<span class="number">800</span>)&#125;,<span class="attr">duration</span>:anime.<span class="title function_">random</span>(<span class="number">1200</span>,<span class="number">1800</span>),<span class="attr">easing</span>:<span class="string">&quot;easeOutExpo&quot;</span>,<span class="attr">update</span>:renderParticule,<span class="attr">offset</span>:<span class="number">0</span>&#125;)&#125;<span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">e,t</span>)&#123;<span class="keyword">var</span> a;<span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> n=<span class="variable language_">this</span>,i=<span class="variable language_">arguments</span>;<span class="built_in">clearTimeout</span>(a),a=<span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;e.<span class="title function_">apply</span>(n,i)&#125;,t)&#125;&#125;<span class="keyword">var</span> canvasEl=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.fireworks&quot;</span>);<span class="keyword">if</span>(canvasEl)&#123;<span class="keyword">var</span> ctx=canvasEl.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>),numberOfParticules=<span class="number">30</span>,pointerX=<span class="number">0</span>,pointerY=<span class="number">0</span>,tap=<span class="string">&quot;mousedown&quot;</span>,colors=[<span class="string">&quot;#FF1461&quot;</span>,<span class="string">&quot;#18FF92&quot;</span>,<span class="string">&quot;#5A87FF&quot;</span>,<span class="string">&quot;#FBF38C&quot;</span>],setCanvasSize=<span class="title function_">debounce</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;canvasEl.<span class="property">width</span>=<span class="number">2</span>*<span class="variable language_">window</span>.<span class="property">innerWidth</span>,canvasEl.<span class="property">height</span>=<span class="number">2</span>*<span class="variable language_">window</span>.<span class="property">innerHeight</span>,canvasEl.<span class="property">style</span>.<span class="property">width</span>=<span class="variable language_">window</span>.<span class="property">innerWidth</span>+<span class="string">&quot;px&quot;</span>,canvasEl.<span class="property">style</span>.<span class="property">height</span>=<span class="variable language_">window</span>.<span class="property">innerHeight</span>+<span class="string">&quot;px&quot;</span>,canvasEl.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>).<span class="title function_">scale</span>(<span class="number">2</span>,<span class="number">2</span>)&#125;,<span class="number">500</span>),render=<span class="title function_">anime</span>(&#123;<span class="attr">duration</span>:<span class="number">1</span>/<span class="number">0</span>,<span class="attr">update</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;ctx.<span class="title function_">clearRect</span>(<span class="number">0</span>,<span class="number">0</span>,canvasEl.<span class="property">width</span>,canvasEl.<span class="property">height</span>)&#125;&#125;);<span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(tap,<span class="keyword">function</span>(<span class="params">e</span>)&#123;<span class="string">&quot;sidebar&quot;</span>!==e.<span class="property">target</span>.<span class="property">id</span>&amp;&amp;<span class="string">&quot;toggle-sidebar&quot;</span>!==e.<span class="property">target</span>.<span class="property">id</span>&amp;&amp;<span class="string">&quot;A&quot;</span>!==e.<span class="property">target</span>.<span class="property">nodeName</span>&amp;&amp;<span class="string">&quot;IMG&quot;</span>!==e.<span class="property">target</span>.<span class="property">nodeName</span>&amp;&amp;(render.<span class="title function_">play</span>(),<span class="title function_">updateCoords</span>(e),<span class="title function_">animateParticules</span>(pointerX,pointerY))&#125;,!<span class="number">1</span>),<span class="title function_">setCanvasSize</span>(),<span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;resize&quot;</span>,setCanvasSize,!<span class="number">1</span>)&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æµ®å‡ºçˆ±å¿ƒç‰¹æ•ˆä»£ç ï¼š</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">!<span class="keyword">function</span>(<span class="params">e,t,a</span>)&#123;<span class="keyword">function</span> <span class="title function_">n</span>(<span class="params"></span>)&#123;<span class="title function_">c</span>(<span class="string">&quot;.heart&#123;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);&#125;.heart:after,.heart:before&#123;content: &#x27;&#x27;;width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;&#125;.heart:after&#123;top: -5px;&#125;.heart:before&#123;left: -5px;&#125;&quot;</span>),<span class="title function_">o</span>(),<span class="title function_">r</span>()&#125;<span class="keyword">function</span> <span class="title function_">r</span>(<span class="params"></span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> e=<span class="number">0</span>;e&lt;d.<span class="property">length</span>;e++)d[e].<span class="property">alpha</span>&lt;=<span class="number">0</span>?(t.<span class="property">body</span>.<span class="title function_">removeChild</span>(d[e].<span class="property">el</span>),d.<span class="title function_">splice</span>(e,<span class="number">1</span>)):(d[e].<span class="property">y</span>--,d[e].<span class="property">scale</span>+=<span class="number">.004</span>,d[e].<span class="property">alpha</span>-=<span class="number">.013</span>,d[e].<span class="property">el</span>.<span class="property">style</span>.<span class="property">cssText</span>=<span class="string">&quot;left:&quot;</span>+d[e].<span class="property">x</span>+<span class="string">&quot;px;top:&quot;</span>+d[e].<span class="property">y</span>+<span class="string">&quot;px;opacity:&quot;</span>+d[e].<span class="property">alpha</span>+<span class="string">&quot;;transform:scale(&quot;</span>+d[e].<span class="property">scale</span>+<span class="string">&quot;,&quot;</span>+d[e].<span class="property">scale</span>+<span class="string">&quot;) rotate(45deg);background:&quot;</span>+d[e].<span class="property">color</span>+<span class="string">&quot;;z-index:99999&quot;</span>);<span class="title function_">requestAnimationFrame</span>(r)&#125;<span class="keyword">function</span> <span class="title function_">o</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> t=<span class="string">&quot;function&quot;</span>==<span class="keyword">typeof</span> e.<span class="property">onclick</span>&amp;&amp;e.<span class="property">onclick</span>;e.<span class="property">onclick</span>=<span class="keyword">function</span>(<span class="params">e</span>)&#123;t&amp;&amp;<span class="title function_">t</span>(),<span class="title function_">i</span>(e)&#125;&#125;<span class="keyword">function</span> <span class="title function_">i</span>(<span class="params">e</span>)&#123;<span class="keyword">var</span> a=t.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);a.<span class="property">className</span>=<span class="string">&quot;heart&quot;</span>,d.<span class="title function_">push</span>(&#123;<span class="attr">el</span>:a,<span class="attr">x</span>:e.<span class="property">clientX</span>-<span class="number">5</span>,<span class="attr">y</span>:e.<span class="property">clientY</span>-<span class="number">5</span>,<span class="attr">scale</span>:<span class="number">1</span>,<span class="attr">alpha</span>:<span class="number">1</span>,<span class="attr">color</span>:<span class="title function_">s</span>()&#125;),t.<span class="property">body</span>.<span class="title function_">appendChild</span>(a)&#125;<span class="keyword">function</span> <span class="title function_">c</span>(<span class="params">e</span>)&#123;<span class="keyword">var</span> a=t.<span class="title function_">createElement</span>(<span class="string">&quot;style&quot;</span>);a.<span class="property">type</span>=<span class="string">&quot;text/css&quot;</span>;<span class="keyword">try</span>&#123;a.<span class="title function_">appendChild</span>(t.<span class="title function_">createTextNode</span>(e))&#125;<span class="keyword">catch</span>(t)&#123;a.<span class="property">styleSheet</span>.<span class="property">cssText</span>=e&#125;t.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;head&quot;</span>)[<span class="number">0</span>].<span class="title function_">appendChild</span>(a)&#125;<span class="keyword">function</span> <span class="title function_">s</span>(<span class="params"></span>)&#123;<span class="keyword">return</span><span class="string">&quot;rgb(&quot;</span>+~~(<span class="number">255</span>*<span class="title class_">Math</span>.<span class="title function_">random</span>())+<span class="string">&quot;,&quot;</span>+~~(<span class="number">255</span>*<span class="title class_">Math</span>.<span class="title function_">random</span>())+<span class="string">&quot;,&quot;</span>+~~(<span class="number">255</span>*<span class="title class_">Math</span>.<span class="title function_">random</span>())+<span class="string">&quot;)&quot;</span>&#125;<span class="keyword">var</span> d=[];e.<span class="property">requestAnimationFrame</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">return</span> e.<span class="property">requestAnimationFrame</span>||e.<span class="property">webkitRequestAnimationFrame</span>||e.<span class="property">mozRequestAnimationFrame</span>||e.<span class="property">oRequestAnimationFrame</span>||e.<span class="property">msRequestAnimationFrame</span>||<span class="keyword">function</span>(<span class="params">e</span>)&#123;<span class="built_in">setTimeout</span>(e,<span class="number">1e3</span>/<span class="number">60</span>)&#125;&#125;(),<span class="title function_">n</span>()&#125;(<span class="variable language_">window</span>,<span class="variable language_">document</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>æµ®å‡ºæ–‡å­—ç‰¹æ•ˆä»£ç ï¼š</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a_idx = <span class="number">0</span>;</span><br><span class="line"><span class="title function_">jQuery</span>(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params">$</span>) &#123;</span><br><span class="line">    $(<span class="string">&quot;body&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="string">&quot;å¯Œå¼º&quot;</span>, <span class="string">&quot;æ°‘ä¸»&quot;</span>, <span class="string">&quot;æ–‡æ˜&quot;</span>, <span class="string">&quot;å’Œè°&quot;</span>, <span class="string">&quot;è‡ªç”±&quot;</span>, <span class="string">&quot;å¹³ç­‰&quot;</span>, <span class="string">&quot;å…¬æ­£&quot;</span> ,<span class="string">&quot;æ³•æ²»&quot;</span>, <span class="string">&quot;çˆ±å›½&quot;</span>, <span class="string">&quot;æ•¬ä¸š&quot;</span>, <span class="string">&quot;è¯šä¿¡&quot;</span>, <span class="string">&quot;å‹å–„&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> $i = $(<span class="string">&quot;&lt;span/&gt;&quot;</span>).<span class="title function_">text</span>(a[a_idx]);</span><br><span class="line">        <span class="keyword">var</span> x = e.<span class="property">pageX</span>,</span><br><span class="line">            y = e.<span class="property">pageY</span>;</span><br><span class="line">        $i.<span class="title function_">css</span>(&#123;</span><br><span class="line">            <span class="string">&quot;z-index&quot;</span>: <span class="number">99999</span>,</span><br><span class="line">            <span class="string">&quot;top&quot;</span>: y - <span class="number">28</span>,</span><br><span class="line">            <span class="string">&quot;left&quot;</span>: x - a[a_idx].<span class="property">length</span> * <span class="number">8</span>,</span><br><span class="line">            <span class="string">&quot;position&quot;</span>: <span class="string">&quot;absolute&quot;</span>,</span><br><span class="line">            <span class="string">&quot;color&quot;</span>: <span class="string">&quot;#ff7a45&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        $(<span class="string">&quot;body&quot;</span>).<span class="title function_">append</span>($i);</span><br><span class="line">        $i.<span class="title function_">animate</span>(&#123;</span><br><span class="line">            <span class="string">&quot;top&quot;</span>: y - <span class="number">180</span>,</span><br><span class="line">            <span class="string">&quot;opacity&quot;</span>: <span class="number">0</span></span><br><span class="line">        &#125;, <span class="number">1500</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            $i.<span class="title function_">remove</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">        a_idx = (a_idx + <span class="number">1</span>) % a.<span class="property">length</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬åœ¨ä¸»é¢˜è‡ªå®šä¹‰å¸ƒå±€æ–‡ä»¶ <code>source/_data/body-end.njk</code> ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;# é¼ æ ‡ç‚¹å‡»ç‰¹æ•ˆ #&#125;</span><br><span class="line">&#123;% if theme.cursor_effect == &quot;fireworks&quot; %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">&quot;/js/cursor/fireworks.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&#123;% elseif theme.cursor_effect == &quot;explosion&quot; %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">class</span>=<span class="string">&quot;fireworks&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//cdn.bootcss.com/animejs/2.2.0/anime.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">&quot;/js/cursor/explosion.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&#123;% elseif theme.cursor_effect == &quot;love&quot; %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">&quot;/js/cursor/love.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&#123;% elseif theme.cursor_effect == &quot;text&quot; %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">&quot;/js/cursor/text.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­ <code>custom_file_path</code> éœ€å¼€å¯ <code>bodyEnd: source/_data/body-end.njk</code> é…ç½®</strong></p>
<p>ç„¶åæˆ‘ä»¬åœ¨<strong>ä¸»é¢˜é…ç½®</strong>æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># mouse click effect: fireworks | explosion | love | text</span></span><br><span class="line"><span class="attr">cursor_effect:</span> <span class="string">fireworks</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å³å¯åœ¨é…ç½®æ–‡ä»¶ä¸­ä¸€é”®å¿«é€Ÿåˆ‡æ¢é¼ æ ‡ç‚¹å‡»ç‰¹æ•ˆã€‚</p>
<h2 id="ç®€ä½“ç¹ä½“ä¸€é”®åˆ‡æ¢"><a href="#ç®€ä½“ç¹ä½“ä¸€é”®åˆ‡æ¢" class="headerlink" title="ç®€ä½“ç¹ä½“ä¸€é”®åˆ‡æ¢"></a>ç®€ä½“ç¹ä½“ä¸€é”®åˆ‡æ¢</h2><p>ç®€ä½“ç¹ä½“åˆ‡æ¢çš„åŸºæœ¬åŸç†ï¼šé¦–å…ˆå»ºç«‹ä¸€ä¸ªç®€ä½“å­—ä¸ç¹ä½“å­—ç›¸å¯¹åº”çš„æ˜ å°„è¡¨ï¼Œç„¶åéå†æ•´ä¸ªç•Œé¢ï¼ŒæŠŠç›¸åº”çš„ç®€ä½“å­—æˆ–è€…æ˜¯ç¹ä½“å­—æ˜ å°„ä¸ºå¯¹åº”çš„å­—ä½“å³å¯ã€‚</p>
<ol>
<li>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»º <code>source/js/tw_cn.js</code> æ–‡ä»¶ï¼š</li>
</ol>
<div><div class="fold_hider"><div class="close hider_title">ç‚¹å‡»æ˜¾/éšå†…å®¹</div></div><div class="fold">
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> defaultEncoding = <span class="number">2</span>; <span class="comment">// ç½‘ç«™é»˜è®¤è¯­è¨€ï¼Œ1: ç¹é«”ä¸­æ–‡, 2: ç®€ä½“ä¸­æ–‡</span></span><br><span class="line"><span class="keyword">var</span> translateDelay = <span class="number">0</span>; <span class="comment">//å»¶è¿Ÿæ—¶é—´,è‹¥ä¸åœ¨å‰, è¦è®¾å®šå»¶è¿Ÿç¿»è¯‘æ—¶é—´, å¦‚100è¡¨ç¤º100ms,é»˜è®¤ä¸º0</span></span><br><span class="line"><span class="keyword">var</span> cookieDomain = <span class="string">&quot;https://tding.top/&quot;</span>; <span class="comment">//æ›´æ”¹ä¸ºä½ çš„åšå®¢ç½‘å€</span></span><br><span class="line"><span class="keyword">var</span> msgToTraditionalChinese = <span class="string">&quot;ç¹é«”&quot;</span>; <span class="comment">//æ­¤å¤„å¯ä»¥æ›´æ”¹ä¸ºä½ æƒ³è¦æ˜¾ç¤ºçš„æ–‡å­—</span></span><br><span class="line"><span class="keyword">var</span> msgToSimplifiedChinese = <span class="string">&quot;ç®€ä½“&quot;</span>; <span class="comment">//åŒä¸Šï¼Œä½†ä¸¤å¤„å‡ä¸å»ºè®®æ›´æ”¹</span></span><br><span class="line"><span class="keyword">var</span> translateButtonId = <span class="string">&quot;translateLink&quot;</span>; <span class="comment">//é»˜è®¤äº’æ¢id</span></span><br><span class="line"><span class="keyword">var</span> currentEncoding = defaultEncoding;</span><br><span class="line"><span class="keyword">var</span> targetEncodingCookie = <span class="string">&quot;targetEncoding&quot;</span> + cookieDomain.<span class="title function_">replace</span>(<span class="regexp">/\./g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> targetEncoding = (<span class="title function_">getCookie</span>(targetEncodingCookie) == <span class="literal">null</span> ? <span class="attr">defaultEncoding</span>: <span class="title function_">getCookie</span>(targetEncodingCookie));</span><br><span class="line"><span class="keyword">var</span> translateButtonObject;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">translateText</span>(<span class="params">txt</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (txt == <span class="string">&quot;&quot;</span> || txt == <span class="literal">null</span>) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (currentEncoding == <span class="number">1</span> &amp;&amp; targetEncoding == <span class="number">2</span>) <span class="keyword">return</span> <span class="title class_">Simplized</span>(txt);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (currentEncoding == <span class="number">2</span> &amp;&amp; targetEncoding == <span class="number">1</span>) <span class="keyword">return</span> <span class="title class_">Traditionalized</span>(txt);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> txt</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">translateBody</span>(<span class="params">fobj</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">typeof</span>(fobj) == <span class="string">&quot;object&quot;</span>) <span class="keyword">var</span> objs = fobj.<span class="property">childNodes</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">var</span> objs = <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">childNodes</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; objs.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> obj = objs.<span class="title function_">item</span>(i);</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;||BR|HR|TEXTAREA|&quot;</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;|&quot;</span> + obj.<span class="property">tagName</span> + <span class="string">&quot;|&quot;</span>) &gt; <span class="number">0</span> || obj == translateButtonObject) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (obj.<span class="property">title</span> != <span class="string">&quot;&quot;</span> &amp;&amp; obj.<span class="property">title</span> != <span class="literal">null</span>) obj.<span class="property">title</span> = <span class="title function_">translateText</span>(obj.<span class="property">title</span>);</span><br><span class="line">        <span class="keyword">if</span> (obj.<span class="property">alt</span> != <span class="string">&quot;&quot;</span> &amp;&amp; obj.<span class="property">alt</span> != <span class="literal">null</span>) obj.<span class="property">alt</span> = <span class="title function_">translateText</span>(obj.<span class="property">alt</span>);</span><br><span class="line">        <span class="keyword">if</span> (obj.<span class="property">tagName</span> == <span class="string">&quot;INPUT&quot;</span> &amp;&amp; obj.<span class="property">value</span> != <span class="string">&quot;&quot;</span> &amp;&amp; obj.<span class="property">type</span> != <span class="string">&quot;text&quot;</span> &amp;&amp; obj.<span class="property">type</span> != <span class="string">&quot;hidden&quot;</span>) obj.<span class="property">value</span> = <span class="title function_">translateText</span>(obj.<span class="property">value</span>);</span><br><span class="line">        <span class="keyword">if</span> (obj.<span class="property">nodeType</span> == <span class="number">3</span>) obj.<span class="property">data</span> = <span class="title function_">translateText</span>(obj.<span class="property">data</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="title function_">translateBody</span>(obj)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">translatePage</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (targetEncoding == <span class="number">1</span>) &#123;</span><br><span class="line">        currentEncoding = <span class="number">1</span>;</span><br><span class="line">        targetEncoding = <span class="number">2</span>;</span><br><span class="line">        translateButtonObject.<span class="property">innerHTML</span> = msgToTraditionalChinese;</span><br><span class="line">        <span class="title function_">setCookie</span>(targetEncodingCookie, targetEncoding, <span class="number">7</span>);</span><br><span class="line">        <span class="title function_">translateBody</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (targetEncoding == <span class="number">2</span>) &#123;</span><br><span class="line">        currentEncoding = <span class="number">2</span>;</span><br><span class="line">        targetEncoding = <span class="number">1</span>;</span><br><span class="line">        translateButtonObject.<span class="property">innerHTML</span> = msgToSimplifiedChinese;</span><br><span class="line">        <span class="title function_">setCookie</span>(targetEncodingCookie, targetEncoding, <span class="number">7</span>);</span><br><span class="line">        <span class="title function_">translateBody</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">JTPYStr</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;ä¸‡ä¸ä¸‘ä¸“ä¸šä¸›ä¸œä¸ä¸¢ä¸¤ä¸¥ä¸§ä¸ªä¸¬ä¸°ä¸´ä¸ºä¸½ä¸¾ä¹ˆä¹‰ä¹Œä¹ä¹”ä¹ ä¹¡ä¹¦ä¹°ä¹±äº‰äºäºäº‘äº˜äºšäº§äº©äº²äºµäº¸äº¿ä»…ä»ä»‘ä»“ä»ªä»¬ä»·ä¼—ä¼˜ä¼™ä¼šä¼›ä¼ä¼Ÿä¼ ä¼¤ä¼¥ä¼¦ä¼§ä¼ªä¼«ä½“ä½™ä½£ä½¥ä¾ ä¾£ä¾¥ä¾¦ä¾§ä¾¨ä¾©ä¾ªä¾¬ä¿£ä¿¦ä¿¨ä¿©ä¿ªä¿­å€ºå€¾å¬å»å¾å¿å‚¥å‚§å‚¨å‚©å„¿å…‘å…–å…šå…°å…³å…´å…¹å…»å…½å†å†…å†ˆå†Œå†™å†›å†œå†¢å†¯å†²å†³å†µå†»å‡€å‡„å‡‰å‡Œå‡å‡‘å‡›å‡ å‡¤å‡«å‡­å‡¯å‡»å‡¼å‡¿åˆåˆ’åˆ˜åˆ™åˆšåˆ›åˆ åˆ«åˆ¬åˆ­åˆ½åˆ¿å‰€å‰‚å‰å‰‘å‰¥å‰§åŠåŠåŠ¡åŠ¢åŠ¨åŠ±åŠ²åŠ³åŠ¿å‹‹å‹å‹šåŒ€åŒ¦åŒ®åŒºåŒ»ååå•å–å¢å¤å§å«å´åºå‚å…å†å‰å‹åŒåå•å¢å£å¦å¨å©å®å¿å‚å†å‡åŒå‘å˜å™å å¶å·å¹å½ååå“å•å—å£å¨å¬å¯å´å‘’å‘“å‘•å‘–å‘—å‘˜å‘™å‘›å‘œå’å’”å’™å’›å’å’¤å’´å’¸å“Œå“å“‘å“’å““å“”å“•å“—å“™å“œå“å“Ÿå”›å”å” å”¡å”¢å”£å”¤å”¿å•§å•¬å•­å•®å•°å•´å•¸å–·å–½å–¾å—«å‘µå—³å˜˜å˜¤å˜±å™œå™¼åš£åš¯å›¢å›­å›±å›´å›µå›½å›¾åœ†åœ£åœ¹åœºå‚åå—åšå›åœåååŸå å„å…å†å’å¦å§å©å«å­å¯å±å²å´åŸ˜åŸ™åŸšåŸåŸ¯å ‘å •å¡†å¢™å£®å£°å£³å£¶å£¸å¤„å¤‡å¤å¤Ÿå¤´å¤¸å¤¹å¤ºå¥å¥‚å¥‹å¥–å¥¥å¦†å¦‡å¦ˆå¦©å¦ªå¦«å§—å§œå¨„å¨…å¨†å¨‡å¨ˆå¨±å¨²å¨´å©³å©´å©µå©¶åªªå«’å«”å«±å¬·å­™å­¦å­ªå®å®å®å® å®¡å®ªå®«å®½å®¾å¯å¯¹å¯»å¯¼å¯¿å°†å°”å°˜å°§å°´å°¸å°½å±‚å±ƒå±‰å±Šå±å±¡å±¦å±¿å²å²‚å²–å²—å²˜å²™å²šå²›å²­å²³å²½å²¿å³ƒå³„å³¡å³£å³¤å³¥å³¦å´‚å´ƒå´„å´­åµ˜åµšåµ›åµåµ´å·…å·©å·¯å¸å¸…å¸ˆå¸å¸å¸˜å¸œå¸¦å¸§å¸®å¸±å¸»å¸¼å¹‚å¹å¹²å¹¶å¹¿åº„åº†åºåº‘åº“åº”åº™åºåºŸåº¼å»ªå¼€å¼‚å¼ƒå¼ å¼¥å¼ªå¼¯å¼¹å¼ºå½’å½“å½•å½Ÿå½¦å½»å¾„å¾•å¾¡å¿†å¿å¿§å¿¾æ€€æ€æ€‚æ€ƒæ€„æ€…æ€†æ€œæ€»æ€¼æ€¿æ‹æ³æ¶æ¸æ¹æºæ»æ¼æ½æ‚¦æ‚«æ‚¬æ‚­æ‚¯æƒŠæƒ§æƒ¨æƒ©æƒ«æƒ¬æƒ­æƒ®æƒ¯æ„æ„ æ„¤æ„¦æ„¿æ…‘æ…­æ†·æ‡‘æ‡’æ‡”æˆ†æˆ‹æˆæˆ—æˆ˜æˆ¬æˆ·æ‰æ‰‘æ‰¦æ‰§æ‰©æ‰ªæ‰«æ‰¬æ‰°æŠšæŠ›æŠŸæŠ æŠ¡æŠ¢æŠ¤æŠ¥æ‹…æ‹Ÿæ‹¢æ‹£æ‹¥æ‹¦æ‹§æ‹¨æ‹©æŒ‚æŒšæŒ›æŒœæŒæŒæŒŸæŒ æŒ¡æŒ¢æŒ£æŒ¤æŒ¥æŒ¦ææŸæ¡æ¢æ£æ®æ»æ³æ´æ·æ¸æºæ¼æ¸æ½æ¿æ€ææ‚æ…æºæ‘„æ‘…æ‘†æ‘‡æ‘ˆæ‘Šæ’„æ’‘æ’µæ’·æ’¸æ’ºæ“æ”’æ•Œæ•›æ•°æ–‹æ–“æ–—æ–©æ–­æ— æ—§æ—¶æ—·æ—¸æ˜™æ˜¼æ˜½æ˜¾æ™‹æ™’æ™“æ™”æ™•æ™–æš‚æš§æœ­æœ¯æœ´æœºæ€æ‚æƒæ¡æ¥æ¨æ©æ°ææ„ææ¢æ£æ¥æ§æ¨æªæ«æ­æŸœæŸ æŸ½æ €æ …æ ‡æ ˆæ ‰æ Šæ ‹æ Œæ æ æ ‘æ –æ ·æ ¾æ¡Šæ¡ æ¡¡æ¡¢æ¡£æ¡¤æ¡¥æ¡¦æ¡§æ¡¨æ¡©æ¢¦æ¢¼æ¢¾æ£€æ£‚æ¤æ¤Ÿæ¤ æ¤¤æ¤­æ¥¼æ¦„æ¦‡æ¦ˆæ¦‰æ§šæ§›æ§Ÿæ§ æ¨ªæ¨¯æ¨±æ©¥æ©±æ©¹æ©¼æªæª©æ¬¢æ¬¤æ¬§æ­¼æ®æ®‡æ®‹æ®’æ®“æ®šæ®¡æ®´æ¯æ¯‚æ¯•æ¯™æ¯¡æ¯µæ°‡æ°”æ°¢æ°©æ°²æ±‡æ±‰æ±¡æ±¤æ±¹æ²“æ²Ÿæ²¡æ²£æ²¤æ²¥æ²¦æ²§æ²¨æ²©æ²ªæ²µæ³æ³ªæ³¶æ³·æ³¸æ³ºæ³»æ³¼æ³½æ³¾æ´æ´’æ´¼æµƒæµ…æµ†æµ‡æµˆæµ‰æµŠæµ‹æµæµæµæµæµ‘æµ’æµ“æµ”æµ•æ¶‚æ¶Œæ¶›æ¶æ¶æ¶Ÿæ¶ æ¶¡æ¶¢æ¶£æ¶¤æ¶¦æ¶§æ¶¨æ¶©æ·€æ¸Šæ¸Œæ¸æ¸æ¸æ¸‘æ¸”æ¸–æ¸—æ¸©æ¸¸æ¹¾æ¹¿æºƒæº…æº†æº‡æ»—æ»šæ»æ»Ÿæ» æ»¡æ»¢æ»¤æ»¥æ»¦æ»¨æ»©æ»ªæ¼¤æ½†æ½‡æ½‹æ½æ½œæ½´æ¾œæ¿‘æ¿’çç­ç¯çµç¾ç¿ç‚€ç‚‰ç‚–ç‚œç‚ç‚¹ç‚¼ç‚½çƒçƒ‚çƒƒçƒ›çƒŸçƒ¦çƒ§çƒ¨çƒ©çƒ«çƒ¬çƒ­ç„•ç„–ç„˜ç……ç…³ç†˜çˆ±çˆ·ç‰ç‰¦ç‰µç‰ºçŠŠçŠŸçŠ¶çŠ·çŠ¸çŠ¹ç‹ˆç‹ç‹ç‹ç‹¬ç‹­ç‹®ç‹¯ç‹°ç‹±ç‹²çŒƒçŒçŒ•çŒ¡çŒªçŒ«çŒ¬çŒ®ç­ç‘ç™çšç›ç®ç¯ç°ç±çºç‰ççç‘ç°ç²çççç¼ç‘¶ç‘·ç’‡ç’ç“’ç“®ç“¯ç”µç”»ç•…ç•²ç•´ç––ç–—ç–Ÿç– ç–¡ç–¬ç–®ç–¯ç–±ç–´ç—ˆç—‰ç—’ç—–ç—¨ç—ªç—«ç—´ç˜…ç˜†ç˜—ç˜˜ç˜ªç˜«ç˜¾ç˜¿ç™ç™£ç™«ç™¯çš‘çš±çš²ç›ç›ç›‘ç›–ç›—ç›˜çœçœ¦çœ¬ç€ççç‘ç’ç©çŸ«çŸ¶çŸ¾çŸ¿ç €ç ç –ç —ç šç œç ºç »ç ¾ç¡€ç¡ç¡…ç¡•ç¡–ç¡—ç¡™ç¡šç¡®ç¡·ç¢ç¢›ç¢œç¢±ç¢¹ç£™ç¤¼ç¥ç¥¢ç¥¯ç¥·ç¥¸ç¦€ç¦„ç¦…ç¦»ç§ƒç§†ç§ç§¯ç§°ç§½ç§¾ç¨†ç¨ç¨£ç¨³ç©‘ç©·çªƒçªçª‘çªœçªçª¥çª¦çª­ç«–ç«ç¬ƒç¬‹ç¬”ç¬•ç¬ºç¬¼ç¬¾ç­‘ç­šç­›ç­œç­ç­¹ç­¾ç®€ç®“ç®¦ç®§ç®¨ç®©ç®ªç®«ç¯‘ç¯“ç¯®ç¯±ç°–ç±ç±´ç±»ç±¼ç²œç²ç²¤ç²ªç²®ç³ç³‡ç´§çµ·çºŸçº çº¡çº¢çº£çº¤çº¥çº¦çº§çº¨çº©çºªçº«çº¬çº­çº®çº¯çº°çº±çº²çº³çº´çºµçº¶çº·çº¸çº¹çººçº»çº¼çº½çº¾çº¿ç»€ç»ç»‚ç»ƒç»„ç»…ç»†ç»‡ç»ˆç»‰ç»Šç»‹ç»Œç»ç»ç»ç»ç»‘ç»’ç»“ç»”ç»•ç»–ç»—ç»˜ç»™ç»šç»›ç»œç»ç»ç»Ÿç» ç»¡ç»¢ç»£ç»¤ç»¥ç»¦ç»§ç»¨ç»©ç»ªç»«ç»¬ç»­ç»®ç»¯ç»°ç»±ç»²ç»³ç»´ç»µç»¶ç»·ç»¸ç»¹ç»ºç»»ç»¼ç»½ç»¾ç»¿ç¼€ç¼ç¼‚ç¼ƒç¼„ç¼…ç¼†ç¼‡ç¼ˆç¼‰ç¼Šç¼‹ç¼Œç¼ç¼ç¼ç¼ç¼‘ç¼’ç¼“ç¼”ç¼•ç¼–ç¼—ç¼˜ç¼™ç¼šç¼›ç¼œç¼ç¼ç¼Ÿç¼ ç¼¡ç¼¢ç¼£ç¼¤ç¼¥ç¼¦ç¼§ç¼¨ç¼©ç¼ªç¼«ç¼¬ç¼­ç¼®ç¼¯ç¼°ç¼±ç¼²ç¼³ç¼´ç¼µç½‚ç½‘ç½—ç½šç½¢ç½´ç¾ç¾Ÿç¾¡ç¿˜ç¿™ç¿šè€¢è€§è€¸è€»è‚è‹èŒèè”è©èªè‚ƒè‚ è‚¤è‚·è‚¾è‚¿èƒ€èƒèƒ†èƒœèƒ§èƒ¨èƒªèƒ«èƒ¶è„‰è„è„è„è„‘è„“è„”è„šè„±è„¶è„¸è…Šè…Œè…˜è…­è…»è…¼è…½è…¾è†‘è‡œèˆ†èˆ£èˆ°èˆ±èˆ»è‰°è‰³è‰¹è‰ºèŠ‚èŠˆèŠ—èŠœèŠ¦è‹è‹‡è‹ˆè‹‹è‹Œè‹è‹è‹è‹˜è‹¹èŒèŒèŒ‘èŒ”èŒ•èŒ§è†èè™èšè›èœèèŸè è¡è£è¤è¥è¦è§è¨è©èªè«è¬è­è®è¯è…èœè±è²è³è´è¶è·è¸è¹èºè¼èšèè¤è¥è¦è§è¨è‘±è’‡è’‰è’‹è’Œè“è“Ÿè“ è“£è“¥è“¦è”·è”¹è”ºè”¼è•²è•´è–®è—è—“è™è™‘è™šè™«è™¬è™®è™½è™¾è™¿èš€èšèš‚èš•èšèš¬è›Šè›è›è›®è›°è›±è›²è›³è›´èœ•èœ—èœ¡è‡èˆè‰èè¼è¾è€è¨èŸè¡…è¡”è¡¥è¡¬è¡®è¢„è¢…è¢†è¢œè¢­è¢¯è£…è£†è£ˆè£¢è££è£¤è£¥è¤›è¤´è¥è¥•è§è§‚è§ƒè§„è§…è§†è§‡è§ˆè§‰è§Šè§‹è§Œè§è§è§è§è§‘è§è§¦è§¯è©Ÿèª‰èªŠè® è®¡è®¢è®£è®¤è®¥è®¦è®§è®¨è®©è®ªè®«è®­è®®è®¯è®°è®±è®²è®³è®´è®µè®¶è®·è®¸è®¹è®ºè®»è®¼è®½è®¾è®¿è¯€è¯è¯‚è¯ƒè¯„è¯…è¯†è¯‡è¯ˆè¯‰è¯Šè¯‹è¯Œè¯è¯è¯è¯è¯‘è¯’è¯“è¯”è¯•è¯–è¯—è¯˜è¯™è¯šè¯›è¯œè¯è¯è¯Ÿè¯ è¯¡è¯¢è¯£è¯¤è¯¥è¯¦è¯§è¯¨è¯©è¯ªè¯«è¯¬è¯­è¯®è¯¯è¯°è¯±è¯²è¯³è¯´è¯µè¯¶è¯·è¯¸è¯¹è¯ºè¯»è¯¼è¯½è¯¾è¯¿è°€è°è°‚è°ƒè°„è°…è°†è°‡è°ˆè°Šè°‹è°Œè°è°è°è°è°‘è°’è°“è°”è°•è°–è°—è°˜è°™è°šè°›è°œè°è°è°Ÿè° è°¡è°¢è°£è°¤è°¥è°¦è°§è°¨è°©è°ªè°«è°¬è°­è°®è°¯è°°è°±è°²è°³è°´è°µè°¶è°·è±®è´è´è´Ÿè´ è´¡è´¢è´£è´¤è´¥è´¦è´§è´¨è´©è´ªè´«è´¬è´­è´®è´¯è´°è´±è´²è´³è´´è´µè´¶è´·è´¸è´¹è´ºè´»è´¼è´½è´¾è´¿èµ€èµèµ‚èµƒèµ„èµ…èµ†èµ‡èµˆèµ‰èµŠèµ‹èµŒèµèµèµèµèµ‘èµ’èµ“èµ”èµ•èµ–èµ—èµ˜èµ™èµšèµ›èµœèµèµèµŸèµ èµ¡èµ¢èµ£èµªèµµèµ¶è¶‹è¶±è¶¸è·ƒè·„è·–è·è·µè·¶è··è·¸è·¹è·»è¸Šè¸Œè¸ªè¸¬è¸¯è¹‘è¹’è¹°è¹¿èºèºœèº¯è½¦è½§è½¨è½©è½ªè½«è½¬è½­è½®è½¯è½°è½±è½²è½³è½´è½µè½¶è½·è½¸è½¹è½ºè½»è½¼è½½è½¾è½¿è¾€è¾è¾‚è¾ƒè¾„è¾…è¾†è¾‡è¾ˆè¾‰è¾Šè¾‹è¾Œè¾è¾è¾è¾è¾‘è¾’è¾“è¾”è¾•è¾–è¾—è¾˜è¾™è¾šè¾è¾©è¾«è¾¹è¾½è¾¾è¿è¿‡è¿ˆè¿è¿˜è¿™è¿›è¿œè¿è¿è¿Ÿè¿©è¿³è¿¹é€‚é€‰é€Šé€’é€¦é€»é—é¥é‚“é‚é‚¬é‚®é‚¹é‚ºé‚»éƒéƒ„éƒéƒéƒ‘éƒ“éƒ¦éƒ§éƒ¸é…é…¦é…±é…½é…¾é…¿é‡Šé‡Œé‰…é‰´éŠ®éŒ¾é’†é’‡é’ˆé’‰é’Šé’‹é’Œé’é’é’é’é’‘é’’é’“é’”é’•é’–é’—é’˜é’™é’šé’›é’é’é’Ÿé’ é’¡é’¢é’£é’¤é’¥é’¦é’§é’¨é’©é’ªé’«é’¬é’­é’®é’¯é’°é’±é’²é’³é’´é’µé’¶é’·é’¸é’¹é’ºé’»é’¼é’½é’¾é’¿é“€é“é“‚é“ƒé“„é“…é“†é“ˆé“‰é“Šé“‹é“é“é“é“é“‘é“’é“•é“—é“˜é“™é“šé“›é“œé“é“é“Ÿé“ é“¡é“¢é“£é“¤é“¥é“¦é“§é“¨é“ªé“«é“¬é“­é“®é“¯é“°é“±é“²é“³é“´é“µé“¶é“·é“¸é“¹é“ºé“»é“¼é“½é“¾é“¿é”€é”é”‚é”ƒé”„é”…é”†é”‡é”ˆé”‰é”Šé”‹é”Œé”é”é”é”é”‘é”’é”“é””é”•é”–é”—é”™é”šé”œé”é”Ÿé” é”¡é”¢é”£é”¤é”¥é”¦é”¨é”©é”«é”¬é”­é”®é”¯é”°é”±é”²é”³é”´é”µé”¶é”·é”¸é”¹é”ºé”»é”¼é”½é”¾é”¿é•€é•é•‚é•ƒé•†é•‡é•ˆé•‰é•Šé•Œé•é•é•é•é•‘é•’é••é•–é•—é•™é•šé•›é•œé•é•é•Ÿé• é•¡é•¢é•£é•¤é•¥é•¦é•§é•¨é•©é•ªé•«é•¬é•­é•®é•¯é•°é•±é•²é•³é•´é•¶é•¿é—¨é—©é—ªé—«é—¬é—­é—®é—¯é—°é—±é—²é—³é—´é—µé—¶é—·é—¸é—¹é—ºé—»é—¼é—½é—¾é—¿é˜€é˜é˜‚é˜ƒé˜„é˜…é˜†é˜‡é˜ˆé˜‰é˜Šé˜‹é˜Œé˜é˜é˜é˜é˜‘é˜’é˜“é˜”é˜•é˜–é˜—é˜˜é˜™é˜šé˜›é˜Ÿé˜³é˜´é˜µé˜¶é™…é™†é™‡é™ˆé™‰é™•é™§é™¨é™©éšéšéš¶éš½éš¾é›é› é›³é›¾éœéœ‰éœ­é“é™é¥é‘é’é¯é´éŸ¦éŸ§éŸ¨éŸ©éŸªéŸ«éŸ¬éŸµé¡µé¡¶é¡·é¡¸é¡¹é¡ºé¡»é¡¼é¡½é¡¾é¡¿é¢€é¢é¢‚é¢ƒé¢„é¢…é¢†é¢‡é¢ˆé¢‰é¢Šé¢‹é¢Œé¢é¢é¢é¢é¢‘é¢’é¢“é¢”é¢•é¢–é¢—é¢˜é¢™é¢šé¢›é¢œé¢é¢é¢Ÿé¢ é¢¡é¢¢é¢£é¢¤é¢¥é¢¦é¢§é£é£é£é£‘é£’é£“é£”é£•é£–é£—é£˜é£™é£šé£é£¨é¤é¥¤é¥¥é¥¦é¥§é¥¨é¥©é¥ªé¥«é¥¬é¥­é¥®é¥¯é¥°é¥±é¥²é¥³é¥´é¥µé¥¶é¥·é¥¸é¥¹é¥ºé¥»é¥¼é¥½é¥¾é¥¿é¦€é¦é¦‚é¦ƒé¦„é¦…é¦†é¦‡é¦ˆé¦‰é¦Šé¦‹é¦Œé¦é¦é¦é¦é¦‘é¦’é¦“é¦”é¦•é©¬é©­é©®é©¯é©°é©±é©²é©³é©´é©µé©¶é©·é©¸é©¹é©ºé©»é©¼é©½é©¾é©¿éª€éªéª‚éªƒéª„éª…éª†éª‡éªˆéª‰éªŠéª‹éªŒéªéªéªéªéª‘éª’éª“éª”éª•éª–éª—éª˜éª™éªšéª›éªœéªéªéªŸéª éª¡éª¢éª£éª¤éª¥éª¦éª§é«…é«‹é«Œé¬“é­‡é­‰é±¼é±½é±¾é±¿é²€é²é²‚é²„é²…é²†é²‡é²ˆé²‰é²Šé²‹é²Œé²é²é²é²é²‘é²’é²“é²”é²•é²–é²—é²˜é²™é²šé²›é²œé²é²é²Ÿé² é²¡é²¢é²£é²¤é²¥é²¦é²§é²¨é²©é²ªé²«é²¬é²­é²®é²¯é²°é²±é²²é²³é²´é²µé²¶é²·é²¸é²¹é²ºé²»é²¼é²½é²¾é²¿é³€é³é³‚é³ƒé³„é³…é³†é³‡é³ˆé³‰é³Šé³‹é³Œé³é³é³é³é³‘é³’é³“é³”é³•é³–é³—é³˜é³™é³›é³œé³é³é³Ÿé³ é³¡é³¢é³£é¸Ÿé¸ é¸¡é¸¢é¸£é¸¤é¸¥é¸¦é¸§é¸¨é¸©é¸ªé¸«é¸¬é¸­é¸®é¸¯é¸°é¸±é¸²é¸³é¸´é¸µé¸¶é¸·é¸¸é¸¹é¸ºé¸»é¸¼é¸½é¸¾é¸¿é¹€é¹é¹‚é¹ƒé¹„é¹…é¹†é¹‡é¹ˆé¹‰é¹Šé¹‹é¹Œé¹é¹é¹é¹é¹‘é¹’é¹“é¹”é¹•é¹–é¹—é¹˜é¹šé¹›é¹œé¹é¹é¹Ÿé¹ é¹¡é¹¢é¹£é¹¤é¹¥é¹¦é¹§é¹¨é¹©é¹ªé¹«é¹¬é¹­é¹¯é¹°é¹±é¹²é¹³é¹´é¹¾éº¦éº¸é»„é»‰é»¡é»©é»ªé»¾é¼‹é¼Œé¼é¼—é¼¹é½„é½é½‘é½¿é¾€é¾é¾‚é¾ƒé¾„é¾…é¾†é¾‡é¾ˆé¾‰é¾Šé¾‹é¾Œé¾™é¾šé¾›é¾Ÿå¿—åˆ¶å’¨åªé‡Œç³»èŒƒæ¾æ²¡å°å°é—¹é¢å‡†é’Ÿåˆ«é—²å¹²å°½è„æ‹¼&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">FTPYStr</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;è¬èˆ‡é†œå°ˆæ¥­å¢æ±çµ²ä¸Ÿå…©åš´å–ªå€‹çˆ¿è±è‡¨ç‚ºéº—èˆ‰éº¼ç¾©çƒæ¨‚å–¬ç¿’é„‰æ›¸è²·äº‚çˆ­æ–¼è™§é›²äº™äºç”¢ç•è¦ªè¤»åš²å„„åƒ…å¾ä¾–å€‰å„€å€‘åƒ¹çœ¾å„ªå¤¥æœƒå‚´å‚˜å‰å‚³å‚·å€€å€«å‚–å½ä½‡é«”é¤˜å‚­åƒ‰ä¿ ä¾¶åƒ¥åµå´åƒ‘å„ˆå„•å„‚ä¿å„”å„¼å€†å„·å„‰å‚µå‚¾å‚¯åƒ‚åƒ¨å„Ÿå„»å„å„²å„ºå…’å…Œå…—é»¨è˜­é—œèˆˆèŒ²é¤Šç¸å›…å…§å²¡å†Šå¯«è»è¾²å¡šé¦®è¡æ±ºæ³å‡æ·¨æ·’æ¶¼æ·©æ¸›æ¹Šå‡œå¹¾é³³é³§æ†‘å‡±æ“Šæ°¹é‘¿èŠ»åŠƒåŠ‰å‰‡å‰›å‰µåˆªåˆ¥å‰—å‰„åŠŠåŠŒå‰´åŠ‘å‰®åŠå‰åŠ‡å‹¸è¾¦å‹™å‹±å‹•å‹µå‹å‹å‹¢å‹³çŒ›å‹©å‹»åŒ­åŒ±å€é†«è¯å”å–®è³£ç›§é¹µè‡¥è¡›å»å·¹å» å»³æ›†å²å£“å­å™å»å»‚å´å»ˆå»šå»„å»ç¸£åƒé‰é†é›™ç™¼è®Šæ•˜ç–Šè‘‰è™Ÿæ­å˜°ç±²å¾Œåš‡å‘‚å—å”šå™¸è½å•Ÿå³å˜¸å›ˆå˜”åš¦å”„å“¡å’¼å—†å—šè© å“¢åš¨åš€å™å’å™…é¹¹å‘±éŸ¿å•å™ å˜µå—¶å™¦å˜©å™²åšŒå™¥å–²å˜œå—Šå˜®å•¢å—©å”•å–šå‘¼å˜–å—‡å›€é½§å›‰å˜½å˜¯å™´å˜åš³å›å—¬å™¯å™“åš¶å›‘åš•åŠˆå›‚è¬”åœ˜åœ’å›ªåœåœ‡åœ‹åœ–åœ“è–å£™å ´é˜ªå£å¡Šå …å£‡å£¢å£©å¡¢å¢³å¢œå£Ÿå£Ÿå£šå£˜å¢¾å°å Šå¢ŠåŸ¡å¢¶å£‹å¡å –å¡’å¡¤å å¢Šåµå¡¹å¢®å£ªç‰†å£¯è²æ®¼å£ºå£¼è™•å‚™è¤‡å¤ é ­èª‡å¤¾å¥ªå¥©å¥å¥®çå¥§å¦å©¦åª½å«µå«—åª¯å§è–‘å©å©­å¬ˆå¬Œå­Œå¨›åª§å«»å«¿å¬°å¬‹å¬¸åª¼å¬¡å¬ªå¬™å¬¤å­«å­¸å­¿å¯§å¯¶å¯¦å¯µå¯©æ†²å®®å¯¬è³“å¯¢å°å°‹å°å£½å°‡çˆ¾å¡µå ¯å°·å±ç›¡å±¤å±­å±œå±†å±¬å±¢å±¨å¶¼æ­²è±ˆå¶‡å´—å³´å¶´åµå³¶å¶ºå¶½å´ å·‹å¶¨å¶§å³½å¶¢å¶ å´¢å·’å¶—å´å¶®å¶„å¶¸å¶”å´³å¶è„Šå·”éå·°å¹£å¸¥å¸«å¹ƒå¸³ç°¾å¹Ÿå¸¶å¹€å¹«å¹¬å¹˜å¹—å†ªè¥†å¹¹ä¸¦å»£èŠæ…¶å»¬å»¡åº«æ‡‰å»Ÿé¾å»¢å»å»©é–‹ç•°æ£„å¼µå½Œå¼³å½å½ˆå¼·æ­¸ç•¶éŒ„å½ å½¥å¾¹å¾‘å¾ ç¦¦æ†¶æ‡ºæ†‚æ„¾æ‡·æ…‹æ…«æ†®æ…ªæ‚µæ„´æ†ç¸½æ‡Ÿæ‡Œæˆ€æ‡‡æƒ¡æ…Ÿæ‡¨æ„·æƒ»æƒ±æƒ²æ‚…æ„¨æ‡¸æ…³æ†«é©šæ‡¼æ…˜æ‡²æ†Šæ„œæ…šæ†šæ…£æ¹£æ…æ†¤æ†’é¡˜æ‡¾æ†–æ€µæ‡£æ‡¶æ‡æˆ‡æˆ”æˆ²æˆ§æˆ°æˆ©æˆ¶ç´®æ’²æ‰¡åŸ·æ“´æ«æƒæšæ“¾æ’«æ‹‹æ‘¶æ‘³æ„æ¶è­·å ±æ“”æ“¬æ”æ€æ“æ””æ“°æ’¥æ“‡æ›æ‘¯æ”£æ—æ’¾æ’»æŒ¾æ’“æ“‹æ’Ÿæ™æ“ æ®æ’æ’ˆææ’¿æ›æ—æ“šæ’šæ“„æ‘‘æ“²æ’£æ‘»æ‘œæ‘£æ”¬æ’³æ”™æ“±æ‘Ÿæ”ªæ”œæ”æ”„æ“ºæ–æ“¯æ”¤æ”–æ’æ”†æ“·æ“¼æ”›æ“»æ”¢æ•µæ–‚æ•¸é½‹æ–•é¬¥æ–¬æ–·ç„¡èˆŠæ™‚æ› æš˜æ›‡æ™æ›¨é¡¯æ™‰æ›¬æ›‰æ›„æšˆæš‰æš«æ›–åŠ„è¡“æ¨¸æ©Ÿæ®ºé›œæ¬Šæ¢ä¾†æ¥Šæ¦ªå‚‘æ¥µæ§‹æ¨…æ¨æ£—æ«ªæ¢˜æ£–æ§æ¥“æ¢Ÿæ«ƒæª¸æª‰æ¢”æŸµæ¨™æ£§æ«›æ«³æ£Ÿæ«¨æ«Ÿæ¬„æ¨¹æ£²æ¨£æ¬’æ£¬æ¤æ©ˆæ¥¨æª”æ¦¿æ©‹æ¨ºæªœæ§³æ¨å¤¢æª®æ£¶æª¢æ¬æ§¨æ«æ§§æ¬æ©¢æ¨“æ¬–æ«¬æ«šæ«¸æªŸæª»æª³æ«§æ©«æª£æ«»æ««æ«¥æ«“æ«ç°·æªæ­¡æ­Ÿæ­æ®²æ­¿æ®¤æ®˜æ®æ®®æ®«æ®¯æ¯†æ¯€è½‚ç•¢æ–ƒæ°ˆæ¯¿æ°Œæ°£æ°«æ°¬æ°³å½™æ¼¢æ±™æ¹¯æ´¶éæºæ²’çƒæ¼šç€æ·ªæ»„æ¸¢æºˆæ»¬æ¿”æ¿˜æ·šæ¾©ç€§ç€˜æ¿¼ç€‰æ½‘æ¾¤æ¶‡æ½”ç‘çªªæµ¹æ·ºæ¼¿æ¾†æ¹æº®æ¿æ¸¬æ¾®æ¿Ÿç€æ»»æ¸¾æ»¸æ¿ƒæ½¯æ¿œå¡—æ¹§æ¿¤æ¾‡æ·¶æ¼£æ½¿æ¸¦æº³æ¸™æ»Œæ½¤æ¾—æ¼²æ¾€æ¾±æ·µæ·¥æ¼¬ç€†æ¼¸æ¾ æ¼ç€‹æ»²æº«éŠç£æ¿•æ½°æ¿ºæ¼µæ¼Šæ½·æ»¾æ»¯ç©ç„æ»¿ç€…æ¿¾æ¿«ç¤æ¿±ç˜æ¾¦æ¿«ç€ ç€Ÿç€²æ¿°æ½›ç€¦ç€¾ç€¨ç€•çæ»…ç‡ˆéˆç½ç‡¦ç…¬çˆç‡‰ç…’ç†—é»ç…‰ç†¾çˆçˆ›çƒ´ç‡­ç…™ç…©ç‡’ç‡ç‡´ç‡™ç‡¼ç†±ç…¥ç‡œç‡¾ç…†ç³Šæºœæ„›çˆºç‰˜çŠ›ç‰½çŠ§çŠ¢å¼·ç‹€ç·ççŒ¶ç‹½éº…ç®ç°ç¨ç‹¹ç…çªçŒ™ç„çŒ»ç«çµç¼ç€è±¬è²“èŸç»çºç’£ç’µç‘’ç‘ªç‘‹ç’°ç¾ç‘²ç’½ç‘‰ç¨çºç“ç’«ç¿ç’¡ç’‰ç‘£ç“Šç‘¤ç’¦ç’¿ç“”ç“šç”•ç”Œé›»ç•«æš¢ä½˜ç–‡ç™¤ç™‚ç˜§ç™˜ç˜é¬ç˜¡ç˜‹çš°å±™ç™°ç—™ç™¢ç˜‚ç™†ç˜“ç™‡ç™¡ç™‰ç˜®ç˜ç˜ºç™Ÿç™±ç™®ç™­ç™©ç™¬ç™²è‡’çššçšºçš¸ç›é¹½ç›£è“‹ç›œç›¤ç˜çœ¥çŸ“è‘—çœçç¼ççŸšçŸ¯ç£¯ç¤¬ç¤¦ç¢­ç¢¼ç£šç¡¨ç¡¯ç¢¸ç¤ªç¤±ç¤«ç¤ç¡œçŸ½ç¢©ç¡¤ç£½ç£‘ç¤„ç¢ºé¹¼ç¤™ç£§ç££å ¿é•Ÿæ»¾ç¦®ç¦•ç¦°ç¦ç¦±ç¦ç¨Ÿç¥¿ç¦ªé›¢ç¦¿ç¨ˆç¨®ç©ç¨±ç©¢ç© ç©­ç¨…ç©Œç©©ç©¡çª®ç«Šç«…çª¯ç«„çª©çªºç«‡çª¶è±ç«¶ç¯¤ç­ç­†ç­§ç®‹ç± ç±©ç¯‰ç¯³ç¯©ç°¹ç®ç±Œç°½ç°¡ç±™ç°€ç¯‹ç±œç±®ç°ç°«ç°£ç°ç±ƒç±¬ç±ªç±Ÿç³´é¡ç§ˆç³¶ç³²ç²µç³ç³§ç³é¤±ç·Šç¸¶ç³¸ç³¾ç´†ç´…ç´‚çº–ç´‡ç´„ç´šç´ˆçºŠç´€ç´‰ç·¯ç´œç´˜ç´”ç´•ç´—ç¶±ç´ç´ç¸±ç¶¸ç´›ç´™ç´‹ç´¡ç´µç´–ç´ç´“ç·šç´ºçµç´±ç·´çµ„ç´³ç´°ç¹”çµ‚ç¸çµ†ç´¼çµ€ç´¹ç¹¹ç¶“ç´¿ç¶çµ¨çµçµç¹çµ°çµç¹ªçµ¦çµ¢çµ³çµ¡çµ•çµçµ±ç¶†ç¶ƒçµ¹ç¹¡ç¶Œç¶çµ›ç¹¼ç¶ˆç¸¾ç·’ç¶¾ç·“çºŒç¶ºç·‹ç¶½ç·”ç·„ç¹©ç¶­ç¶¿ç¶¬ç¹ƒç¶¢ç¶¯ç¶¹ç¶£ç¶œç¶»ç¶°ç¶ ç¶´ç·‡ç·™ç·—ç·˜ç·¬çºœç·¹ç·²ç·ç¸•ç¹¢ç·¦ç¶ç·ç·¶ç·šç·±ç¸‹ç·©ç· ç¸·ç·¨ç·¡ç·£ç¸‰ç¸›ç¸Ÿç¸ç¸«ç¸—ç¸çºç¸­ç¸Šç¸‘ç¹½ç¸¹ç¸µç¸²çº“ç¸®ç¹†ç¹…çºˆç¹šç¹•ç¹’éŸç¹¾ç¹°ç¹¯ç¹³çº˜ç½Œç¶²ç¾…ç½°ç½·ç¾†ç¾ˆç¾¥ç¾¨ç¿¹ç¿½ç¿¬è€®è€¬è³æ¥è¶è¾è·è¹è¯èµè°è‚…è…¸è†šè†è…è…«è„¹è„…è†½å‹æœ§è…–è‡šè„›è† è„ˆè†¾é«’è‡è…¦è†¿è‡ è…³è„«è…¡è‡‰è‡˜é†ƒè†•é½¶è†©é¦è†ƒé¨°è‡è‡¢è¼¿è‰¤è‰¦è‰™è‰«è‰±è±”è‰¸è—ç¯€ç¾‹è–Œè•ªè˜†è“¯è‘¦è—¶è§è‡è’¼è‹§è˜‡æª¾è˜‹è–è˜¢è”¦å¡‹ç…¢ç¹­èŠè–¦è–˜è¢è•˜è“½è•è–ˆè–ºè•©æ¦®è‘·æ»çŠ–ç†’è•è—è“€è”­è•’è‘’è‘¤è—¥è’è“§èŠè“®è’”èµè–Ÿç²è••ç‘©é¶¯è“´è˜€è˜¿è¢ç‡Ÿç¸ˆè•­è–©è”¥è•†è•¢è”£è”è—è–Šè˜ºè•·é£é©€è–”è˜è—ºè—¹è˜„è˜Šè—ªæ§è˜šè™œæ…®è™›èŸ²è™¯èŸ£é›–è¦è †è•èŸ»èè ¶è ”èœ†è ±è £èŸ¶è »èŸ„è›ºèŸ¯è„è è›»è¸è Ÿè …èŸˆèŸ¬è è»è ‘è¿èŸè ¨é‡éŠœè£œè¥¯è¢è¥–å«‹è¤˜è¥ªè¥²è¥è£è¥ è¤Œè¤³è¥è¤²è¥‡è¤¸è¥¤ç¹ˆè¥´è¦‹è§€è¦è¦è¦“è¦–è¦˜è¦½è¦ºè¦¬è¦¡è¦¿è¦¥è¦¦è¦¯è¦²è¦·è§´è§¸è§¶è®‹è­½è¬„è¨è¨ˆè¨‚è¨ƒèªè­è¨è¨Œè¨è®“è¨•è¨–è¨“è­°è¨Šè¨˜è¨’è¬›è«±è¬³è©è¨è¨¥è¨±è¨›è«–è¨©è¨Ÿè«·è¨­è¨ªè¨£è­‰è©è¨¶è©•è©›è­˜è©—è©è¨´è¨ºè©†è¬…è©è©˜è©”è©–è­¯è©’èª†èª„è©¦è©¿è©©è©°è©¼èª èª…è©µè©±èª•è©¬è©®è©­è©¢è©£è«è©²è©³è©«è«¢è©¡è­¸èª¡èª£èªèªšèª¤èª¥èª˜èª¨èª‘èªªèª¦èª’è«‹è«¸è«è«¾è®€è«‘èª¹èª²è«‰è«›èª°è«—èª¿è«‚è«’è«„èª¶è«‡èª¼è¬€è«¶è«œè¬Šè««è«§è¬”è¬è¬‚è«¤è«­è«¼è®’è«®è«³è«ºè«¦è¬è«è«è¬¨è®œè¬–è¬è¬ è¬—è«¡è¬™è¬è¬¹è¬¾è¬«è­¾è¬¬è­šè­–è­™è®•è­œè­è®è­´è­«è®–ç©€è±¶è²è²è² è²Ÿè²¢è²¡è²¬è³¢æ•—è³¬è²¨è³ªè²©è²ªè²§è²¶è³¼è²¯è²«è²³è³¤è³è²°è²¼è²´è²ºè²¸è²¿è²»è³€è²½è³Šè´„è³ˆè³„è²²è³ƒè³‚è´“è³‡è³…è´è³•è³‘è³šè³’è³¦è³­é½è´–è³è³œè´”è³™è³¡è³ è³§è³´è³µè´…è³»è³ºè³½è³¾è´—è®šè´‡è´ˆè´è´è´›èµ¬è¶™è¶•è¶¨è¶²èº‰èºè¹Œè¹ èº’è¸èº‚è¹ºè¹•èºšèº‹è¸´èºŠè¹¤èº“èº‘èº¡è¹£èº•èº¥èºªèº¦è»€è»Šè»‹è»Œè»’è»‘è»”è½‰è»›è¼ªè»Ÿè½Ÿè»²è»»è½¤è»¸è»¹è»¼è»¤è»«è½¢è»ºè¼•è»¾è¼‰è¼Šè½è¼ˆè¼‡è¼…è¼ƒè¼’è¼”è¼›è¼¦è¼©è¼è¼¥è¼è¼¬è¼Ÿè¼œè¼³è¼»è¼¯è½€è¼¸è½¡è½…è½„è¼¾è½†è½è½”è¾­è¾¯è¾®é‚Šé¼é”é·éé‚é‹é‚„é€™é€²é é•é€£é²é‚‡é€•è·¡é©é¸éœéé‚é‚éºé™é„§é„ºé„”éƒµé„’é„´é„°é¬±éƒ¤éƒŸé„¶é„­é„†é…ˆé„–é„²é†é†±é†¬é‡…é‡ƒé‡€é‡‹è£é’œé‘’é‘¾é¨é‡“é‡”é‡é‡˜é‡—é‡™é‡•é‡·é‡ºé‡§é‡¤éˆ’é‡©é‡£é†é‡¹éšé‡µéˆƒéˆ£éˆˆéˆ¦éˆéˆ”é¾éˆ‰é‹‡é‹¼éˆ‘éˆé‘°æ¬½éˆé¢é‰¤éˆ§éˆéˆ¥éˆ„éˆ•éˆ€éˆºéŒ¢é‰¦é‰—éˆ·ç¼½éˆ³é‰•éˆ½éˆ¸é‰é‘½é‰¬é‰­é‰€éˆ¿éˆ¾éµé‰‘éˆ´é‘ é‰›é‰šéˆ°é‰‰é‰ˆé‰éˆ¹é¸é‰¶éŠ¬éŠ é‰ºéŠªé‹é‹£éƒéŠéºéŠ…é‹éŠ±éŠ¦é§é˜éŠ–éŠ‘é‹ŒéŠ©éŠ›éµéŠ“é‰¿éŠšé‰»éŠ˜éŒšéŠ«é‰¸éŠ¥éŸéŠƒé‹éŠ¨éŠ€éŠ£é‘„é’é‹ªé‹™éŒ¸é‹±éˆé—éŠ·é–é‹°é‹¥é‹¤é‹é‹¯é‹¨é½éŠ¼é‹é‹’é‹…é‹¶é¦é§éŠ³éŠ»é‹ƒé‹Ÿé‹¦éŒ’éŒ†éºéŒ¯éŒ¨éŒ¡éŒéŒ•éŒ©éŒ«éŒ®é‘¼éŒ˜éŒéŒ¦ééŒˆéŒ‡éŒŸéŒ éµé‹¸éŒ³éŒ™é¥éˆé‡é˜é¶é”é¤é¬é¾é›éªé é°é„éé‚é¤é¡éŒé®é›é˜é‘·é«é³é¿é¦é¬éŠé°é”é¢éœéé°éé¡é‘éƒé‡éé”é’éé·é‘¥é“é‘­é é‘¹é¹é™é‘Šé³é¶é²é®é¿é‘”é‘£é‘é‘²é•·é–€é–‚é–ƒé–†é–ˆé–‰å•é—–é–é—ˆé–‘é–é–“é–”é–Œæ‚¶é–˜é¬§é–¨èé—¥é–©é–­é—“é–¥é–£é–¡é–«é¬®é–±é–¬é—é–¾é–¹é–¶é¬©é–¿é–½é–»é–¼é—¡é—Œé—ƒé— é—Šé—‹é—”é—é—’é—•é—é—¤éšŠé™½é™°é™£éšéš›é™¸éš´é™³é™˜é™éš‰éš•éšªéš¨éš±éš¸é›‹é›£é››è®é‚éœ§éœ½é»´é„éšéœé¨éŸƒé½éŸ‰éŸéŸ‹éŸŒéŸéŸ“éŸ™éŸéŸœéŸ»é é ‚é ƒé ‡é …é †é ˆé Šé ‘é¡§é “é é ’é Œé é é¡±é ˜é —é ¸é ¡é °é ²é œæ½ç†²é ¦é ¤é »é ®é ¹é ·é ´ç©é¡†é¡Œé¡’é¡é¡“é¡é¡é¡³é¡¢é¡›é¡™é¡¥çº‡é¡«é¡¬é¡°é¡´é¢¨é¢ºé¢­é¢®é¢¯é¢¶é¢¸é¢¼é¢»é£€é£„é£†é£†é£›é¥—é¥œé££é¥‘é£¥é¤³é£©é¤¼é£ªé£«é£­é£¯é£²é¤é£¾é£½é£¼é£¿é£´é¤Œé¥’é¤‰é¤„é¤é¤ƒé¤é¤…é¤‘é¤–é¤“é¤˜é¤’é¤•é¤œé¤›é¤¡é¤¨é¤·é¥‹é¤¶é¤¿é¥é¥é¥ƒé¤ºé¤¾é¥ˆé¥‰é¥…é¥Šé¥Œé¥¢é¦¬é¦­é¦±é¦´é¦³é©…é¦¹é§é©¢é§”é§›é§Ÿé§™é§’é¨¶é§é§é§‘é§•é©›é§˜é©ç½µé§°é©•é©Šé§±é§­é§¢é©«é©ªé¨é©—é¨‚é§¸é§¿é¨é¨é¨é¨…é¨Œé©Œé©‚é¨™é¨­é¨¤é¨·é¨–é©é¨®é¨«é¨¸é©ƒé¨¾é©„é©é©Ÿé©¥é©¦é©¤é«é«–é«•é¬¢é­˜é­é­šé­›é­¢é­·é­¨é­¯é­´é­ºé®é®ƒé¯°é±¸é®‹é®“é®’é®Šé®‘é±Ÿé®é®é®­é®šé®³é®ªé®é®¦é°‚é®œé± é±­é®«é®®é®ºé¯—é±˜é¯é±ºé°±é°¹é¯‰é°£é°·é¯€é¯Šé¯‡é®¶é¯½é¯’é¯–é¯ªé¯•é¯«é¯¡é¯¤é¯§é¯é¯¢é¯°é¯›é¯¨é¯µé¯´é¯”é±é°ˆé°é±¨é¯·é°®é°ƒé°“é±·é°é°’é°‰é°é±‚é¯¿é° é¼‡é°­é°¨é°¥é°©é°Ÿé°œé°³é°¾é±ˆé±‰é°»é°µé±…é°¼é±–é±”é±—é±’é±¯é±¤é±§é±£é³¥é³©é›é³¶é³´é³²é·—é´‰é¶¬é´‡é´†é´£é¶‡é¸•é´¨é´é´¦é´’é´Ÿé´é´›é´¬é´•é·¥é·™é´¯é´°éµ‚é´´éµƒé´¿é¸é´»éµéµ“é¸éµ‘éµ éµéµ’é·³éµœéµ¡éµ²é¶“éµªé¶¤éµ¯éµ¬éµ®é¶‰é¶Šéµ·é·«é¶˜é¶¡é¶šé¶»é¶¿é¶¥é¶©é·Šé·‚é¶²é¶¹é¶ºé·é¶¼é¶´é·–é¸šé·“é·šé·¯é·¦é·²é·¸é·ºé¸‡é·¹é¸Œé¸é¸›é¸˜é¹ºéº¥éº©é»ƒé»Œé»¶é»·é»²é»½é»¿é¼‚é¼‰é€é¼´é½‡é½Šé½é½’é½”é½•é½—é½Ÿé½¡é½™é½ é½œé½¦é½¬é½ªé½²é½·é¾é¾”é¾•é¾œèªŒè£½è°˜éš»è£¡ä¿‚ç¯„é¬†å†‡åšå˜—é¬¨éºµæº–é˜å½†é–’ä¹¾å„˜è‡Ÿæ‹š&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Traditionalized</span>(<span class="params">cc</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> str = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> ss = <span class="title class_">JTPYStr</span>();</span><br><span class="line">    <span class="keyword">var</span> tt = <span class="title class_">FTPYStr</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cc.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cc.<span class="title function_">charCodeAt</span>(i) &gt; <span class="number">10000</span> &amp;&amp; ss.<span class="title function_">indexOf</span>(cc.<span class="title function_">charAt</span>(i)) != -<span class="number">1</span>) str += tt.<span class="title function_">charAt</span>(ss.<span class="title function_">indexOf</span>(cc.<span class="title function_">charAt</span>(i)));</span><br><span class="line">        <span class="keyword">else</span> str += cc.<span class="title function_">charAt</span>(i)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Simplized</span>(<span class="params">cc</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> str = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> ss = <span class="title class_">JTPYStr</span>();</span><br><span class="line">    <span class="keyword">var</span> tt = <span class="title class_">FTPYStr</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cc.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cc.<span class="title function_">charCodeAt</span>(i) &gt; <span class="number">10000</span> &amp;&amp; tt.<span class="title function_">indexOf</span>(cc.<span class="title function_">charAt</span>(i)) != -<span class="number">1</span>) str += ss.<span class="title function_">charAt</span>(tt.<span class="title function_">indexOf</span>(cc.<span class="title function_">charAt</span>(i)));</span><br><span class="line">        <span class="keyword">else</span> str += cc.<span class="title function_">charAt</span>(i)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setCookie</span>(<span class="params">name, value, days</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (days) &#123;</span><br><span class="line">        <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        date.<span class="title function_">setTime</span>(date.<span class="title function_">getTime</span>() + (days * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>));</span><br><span class="line">        <span class="keyword">var</span> expires = <span class="string">&quot;; expires=&quot;</span> + date.<span class="title function_">toGMTString</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">var</span> expires = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">cookie</span> = name + <span class="string">&quot;=&quot;</span> + value + expires + <span class="string">&quot;; path=/&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCookie</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> nameEQ = name + <span class="string">&quot;=&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> ca = <span class="variable language_">document</span>.<span class="property">cookie</span>.<span class="title function_">split</span>(<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; ca.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> c = ca[i];</span><br><span class="line">        <span class="keyword">while</span> (c.<span class="title function_">charAt</span>(<span class="number">0</span>) == <span class="string">&#x27; &#x27;</span>) c = c.<span class="title function_">substring</span>(<span class="number">1</span>, c.<span class="property">length</span>);</span><br><span class="line">        <span class="keyword">if</span> (c.<span class="title function_">indexOf</span>(nameEQ) == <span class="number">0</span>) <span class="keyword">return</span> c.<span class="title function_">substring</span>(nameEQ.<span class="property">length</span>, c.<span class="property">length</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">translateInitilization</span>(<span class="params"></span>) &#123;</span><br><span class="line">    translateButtonObject = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(translateButtonId);</span><br><span class="line">    <span class="keyword">if</span> (translateButtonObject) &#123;</span><br><span class="line">        <span class="title function_">with</span>(<span class="params">translateButtonObject</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_">typeof</span>(<span class="variable language_">document</span>.<span class="property">all</span>) != <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">                href = <span class="string">&quot;javascript:translatePage();&quot;</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                href = <span class="string">&quot;#&quot;</span>;</span><br><span class="line">                onclick = <span class="keyword">new</span> <span class="title class_">Function</span>(<span class="string">&quot;translatePage(); return false;&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (currentEncoding != targetEncoding) &#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="string">&quot;translateBody()&quot;</span>, translateDelay);</span><br><span class="line">            <span class="keyword">if</span> (targetEncoding == <span class="number">1</span>) translateButtonObject.<span class="property">innerHTML</span> = msgToSimplifiedChinese;</span><br><span class="line">            <span class="keyword">else</span> translateButtonObject.<span class="property">innerHTML</span> = msgToTraditionalChinese</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>

<ol start="2">
<li>ä¿®æ”¹æ¨¡æ¿ï¼Œåœ¨æˆ‘ä»¬æƒ³è¦æ˜¾ç¤ºç®€ç¹è½¬æ¢æŒ‰é’®çš„åœ°æ–¹æ·»åŠ å¦‚ä¸‹ä»£ç ã€‚ä¾‹å¦‚ï¼Œæˆ‘åœ¨ä¸»é¢˜è‡ªå®šä¹‰å¸ƒå±€æ–‡ä»¶ <code>source/_data/footer.njk</code> ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;translate-style&quot;</span>&gt;</span></span><br><span class="line">ç¹/ç®€ï¼š<span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;translateLink&quot;</span> <span class="attr">href</span>=<span class="string">&quot;javascript:translatePage();&quot;</span>&gt;</span>ç¹ä½“</span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/js/tw_cn.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> defaultEncoding = <span class="number">2</span>; <span class="comment">//ç½‘ç«™ç¼–å†™å­—ä½“æ˜¯å¦ç¹ä½“ï¼Œ1-ç¹ä½“ï¼Œ2-ç®€ä½“</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> translateDelay = <span class="number">0</span>; <span class="comment">//å»¶è¿Ÿæ—¶é—´,è‹¥ä¸åœ¨å‰, è¦è®¾å®šå»¶è¿Ÿç¿»è¯‘æ—¶é—´, å¦‚100è¡¨ç¤º100ms,é»˜è®¤ä¸º0</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> cookieDomain = <span class="string">&quot;https://novnan.github.io/&quot;</span>; <span class="comment">//Cookieåœ°å€, ä¸€å®šè¦è®¾å®š, é€šå¸¸ä¸ºä½ çš„ç½‘å€</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> msgToTraditionalChinese = <span class="string">&quot;ç¹ä½“&quot;</span>; <span class="comment">//æ­¤å¤„å¯ä»¥æ›´æ”¹ä¸ºä½ æƒ³è¦æ˜¾ç¤ºçš„æ–‡å­—</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> msgToSimplifiedChinese = <span class="string">&quot;ç®€ä½“&quot;</span>; <span class="comment">//åŒä¸Šï¼Œä½†ä¸¤å¤„å‡ä¸å»ºè®®æ›´æ”¹</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> translateButtonId = <span class="string">&quot;translateLink&quot;</span>; <span class="comment">//é»˜è®¤äº’æ¢id</span></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">translateInitilization</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­ <code>custom_file_path</code> éœ€å¼€å¯ <code>footer: source/_data/footer.njk</code> é…ç½®</strong></p>
<p>è¯»è€…å¯ä»¥åœ¨åšå®¢åº•éƒ¨ç‚¹å‡»ç®€ä½“ &#x2F; ç¹ä½“æ¥çœ‹å…·ä½“çš„åˆ‡æ¢å­—ä½“æ•ˆæœã€‚</p>
<h2 id="canvas-ç²’å­æ—¶é’Ÿ"><a href="#canvas-ç²’å­æ—¶é’Ÿ" class="headerlink" title="canvas ç²’å­æ—¶é’Ÿ"></a>canvas ç²’å­æ—¶é’Ÿ</h2><ol>
<li>åœ¨ <code>source/_data/sidebar.njk</code> æ·»åŠ å†…å®¹å¦‚ä¸‹ï¼š</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:60%;&quot;</span>&gt;</span>å½“å‰æµè§ˆå™¨ä¸æ”¯æŒcanvasï¼Œè¯·æ›´æ¢æµè§ˆå™¨åå†è¯•<span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">   <span class="keyword">var</span> digit=</span></span><br><span class="line"><span class="language-javascript">    [</span></span><br><span class="line"><span class="language-javascript">        [</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>]</span></span><br><span class="line"><span class="language-javascript">        ],<span class="comment">//0</span></span></span><br><span class="line"><span class="language-javascript">        [</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]</span></span><br><span class="line"><span class="language-javascript">        ],<span class="comment">//1</span></span></span><br><span class="line"><span class="language-javascript">        [</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]</span></span><br><span class="line"><span class="language-javascript">        ],<span class="comment">//2</span></span></span><br><span class="line"><span class="language-javascript">        [</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>]</span></span><br><span class="line"><span class="language-javascript">        ],<span class="comment">//3</span></span></span><br><span class="line"><span class="language-javascript">        [</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]</span></span><br><span class="line"><span class="language-javascript">        ],<span class="comment">//4</span></span></span><br><span class="line"><span class="language-javascript">        [</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>]</span></span><br><span class="line"><span class="language-javascript">        ],<span class="comment">//5</span></span></span><br><span class="line"><span class="language-javascript">        [</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>]</span></span><br><span class="line"><span class="language-javascript">        ],<span class="comment">//6</span></span></span><br><span class="line"><span class="language-javascript">        [</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span></span><br><span class="line"><span class="language-javascript">        ],<span class="comment">//7</span></span></span><br><span class="line"><span class="language-javascript">        [</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>]</span></span><br><span class="line"><span class="language-javascript">        ],<span class="comment">//8</span></span></span><br><span class="line"><span class="language-javascript">        [</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span></span><br><span class="line"><span class="language-javascript">        ],<span class="comment">//9</span></span></span><br><span class="line"><span class="language-javascript">        [</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span></span><br><span class="line"><span class="language-javascript">        ]<span class="comment">//:</span></span></span><br><span class="line"><span class="language-javascript">    ];</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">if</span>(canvas.<span class="property">getContext</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> cxt = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//å£°æ˜canvasçš„å®½é«˜</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> H = <span class="number">100</span>,W = <span class="number">700</span>;</span></span><br><span class="line"><span class="language-javascript">    canvas.<span class="property">height</span> = H;</span></span><br><span class="line"><span class="language-javascript">    canvas.<span class="property">width</span> = W;</span></span><br><span class="line"><span class="language-javascript">    cxt.<span class="property">fillStyle</span> = <span class="string">&#x27;#f00&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    cxt.<span class="title function_">fillRect</span>(<span class="number">10</span>,<span class="number">10</span>,<span class="number">50</span>,<span class="number">50</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//å­˜å‚¨æ—¶é—´æ•°æ®</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> data = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//å­˜å‚¨è¿åŠ¨çš„å°çƒ</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> balls = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//è®¾ç½®ç²’å­åŠå¾„</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> R = canvas.<span class="property">height</span>/<span class="number">20</span>-<span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">    (<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> temp = <span class="regexp">/(\d)(\d):(\d)(\d):(\d)(\d)/</span>.<span class="title function_">exec</span>(<span class="keyword">new</span> <span class="title class_">Date</span>());</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//å­˜å‚¨æ—¶é—´æ•°å­—ï¼Œç”±åä½å°æ—¶ã€ä¸ªä½å°æ—¶ã€å†’å·ã€åä½åˆ†é’Ÿã€ä¸ªä½åˆ†é’Ÿã€å†’å·ã€åä½ç§’é’Ÿã€ä¸ªä½ç§’é’Ÿè¿™7ä¸ªæ•°å­—ç»„æˆ</span></span></span><br><span class="line"><span class="language-javascript">        data.<span class="title function_">push</span>(temp[<span class="number">1</span>],temp[<span class="number">2</span>],<span class="number">10</span>,temp[<span class="number">3</span>],temp[<span class="number">4</span>],<span class="number">10</span>,temp[<span class="number">5</span>],temp[<span class="number">6</span>]);</span></span><br><span class="line"><span class="language-javascript">    &#125;)();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">/*ç”Ÿæˆç‚¹é˜µæ•°å­—*/</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">renderDigit</span>(<span class="params">index,num</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; digit[num].<span class="property">length</span>; i++)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; digit[num][i].<span class="property">length</span>; j++)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span>(digit[num][i][j] == <span class="number">1</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                    cxt.<span class="title function_">beginPath</span>();</span></span><br><span class="line"><span class="language-javascript">                    cxt.<span class="title function_">arc</span>(<span class="number">14</span>*(R+<span class="number">2</span>)*index + j*<span class="number">2</span>*(R+<span class="number">1</span>)+(R+<span class="number">1</span>),i*<span class="number">2</span>*(R+<span class="number">1</span>)+(R+<span class="number">1</span>),R,<span class="number">0</span>,<span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>);</span></span><br><span class="line"><span class="language-javascript">                    cxt.<span class="title function_">closePath</span>();</span></span><br><span class="line"><span class="language-javascript">                    cxt.<span class="title function_">fill</span>();</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">/*æ›´æ–°æ—¶é’Ÿ*/</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">updateDigitTime</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> changeNumArray = [];</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> temp = <span class="regexp">/(\d)(\d):(\d)(\d):(\d)(\d)/</span>.<span class="title function_">exec</span>(<span class="keyword">new</span> <span class="title class_">Date</span>());</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> <span class="title class_">NewData</span> = [];</span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">NewData</span>.<span class="title function_">push</span>(temp[<span class="number">1</span>],temp[<span class="number">2</span>],<span class="number">10</span>,temp[<span class="number">3</span>],temp[<span class="number">4</span>],<span class="number">10</span>,temp[<span class="number">5</span>],temp[<span class="number">6</span>]);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> i = data.<span class="property">length</span>-<span class="number">1</span>; i &gt;=<span class="number">0</span> ; i--)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//æ—¶é—´å‘ç”Ÿå˜åŒ–</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(<span class="title class_">NewData</span>[i] !== data[i])&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//å°†å˜åŒ–çš„æ•°å­—å€¼å’Œåœ¨dataæ•°ç»„ä¸­çš„ç´¢å¼•å­˜å‚¨åœ¨changeNumArrayæ•°ç»„ä¸­</span></span></span><br><span class="line"><span class="language-javascript">                changeNumArray.<span class="title function_">push</span>(i+<span class="string">&#x27;_&#x27;</span>+(<span class="title class_">Number</span>(data[i])+<span class="number">1</span>)%<span class="number">10</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//å¢åŠ å°çƒ</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i&lt; changeNumArray.<span class="property">length</span>; i++)&#123;</span></span><br><span class="line"><span class="language-javascript">            addBalls.<span class="title function_">apply</span>(<span class="variable language_">this</span>,changeNumArray[i].<span class="title function_">split</span>(<span class="string">&#x27;_&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        data = <span class="title class_">NewData</span>.<span class="title function_">concat</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">/*æ›´æ–°å°çƒçŠ¶æ€*/</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">updateBalls</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; balls.<span class="property">length</span>; i++)&#123;</span></span><br><span class="line"><span class="language-javascript">            balls[i].<span class="property">stepY</span> += balls[i].<span class="property">disY</span>;</span></span><br><span class="line"><span class="language-javascript">            balls[i].<span class="property">x</span> += balls[i].<span class="property">stepX</span>;</span></span><br><span class="line"><span class="language-javascript">            balls[i].<span class="property">y</span> += balls[i].<span class="property">stepY</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(balls[i].<span class="property">x</span> &gt; W + R || balls[i].<span class="property">y</span> &gt; H + R)&#123;</span></span><br><span class="line"><span class="language-javascript">                balls.<span class="title function_">splice</span>(i,<span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">                i--;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">/*å¢åŠ è¦è¿åŠ¨çš„å°çƒ*/</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">addBalls</span>(<span class="params">index,num</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> numArray = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> colorArray =  [<span class="string">&quot;#3BE&quot;</span>,<span class="string">&quot;#09C&quot;</span>,<span class="string">&quot;#A6C&quot;</span>,<span class="string">&quot;#93C&quot;</span>,<span class="string">&quot;#9C0&quot;</span>,<span class="string">&quot;#690&quot;</span>,<span class="string">&quot;#FB3&quot;</span>,<span class="string">&quot;#F80&quot;</span>,<span class="string">&quot;#F44&quot;</span>,<span class="string">&quot;#C00&quot;</span>];</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; digit[num].<span class="property">length</span>; i++)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; digit[num][i].<span class="property">length</span>; j++)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span>(digit[num][i][j] == <span class="number">1</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> ball = &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">x</span>:<span class="number">14</span>*(R+<span class="number">2</span>)*index + j*<span class="number">2</span>*(R+<span class="number">1</span>)+(R+<span class="number">1</span>),</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">y</span>:i*<span class="number">2</span>*(R+<span class="number">1</span>)+(R+<span class="number">1</span>),</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">stepX</span>:<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">4</span> -<span class="number">2</span>),</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">stepY</span>:-<span class="number">2</span>*numArray[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*numArray.<span class="property">length</span>)],</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">color</span>:colorArray[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*colorArray.<span class="property">length</span>)],</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">disY</span>:<span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;;</span></span><br><span class="line"><span class="language-javascript">                    balls.<span class="title function_">push</span>(ball);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">/*æ¸²æŸ“*/</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//é‡ç½®ç”»å¸ƒå®½åº¦ï¼Œè¾¾åˆ°æ¸…ç©ºç”»å¸ƒçš„æ•ˆæœ</span></span></span><br><span class="line"><span class="language-javascript">        canvas.<span class="property">height</span> = <span class="number">100</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//æ¸²æŸ“æ—¶é’Ÿ</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; i++)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">renderDigit</span>(i,data[i]);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//æ¸²æŸ“å°çƒ</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; balls.<span class="property">length</span>; i++)&#123;</span></span><br><span class="line"><span class="language-javascript">            cxt.<span class="title function_">beginPath</span>();</span></span><br><span class="line"><span class="language-javascript">            cxt.<span class="title function_">arc</span>(balls[i].<span class="property">x</span>,balls[i].<span class="property">y</span>,R,<span class="number">0</span>,<span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>);</span></span><br><span class="line"><span class="language-javascript">            cxt.<span class="property">fillStyle</span> = balls[i].<span class="property">color</span>;</span></span><br><span class="line"><span class="language-javascript">            cxt.<span class="title function_">closePath</span>();</span></span><br><span class="line"><span class="language-javascript">            cxt.<span class="title function_">fill</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">clearInterval</span>(oTimer);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> oTimer = <span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//æ›´æ–°æ—¶é’Ÿ</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">updateDigitTime</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//æ›´æ–°å°çƒçŠ¶æ€</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">updateBalls</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//æ¸²æŸ“</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">render</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;,<span class="number">50</span>);</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;)();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­ <code>custom_file_path</code> éœ€å¼€å¯ <code>sidebar: source/_data/sidebar.njk</code> é…ç½®</strong></p>
<ol start="2">
<li>åœ¨ <code>source/_data/styles.styl</code> æ·»åŠ ï¼š</li>
</ol>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">// ç²’å­æ—¶é’Ÿæ ·å¼</span><br><span class="line"><span class="selector-class">.site-overview</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">canvas</span><span class="selector-id">#canvas</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­ <code>custom_file_path</code> éœ€å¼€å¯ <code>style: source/_data/styles.styl</code> é…ç½®</strong></p>
<h2 id="åœ¨æ–‡ç« ç»“å°¾æ·»åŠ æœ¬æ–‡ç»“æŸæ ‡å¿—"><a href="#åœ¨æ–‡ç« ç»“å°¾æ·»åŠ æœ¬æ–‡ç»“æŸæ ‡å¿—" class="headerlink" title="åœ¨æ–‡ç« ç»“å°¾æ·»åŠ æœ¬æ–‡ç»“æŸæ ‡å¿—"></a>åœ¨æ–‡ç« ç»“å°¾æ·»åŠ æœ¬æ–‡ç»“æŸæ ‡å¿—</h2><p>åœ¨ <code>source/_data/post-body-end.njk</code> æ·»åŠ ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% if not is_index and theme.post_end_tag.enable %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align:center;font-size:22px;letter-spacing:10px;user-select:none;color:#bbb;&quot;</span>&gt;</span>-------------æœ¬æ–‡ç»“æŸ<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-paw&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>æ„Ÿè°¢æ‚¨çš„é˜…è¯»-------------<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­ <code>custom_file_path</code> éœ€å¼€å¯ <code>postBodyEnd: source/_data/post-body-end.njk</code> é…ç½®</strong></p>
<p>ç„¶åæˆ‘ä»¬åœ¨<strong>ä¸»é¢˜é…ç½®</strong>æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ–‡ç« æœ«å°¾æ·»åŠ â€œæœ¬æ–‡ç»“æŸâ€æ ‡è®°</span></span><br><span class="line"><span class="attr">post_end_tag:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="ä»£ç å—æŠ˜å "><a href="#ä»£ç å—æŠ˜å " class="headerlink" title="ä»£ç å—æŠ˜å "></a>ä»£ç å—æŠ˜å </h2><ol>
<li>æ–°å»ºå†…å»ºæ ‡ç­¾ foldï¼šæˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»º <code>scripts/tags</code> æ–‡ä»¶å¤¹ï¼ˆå³ <code>scripts/tags/</code>ï¼‰ï¼Œæ–°å»º <code>fold_tag.js</code>ï¼š</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* global hexo */</span></span><br><span class="line"><span class="comment">// Usage: &#123;% fold ç‚¹å‡»æ˜¾/éšå†…å®¹ %&#125; Something &#123;% endfold %&#125;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fold</span> (args, content) &#123;</span><br><span class="line">  <span class="keyword">var</span> text = args[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span>(!text) text = <span class="string">&quot;ç‚¹å‡»æ˜¾/éš&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;&lt;div&gt;&lt;div class=&quot;fold_hider&quot;&gt;&lt;div class=&quot;close hider_title&quot;&gt;&#x27;</span> + text + <span class="string">&#x27;&lt;/div&gt;&lt;/div&gt;&lt;div class=&quot;fold&quot;&gt;\n&#x27;</span> + hexo.<span class="property">render</span>.<span class="title function_">renderSync</span>(&#123;<span class="attr">text</span>: content, <span class="attr">engine</span>: <span class="string">&#x27;markdown&#x27;</span>&#125;) + <span class="string">&#x27;\n&lt;/div&gt;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">tag</span>.<span class="title function_">register</span>(<span class="string">&#x27;fold&#x27;</span>, fold, &#123;<span class="attr">ends</span>: <span class="literal">true</span>&#125;);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åˆ›å»º <code>source/js/fold_action.js</code>ï¼š</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    $(<span class="variable language_">document</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;.fold_hider&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        $(<span class="string">&#x27;&gt;.fold&#x27;</span>, <span class="variable language_">this</span>.<span class="property">parentNode</span>).<span class="title function_">slideToggle</span>();</span><br><span class="line">        $(<span class="string">&#x27;&gt;:first&#x27;</span>, <span class="variable language_">this</span>).<span class="title function_">toggleClass</span>(<span class="string">&#x27;open&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//é»˜è®¤æƒ…å†µä¸‹æŠ˜å </span></span><br><span class="line">    $(<span class="string">&quot;div.fold&quot;</span>).<span class="title function_">css</span>(<span class="string">&quot;display&quot;</span>,<span class="string">&quot;none&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æˆ‘ä»¬åœ¨ <code>source/_data/body-end.njk</code> æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;# ä»£ç å—æŠ˜å  #&#125;</span><br><span class="line">  &lt;script type=&quot;text/javascript&quot; src=&quot;/js/fold_action.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­ <code>custom_file_path</code> éœ€å¼€å¯ <code>postBodyEnd: source/_data/post-body-end.njk</code> é…ç½®</strong></p>
<ol start="4">
<li>æœ€åï¼Œä¿®æ”¹ <code>source/_data/style.styl</code> é…ç½®é£æ ¼ï¼š</li>
</ol>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">// ä»£ç æŠ˜å åŠŸèƒ½æ·»åŠ </span><br><span class="line"><span class="selector-class">.hider_title</span>&#123;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#ef4a05</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.close</span><span class="selector-pseudo">:before</span>&#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;â–¼&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.open</span><span class="selector-pseudo">:before</span>&#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;â–²&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­ <code>custom_file_path</code> éœ€å¼€å¯ <code>style: source/_data/styles.styl</code> é…ç½®</strong></p>
<ol start="5">
<li>ä½¿ç”¨æ–¹æ³•ï¼š</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% fold ç‚¹å‡»æ˜¾/éšå†…å®¹ %&#125;</span><br><span class="line">something you want to fold, include code block.</span><br><span class="line">&#123;% endfold %&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>NexT</tag>
      </tags>
  </entry>
  <entry>
    <title>Goå¹¶å‘-ä½¿ç”¨åç¨‹ã€é€šé“å’Œselect</title>
    <url>/GO/Go%E5%B9%B6%E5%8F%91-%E4%BD%BF%E7%94%A8%E5%8D%8F%E7%A8%8B%E3%80%81%E9%80%9A%E9%81%93%E5%92%8Cselect/</url>
    <content><![CDATA[<h2 id="é€šé“å’Œé˜»å¡"><a href="#é€šé“å’Œé˜»å¡" class="headerlink" title="é€šé“å’Œé˜»å¡"></a>é€šé“å’Œé˜»å¡</h2><p>é€šé“ï¼ˆchannelï¼‰å’Œåç¨‹ï¼ˆgoroutineï¼‰æ˜¯å®ç°Goå¹¶å‘ç¨‹åºçš„ä¸¤ç§æœºåˆ¶ã€‚å…¶ä¸­ï¼Œé€šé“åˆåˆ†ä¸ºæ— ç¼“å†²é€šé“å’Œæœ‰ç¼“å†²é€šé“ä¸¤ç§ï¼Œåœ¨ç¼–å†™å®é™…çš„å¹¶å‘ç¨‹åºæ—¶ï¼ŒåŸºæœ¬éƒ½ä½¿ç”¨å¼‚æ­¥æ¨¡å¼çš„æœ‰ç¼“å†²é€šé“ã€‚é€šé“åˆå¯ç»†åˆ†ä¸ºæ”¯æŒè¯»å’Œå†™çš„åŒå‘é€šé“ï¼Œåªè¯»çš„é€šé“ï¼Œåªå†™çš„é€šé“ä¸‰ç§ã€‚</p>
<h2 id="é€šé“é˜»å¡åœºæ™¯"><a href="#é€šé“é˜»å¡åœºæ™¯" class="headerlink" title="é€šé“é˜»å¡åœºæ™¯"></a>é€šé“é˜»å¡åœºæ™¯</h2><p>æ— è®ºæ˜¯æœ‰ç¼“å­˜é€šé“ã€è¿˜æ˜¯æ— ç¼“å†²é€šé“éƒ½å­˜åœ¨é˜»å¡çš„æƒ…å†µã€‚é˜»å¡åœºæ™¯å…±4ä¸ªï¼Œæœ‰ç¼“å­˜å’Œæ— ç¼“å†²å„2ä¸ªã€‚</p>
<p>æ— ç¼“å†²é€šé“çš„ç‰¹ç‚¹æ˜¯ï¼Œå‘é€çš„æ•°æ®éœ€è¦è¢«è¯»å–åå‘é€æ‰ä¼šå®Œæˆï¼ˆåŒæ­¥ï¼‰ï¼Œå®ƒé˜»å¡åœºæ™¯æ˜¯ï¼š</p>
<ul>
<li>é€šé“ä¸­æ— æ•°æ®ï¼Œä½†æ‰§è¡Œè¯»é€šé“ã€‚</li>
<li>é€šé“ä¸­æ— æ•°æ®ï¼Œå‘é€šé“å†™æ•°æ®ï¼Œä½†æ— åç¨‹è¯»å–ã€‚</li>
</ul>
<p>æœ‰ç¼“å­˜é€šé“çš„ç‰¹ç‚¹æ˜¯ï¼Œæœ‰ç¼“å­˜æ—¶å¯ä»¥å‘é€šé“ä¸­å†™å…¥æ•°æ®åç›´æ¥è¿”å›ï¼ˆå¼‚æ­¥ï¼‰ï¼Œå®ƒé˜»å¡åœºæ™¯æ˜¯ï¼š</p>
<ul>
<li>é€šé“ç¼“å­˜æ— æ•°æ®ï¼Œä½†æ‰§è¡Œè¯»é€šé“(æ¥æ”¶æ•°æ®)ã€‚</li>
<li>é€šé“ç¼“å­˜å·²ç»å æ»¡ï¼Œå‘é€šé“å†™æ•°æ®(å‘é€æ•°æ®)ï¼Œä½†æ— åç¨‹è¯»ã€‚</li>
</ul>
<h2 id="ä½¿ç”¨åç¨‹ã€é€šé“å’Œselect"><a href="#ä½¿ç”¨åç¨‹ã€é€šé“å’Œselect" class="headerlink" title="ä½¿ç”¨åç¨‹ã€é€šé“å’Œselect"></a>ä½¿ç”¨åç¨‹ã€é€šé“å’Œselect</h2><p>Goçš„selectå…³é”®å­—å¯ä»¥è®©æˆ‘ä»¬æ“ä½œå¤šä¸ªé€šé“ï¼Œå°†åç¨‹ï¼ˆgoroutineï¼‰ï¼Œé€šé“ï¼ˆchannelï¼‰å’Œselectç»“åˆèµ·æ¥æ„æˆäº†Goçš„ä¸€ä¸ªå¼ºå¤§ç‰¹æ€§ã€‚</p>
<span id="more"></span>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€çŸ­ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    c1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>, <span class="number">1</span>)         <span class="comment">//å®šä¹‰ä¸¤ä¸ªæœ‰ç¼“å†²é€šé“ï¼Œå®¹é‡ä¸º1</span></span><br><span class="line">    c2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        time.Sleep(time.Second * <span class="number">1</span>)   <span class="comment">//æ¯éš”1ç§’å‘é€æ•°æ®</span></span><br><span class="line">        c1 &lt;- <span class="string">&quot;name: xuchao&quot;</span></span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        time.Sleep(time.Second * <span class="number">2</span>)    <span class="comment">//æ¯éš”2ç§’å‘é€æ•°æ®</span></span><br><span class="line">        c2 &lt;- <span class="string">&quot;age: 25&quot;</span></span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="number">2</span>; i++ &#123;                <span class="comment">//ä½¿ç”¨selectæ¥ç­‰å¾…è¿™ä¸¤ä¸ªé€šé“çš„å€¼ï¼Œç„¶åè¾“å‡º</span></span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> msg1 := &lt;- c1:</span><br><span class="line">            fmt.Println(msg1)</span><br><span class="line">        <span class="keyword">case</span> msg2 := &lt;- c2:</span><br><span class="line">            fmt.Println(msg2)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># go run channel.go </span><br><span class="line">name: xuchao</span><br><span class="line">age: 25</span><br></pre></td></tr></table></figure>

<p>å¦‚æˆ‘ä»¬æ‰€æœŸæœ›çš„ï¼Œç¨‹åºè¾“å‡ºäº†æ­£ç¡®çš„å€¼ã€‚å¯¹äºselectè¯­å¥è€Œè¨€ï¼Œå®ƒä¸æ–­åœ°æ£€æµ‹é€šé“æ˜¯å¦æœ‰å€¼è¿‡æ¥ï¼Œä¸€æ—¦å‘ç°æœ‰å€¼è¿‡æ¥ï¼Œç«‹åˆ»è·å–è¾“å‡ºã€‚</p>
<h2 id="ä½¿ç”¨Select-è¶…æ—¶å®ç°æ— é˜»å¡è¯»å†™"><a href="#ä½¿ç”¨Select-è¶…æ—¶å®ç°æ— é˜»å¡è¯»å†™" class="headerlink" title="ä½¿ç”¨Select+è¶…æ—¶å®ç°æ— é˜»å¡è¯»å†™"></a>ä½¿ç”¨Select+è¶…æ—¶å®ç°æ— é˜»å¡è¯»å†™</h2><p>selectæ˜¯æ‰§è¡Œé€‰æ‹©æ“ä½œçš„ä¸€ä¸ªç»“æ„ï¼Œå®ƒé‡Œé¢æœ‰ä¸€ç»„caseè¯­å¥ï¼Œå®ƒä¼šæ‰§è¡Œå…¶ä¸­æ— é˜»å¡çš„é‚£ä¸€ä¸ªï¼Œå¦‚æœéƒ½é˜»å¡äº†ï¼Œé‚£å°±ç­‰å¾…å…¶ä¸­ä¸€ä¸ªä¸é˜»å¡ï¼Œè¿›è€Œç»§ç»­æ‰§è¡Œï¼Œå®ƒæœ‰ä¸€ä¸ªdefaultè¯­å¥ï¼Œè¯¥è¯­å¥æ˜¯æ°¸è¿œä¸ä¼šé˜»å¡çš„ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©å®ƒå®ç°æ— é˜»å¡çš„æ“ä½œã€‚</p>
<p>ä½†ä½¿ç”¨defaultå®ç°çš„æ— é˜»å¡é€šé“é˜»å¡æœ‰ä¸€ä¸ªç¼ºé™·ï¼šå½“é€šé“ä¸å¯è¯»æˆ–å†™çš„æ—¶å€™ï¼Œä¼šå³å¯è¿”å›ã€‚å®é™…åœºæ™¯æ›´å¤šçš„éœ€æ±‚æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›å°è¯•è¯»ä¸€ä¼šæ•°æ®ï¼Œæˆ–è€…å°è¯•å†™ä¸€ä¼šæ•°æ®ï¼Œå¦‚æœå®åœ¨æ²¡æ³•è¯»å†™å†è¿”å›ï¼Œç¨‹åºç»§ç»­åšå…¶å®ƒçš„äº‹æƒ…ã€‚</p>
<p>ä½¿ç”¨å®šæ—¶å™¨æ›¿ä»£defaultå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç»™é€šé“å¢åŠ è¯»å†™æ•°æ®çš„å®¹å¿æ—¶é—´ï¼Œå¦‚æœ5så†…æ— æ³•è¯»å†™ï¼Œå°±å³åˆ»è¿”å›ã€‚ç¤ºä¾‹ä»£ç ä¿®æ”¹ä¸€ä¸‹ä¼šæ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;time&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	c1 := make(chan string, 1) //å®šä¹‰ä¸¤ä¸ªæœ‰ç¼“å†²é€šé“ï¼Œå®¹é‡åˆ†åˆ«ä¸º1</span><br><span class="line">	c2 := make(chan string, 1)</span><br><span class="line"></span><br><span class="line">	go func() &#123;                     //å®šä¹‰ä¸€ä¸ªåç¨‹</span><br><span class="line">		time.Sleep(time.Second * 1) //éš”1ç§’å‘é€æ•°æ®</span><br><span class="line">		c1 &lt;- &quot;name: xuchao&quot;        //å‘c1é€šé“å‘é€æ•°æ®</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	go func() &#123;</span><br><span class="line">		time.Sleep(time.Second * 6) //éš”6ç§’å‘é€æ•°æ®</span><br><span class="line">		c2 &lt;- &quot;age: 25&quot;             //å‘c2é€šé“å‘é€æ•°æ®</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	for i := 0; i &lt; 2; i++ &#123;                  //ä½¿ç”¨selectæ¥è·å–è¿™ä¸¤ä¸ªé€šé“çš„å€¼ï¼Œç„¶åè¾“å‡º</span><br><span class="line">		tm := time.NewTimer(time.Second * 5) //ç»™é€šé“åˆ›å»ºå®¹å¿æ—¶é—´ï¼Œå¦‚æœ5så†…æ— æ³•è¯»å†™ï¼Œå°±å³åˆ»è¿”å›</span><br><span class="line">		select &#123;</span><br><span class="line">		case msg1 := &lt;-c1:          //æ¥æ”¶c1é€šé“æ•°æ®ï¼ˆæ¶ˆè´¹æ•°æ®ï¼‰</span><br><span class="line">			fmt.Println(msg1)</span><br><span class="line">		case msg2 := &lt;-c2:          //æ¥æ”¶c2é€šé“æ•°æ®ï¼ˆæ¶ˆè´¹æ•°æ®ï¼‰</span><br><span class="line">			fmt.Println(msg2)</span><br><span class="line">		case &lt;-tm.C:</span><br><span class="line">			fmt.Println(&quot;send data timeout!&quot;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»“æœå°±ä¼šå˜æˆè¶…æ—¶è¿”å›ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># go run channel2.go </span><br><span class="line">name: xuchao</span><br><span class="line">send data timeout!</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><strong>ä¸ºä»€ä¹ˆGoè¯­è¨€å¯¹é€šé“è¦é™åˆ¶é•¿åº¦è€Œä¸æä¾›æ— é™é•¿åº¦çš„é€šé“ï¼Ÿ</strong><br>æˆ‘ä»¬çŸ¥é“é€šé“ï¼ˆchannelï¼‰æ˜¯åœ¨ä¸¤ä¸ª goroutineé—´é€šä¿¡çš„æ¡¥æ¢ã€‚å½“æ•°æ®æä¾›æ–¹ä¾›ç»™é€Ÿåº¦å¤§äºæ¶ˆè´¹æ–¹æ•°æ®å¤„ç†é€Ÿåº¦æ—¶ï¼Œå¦‚æœé€šé“ä¸é™åˆ¶é•¿åº¦ï¼Œé‚£ä¹ˆå†…å­˜å°†ä¸æ–­è†¨èƒ€ç›´åˆ°åº”ç”¨å´©æºƒã€‚å› æ­¤ï¼Œé™åˆ¶é€šé“çš„é•¿åº¦æœ‰åˆ©äºçº¦æŸæ•°æ®æä¾›æ–¹çš„ä¾›ç»™é€Ÿåº¦ï¼Œæ‰èƒ½æ­£å¸¸åœ°å¤„ç†æ•°æ®ã€‚</p>
<p><strong>å¸¸ç”¨çš„selectåœºæ™¯</strong></p>
<ul>
<li>æ— é˜»å¡çš„è¯»ã€å†™é€šé“ã€‚å³ä½¿é€šé“æ˜¯å¸¦ç¼“å­˜çš„ï¼Œä¹Ÿæ˜¯å­˜åœ¨é˜»å¡çš„æƒ…å†µï¼Œä½¿ç”¨selectå¯ä»¥å®Œç¾çš„è§£å†³é˜»å¡è¯»å†™ã€‚</li>
<li>ç»™æŸä¸ªè¯·æ±‚&#x2F;å¤„ç†&#x2F;æ“ä½œï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œä¸€æ—¦è¶…æ—¶æ—¶é—´å†…æ— æ³•å®Œæˆï¼Œåˆ™åœæ­¢å¤„ç†ã€‚</li>
<li>selectæœ¬è‰²ï¼šå¤šé€šé“å¤„ç†ã€‚</li>
</ul>
<p><strong>è§£å†³é˜»å¡çš„2ç§åŠæ³•</strong></p>
<ul>
<li>ä½¿ç”¨selectçš„defaultè¯­å¥ï¼Œåœ¨channelä¸å¯è¯»å†™æ—¶ï¼Œå³å¯è¿”å›</li>
<li>ä½¿ç”¨select+å®šæ—¶å™¨ï¼Œåœ¨è¶…æ—¶æ—¶é—´å†…ï¼Œchannelä¸å¯è¯»å†™ï¼Œåˆ™è¿”å›ï¼ˆæ¨èæ–¹å¼ï¼‰</li>
</ul>
<p>è®°ä½ï¼Œåœ¨forå¾ªç¯é‡Œä¸è¦ä½¿ç”¨select + time.Afterçš„ç»„åˆï¼Œæ˜“é€ æˆå†…å­˜æ³„æ¼ï¼Œåº”å½“ä½¿ç”¨NewTimeræ¥åšå®šæ—¶å™¨ã€‚å½“ä½¿ç”¨golangè¿‡ç¨‹ä¸­ï¼Œé‡åˆ°æ€§èƒ½å’Œå†…å­˜gcé—®é¢˜ï¼Œéƒ½å¯ä»¥ä½¿ç”¨golang tool pprofæ¥æ’æŸ¥åˆ†æé—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>GO</category>
      </categories>
      <tags>
        <tag>GO</tag>
        <tag>channel</tag>
        <tag>goroutine</tag>
      </tags>
  </entry>
  <entry>
    <title>Laravel æœåŠ¡å®¹å™¨</title>
    <url>/Laravel/learn-laravel-container/</url>
    <content><![CDATA[<blockquote>
<p>å®¹å™¨ï¼Œå­—é¢ä¸Šç†è§£å°±æ˜¯è£…ä¸œè¥¿çš„ä¸œè¥¿ã€‚å¸¸è§çš„å˜é‡ã€å¯¹è±¡å±æ€§ç­‰éƒ½å¯ä»¥ç®—æ˜¯å®¹å™¨ã€‚ä¸€ä¸ªå®¹å™¨èƒ½å¤Ÿè£…ä»€ä¹ˆï¼Œå…¨éƒ¨å–å†³äºä½ å¯¹è¯¥å®¹å™¨çš„å®šä¹‰ã€‚å½“ç„¶ï¼Œæœ‰è¿™æ ·ä¸€ç§å®¹å™¨ï¼Œå®ƒå­˜æ”¾çš„ä¸æ˜¯æ–‡æœ¬ã€æ•°å€¼ï¼Œè€Œæ˜¯å¯¹è±¡ã€å¯¹è±¡çš„æè¿°ï¼ˆç±»ã€æ¥å£ï¼‰æˆ–è€…æ˜¯æä¾›å¯¹è±¡çš„å›è°ƒï¼Œé€šè¿‡è¿™ç§å®¹å™¨ï¼Œæˆ‘ä»¬å¾—ä»¥å®ç°è®¸å¤šé«˜çº§çš„åŠŸèƒ½ï¼Œå…¶ä¸­æœ€å¸¸æåˆ°çš„ï¼Œå°±æ˜¯ â€œè§£è€¦â€ ã€â€œä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰â€ã€‚æœ¬æ–‡å°±ä»è¿™é‡Œå¼€å§‹ã€‚</p>
</blockquote>
<h2 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h2><div class="note info"><p>Laravel Framework version 5.1.41 (LTS)</p>
</div>

<h2 id="IoC-å®¹å™¨ï¼Œ-laravel-çš„æ ¸å¿ƒ"><a href="#IoC-å®¹å™¨ï¼Œ-laravel-çš„æ ¸å¿ƒ" class="headerlink" title="IoC å®¹å™¨ï¼Œ laravel çš„æ ¸å¿ƒ"></a>IoC å®¹å™¨ï¼Œ laravel çš„æ ¸å¿ƒ</h2><p>Laravel çš„æ ¸å¿ƒå°±æ˜¯ä¸€ä¸ª <code>IoC å®¹å™¨</code>ï¼Œæ ¹æ®æ–‡æ¡£ï¼Œç§°å…¶ä¸ºâ€œ<code>æœåŠ¡å®¹å™¨</code>â€ï¼Œé¡¾åæ€ä¹‰ï¼Œè¯¥å®¹å™¨æä¾›äº†æ•´ä¸ªæ¡†æ¶ä¸­éœ€è¦çš„ä¸€ç³»åˆ—æœåŠ¡ã€‚ä½œä¸ºåˆå­¦è€…ï¼Œå¾ˆå¤šäººä¼šåœ¨è¿™ä¸€ä¸ªæ¦‚å¿µä¸ŠçŠ¯éš¾ï¼Œå› æ­¤ï¼Œæˆ‘æ‰“ç®—ä»ä¸€äº›åŸºç¡€çš„å†…å®¹å¼€å§‹è®²è§£ï¼Œé€šè¿‡ç†è§£é¢å‘å¯¹è±¡å¼€å‘ä¸­ä¾èµ–çš„äº§ç”Ÿå’Œè§£å†³æ–¹æ³•ï¼Œæ¥é€æ¸æ­å¼€â€œä¾èµ–æ³¨å…¥â€çš„é¢çº±ï¼Œé€æ¸ç†è§£è¿™ä¸€ç¥å¥‡çš„è®¾è®¡ç†å¿µã€‚</p>
<p>æœ¬æ–‡ä¸€å¤§åŠå†…å®¹éƒ½æ˜¯é€šè¿‡ä¸¾ä¾‹æ¥è®©è¯»è€…å»ç†è§£ä»€ä¹ˆæ˜¯ <code>IoCï¼ˆæ§åˆ¶åè½¬ï¼‰</code> å’Œ <code>DIï¼ˆä¾èµ–æ³¨å…¥ï¼‰</code>ï¼Œé€šè¿‡ç†è§£è¿™äº›æ¦‚å¿µï¼Œæ¥æ›´åŠ æ·±å…¥ã€‚æ›´å¤šå…³äº laravel æœåŠ¡å®¹å™¨çš„ç”¨æ³•å»ºè®®é˜…è¯»æ–‡æ¡£å³å¯ã€‚</p>
<h2 id="IoC-å®¹å™¨è¯ç”Ÿçš„æ•…äº‹"><a href="#IoC-å®¹å™¨è¯ç”Ÿçš„æ•…äº‹" class="headerlink" title="IoC å®¹å™¨è¯ç”Ÿçš„æ•…äº‹"></a>IoC å®¹å™¨è¯ç”Ÿçš„æ•…äº‹</h2><p>è®²è§£ IoC å®¹å™¨æœ‰å¾ˆå¤šçš„æ–‡ç« ï¼Œæˆ‘ä¹‹å‰ä¹Ÿå†™è¿‡ã€‚ä½†ç°åœ¨æˆ‘æ‰“ç®—åˆ©ç”¨å½“ä¸‹çš„çµæ„Ÿé‡æ–°æ¥è¿‡ï¼Œé‚£ä¹ˆå¼€å§‹å§ã€‚</p>
<span id="more"></span>

<h3 id="è¶…äººå’Œè¶…èƒ½åŠ›ï¼Œä¾èµ–çš„äº§ç”Ÿï¼"><a href="#è¶…äººå’Œè¶…èƒ½åŠ›ï¼Œä¾èµ–çš„äº§ç”Ÿï¼" class="headerlink" title="è¶…äººå’Œè¶…èƒ½åŠ›ï¼Œä¾èµ–çš„äº§ç”Ÿï¼"></a>è¶…äººå’Œè¶…èƒ½åŠ›ï¼Œä¾èµ–çš„äº§ç”Ÿï¼</h3><p>é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œæœ‰ä»¥ä¸‹å‡ æ ·ä¸œè¥¿æ— æ—¶ä¸åˆ»çš„æ¥è§¦ï¼š<code>æ¥å£</code>ã€<code>ç±»</code>è¿˜æœ‰<code>å¯¹è±¡</code>ã€‚è¿™å…¶ä¸­ï¼Œæ¥å£æ˜¯ç±»çš„åŸå‹ï¼Œä¸€ä¸ªç±»å¿…é¡»è¦éµå®ˆå…¶å®ç°çš„æ¥å£ï¼›å¯¹è±¡åˆ™æ˜¯ä¸€ä¸ªç±»å®ä¾‹åŒ–åçš„äº§ç‰©ï¼Œæˆ‘ä»¬ç§°å…¶ä¸ºä¸€ä¸ªå®ä¾‹ã€‚å½“ç„¶è¿™æ ·è¯´è‚¯å®šä¸åˆ©äºç†è§£ï¼Œæˆ‘ä»¬å°±å®é™…çš„å†™ç‚¹ä¸­çœ‹ä¸ä¸­ç”¨çš„ä»£ç è¾…åŠ©å­¦ä¹ ã€‚</p>
<blockquote>
<p>æ€ªç‰©æ¨ªè¡Œçš„ä¸–ç•Œï¼Œæ€»å½’éœ€è¦ç‚¹è¶…çº§äººç‰©æ¥æ‘†å¹³ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬æŠŠä¸€ä¸ªâ€œè¶…äººâ€ä½œä¸ºä¸€ä¸ªç±»ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Superman</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥æƒ³è±¡ï¼Œä¸€ä¸ªè¶…äººè¯ç”Ÿçš„æ—¶å€™è‚¯å®šæ‹¥æœ‰è‡³å°‘ä¸€ä¸ªè¶…èƒ½åŠ›ï¼Œè¿™ä¸ªè¶…èƒ½åŠ›ä¹Ÿå¯ä»¥æŠ½è±¡ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä¸ºè¿™ä¸ªå¯¹è±¡å®šä¹‰ä¸€ä¸ªæè¿°ä»–çš„ç±»å§ã€‚ä¸€ä¸ªè¶…èƒ½åŠ›è‚¯å®šæœ‰å¤šç§å±æ€§ã€ï¼ˆæ“ä½œï¼‰æ–¹æ³•ï¼Œè¿™ä¸ªå°½æƒ…çš„æƒ³è±¡ï¼Œä½†æ˜¯ç›®å‰æˆ‘ä»¬å…ˆå¤§è‡´å®šä¹‰ä¸€ä¸ªåªæœ‰å±æ€§çš„â€œè¶…èƒ½åŠ›â€ï¼Œè‡³äºèƒ½å¹²å•¥ï¼Œæˆ‘ä»¬ä»¥åå†ä¸°å¯Œï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Power</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * èƒ½åŠ›å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$ability</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * èƒ½åŠ›èŒƒå›´æˆ–è·ç¦»</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$range</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$ability</span>, <span class="variable">$range</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ability = <span class="variable">$ability</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;range = <span class="variable">$range</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™æˆ‘ä»¬å›è¿‡å¤´ï¼Œä¿®æ”¹ä¸€ä¸‹ä¹‹å‰çš„â€œè¶…äººâ€ç±»ï¼Œè®©ä¸€ä¸ªâ€œè¶…äººâ€åˆ›å»ºçš„æ—¶å€™è¢«èµ‹äºˆä¸€ä¸ªè¶…èƒ½åŠ›ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Superman</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$power</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;power = <span class="keyword">new</span> <span class="title class_">Power</span>(<span class="number">999</span>, <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„è¯ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªâ€œè¶…äººâ€å®ä¾‹çš„æ—¶å€™ï¼ŒåŒæ—¶ä¹Ÿåˆ›å»ºäº†ä¸€ä¸ªâ€œè¶…èƒ½åŠ›â€çš„å®ä¾‹ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ç‚¹ï¼Œâ€œè¶…äººâ€å’Œâ€œè¶…èƒ½åŠ›â€ä¹‹é—´ä¸å¯é¿å…çš„äº§ç”Ÿäº†ä¸€ä¸ªä¾èµ–ã€‚</p>
<blockquote>
<p>æ‰€è°“â€œä¾èµ–â€ï¼Œå°±æ˜¯ â€œæˆ‘è‹¥ä¾èµ–ä½ ï¼Œæˆ‘å°±ä¸èƒ½ç¦»å¼€ä½ â€ã€‚</p>
</blockquote>
<p>åœ¨ä¸€ä¸ªè´¯å½»é¢å‘å¯¹è±¡ç¼–ç¨‹çš„é¡¹ç›®ä¸­ï¼Œè¿™æ ·çš„ä¾èµ–éšå¤„å¯è§ã€‚å°‘é‡çš„ä¾èµ–å¹¶ä¸ä¼šæœ‰å¤ªè¿‡ç›´è§‚çš„å½±å“ï¼Œæˆ‘ä»¬éšç€è¿™ä¸ªä¾‹å­é€æ¸é“ºå¼€ï¼Œè®©å¤§å®¶æ…¢æ…¢æ„è¯†åˆ°ï¼Œå½“ä¾èµ–è¾¾åˆ°ä¸€ä¸ªé‡çº§æ—¶ï¼Œæ˜¯æ€æ ·ä¸€ç•ªå™©æ¢¦èˆ¬çš„ä½“éªŒã€‚å½“ç„¶ï¼Œæˆ‘ä¹Ÿä¼šè‡ªç„¶è€Œç„¶çš„è®²è¿°å¦‚ä½•è§£å†³é—®é¢˜ã€‚</p>
<h3 id="ä¸€å †ä¹±éº»-â€”â€”-å¯æ€•çš„ä¾èµ–"><a href="#ä¸€å †ä¹±éº»-â€”â€”-å¯æ€•çš„ä¾èµ–" class="headerlink" title="ä¸€å †ä¹±éº» â€”â€” å¯æ€•çš„ä¾èµ–"></a>ä¸€å †ä¹±éº» â€”â€” å¯æ€•çš„ä¾èµ–</h3><p>ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œè¶…èƒ½åŠ›ç±»å®ä¾‹åŒ–åæ˜¯ä¸€ä¸ªå…·ä½“çš„è¶…èƒ½åŠ›ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œè¶…äººçš„è¶…èƒ½åŠ›æ˜¯å¤šå…ƒåŒ–çš„ï¼Œæ¯ç§è¶…èƒ½åŠ›çš„æ–¹æ³•ã€å±æ€§éƒ½æœ‰ä¸å°çš„å·®å¼‚ï¼Œæ²¡æ³•é€šè¿‡ä¸€ç§ç±»æè¿°å®Œå…¨ã€‚æˆ‘ä»¬ç°åœ¨è¿›è¡Œä¿®æ”¹ï¼Œæˆ‘ä»¬å‡è®¾è¶…äººå¯ä»¥æœ‰ä»¥ä¸‹å¤šç§è¶…èƒ½åŠ›ï¼š</p>
<ul>
<li>é£è¡Œï¼Œå±æ€§æœ‰ï¼šé£è¡Œé€Ÿåº¦ã€æŒç»­é£è¡Œæ—¶é—´</li>
<li>è›®åŠ›ï¼Œå±æ€§æœ‰ï¼šåŠ›é‡å€¼</li>
<li>èƒ½é‡å¼¹ï¼Œå±æ€§æœ‰ï¼šä¼¤å®³å€¼ã€å°„å‡»è·ç¦»ã€åŒæ—¶å°„å‡»ä¸ªæ•°</li>
</ul>
<p>æˆ‘ä»¬åˆ›å»ºäº†å¦‚ä¸‹ç±»ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flight</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$speed</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$holdtime</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$speed</span>, <span class="variable">$holdtime</span></span>) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Force</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$force</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$force</span></span>) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shot</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$atk</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$range</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$limit</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$atk</span>, <span class="variable">$range</span>, <span class="variable">$limit</span></span>) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>ä¸ºäº†çœäº‹å„¿æˆ‘æ²¡æœ‰è¯¦ç»†å†™å‡º __construct() è¿™ä¸ªæ„é€ å‡½æ•°çš„å…¨éƒ¨ï¼Œåªå†™äº†éœ€è¦ä¼ é€’çš„å‚æ•°ã€‚</em></p>
<p>å¥½äº†ï¼Œè¿™ä¸‹æˆ‘ä»¬çš„è¶…äººæœ‰ç‚¹â€œå¿™â€äº†ã€‚åœ¨è¶…äººåˆå§‹åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæ ¹æ®éœ€è¦æ¥å®ä¾‹åŒ–å…¶æ‹¥æœ‰çš„è¶…èƒ½åŠ›å—ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Superman</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$power</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;power = <span class="keyword">new</span> <span class="title class_">Fight</span>(<span class="number">9</span>, <span class="number">100</span>);</span><br><span class="line">        <span class="comment">// $this-&gt;power = new Force(45);</span></span><br><span class="line">        <span class="comment">// $this-&gt;power = new Shot(99, 50, 2);</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        $this-&gt;power = array(</span></span><br><span class="line"><span class="comment">            new Force(45),</span></span><br><span class="line"><span class="comment">            new Shot(99, 50, 2)</span></span><br><span class="line"><span class="comment">        );</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬éœ€è¦è‡ªå·±æ‰‹åŠ¨çš„åœ¨æ„é€ å‡½æ•°å†…ï¼ˆæˆ–è€…å…¶ä»–æ–¹æ³•é‡Œï¼‰å®ä¾‹åŒ–ä¸€ç³»åˆ—éœ€è¦çš„ç±»ï¼Œè¿™æ ·å¹¶ä¸å¥½ã€‚å¯ä»¥æƒ³è±¡ï¼Œå‡å¦‚éœ€æ±‚å˜æ›´ï¼ˆä¸åŒçš„æ€ªç‰©æ¨ªè¡Œåœ°çƒï¼‰ï¼Œéœ€è¦æ›´å¤šçš„æœ‰é’ˆå¯¹æ€§çš„ <strong>æ–°çš„</strong> è¶…èƒ½åŠ›ï¼Œæˆ–è€…éœ€è¦ <strong>å˜æ›´</strong> è¶…èƒ½åŠ›çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¿…é¡» <code>é‡æ–°æ”¹é€ </code> è¶…äººã€‚<strong>æ¢å¥è¯è¯´å°±æ˜¯ï¼Œæ”¹å˜è¶…èƒ½åŠ›çš„åŒæ—¶ï¼Œæˆ‘è¿˜å¾—é‡æ–°åˆ¶é€ ä¸ªè¶…äººã€‚</strong>æ•ˆç‡å¤ªä½äº†ï¼æ–°è¶…äººè¿˜æ²¡åˆ›é€ å®Œæˆä¸–ç•Œæ—©å·²è¢«æ¯ç­ã€‚</p>
<blockquote>
<p>è¿™æ—¶ï¼Œçµæœºä¸€åŠ¨çš„äººæƒ³åˆ°ï¼šä¸ºä»€ä¹ˆä¸å¯ä»¥è¿™æ ·å‘¢ï¼Ÿè¶…äººçš„èƒ½åŠ›å¯ä»¥è¢«éšæ—¶æ›´æ¢ï¼Œåªéœ€è¦æ·»åŠ æˆ–è€…æ›´æ–°ä¸€ä¸ªèŠ¯ç‰‡æˆ–è€…å…¶ä»–è£…ç½®å•¥çš„ï¼ˆæƒ³åˆ°é’¢é“ä¾ æ²¡ï¼‰ã€‚è¿™æ ·çš„è¯å°±ä¸è¦æ•´ä¸ªé‡æ–°æ¥è¿‡äº†ã€‚</p>
</blockquote>
<p>å¯¹ï¼Œå°±æ˜¯è¿™æ ·çš„ã€‚</p>
<p>æˆ‘ä»¬ä¸åº”è¯¥æ‰‹åŠ¨åœ¨ â€œè¶…äººâ€ ç±»ä¸­å›ºåŒ–äº†ä»–çš„ â€œè¶…èƒ½åŠ›â€ åˆå§‹åŒ–çš„è¡Œä¸ºï¼Œè€Œè½¬ç”±å¤–éƒ¨è´Ÿè´£ï¼Œç”±å¤–éƒ¨åˆ›é€ è¶…èƒ½åŠ›æ¨¡ç»„ã€è£…ç½®æˆ–è€…èŠ¯ç‰‡ç­‰ï¼ˆæˆ‘ä»¬åé¢ç»Ÿä¸€ç§°ä¸º â€œæ¨¡ç»„â€ï¼‰ï¼Œæ¤å…¥è¶…äººä½“å†…çš„æŸä¸€ä¸ªæ¥å£ï¼Œè¿™ä¸ªæ¥å£æ˜¯ä¸€ä¸ªæ—¢å®šçš„ï¼Œåªè¦è¿™ä¸ª â€œæ¨¡ç»„â€ æ»¡è¶³è¿™ä¸ªæ¥å£çš„è£…ç½®éƒ½å¯ä»¥è¢«è¶…äººæ‰€åˆ©ç”¨ï¼Œå¯ä»¥æå‡ã€å¢åŠ è¶…äººçš„æŸä¸€ç§èƒ½åŠ›ã€‚è¿™ç§ç”±å¤–éƒ¨è´Ÿè´£å…¶ä¾èµ–éœ€æ±‚çš„è¡Œä¸ºï¼Œæˆ‘ä»¬å¯ä»¥ç§°å…¶ä¸º â€œ<code>æ§åˆ¶åè½¬ï¼ˆIoCï¼‰</code>â€ã€‚</p>
<h3 id="å·¥å‚æ¨¡å¼ï¼Œä¾èµ–è½¬ç§»ï¼"><a href="#å·¥å‚æ¨¡å¼ï¼Œä¾èµ–è½¬ç§»ï¼" class="headerlink" title="å·¥å‚æ¨¡å¼ï¼Œä¾èµ–è½¬ç§»ï¼"></a>å·¥å‚æ¨¡å¼ï¼Œä¾èµ–è½¬ç§»ï¼</h3><p>å½“ç„¶ï¼Œå®ç°æ§åˆ¶åè½¬çš„æ–¹æ³•æœ‰å‡ ç§ã€‚åœ¨è¿™ä¹‹å‰ï¼Œä¸å¦‚æˆ‘ä»¬å…ˆäº†è§£ä¸€äº›å¥½ç©çš„ä¸œè¥¿ã€‚</p>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥æƒ³åˆ°ï¼Œç»„ä»¶ã€å·¥å…·ï¼ˆæˆ–è€…è¶…äººçš„æ¨¡ç»„ï¼‰ï¼Œæ˜¯ä¸€ç§å¯è¢«ç”Ÿäº§çš„ç©æ„å„¿ï¼Œç”Ÿäº§çš„åœ°æ–¹å½“ç„¶æ˜¯ â€œå·¥å‚ï¼ˆFactoryï¼‰â€ï¼Œäºæ˜¯æœ‰äººå°±æå‡ºäº†è¿™æ ·ä¸€ç§æ¨¡å¼ï¼š å·¥å‚æ¨¡å¼ã€‚</p>
</blockquote>
<p>å·¥å‚æ¨¡å¼ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸€ä¸ªç±»æ‰€ä¾èµ–çš„å¤–éƒ¨äº‹ç‰©çš„å®ä¾‹ï¼Œéƒ½å¯ä»¥è¢«ä¸€ä¸ªæˆ–å¤šä¸ª â€œå·¥å‚â€ åˆ›å»ºçš„è¿™æ ·ä¸€ç§å¼€å‘æ¨¡å¼ï¼Œå°±æ˜¯ â€œ<code>å·¥å‚æ¨¡å¼</code>â€ã€‚</p>
<p>æˆ‘ä»¬ä¸ºäº†ç»™è¶…äººåˆ¶é€ è¶…èƒ½åŠ›æ¨¡ç»„ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå·¥å‚ï¼Œå®ƒå¯ä»¥åˆ¶é€ å„ç§å„æ ·çš„æ¨¡ç»„ï¼Œä¸”ä»…éœ€è¦é€šè¿‡ä¸€ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SuperModuleFactory</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">makeModule</span>(<span class="params"><span class="variable">$moduleName</span>, <span class="variable">$options</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable">$moduleName</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;Fight&#x27;</span>:   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Fight</span>(<span class="variable">$options</span>[<span class="number">0</span>], <span class="variable">$options</span>[<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;Force&#x27;</span>:   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Force</span>(<span class="variable">$options</span>[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;Shot&#x27;</span>:    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Shot</span>(<span class="variable">$options</span>[<span class="number">0</span>], <span class="variable">$options</span>[<span class="number">1</span>], <span class="variable">$options</span>[<span class="number">2</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™ï¼Œè¶…äºº åˆ›å»ºä¹‹åˆå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå·¥å‚ï¼</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Superman</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$power</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–å·¥å‚</span></span><br><span class="line">        <span class="variable">$factory</span> = <span class="keyword">new</span> SuperModuleFactory;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// é€šè¿‡å·¥å‚æä¾›çš„æ–¹æ³•åˆ¶é€ éœ€è¦çš„æ¨¡å—</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;power = <span class="variable">$factory</span>-&gt;<span class="title function_ invoke__">makeModule</span>(<span class="string">&#x27;Fight&#x27;</span>, [<span class="number">9</span>, <span class="number">100</span>]);</span><br><span class="line">        <span class="comment">// $this-&gt;power = $factory-&gt;makeModule(&#x27;Force&#x27;, [45]);</span></span><br><span class="line">        <span class="comment">// $this-&gt;power = $factory-&gt;makeModule(&#x27;Shot&#x27;, [99, 50, 2]);</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        $this-&gt;power = array(</span></span><br><span class="line"><span class="comment">            $factory-&gt;makeModule(&#x27;Force&#x27;, [45]),</span></span><br><span class="line"><span class="comment">            $factory-&gt;makeModule(&#x27;Shot&#x27;, [99, 50, 2])</span></span><br><span class="line"><span class="comment">        );</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å¾—å‡ºï¼Œæˆ‘ä»¬ä¸å†éœ€è¦åœ¨è¶…äººåˆå§‹åŒ–ä¹‹åˆï¼Œå»åˆå§‹åŒ–è®¸å¤šç¬¬ä¸‰æ–¹ç±»ï¼Œåªéœ€åˆå§‹åŒ–ä¸€ä¸ªå·¥å‚ç±»ï¼Œå³å¯æ»¡è¶³éœ€æ±‚ã€‚ä½†è¿™æ ·ä¼¼ä¹å’Œä»¥å‰åŒºåˆ«ä¸å¤§ï¼Œåªæ˜¯æ²¡æœ‰é‚£ä¹ˆå¤š <code>new</code> å…³é”®å­—ã€‚å…¶å®æˆ‘ä»¬ç¨å¾®æ”¹é€ ä¸€ä¸‹è¿™ä¸ªç±»ï¼Œä½ å°±æ˜ç™½ï¼Œå·¥å‚ç±»çš„çœŸæ­£æ„ä¹‰å’Œä»·å€¼äº†ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Superman</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$power</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$modules</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–å·¥å‚</span></span><br><span class="line">        <span class="variable">$factory</span> = <span class="keyword">new</span> SuperModuleFactory;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// é€šè¿‡å·¥å‚æä¾›çš„æ–¹æ³•åˆ¶é€ éœ€è¦çš„æ¨¡å—</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$modules</span> <span class="keyword">as</span> <span class="variable">$moduleName</span> =&gt; <span class="variable">$moduleOptions</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;power[] = <span class="variable">$factory</span>-&gt;<span class="title function_ invoke__">makeModule</span>(<span class="variable">$moduleName</span>, <span class="variable">$moduleOptions</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// åˆ›å»ºè¶…äºº</span></span><br><span class="line"><span class="variable">$superman</span> = <span class="keyword">new</span> <span class="title class_">Superman</span>([</span><br><span class="line">    <span class="string">&#x27;Fight&#x27;</span> =&gt; [<span class="number">9</span>, <span class="number">100</span>], </span><br><span class="line">    <span class="string">&#x27;Shot&#x27;</span> =&gt; [<span class="number">99</span>, <span class="number">50</span>, <span class="number">2</span>]</span><br><span class="line">    ]);</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ä¿®æ”¹çš„ç»“æœä»¤äººæ»¡æ„ã€‚ç°åœ¨ï¼Œâ€œè¶…äººâ€ çš„åˆ›å»ºä¸å†ä¾èµ–ä»»ä½•ä¸€ä¸ª â€œè¶…èƒ½åŠ›â€ çš„ç±»ï¼Œæˆ‘ä»¬å¦‚è‹¥ä¿®æ”¹äº†æˆ–è€…å¢åŠ äº†æ–°çš„è¶…èƒ½åŠ›ï¼Œåªéœ€è¦é’ˆå¯¹ä¿®æ”¹ <code>SuperModuleFactory</code> å³å¯ã€‚æ‰©å……è¶…èƒ½åŠ›çš„åŒæ—¶ä¸å†éœ€è¦é‡æ–°ç¼–è¾‘è¶…äººçš„ç±»æ–‡ä»¶ï¼Œä½¿å¾—æˆ‘ä»¬å˜å¾—å¾ˆè½»æ¾ã€‚ä½†æ˜¯ï¼Œè¿™æ‰åˆšåˆšå¼€å§‹ã€‚</p>
<h3 id="å†è¿›ä¸€æ­¥ï¼IoC-å®¹å™¨çš„é‡è¦ç»„æˆ-â€”â€”-ä¾èµ–æ³¨å…¥ï¼"><a href="#å†è¿›ä¸€æ­¥ï¼IoC-å®¹å™¨çš„é‡è¦ç»„æˆ-â€”â€”-ä¾èµ–æ³¨å…¥ï¼" class="headerlink" title="å†è¿›ä¸€æ­¥ï¼IoC å®¹å™¨çš„é‡è¦ç»„æˆ â€”â€” ä¾èµ–æ³¨å…¥ï¼"></a>å†è¿›ä¸€æ­¥ï¼IoC å®¹å™¨çš„é‡è¦ç»„æˆ â€”â€” ä¾èµ–æ³¨å…¥ï¼</h3><p>ç”± â€œè¶…äººâ€ å¯¹ â€œè¶…èƒ½åŠ›â€ çš„ä¾èµ–å˜æˆ â€œè¶…äººâ€ å¯¹ â€œè¶…èƒ½åŠ›æ¨¡ç»„å·¥å‚â€ çš„ä¾èµ–åï¼Œå¯¹ä»˜å°æ€ªå…½ä»¬å˜å¾—æ›´åŠ å¾—å¿ƒåº”æ‰‹ã€‚ä½†è¿™ä¹Ÿæ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œä¾èµ–å¹¶æœªè§£é™¤ï¼Œåªæ˜¯ç”±åŸæ¥å¯¹å¤šä¸ªå¤–éƒ¨çš„ä¾èµ–å˜æˆäº†å¯¹ä¸€ä¸ª â€œå·¥å‚â€ çš„ä¾èµ–ã€‚å‡å¦‚å·¥å‚å‡ºäº†ç‚¹éº»çƒ¦ï¼Œé—®é¢˜å˜å¾—å°±å¾ˆæ£˜æ‰‹ã€‚</p>
<blockquote>
<p>å…¶å®å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå·¥å‚æ¨¡å¼å·²ç»è¶³å¤Ÿäº†ã€‚å·¥å‚æ¨¡å¼çš„ç¼ºç‚¹å°±æ˜¯ï¼šæ¥å£æœªçŸ¥ï¼ˆå³æ²¡æœ‰ä¸€ä¸ªå¾ˆå¥½çš„å¥‘çº¦æ¨¡å‹ï¼Œå…³äºè¿™ä¸ªæˆ‘é©¬ä¸Šä¼šæœ‰è§£é‡Šï¼‰ã€äº§ç”Ÿå¯¹è±¡ç±»å‹å•ä¸€ã€‚æ€»ä¹‹å°±æ˜¯ï¼Œè¿˜æ˜¯ä¸å¤Ÿçµæ´»ã€‚è™½ç„¶å¦‚æ­¤ï¼Œå·¥å‚æ¨¡å¼ä¾æ—§ååˆ†ä¼˜ç§€ï¼Œå¹¶ä¸”é€‚ç”¨äºç»å¤§å¤šæ•°æƒ…å†µã€‚ä¸è¿‡æˆ‘ä»¬ä¸ºäº†è®²è§£åé¢çš„ <code>ä¾èµ–æ³¨å…¥</code> ï¼Œè¿™é‡Œå°±å…ˆå¤¸å¤§ä¸€ä¸‹å·¥å‚æ¨¡å¼çš„ç¼ºé™·å’¯ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œè¶…äººä¾èµ–çš„æ¨¡ç»„ï¼Œæˆ‘ä»¬è¦æ±‚æœ‰ç»Ÿä¸€çš„æ¥å£ï¼Œè¿™æ ·æ‰èƒ½å’Œè¶…äººèº«ä¸Šçš„æ³¨å…¥æ¥å£å¯¹æ¥ï¼Œæœ€ç»ˆèµ·åˆ°æå‡è¶…èƒ½åŠ›çš„æ•ˆæœã€‚</p>
<p>äº‹å®ä¸Šï¼Œæˆ‘ä¹‹å‰è¯´è°äº†ï¼Œä¸ä»…ä»…åªæœ‰ä¸€å †å°æ€ªå…½ï¼Œè¿˜æœ‰æ›´å¤šçš„å¤§æ€ªå…½ã€‚å˜¿å˜¿ã€‚é¢ï¼Œè¿™æ—¶å€™ä¼¼ä¹å·¥å‚çš„ç”Ÿäº§èƒ½åŠ›æ˜¾å¾—æœ‰äº›ä¸è¶³ â€”â€” ç”±äºå·¥å‚æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰çš„æ¨¡ç»„éƒ½å·²ç»åœ¨å·¥å‚ç±»ä¸­å®‰æ’å¥½äº†ï¼Œå¦‚æœæœ‰æ–°çš„ã€é«˜çº§çš„æ¨¡ç»„åŠ å…¥ï¼Œæˆ‘ä»¬å¿…é¡»ä¿®æ”¹å·¥å‚ç±»ï¼ˆå¥½æ¯”å¢åŠ æ–°çš„ç”Ÿäº§çº¿ï¼‰ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SuperModuleFactory</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">makeModule</span>(<span class="params"><span class="variable">$moduleName</span>, <span class="variable">$options</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable">$moduleName</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;Fight&#x27;</span>:   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Fight</span>(<span class="variable">$options</span>[<span class="number">0</span>], <span class="variable">$options</span>[<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;Force&#x27;</span>:   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Force</span>(<span class="variable">$options</span>[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;Shot&#x27;</span>:    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Shot</span>(<span class="variable">$options</span>[<span class="number">0</span>], <span class="variable">$options</span>[<span class="number">1</span>], <span class="variable">$options</span>[<span class="number">2</span>]);</span><br><span class="line">            <span class="comment">// case &#x27;more&#x27;: .......</span></span><br><span class="line">            <span class="comment">// case &#x27;and more&#x27;: .......</span></span><br><span class="line">            <span class="comment">// case &#x27;and more&#x27;: .......</span></span><br><span class="line">            <span class="comment">// case &#x27;oh no! its too many!&#x27;: .......</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°æ²¡ã€‚ã€‚ã€‚å™©æ¢¦èˆ¬çš„æ„Ÿå—ï¼</p>
<blockquote>
<p>å…¶å®çµæ„Ÿå°±å·®ä¸€æ­¥ï¼ä½ å¯èƒ½ä¼šæƒ³åˆ°æ›´ä¸ºçµæ´»çš„åŠæ³•ï¼å¯¹ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯æˆ‘ä»¬ä»Šå¤©çš„ä¸»è¦é…è§’ â€”â€” DI ï¼ˆä¾èµ–æ³¨å…¥ï¼‰</p>
</blockquote>
<p>ç”±äºå¯¹è¶…èƒ½åŠ›æ¨¡ç»„çš„éœ€æ±‚ä¸æ–­å¢å¤§ï¼Œæˆ‘ä»¬éœ€è¦é›†åˆæ•´ä¸ªä¸–ç•Œçš„é«˜æ™ºå•†äººæ‰ï¼Œä¸€èµ·è§£å†³é—®é¢˜ï¼Œä¸åº”è¯¥ä»…ä»…åªæœ‰å‡ ä¸ªå·¥å‚å„æ–­è´Ÿè´£ã€‚ä¸è¿‡é«˜æ™ºå•†äººæ‰ä»¬éƒ½éå¸¸è‡ªè´Ÿï¼Œè®¤ä¸ºè‡ªå·±çš„æƒ³æ³•æ˜¯å¯¹çš„ï¼Œåˆ›é€ å‡ºçš„è¶…èƒ½åŠ›æ¨¡ç»„æ²¡æœ‰ç»Ÿä¸€çš„æ¥å£ï¼Œè‡ªç„¶è€Œç„¶æ— æ³•è¢«æ­£å¸¸ä½¿ç”¨ã€‚è¿™æ—¶æˆ‘ä»¬éœ€è¦æå‡ºä¸€ç§å¥‘çº¦ï¼Œè¿™æ ·æ— è®ºæ˜¯è°åˆ›é€ å‡ºçš„æ¨¡ç»„ï¼Œéƒ½ç¬¦åˆè¿™æ ·çš„æ¥å£ï¼Œè‡ªç„¶å°±å¯è¢«æ­£å¸¸ä½¿ç”¨ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">SuperModuleInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¶…èƒ½åŠ›æ¿€æ´»æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * ä»»ä½•ä¸€ä¸ªè¶…èƒ½åŠ›éƒ½å¾—æœ‰è¯¥æ–¹æ³•ï¼Œå¹¶æ‹¥æœ‰ä¸€ä¸ªå‚æ•°</span></span><br><span class="line"><span class="comment">     *<span class="doctag">@param</span> array $target é’ˆå¯¹ç›®æ ‡ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œè‡ªå·±æˆ–ä»–äºº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">activate</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$target</span></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬å®šä¸‹äº†ä¸€ä¸ªæ¥å£ ï¼ˆè¶…èƒ½åŠ›æ¨¡ç»„çš„è§„èŒƒã€å¥‘çº¦ï¼‰ï¼Œæ‰€æœ‰è¢«åˆ›é€ çš„æ¨¡ç»„å¿…é¡»éµå®ˆè¯¥è§„èŒƒï¼Œæ‰èƒ½è¢«ç”Ÿäº§ã€‚</p>
</blockquote>
<blockquote>
<p>å…¶å®ï¼Œè¿™å°±æ˜¯ php ä¸­ <code>æ¥å£ï¼ˆ interface ï¼‰</code> çš„ç”¨å¤„å’Œæ„ä¹‰ï¼å¾ˆå¤šäººè§‰å¾—ï¼Œä¸ºä»€ä¹ˆ php éœ€è¦æ¥å£è¿™ç§ä¸œè¥¿ï¼Ÿéš¾é“ä¸æ˜¯ java ã€ C# ä¹‹ç±»çš„è¯­è¨€æ‰æœ‰çš„å—ï¼Ÿè¿™ä¹ˆè¯´ï¼Œåªè¦æ˜¯ä¸€ä¸ªæ­£å¸¸çš„é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ï¼ˆè™½ç„¶ php å¯ä»¥é¢å‘è¿‡ç¨‹ï¼‰ï¼Œéƒ½åº”è¯¥å…·å¤‡è¿™ä¸€ç‰¹æ€§ã€‚å› ä¸ºä¸€ä¸ª <code>å¯¹è±¡ï¼ˆobjectï¼‰</code> æœ¬èº«æ˜¯ç”±ä»–çš„æ¨¡æ¿æˆ–è€…åŸå‹ â€”â€” <code>ç±» ï¼ˆclassï¼‰</code> ï¼Œç»è¿‡å®ä¾‹åŒ–åäº§ç”Ÿçš„ä¸€ä¸ªå…·ä½“äº‹ç‰©ï¼Œè€Œæœ‰æ—¶å€™ï¼Œå®ç°ç»Ÿä¸€ç§æ–¹æ³•ä¸”ä¸åŒåŠŸèƒ½ï¼ˆæˆ–ç‰¹æ€§ï¼‰çš„æ—¶å€™ï¼Œä¼šå­˜åœ¨å¾ˆå¤šçš„ç±»ï¼ˆclassï¼‰ï¼Œè¿™æ—¶å€™å°±éœ€è¦æœ‰ä¸€ä¸ªå¥‘çº¦ï¼Œè®©å¤§å®¶ç¼–å†™å‡ºå¯ä»¥è¢«éšæ—¶æ›¿æ¢å´ä¸ä¼šäº§ç”Ÿå½±å“çš„æ¥å£ã€‚è¿™ç§ç”±ç¼–ç¨‹è¯­è¨€æœ¬èº«æå‡ºçš„ç¡¬æ€§è§„èŒƒï¼Œä¼šå¢åŠ æ›´å¤šä¼˜ç§€çš„ç‰¹æ€§ã€‚</p>
</blockquote>
<blockquote>
<p>è™½ç„¶æœ‰äº›ç»•ï¼Œä½†é€šè¿‡æˆ‘ä»¬æ¥ä¸‹æ¥çš„å®ä¾‹ï¼Œå¤§å®¶ä¼šæ…¢æ…¢é¢†ä¼šæ¥å£å¸¦æ¥çš„å¥½å¤„ã€‚</p>
</blockquote>
<p>è¿™æ—¶å€™ï¼Œé‚£äº›æå‡ºæ›´å¥½çš„è¶…èƒ½åŠ›æ¨¡ç»„çš„é«˜æ™ºå•†äººæ‰ï¼Œéµå¾ªè¿™ä¸ªæ¥å£ï¼Œåˆ›å»ºäº†ä¸‹è¿°ï¼ˆæ¨¡ç»„ï¼‰ç±»ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * X-è¶…èƒ½é‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XPower</span> <span class="keyword">implements</span> <span class="title">SuperModuleInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">activate</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$target</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// è¿™åªæ˜¯ä¸ªä¾‹å­ã€‚ã€‚å…·ä½“è‡ªè¡Œè„‘è¡¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»ˆæç‚¸å¼¹ ï¼ˆå°±è¿™ä¹ˆä¿—ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UltraBomb</span> <span class="keyword">implements</span> <span class="title">SuperModuleInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">activate</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$target</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// è¿™åªæ˜¯ä¸ªä¾‹å­ã€‚ã€‚å…·ä½“è‡ªè¡Œè„‘è¡¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶ï¼Œä¸ºäº†é˜²æ­¢æœ‰äº› â€œç –å®¶â€ è‡ªä½œèªæ˜ï¼Œæˆ–è€…ä¸€äº›å›å¾’æ¶æ„æ£è›‹ï¼Œä¸éµå®ˆå¥‘çº¦èƒ¡ä¹±åˆ¶é€ æ¨¡ç»„ï¼Œå½±å“è¶…äººï¼Œæˆ‘ä»¬å¯¹è¶…äººåˆå§‹åŒ–çš„æ–¹æ³•è¿›è¡Œæ”¹é€ ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Superman</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$module</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">SuperModuleInterface <span class="variable">$module</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;module = <span class="variable">$module</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ”¹é€ å®Œæ¯•ï¼ç°åœ¨ï¼Œå½“æˆ‘ä»¬åˆå§‹åŒ– â€œè¶…äººâ€ ç±»çš„æ—¶å€™ï¼Œæä¾›çš„æ¨¡ç»„å®ä¾‹å¿…é¡»æ˜¯ä¸€ä¸ª <code>SuperModuleInterface</code> æ¥å£çš„å®ç°ã€‚å¦åˆ™å°±ä¼šæç¤ºé”™è¯¯ã€‚</p>
<p>æ­£æ˜¯ç”±äºè¶…äººçš„åˆ›é€ å˜å¾—å®¹æ˜“ï¼Œä¸€ä¸ªè¶…äººä¹Ÿå°±ä¸éœ€è¦å¤ªå¤šçš„è¶…èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›é€ å¤šä¸ªè¶…äººï¼Œå¹¶åˆ†åˆ«æ³¨å…¥éœ€è¦çš„è¶…èƒ½åŠ›æ¨¡ç»„å³å¯ã€‚è¿™æ ·çš„è¯ï¼Œè™½ç„¶ä¸€ä¸ªè¶…äººåªæœ‰ä¸€ä¸ªè¶…èƒ½åŠ›ï¼Œä½†è¶…äººæ›´å®¹æ˜“å˜å¤šï¼Œæˆ‘ä»¬ä¹Ÿä¸æ€•æ€ªå…½å•¦ï¼</p>
<blockquote>
<p>ç°åœ¨æœ‰äººç–‘æƒ‘äº†ï¼Œä½ è¦è®²çš„ <code>ä¾èµ–æ³¨å…¥</code> å‘¢ï¼Ÿ</p>
</blockquote>
<blockquote>
<p>å…¶å®ï¼Œä¸Šé¢è®²çš„å†…å®¹ï¼Œæ­£æ˜¯ä¾èµ–æ³¨å…¥ã€‚</p>
</blockquote>
<p>ä»€ä¹ˆå«åš <code>ä¾èµ–æ³¨å…¥</code>ï¼Ÿ</p>
<p>æœ¬æ–‡ä»å¼€å¤´åˆ°ç°åœ¨æåˆ°çš„ä¸€ç³»åˆ—ä¾èµ–ï¼Œåªè¦ä¸æ˜¯ç”±å†…éƒ¨ç”Ÿäº§ï¼ˆæ¯”å¦‚åˆå§‹åŒ–ã€æ„é€ å‡½æ•° <code>__construct</code> ä¸­é€šè¿‡å·¥å‚æ–¹æ³•ã€è‡ªè¡Œæ‰‹åŠ¨ new çš„ï¼‰ï¼Œè€Œæ˜¯ç”±å¤–éƒ¨ä»¥å‚æ•°æˆ–å…¶ä»–å½¢å¼æ³¨å…¥çš„ï¼Œéƒ½å±äº <code>ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰</code> ã€‚æ˜¯ä¸æ˜¯è±ç„¶å¼€æœ—ï¼Ÿäº‹å®ä¸Šï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ã€‚ä¸‹é¢å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾èµ–æ³¨å…¥ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¶…èƒ½åŠ›æ¨¡ç»„</span></span><br><span class="line"><span class="variable">$superModule</span> = <span class="keyword">new</span> XPower;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// åˆå§‹åŒ–ä¸€ä¸ªè¶…äººï¼Œå¹¶æ³¨å…¥ä¸€ä¸ªè¶…èƒ½åŠ›æ¨¡ç»„ä¾èµ–</span></span><br><span class="line"><span class="variable">$superMan</span> = <span class="keyword">new</span> <span class="title class_">Superman</span>(<span class="variable">$superModule</span>);</span><br></pre></td></tr></table></figure>

<p>å…³äºä¾èµ–æ³¨å…¥è¿™ä¸ªæœ¬æ–‡çš„ä¸»è¦é…è§’ï¼Œä¹Ÿå°±è¿™ä¹ˆå¤šéœ€è¦è®²çš„ã€‚ç†è§£äº†ä¾èµ–æ³¨å…¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»§ç»­æ·±å…¥é—®é¢˜ã€‚æ…¢æ…¢èµ°è¿‘ä»Šå¤©çš„ä¸»è§’â€¦â€¦</p>
<h3 id="æ›´ä¸ºå…ˆè¿›çš„å·¥å‚-â€”â€”-IoC-å®¹å™¨ï¼"><a href="#æ›´ä¸ºå…ˆè¿›çš„å·¥å‚-â€”â€”-IoC-å®¹å™¨ï¼" class="headerlink" title="æ›´ä¸ºå…ˆè¿›çš„å·¥å‚ â€”â€” IoC å®¹å™¨ï¼"></a>æ›´ä¸ºå…ˆè¿›çš„å·¥å‚ â€”â€” IoC å®¹å™¨ï¼</h3><p>åˆšåˆšåˆ—äº†ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$superModule</span> = <span class="keyword">new</span> XPower;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$superMan</span> = <span class="keyword">new</span> <span class="title class_">Superman</span>(<span class="variable">$superModule</span>);</span><br></pre></td></tr></table></figure>

<p>è¯»è€…åº”è¯¥çœ‹å‡ºæ¥äº†ï¼Œæ‰‹åŠ¨çš„åˆ›å»ºäº†ä¸€ä¸ªè¶…èƒ½åŠ›æ¨¡ç»„ã€æ‰‹åŠ¨çš„åˆ›å»ºè¶…äººå¹¶æ³¨å…¥äº†åˆšåˆšåˆ›å»ºè¶…èƒ½åŠ›æ¨¡ç»„ã€‚å‘µå‘µï¼Œæ‰‹åŠ¨ã€‚</p>
<blockquote>
<p>ç°ä»£ç¤¾ä¼šï¼Œåº”è¯¥æ˜¯é«˜æ•ˆç‡çš„ç”Ÿäº§ï¼Œå¹²å‡€çš„è½¦é—´ï¼Œå®Œç¾çš„è‡ªåŠ¨åŒ–è£…é…ã€‚</p>
</blockquote>
<p>ä¸€ç¾¤æ€ªå…½æ¥äº†ï¼Œå¦‚æ­¤ä½æ•ˆç‡äº§å‡ºè¶…äººæ˜¯ä¸ç°å®ï¼Œæˆ‘ä»¬éœ€è¦è‡ªåŠ¨åŒ– â€”â€” æœ€å¤šä¸€æ¡æŒ‡ä»¤ï¼Œåƒå†›ä¸‡é©¬æ¥ç›¸è§ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§é«˜çº§çš„ç”Ÿäº§è½¦é—´ï¼Œæˆ‘ä»¬åªéœ€è¦å‘ç”Ÿäº§è½¦é—´æäº¤ä¸€ä¸ªè„šæœ¬ï¼Œå·¥å‚ä¾¿èƒ½å¤Ÿé€šè¿‡æŒ‡ä»¤è‡ªåŠ¨åŒ–ç”Ÿäº§ã€‚è¿™ç§æ›´ä¸ºé«˜çº§çš„å·¥å‚ï¼Œå°±æ˜¯å·¥å‚æ¨¡å¼çš„å‡å â€”â€” <code>IoC å®¹å™¨</code>ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Container</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$binds</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$instances</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">bind</span>(<span class="params"><span class="variable">$abstract</span>, <span class="variable">$concrete</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$concrete</span> <span class="keyword">instanceof</span> <span class="built_in">Closure</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binds[<span class="variable">$abstract</span>] = <span class="variable">$concrete</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;instances[<span class="variable">$abstract</span>] = <span class="variable">$concrete</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">make</span>(<span class="params"><span class="variable">$abstract</span>, <span class="variable">$parameters</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;instances[<span class="variable">$abstract</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;instances[<span class="variable">$abstract</span>];</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="title function_ invoke__">array_unshift</span>(<span class="variable">$parameters</span>, <span class="variable language_">$this</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">call_user_func_array</span>(<span class="variable language_">$this</span>-&gt;binds[<span class="variable">$abstract</span>], <span class="variable">$parameters</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™ï¼Œä¸€ä¸ªååˆ†ç²—ç³™çš„å®¹å™¨å°±è¯ç”Ÿäº†ã€‚ç°åœ¨çš„ç¡®å¾ˆç®€é™‹ï¼Œä½†ä¸å¦¨ç¢æˆ‘ä»¬è¿›ä¸€æ­¥æå‡ä»–ã€‚å…ˆç€çœ¼ç°åœ¨ï¼Œçœ‹çœ‹è¿™ä¸ªå®¹å™¨å¦‚ä½•ä½¿ç”¨å§ï¼</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼ˆåé¢ç§°ä½œè¶…çº§å·¥å‚ï¼‰</span></span><br><span class="line"><span class="variable">$container</span> = <span class="keyword">new</span> Container;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// å‘è¯¥ è¶…çº§å·¥å‚ æ·»åŠ  è¶…äºº çš„ç”Ÿäº§è„šæœ¬</span></span><br><span class="line"><span class="variable">$container</span>-&gt;<span class="title function_ invoke__">bind</span>(<span class="string">&#x27;superman&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$container</span>, <span class="variable">$moduleName</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Superman</span>(<span class="variable">$container</span>-&gt;<span class="title function_ invoke__">make</span>(<span class="variable">$moduleName</span>));</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// å‘è¯¥ è¶…çº§å·¥å‚ æ·»åŠ  è¶…èƒ½åŠ›æ¨¡ç»„ çš„ç”Ÿäº§è„šæœ¬</span></span><br><span class="line"><span class="variable">$container</span>-&gt;<span class="title function_ invoke__">bind</span>(<span class="string">&#x27;xpower&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$container</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> XPower;</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// åŒä¸Š</span></span><br><span class="line"><span class="variable">$container</span>-&gt;<span class="title function_ invoke__">bind</span>(<span class="string">&#x27;ultrabomb&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$container</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> UltraBomb;</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ******************  åä¸½ä¸½çš„åˆ†å‰²çº¿  **********************</span></span><br><span class="line"><span class="comment">// å¼€å§‹å¯åŠ¨ç”Ÿäº§</span></span><br><span class="line"><span class="variable">$superman_1</span> = <span class="variable">$container</span>-&gt;<span class="title function_ invoke__">make</span>(<span class="string">&#x27;superman&#x27;</span>, [<span class="string">&#x27;xpower&#x27;</span>]);</span><br><span class="line"><span class="variable">$superman_2</span> = <span class="variable">$container</span>-&gt;<span class="title function_ invoke__">make</span>(<span class="string">&#x27;superman&#x27;</span>, [<span class="string">&#x27;ultrabomb&#x27;</span>]);</span><br><span class="line"><span class="variable">$superman_3</span> = <span class="variable">$container</span>-&gt;<span class="title function_ invoke__">make</span>(<span class="string">&#x27;superman&#x27;</span>, [<span class="string">&#x27;xpower&#x27;</span>]);</span><br><span class="line"><span class="comment">// ...éšæ„æ·»åŠ </span></span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°æ²¡ï¼Ÿé€šè¿‡æœ€åˆçš„ <code>ç»‘å®šï¼ˆbindï¼‰</code> æ“ä½œï¼Œæˆ‘ä»¬å‘ è¶…çº§å·¥å‚ æ³¨å†Œäº†ä¸€äº›ç”Ÿäº§è„šæœ¬ï¼Œè¿™äº›ç”Ÿäº§è„šæœ¬åœ¨ç”Ÿäº§æŒ‡ä»¤ä¸‹è¾¾ä¹‹æ—¶ä¾¿ä¼šæ‰§è¡Œã€‚å‘ç°æ²¡æœ‰ï¼Ÿæˆ‘ä»¬å½»åº•çš„è§£é™¤äº† è¶…äºº ä¸ è¶…èƒ½åŠ›æ¨¡ç»„ çš„ä¾èµ–å…³ç³»ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®¹å™¨ç±»ä¹Ÿä¸æ¯«æ²¡æœ‰å’Œä»–ä»¬äº§ç”Ÿä»»ä½•ä¾èµ–ï¼æˆ‘ä»¬é€šè¿‡æ³¨å†Œã€ç»‘å®šçš„æ–¹å¼å‘å®¹å™¨ä¸­æ·»åŠ ä¸€æ®µå¯ä»¥è¢«æ‰§è¡Œçš„å›è°ƒï¼ˆå¯ä»¥æ˜¯åŒ¿åå‡½æ•°ã€éåŒ¿åå‡½æ•°ã€ç±»çš„æ–¹æ³•ï¼‰ä½œä¸ºç”Ÿäº§ä¸€ä¸ªç±»çš„å®ä¾‹çš„ è„šæœ¬ ï¼Œåªæœ‰åœ¨çœŸæ­£çš„ <code>ç”Ÿäº§ï¼ˆmakeï¼‰</code> æ“ä½œè¢«è°ƒç”¨æ‰§è¡Œæ—¶ï¼Œæ‰ä¼šè§¦å‘ã€‚</p>
<p>è¿™æ ·ä¸€ç§æ–¹å¼ï¼Œä½¿å¾—æˆ‘ä»¬æ›´å®¹æ˜“åœ¨åˆ›å»ºä¸€ä¸ªå®ä¾‹çš„åŒæ—¶è§£å†³å…¶ä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”æ›´åŠ çµæ´»ã€‚å½“æœ‰æ–°çš„éœ€æ±‚ï¼Œåªéœ€å¦å¤–ç»‘å®šä¸€ä¸ªâ€œç”Ÿäº§è„šæœ¬â€å³å¯ã€‚</p>
<blockquote>
<p>å®é™…ä¸Šï¼ŒçœŸæ­£çš„ IoC å®¹å™¨æ›´ä¸ºé«˜çº§ã€‚æˆ‘ä»¬ç°åœ¨çš„ä¾‹å­ä¸­ï¼Œè¿˜æ˜¯éœ€è¦æ‰‹åŠ¨æä¾›è¶…äººæ‰€éœ€è¦çš„æ¨¡ç»„å‚æ•°ï¼Œä½†çœŸæ­£çš„ IoC å®¹å™¨ä¼šæ ¹æ®ç±»çš„ä¾èµ–éœ€æ±‚ï¼Œè‡ªåŠ¨åœ¨æ³¨å†Œã€ç»‘å®šçš„ä¸€å †å®ä¾‹ä¸­æœå¯»ç¬¦åˆçš„ä¾èµ–éœ€æ±‚ï¼Œå¹¶è‡ªåŠ¨æ³¨å…¥åˆ°æ„é€ å‡½æ•°å‚æ•°ä¸­å»ã€‚Laravel æ¡†æ¶çš„æœåŠ¡å®¹å™¨æ­£æ˜¯è¿™ä¹ˆåšçš„ã€‚å®ç°è¿™ç§åŠŸèƒ½å…¶å®ç†è®ºä¸Šå¹¶ä¸éº»çƒ¦ï¼Œä½†æˆ‘å¹¶ä¸ä¼šåœ¨æœ¬æ–‡ä¸­å†™å‡ºï¼Œå› ä¸ºâ€¦â€¦æˆ‘æ‡’å¾—å†™ã€‚</p>
</blockquote>
<blockquote>
<p>ä¸è¿‡æˆ‘å‘Šè¯‰å¤§å®¶ï¼Œè¿™ç§è‡ªåŠ¨æœå¯»ä¾èµ–éœ€æ±‚çš„åŠŸèƒ½ï¼Œæ˜¯é€šè¿‡ <code>åå°„ï¼ˆReflectionï¼‰</code> å®ç°çš„ï¼Œæ°å¥½çš„ï¼Œphp å®Œç¾çš„æ”¯æŒåå°„æœºåˆ¶ï¼å…³äºåå°„ï¼Œphp å®˜æ–¹æ–‡æ¡£æœ‰è¯¦ç»†çš„èµ„æ–™ï¼Œå¹¶ä¸”ä¸­æ–‡ç¿»è¯‘åŸºæœ¬è¦†ç›–ï¼Œè¶³å¤Ÿå­¦ä¹ å’Œç ”ç©¶ï¼</p>
</blockquote>
<blockquote>
<p><a href="http://php.net/manual/zh/book.reflection.php">http://php.net/manual/zh/book.reflection.php</a></p>
</blockquote>
<p>ç°åœ¨ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ä¸å†æƒ§æ€•æ€ªå…½ä»¬äº†ã€‚é«˜æ™ºå•†äººæ‰é›†æ€å¹¿ç›Šï¼Œäº•äº•æœ‰æ¡ï¼Œæ ¹æ®æ¥å£å¥‘çº¦åˆ›é€ è§„èŒƒçš„è¶…èƒ½åŠ›æ¨¡ç»„ã€‚è¶…äººå¼€å§‹æ‰¹é‡äº§å‡ºã€‚æœ€ç»ˆï¼Œäººäººéƒ½æ˜¯è¶…äººï¼Œä½ ä¹Ÿå¯ä»¥æ˜¯å“¦:stuck_out_tongue_closed_eyes:ï¼</p>
<h2 id="å›å½’æ­£å¸¸ä¸–ç•Œã€‚æˆ‘ä»¬å¼€å§‹é‡æ–°å®¡è§†-laravel-çš„æ ¸å¿ƒã€‚"><a href="#å›å½’æ­£å¸¸ä¸–ç•Œã€‚æˆ‘ä»¬å¼€å§‹é‡æ–°å®¡è§†-laravel-çš„æ ¸å¿ƒã€‚" class="headerlink" title="å›å½’æ­£å¸¸ä¸–ç•Œã€‚æˆ‘ä»¬å¼€å§‹é‡æ–°å®¡è§† laravel çš„æ ¸å¿ƒã€‚"></a>å›å½’æ­£å¸¸ä¸–ç•Œã€‚æˆ‘ä»¬å¼€å§‹é‡æ–°å®¡è§† laravel çš„æ ¸å¿ƒã€‚</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¼€å§‹æ…¢æ…¢è§£è¯» laravel çš„æ ¸å¿ƒã€‚å…¶å®ï¼Œlaravel çš„æ ¸å¿ƒå°±æ˜¯ä¸€ä¸ª IoC å®¹å™¨ï¼Œä¹Ÿæ°å¥½æ˜¯æˆ‘ä¹‹å‰æ‰€è¯´çš„é«˜çº§çš„ IoC å®¹å™¨ã€‚</p>
<p>å¯ä»¥è¯´ï¼Œlaravel çš„æ ¸å¿ƒæœ¬èº«ååˆ†è½»é‡ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå¾ˆç¥å¥‡å¾ˆå®è´¨æ€§çš„åº”ç”¨åŠŸèƒ½ã€‚å¾ˆå¤šäººç”¨åˆ°çš„å„ç§åŠŸèƒ½æ¨¡å—æ¯”å¦‚ <code>Routeï¼ˆè·¯ç”±ï¼‰</code>ã€<code>Eloquent ORMï¼ˆæ•°æ®åº“ ORM ç»„ä»¶ï¼‰</code>ã€<code>Request and Responseï¼ˆè¯·æ±‚å’Œå“åº”ï¼‰</code>ç­‰ç­‰ç­‰ç­‰ï¼Œå®é™…ä¸Šéƒ½æ˜¯ä¸æ ¸å¿ƒæ— å…³çš„ç±»æ¨¡å—æä¾›çš„ï¼Œè¿™äº›ç±»ä»æ³¨å†Œåˆ°å®ä¾‹åŒ–ï¼Œæœ€ç»ˆè¢«ä½ æ‰€ä½¿ç”¨ï¼Œå…¶å®éƒ½æ˜¯ laravel çš„æœåŠ¡å®¹å™¨è´Ÿè´£çš„ã€‚</p>
<p>æˆ‘ä»¬ä»¥å¤§å®¶æœ€å¸¸è§çš„ <code>Route</code> ç±»ä½œä¸ºä¾‹å­ã€‚å¤§å®¶å¯èƒ½ç»å¸¸è§åˆ°è·¯ç”±å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// bla bla bla...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šï¼Œ <code>Route</code> ç±»è¢«å®šä¹‰åœ¨è¿™ä¸ªå‘½åç©ºé—´ï¼š<code>Illuminate\Routing\Router</code>ï¼Œæ–‡ä»¶ <code>vendor/laravel/framework/src/Illuminate/Routing/Router.php</code>ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡æ‰“å¼€å‘ç°ï¼Œè¿™ä¸ªç±»çš„è¿™ä¸€ç³»åˆ—æ–¹æ³•ï¼Œå¦‚ <code>get</code>ï¼Œ<code>post</code>ï¼Œ<code>any</code> ç­‰éƒ½ä¸æ˜¯é™æ€ï¼ˆstaticï¼‰æ–¹æ³•ï¼Œè¿™æ˜¯æ€ä¹ˆä¸€å›äº‹å„¿ï¼Ÿä¸è¦æ€¥ï¼Œæˆ‘ä»¬ç»§ç»­ã€‚</p>
<h3 id="æœåŠ¡æä¾›è€…"><a href="#æœåŠ¡æä¾›è€…" class="headerlink" title="æœåŠ¡æä¾›è€…"></a>æœåŠ¡æä¾›è€…</h3><p>æˆ‘ä»¬åœ¨å‰æ–‡ä»‹ç» IoC å®¹å™¨çš„éƒ¨åˆ†ä¸­ï¼Œæåˆ°äº†ï¼Œä¸€ä¸ªç±»éœ€è¦ç»‘å®šã€æ³¨å†Œè‡³å®¹å™¨ä¸­ï¼Œæ‰èƒ½è¢«â€œåˆ¶é€ â€ã€‚</p>
<p>å¯¹ï¼Œä¸€ä¸ªç±»è¦è¢«å®¹å™¨æ‰€èƒ½å¤Ÿæå–ï¼Œå¿…é¡»è¦å…ˆæ³¨å†Œè‡³è¿™ä¸ªå®¹å™¨ã€‚æ—¢ç„¶ laravel ç§°è¿™ä¸ªå®¹å™¨å«åšæœåŠ¡å®¹å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æŸä¸ªæœåŠ¡ï¼Œå°±å¾—å…ˆæ³¨å†Œã€ç»‘å®šè¿™ä¸ªæœåŠ¡åˆ°å®¹å™¨ï¼Œé‚£ä¹ˆæä¾›æœåŠ¡å¹¶ç»‘å®šæœåŠ¡è‡³å®¹å™¨çš„ä¸œè¥¿ï¼Œå°±æ˜¯ <code>æœåŠ¡æä¾›è€…ï¼ˆServiceProviderï¼‰</code>ã€‚</p>
<blockquote>
<p>è™½ç„¶ï¼Œç»‘å®šä¸€ä¸ªç±»åˆ°å®¹å™¨ä¸ä¸€å®šéè¦é€šè¿‡ <code>æœåŠ¡æä¾›è€…ï¼ˆServiceProviderï¼‰</code> ã€‚</p>
</blockquote>
<blockquote>
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬çš„ç±»ã€æ¨¡å—ä¼šæœ‰éœ€è¦å…¶ä»–ç±»å’Œç»„ä»¶çš„æƒ…å†µï¼Œä¸ºäº†ä¿è¯åˆå§‹åŒ–é˜¶æ®µä¸ä¼šå‡ºç°æ‰€éœ€è¦çš„æ¨¡å—å’Œç»„ä»¶æ²¡æœ‰æ³¨å†Œçš„æƒ…å†µï¼Œlaravel å°†æ³¨å†Œå’Œåˆå§‹åŒ–è¡Œä¸ºè¿›è¡Œæ‹†åˆ†ï¼Œæ³¨å†Œçš„æ—¶å€™å°±åªèƒ½æ³¨å†Œï¼Œåˆå§‹åŒ–çš„æ—¶å€™å°±æ˜¯åˆå§‹åŒ–ã€‚æ‹†åˆ†åçš„äº§ç‰©å°±æ˜¯ç°åœ¨çš„ <code>æœåŠ¡æä¾›è€…</code>ã€‚</p>
</blockquote>
<p>æœåŠ¡æä¾›è€…ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œ<code>registerï¼ˆæ³¨å†Œï¼‰</code> å’Œ <code>bootï¼ˆå¼•å¯¼ã€åˆå§‹åŒ–ï¼‰</code>ï¼Œå…·ä½“å‚è€ƒæ–‡æ¡£ã€‚<code>register</code> è´Ÿè´£è¿›è¡Œå‘å®¹å™¨æ³¨å†Œâ€œè„šæœ¬â€ï¼Œä½†è¦æ³¨æ„æ³¨å†Œéƒ¨åˆ†ä¸è¦æœ‰å¯¹æœªçŸ¥äº‹ç‰©çš„ä¾èµ–ï¼Œå¦‚æœæœ‰ï¼Œå°±è¦ç§»æ­¥è‡³ <code>boot</code> éƒ¨åˆ†ã€‚</p>
<h3 id="Facade"><a href="#Facade" class="headerlink" title="Facade"></a>Facade</h3><p>æˆ‘ä»¬ç°åœ¨è§£ç­”ä¹‹å‰å…³äº <code>Route</code> çš„æ–¹æ³•ä¸ºä½•èƒ½ä»¥é™æ€æ–¹æ³•è®¿é—®çš„é—®é¢˜ã€‚å®é™…ä¸Šè¿™ä¸ªé—®é¢˜æ–‡æ¡£ä¸Šæœ‰å†™ï¼Œç®€å•è¯´æ¥å°±æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªç±»ï¼Œæä¾›ä¸€ä¸ªé™æ€é­”æœ¯æ–¹æ³• <code>__callStatic</code>ï¼Œå¹¶å°†è¯¥é™æ€æ–¹æ³•æ˜ å°„åˆ°çœŸæ­£çš„æ–¹æ³•ä¸Šã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨çš„ <code>Route</code> ç±»å®é™…ä¸Šæ˜¯ <code>Illuminate\Support\Facades\Route</code> é€šè¿‡ <code>class_alias()</code> å‡½æ•°åˆ›é€ çš„ <code>åˆ«å</code> è€Œå·²ã€‚è¿™ä¸ªç±»è¢«å®šä¹‰åœ¨æ–‡ä»¶ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">vendor/laravel/framework/src/Illuminate/Support/Facades/Route.php` </span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰“å¼€æ–‡ä»¶ä¸€çœ‹â€¦â€¦è¯¶ï¼Ÿæ€ä¹ˆåªæœ‰è¿™ä¹ˆç®€å•çš„ä¸€æ®µä»£ç å‘¢ï¼Ÿ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Support</span>\<span class="title class_">Facades</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> \Illuminate\Routing\Router</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Route</span> <span class="keyword">extends</span> <span class="title">Facade</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get the registered name of the component.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getFacadeAccessor</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;router&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶å®ä»”ç»†çœ‹ï¼Œä¼šå‘ç°è¿™ä¸ªç±»ç»§æ‰¿äº†ä¸€ä¸ªå«åš <code>Facade</code> çš„ç±»ï¼Œåˆ°è¿™é‡Œè°œåº•å·®ä¸å¤šè¦è§£å¼€äº†ã€‚</p>
<p>ä¸Šè¿°ç®€å•çš„å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº† <code>getFacadeAccessor</code> æ–¹æ³•è¿”å›äº†ä¸€ä¸ª <code>route</code>ï¼Œè¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿäº‹å®ä¸Šï¼Œè¿™ä¸ªå€¼è¢«ä¸€ä¸ª <code>ServiceProvider</code> æ³¨å†Œè¿‡ï¼Œå¤§å®¶åº”è¯¥çŸ¥é“æ³¨å†Œäº†ä¸ªä»€ä¹ˆï¼Œå½“ç„¶æ˜¯é‚£ä¸ªçœŸæ­£çš„è·¯ç”±ç±»ï¼</p>
<blockquote>
<p>æœ‰äººä¼šé—®ï¼ŒFacade æ˜¯æ€ä¹ˆå®ç°çš„ã€‚æˆ‘å¹¶ä¸æƒ³è¯´å¾—å¤ªç»†ï¼Œä¸€ä¸ªæ˜¯æˆ‘æ‡’ï¼Œå¦ä¸€ä¸ªåŸå› å°±æ˜¯ï¼Œè‡ªå·±å‘ç°ä¸€äº›ä¸œè¥¿æ›´å®¹æ˜“ç†è§£ï¼Œå¹¶ä¸å®¹æ˜“å¿˜è®°ã€‚å¾ˆå¤šç»†èŠ‚æˆ‘å·²ç»è¯´äº†ï¼Œå»ºè®®å¤§å®¶è‡ªè¡Œå»ç ”ç©¶ã€‚</p>
</blockquote>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»è®²çš„å·®ä¸å¤šäº†ã€‚</p>
<h2 id="å’Œå¹³ï¼æˆ‘ä»¬è¯¥æ€»ç»“æ€»ç»“äº†ï¼"><a href="#å’Œå¹³ï¼æˆ‘ä»¬è¯¥æ€»ç»“æ€»ç»“äº†ï¼" class="headerlink" title="å’Œå¹³ï¼æˆ‘ä»¬è¯¥æ€»ç»“æ€»ç»“äº†ï¼"></a>å’Œå¹³ï¼æˆ‘ä»¬è¯¥æ€»ç»“æ€»ç»“äº†ï¼</h2><p>æ— è®ºå¦‚ä½•ï¼Œä¸–ç•Œå’Œå¹³äº†ã€‚</p>
<p>è¿™é‡Œè¦æ€»ç»“çš„å†…å®¹å°±æ˜¯ï¼Œå…¶å®å¾ˆå¤šäº‹æƒ…å¹¶ä¸å¤æ‚ï¼Œæ€•çš„æ˜¯å¤æ‚çš„ç†è®ºå†…å®¹ã€‚æˆ‘è§‰å¾—å¾ˆå¤šä¸œè¥¿ä¸€æ—¦æƒ³é€šä¹Ÿå°±é‚£ä¹ˆå›äº‹å„¿ã€‚å¾ˆå¤šäººè§‰å¾— laravel è¿™ä¸å¥½é‚£ä¸å¥½ã€è¿™é‡Œéš¾å“ªé‡Œéš¾ï¼Œæˆ‘åªèƒ½è¯´ï¼Œlaravel çš„ç¡®ä¸æ˜¯ä¸€æµå’Œä¼˜ç§€çš„æ¡†æ¶ï¼Œè¯´ laravel æ˜¯ä¸€æµã€ä¼˜ç§€çš„æ¡†æ¶çš„äººï¼Œä¸æ˜¯ laravel çš„ç²‰ä¸é‚£ä¹ˆå°±æ˜¯è·Ÿé£ç‚’ä½œã€‚Laravel æœ€å¤§çš„ç‰¹ç‚¹å’Œä¼˜ç§€ä¹‹å¤„å°±æ˜¯ä½¿ç”¨äº†å¾ˆå¤š php æ¯”è¾ƒæ–°ï¼ˆå®é™…ä¸Šå¹¶ä¸æ–°ï¼‰çš„æ¦‚å¿µå’ŒæŠ€æœ¯ï¼ˆä¹Ÿå°±ä¸€å †è¯­æ³•ç³–ï¼‰è€Œå·²ã€‚å› æ­¤ laravel çš„ç¡®ç¬¦åˆä¸€ä¸ªé€‚å®œå­¦ä¹ çš„æ¡†æ¶ã€‚Laravel çš„æ„æ€çš„ç¡®å’Œå…¶ä»–æ¡†æ¶æœ‰å¾ˆå¤§ä¸åŒï¼Œè¿™ä¹Ÿè¦æ±‚å­¦ä¹ ä»–çš„äººå¿…é¡»ç†Ÿç»ƒ phpï¼Œå¹¶ åŸºç¡€æ‰å®ï¼å¦‚æœä½ è§‰å¾—å­¦ laravel æ¡†æ¶ååˆ†å›°éš¾ï¼Œé‚£ä¹ˆåŸå› åªæœ‰ä¸€ä¸ªï¼šä½  php åŸºç¡€ä¸å¥½ã€‚</p>
<p>å¦å¤–ï¼Œå–„äºåˆ©ç”¨å‘½åç©ºé—´å’Œé¢å‘å¯¹è±¡çš„è¯¸å¤šç‰¹æ€§ï¼Œå»è¿½å¯»ä¸€äº›ä¸œè¥¿ï¼Œä½ ä¼šå‘ç°ï¼ŒåŸæ¥è¿™ä¸€åˆ‡è¿™ä¹ˆå®¹æ˜“ã€‚</p>
<div class="note default"><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.insp.top/article/learn-laravel-container">laravel å­¦ä¹ ç¬”è®° â€”â€” ç¥å¥‡çš„æœåŠ¡å®¹å™¨</a></p>
</div>]]></content>
      <categories>
        <category>Laravel</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Laravel</tag>
        <tag>Container</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 7.1 åˆ‡æ¢å‘½ä»¤è¡Œæ¨¡å¼ä¸æ¡Œé¢æ¨¡å¼</title>
    <url>/Linux/CentOS-7-1-switch-in-command-line-mode-and-desktop-mode/</url>
    <content><![CDATA[<p>åœ¨ CentOS7.x ä¹‹å‰çš„ç‰ˆæœ¬éƒ½æ˜¯é€šè¿‡ä¿®æ”¹ <code>/etc/inittab</code> æ–‡ä»¶æ¥è®¾ç½®å¯åŠ¨é¡ºåºï¼Œå…·ä½“å¯å‚è€ƒ<a href="http://www.habadog.com/2012/03/03/centos-model-switch/">è¿™é‡Œ</a>ã€‚<br>ä½†æ˜¯æ­¤ç§æ–¹æ³•å¹¶ä¸é€‚åº”äº CentOS7.x ç‰ˆæœ¬ï¼Œåœ¨è¯¥ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬æŸ¥çœ‹ <code>/etc/inittab</code> æ–‡ä»¶å¯å¾—</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">[centos@localhost ~]$ vim /etc/inittab</span><br><span class="line"># inittab is no longer used when using systemd.</span><br><span class="line">#</span><br><span class="line"># ADDING CONFIGURATION HERE WILL HAVE NO EFFECT ON YOUR SYSTEM.</span><br><span class="line">#</span><br><span class="line"># Ctrl-Alt-Delete is handled by /usr/lib/systemd/system/ctrl-alt-del.target</span><br><span class="line">#</span><br><span class="line"># systemd uses &#x27;targets&#x27; instead of runlevels. By default, there are two main targets:</span><br><span class="line">#</span><br><span class="line"># multi-user.target: analogous to runlevel 3</span><br><span class="line"># graphical.target: analogous to runlevel 5</span><br><span class="line">#</span><br><span class="line"># To view current default target, run:</span><br><span class="line"># systemctl get-default</span><br><span class="line">#</span><br><span class="line"># To set a default target, run:</span><br><span class="line"># systemctl set-default TARGET.target</span><br></pre></td></tr></table></figure>

<p>è¯¥æ–‡ä»¶ä¸­å·²ç»è¯¦ç»†è¯´æ˜äº†ï¼Œä¸å†ä½¿ç”¨ inittab æ–‡ä»¶è€Œæ˜¯ä½¿ç”¨ systemd ä»£æ›¿ï¼Œå¹¶ä¸”è¿˜æŒ‡å‡ºï¼Œç°åœ¨åªæœ‰ multi-user ç›¸å½“äºè¿è¡Œçº§åˆ«æ˜¯ 3ï¼Œgraphical ç›¸å½“äºè¿è¡Œçº§åˆ«æ˜¯ 5ï¼Œ<br>ç°åœ¨å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è®¾ç½®é»˜è®¤å¯åŠ¨çº§åˆ«äº†ï¼Œæ³¨æ„è¦ä»¥ root ç”¨æˆ·ï¼Œæˆ–è€…æ˜¯ä½¿ç”¨ sudo æƒé™ã€‚</p>
<blockquote>
<p>å¦‚æœç”¨æˆ·æ²¡æœ‰ sudo æƒé™ï¼Œå‚è€ƒ<a href="http://www.centoscn.com/CentosBug/osbug/2015/0114/4496.html">è¿™é‡Œ</a>è¿›è¡Œè®¾ç½®ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[centos@localhost ~]$ sudo systemctl set-default multi-user.target</span><br><span class="line"><span class="built_in">rm</span> <span class="string">&#x27;/etc/systemd/system/default.target&#x27;</span></span><br><span class="line"><span class="built_in">ln</span> -s <span class="string">&#x27;/usr/lib/systemd/system/multi-user.target&#x27;</span> <span class="string">&#x27;/etc/systemd/system/default.target&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è®¾ç½®æˆåŠŸä¹‹å reboot ä¸€ä¸‹ï¼Œå³å¯é¡ºåˆ©è¿›å…¥å‘½ä»¤è¡Œç•Œé¢äº†ã€‚<br>å¦‚æœæƒ³è¦å†æ¬¡è¿›å…¥å›¾å½¢ç•Œé¢ï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[centos@localhost ~]$ sudo systemctl set-default graphical.target</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>CentOS</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu 18.04 LTSä¸­å®‰è£…å’Œç¾åŒ–ZSH Shell</title>
    <url>/Linux/install-zsh-shell-ubuntu-18-04/</url>
    <content><![CDATA[<blockquote>
<p>ZSH æˆ–ç§° Z Shell æ˜¯ä¸€ä¸ªç±»ä¼¼äº Bash å’Œ SH çš„ Linux Shellï¼Œå®ƒå…·æœ‰ä¸€äº› Bash å’Œå…¶å®ƒ Shell ä¸å…·å¤‡çš„é«˜çº§åŠŸèƒ½ã€‚æµè¡Œçš„ Git ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¹Ÿå¯ä»¥ä½¿ç”¨æ’ä»¶ä¸ ZSH å¾ˆå¥½çš„é›†æˆï¼Œè¿™ä¸€ç‚¹å¯¹è½¯ä»¶å¼€å‘äººå‘˜æ¥è¯´éå¸¸æœ‰ç”¨ã€‚è€Œä¸” ZSH æœ‰éå¸¸å¤šçš„ä¸»é¢˜å’Œæ’ä»¶æ”¯æŒï¼Œæ¯” Bash æ›´å…·å¯å®šåˆ¶æ€§ã€‚ç®€å•æ¥è¯´ï¼ŒZSH å°±æ˜¯ä¸€æ¬¾æ›¿ä»£ Bash ä¸”éå¸¸å¥½ç”¨çš„ Linux Shellã€‚</p>
</blockquote>
<h2 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h2><div class="note info"><p>Ubuntu 18.04.2 LTS</p>
</div>

<h2 id="å®‰è£…ZSH-Shell"><a href="#å®‰è£…ZSH-Shell" class="headerlink" title="å®‰è£…ZSH Shell"></a>å®‰è£…ZSH Shell</h2><p>ZSH å·²ç»è¢«æ”¶å½•åˆ°äº† Ubuntu 18.04 LTS çš„å®˜æ–¹è½¯ä»¶åŒ…å­˜å‚¨åº“ä¸­ï¼Œå®‰è£…èµ·æ¥ä¹Ÿéå¸¸å®¹æ˜“ã€‚ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å°±å¯ä»¥ç›´æ¥å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install zsh</span><br></pre></td></tr></table></figure>

<p><img src="/images/Linux/install-zsh-shell-ubuntu-18-04/bd9f206bly1g1jqcbjc1yj210y0xg79k.jpg"></p>
<span id="more"></span>

<p>ZSH Shell å®‰è£…å¥½ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å…¶ç‰ˆæœ¬</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">zsh --version</span><br></pre></td></tr></table></figure>

<p><img src="/images/Linux/install-zsh-shell-ubuntu-18-04/bd9f206bly1g1jqdmy8raj210y0xg40i.jpg"></p>
<h2 id="è®¾ç½®ZSHä¸ºé»˜è®¤Shell"><a href="#è®¾ç½®ZSHä¸ºé»˜è®¤Shell" class="headerlink" title="è®¾ç½®ZSHä¸ºé»˜è®¤Shell"></a>è®¾ç½®ZSHä¸ºé»˜è®¤Shell</h2><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰¾å‡º ZSH Shell çš„è·¯å¾„</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">whereis zsh</span><br></pre></td></tr></table></figure>

<p><img src="/images/Linux/install-zsh-shell-ubuntu-18-04/bd9f206bly1g1jqfn1dlvj210y0xgdi1.jpg"></p>
<p>ä»ä¸Šé¢çš„æˆªå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒZSH Shell çš„è·¯å¾„æ˜¯ <code>/usr/bin/zsh</code></p>
<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å°† ZSH è®¾ç½®ä¸ºå½“å‰ç™»å½•ç”¨æˆ·çš„é»˜è®¤ Shell</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo usermod -s /usr/bin/zsh $(<span class="built_in">whoami</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/images/Linux/install-zsh-shell-ubuntu-18-04/bd9f206bly1g1jqhc9muwj210y0xgjta.jpg"></p>
<p>ç°åœ¨ä½¿ç”¨ <code>reboot</code> æˆ– <code>init 6</code> å‘½ä»¤é‡æ–°å¯åŠ¨ Ubuntu 18.04 LTS è®¡ç®—æœºã€‚åœ¨è®¡ç®—æœºé‡å¯åæ‰“å¼€ã€Œç»ˆç«¯ã€ï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹çª—å£æç¤º</p>
<p><img src="/images/Linux/install-zsh-shell-ubuntu-18-04/bd9f206bly1g1jqroex99j210y0xgdqx.jpg"></p>
<p>æŒ‰é”®ç›˜æ•°å­—é”® <code>2</code>ï¼ŒZSH ä¼šä½¿ç”¨æ¨èçš„è®¾ç½®åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>~/.zshrc</code> é…ç½®æ–‡ä»¶ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ­¤åå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨ ZSH Shell äº†</p>
<p><img src="/images/Linux/install-zsh-shell-ubuntu-18-04/bd9f206bly1g1jqy945y6j210y0xggr3.jpg"></p>
<h2 id="ZSHå’ŒGitä¸ã€ŒOh-My-ZSHã€é›†æˆ"><a href="#ZSHå’ŒGitä¸ã€ŒOh-My-ZSHã€é›†æˆ" class="headerlink" title="ZSHå’ŒGitä¸ã€ŒOh My ZSHã€é›†æˆ"></a>ZSHå’ŒGitä¸ã€ŒOh My ZSHã€é›†æˆ</h2><div class="note success"><p>ZSH æœ‰ä¸€ä¸ªè‡´åŠ›äºä¸ Git ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸€èµ·å·¥ä½œçš„å®Œæ•´æ¡†æ¶â€”â€”ã€ŒOh My ZSHã€ï¼Œè¦äº†è§£ã€ŒOh My ZSHã€çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹å®˜æ–¹ <a href="https://github.com/robbyrussell/oh-my-zsh">Github</a> é¡µé¢ã€‚</p>
</div>

<p>è¿è¡Œä»¥ä¸‹å‘½ä»¤åœ¨ Ubuntu 18.04 LTS ä¸Šå®‰è£… Git</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install git</span><br></pre></td></tr></table></figure>

<p>Git å®‰è£…å¥½ä¹‹åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤åœ¨ Ubuntu 18.04 LTS ç³»ç»Ÿä¸­å®‰è£…ã€ŒOh My ZSHã€</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sh -c <span class="string">&quot;<span class="subst">$(wget https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/Linux/install-zsh-shell-ubuntu-18-04/bd9f206bly1g1jr8bzswij210y1kg47y.jpg"></p>
<h2 id="æ›´æ”¹ã€ŒOh-My-ZSHã€ä¸»é¢˜"><a href="#æ›´æ”¹ã€ŒOh-My-ZSHã€ä¸»é¢˜" class="headerlink" title="æ›´æ”¹ã€ŒOh My ZSHã€ä¸»é¢˜"></a>æ›´æ”¹ã€ŒOh My ZSHã€ä¸»é¢˜</h2><h3 id="å®‰è£…å†…ç½®ä¸»é¢˜"><a href="#å®‰è£…å†…ç½®ä¸»é¢˜" class="headerlink" title="å®‰è£…å†…ç½®ä¸»é¢˜"></a>å®‰è£…å†…ç½®ä¸»é¢˜</h3><p>ã€ŒOh My ZSHã€é¢„è£…äº†å¾ˆå¤šä¸»é¢˜ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹<a href="https://github.com/robbyrussell/oh-my-zsh/wiki/Themes">å®˜ç½‘ä¸»é¢˜åˆ—è¡¨</a>æ¥æŸ¥æ‰¾æ‚¨å–œæ¬¢çš„ä¸»é¢˜ã€‚</p>
<p>å°† <code>~/.zshrc</code> é…ç½®æ–‡ä»¶ä¸­åŸæœ‰çš„ <code>ZSH_THEME</code> ä¸»é¢˜å˜é‡åç§°è¿›è¡Œæ›´æ”¹å³å¯ï¼Œä¾‹å¦‚è¦å¯ç”¨ <code>cloud</code> ä¸»é¢˜ï¼Œå°±æ”¹æˆ</p>
<p><img src="/images/Linux/install-zsh-shell-ubuntu-18-04/bd9f206bly1g1jrcjvwebj21040xgn3c.jpg"></p>
<h3 id="å®‰è£…ç¬¬ä¸‰æ–¹ä¸»é¢˜"><a href="#å®‰è£…ç¬¬ä¸‰æ–¹ä¸»é¢˜" class="headerlink" title="å®‰è£…ç¬¬ä¸‰æ–¹ä¸»é¢˜"></a>å®‰è£…ç¬¬ä¸‰æ–¹ä¸»é¢˜</h3><p>è¿™é‡Œä»¥ <a href="https://draculatheme.com/zsh/">Dracula for ZSH</a> ä¸ºä¾‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/dracula/zsh.git</span><br></pre></td></tr></table></figure>

<p><img src="/images/Linux/install-zsh-shell-ubuntu-18-04/bd9f206bly1g1jsek5lunj210y0xgacz.jpg"></p>
<p>æŠŠ <code>dracula.zsh-theme</code> æ–‡ä»¶å¤åˆ¶åˆ°ã€ŒOh My ZSHã€ä¸»é¢˜ç›®å½•ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> zsh/dracula.zsh-theme ~/.oh-my-zsh/themes/dracula.zsh-theme</span><br></pre></td></tr></table></figure>

<p><img src="/images/Linux/install-zsh-shell-ubuntu-18-04/bd9f206bly1g1jslq2qcrj210y0xg0ue.jpg"></p>
<p>å°† <code>~/.zshrc</code> é…ç½®æ–‡ä»¶ä¸­åŸæœ‰çš„ <code>ZSH_THEME</code> ä¸»é¢˜å˜é‡åç§°æ”¹ä¸º <code>dracula</code> å³å¯</p>
<p>ç°åœ¨å¯ä»¥å…³æ‰ Terminal é‡æ–°æ‰“å¼€ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>source ~/.zshrc</code> æˆ– <code>. ~/.zshrc</code> æ¥é‡æ–°åŠ è½½ zsh çš„é…ç½®ï¼Œè®©åˆšåˆšçš„é…ç½®ç”Ÿæ•ˆã€‚</p>
<h2 id="å®‰è£…zsh-autosuggestion"><a href="#å®‰è£…zsh-autosuggestion" class="headerlink" title="å®‰è£…zsh-autosuggestion"></a>å®‰è£…zsh-autosuggestion</h2><h3 id="Clone-æ’ä»¶"><a href="#Clone-æ’ä»¶" class="headerlink" title="Clone æ’ä»¶"></a>Clone æ’ä»¶</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-autosuggestions</span><br></pre></td></tr></table></figure>

<h3 id="æŠŠæ’ä»¶åç§°åŠ å…¥ã€ŒOh-My-ZSHã€æ’ä»¶åˆ—è¡¨"><a href="#æŠŠæ’ä»¶åç§°åŠ å…¥ã€ŒOh-My-ZSHã€æ’ä»¶åˆ—è¡¨" class="headerlink" title="æŠŠæ’ä»¶åç§°åŠ å…¥ã€ŒOh My ZSHã€æ’ä»¶åˆ—è¡¨"></a>æŠŠæ’ä»¶åç§°åŠ å…¥ã€ŒOh My ZSHã€æ’ä»¶åˆ—è¡¨</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim ~/.zshrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠŠæ’ä»¶åç§°åŠ å…¥æ’ä»¶åˆ—è¡¨</span></span><br><span class="line">plugins=(zsh-autosuggestions)</span><br></pre></td></tr></table></figure>

<p><img src="/images/Linux/install-zsh-shell-ubuntu-18-04/bd9f206bly1g1jrsr19krj210y0xgn2r.jpg"></p>
<h3 id="é‡æ–°åŠ è½½-zsh-çš„é…ç½®"><a href="#é‡æ–°åŠ è½½-zsh-çš„é…ç½®" class="headerlink" title="é‡æ–°åŠ è½½ zsh çš„é…ç½®"></a>é‡æ–°åŠ è½½ zsh çš„é…ç½®</h3><p>å¯ä»¥å…³æ‰ Terminal é‡æ–°æ‰“å¼€ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>source ~/.zshrc</code> æˆ– <code>. ~/.zshrc</code> æ¥é‡æ–°åŠ è½½ zsh çš„é…ç½®ï¼Œè®©åˆšåˆšçš„é…ç½®ç”Ÿæ•ˆã€‚</p>
<p>å½“è‡ªåŠ¨æç¤ºå‡ºç°åï¼ŒæŒ‰ â¡ é”®æˆ– ctrl + E å°±èƒ½æŠŠè‡ªåŠ¨æç¤ºçš„å‘½ä»¤è¾“å…¥åˆ°å½“å‰çš„ Terminalã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>zsh</tag>
        <tag>oh my zsh</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo æ–‡ç« ä¿å­˜ä¸ºè‰ç¨¿</title>
    <url>/Hexo/hexo-draft/</url>
    <content><![CDATA[<h2 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h2><div class="note info"><p>Hexo 3.3.8</p>
</div>

<h2 id="ä¼ ç»Ÿå»ºç«‹æ–‡ç« æ–¹å¼"><a href="#ä¼ ç»Ÿå»ºç«‹æ–‡ç« æ–¹å¼" class="headerlink" title="ä¼ ç»Ÿå»ºç«‹æ–‡ç« æ–¹å¼"></a>ä¼ ç»Ÿå»ºç«‹æ–‡ç« æ–¹å¼</h2><p>ä¸€èˆ¬æˆ‘ä»¬éƒ½ä¼šä½¿ç”¨ <code>hexo new &lt;title&gt;</code> æ¥å»ºç«‹æ–‡ç« ï¼Œè¿™ç§å»ºç«‹æ–¹æ³•ä¼šå°†æ–°æ–‡ç« å»ºç«‹åœ¨ <code>source/_posts</code> ç›®å½•ä¸‹ï¼Œå½“ä½¿ç”¨ <code>hexo generate</code> ç¼–è¯‘ markdown æ–‡ä»¶æ—¶ï¼Œä¼šå°†å…¶ HTML ç»“æœç¼–è¯‘åœ¨ <code>public</code> ç›®å½•ä¸‹ï¼Œä¹‹å <code>hexo deploy</code> å°†ä¼šæŠŠ <code>public</code> ç›®å½•ä¸‹æ‰€æœ‰æ–‡ç« éƒ¨ç½²åˆ° GitHubï¼Œè¿™æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ Hexo æµç¨‹ã€‚</p>
<p>è¿™ç§å»ºç«‹æ–‡ç« æ–¹å¼çš„ç¼ºç‚¹æ˜¯ï¼šè‹¥æˆ‘ä»¬åŒæ—¶ç¼–è¾‘å¤šç¯‡æ–‡ç« ï¼Œåªè¦å…¶ä¸­ä¸€ç¯‡æ–‡ç« å°šæœªç¼–è¾‘å®Œæˆï¼Œä¹Ÿä¼šéšç€ <code>hexo deploy</code> ä¸€èµ·éƒ¨ç½²åˆ° GitHubï¼Œä¹Ÿå°±æ˜¯ GitHub å¯èƒ½ä¼šçœ‹åˆ°æˆ‘ä»¬å°šæœªå®Œæˆçš„æ–‡ç« ã€‚</p>
<h2 id="å»ºç«‹æ–‡ç« è‰ç¨¿"><a href="#å»ºç«‹æ–‡ç« è‰ç¨¿" class="headerlink" title="å»ºç«‹æ–‡ç« è‰ç¨¿"></a>å»ºç«‹æ–‡ç« è‰ç¨¿</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new draft &lt;title&gt;</span><br></pre></td></tr></table></figure>

<p>Hexo å¦å¤–æä¾› <code>draft</code> æœºåˆ¶ï¼Œå®ƒçš„åŸç†æ˜¯æ–°æ–‡ç« å°†å»ºç«‹åœ¨ <code>source/_drafts</code> ç›®å½•ä¸‹ï¼Œå› æ­¤ <code>hexo generate</code> å¹¶ä¸ä¼šå°†å…¶ç¼–è¯‘åˆ° <code>public</code> ç›®å½•ä¸‹ï¼Œæ‰€ä»¥ <code>hexo deploy</code> ä¹Ÿä¸ä¼šå°†å…¶éƒ¨ç½²åˆ° GitHubã€‚</p>
<span id="more"></span>

<h2 id="æœ¬æœºé¢„è§ˆè‰ç¨¿"><a href="#æœ¬æœºé¢„è§ˆè‰ç¨¿" class="headerlink" title="æœ¬æœºé¢„è§ˆè‰ç¨¿"></a>æœ¬æœºé¢„è§ˆè‰ç¨¿</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo S --draft</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶ <code>hexo generate</code> ä¸ä¼šç¼–è¯‘ <code>source/_drafts</code> ç›®å½•ä¸‹çš„æ–‡ç« ï¼Œä½† Hexo çš„ <code>Hexo server</code> å¦å¤–æä¾› <code>--draft</code> å‚æ•°ï¼Œè¿™è®©æˆ‘ä»¬åªè¦æ­é… <code>hexo-browsersync</code> pluginsï¼Œå°±å¯ä»¥è¾¾åˆ°ä¸€è¾¹ç¼–è¾‘ <code>markdown</code> æ–‡ç« ï¼Œä¸€è¾¹ä½¿ç”¨æµè§ˆå™¨é¢„è§ˆçš„ç›®çš„ã€‚</p>
<h2 id="å°†è‰ç¨¿å‘å¸ƒä¸ºæ­£å¼æ–‡ç« "><a href="#å°†è‰ç¨¿å‘å¸ƒä¸ºæ­£å¼æ–‡ç« " class="headerlink" title="å°†è‰ç¨¿å‘å¸ƒä¸ºæ­£å¼æ–‡ç« "></a>å°†è‰ç¨¿å‘å¸ƒä¸ºæ­£å¼æ–‡ç« </h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo P &lt;filename&gt;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>&lt;filename&gt;</code> ä¸ºä¸åŒ…å« <code>md</code> åç¼€çš„æ–‡ç« åç§°ã€‚å®ƒçš„åŸç†åªæ˜¯å°†æ–‡ç« ä» <code>source/_drafts</code> ç§»åŠ¨åˆ° <code>source/_posts</code> è€Œå·²ã€‚</p>
<p>ä¹‹åçš„ <code>hexo generate</code> ä¸ <code>hexo deploy</code> çš„ç”¨æ³•å°±å®Œå…¨ä¸€æ ·äº†ã€‚</p>
<div class="note success"><p>è‹¥æ—¥åæƒ³å°†æ­£å¼æ–‡ç« è½¬ä¸ºä¸ºè‰ç¨¿ï¼Œåªéœ€æ‰‹åŠ¨å°†æ–‡ç« ä» <code>source/_posts</code> ç›®å½•ç§»åŠ¨åˆ° <code>source/_drafts</code> ç›®å½•å³å¯ã€‚</p>
</div>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis Pipeline</title>
    <url>/Redis/redis-pipeline/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>åœ¨å‘½ä»¤è¡Œä¸­æ˜¯æ²¡æœ‰ redis pipeline åŠŸèƒ½çš„ï¼Œä½† redis æ˜¯æ”¯æŒ pipeline çš„ï¼Œè€Œä¸”åœ¨å„ä¸ªè¯­è¨€ç‰ˆçš„ client ä¸­éƒ½æœ‰ç›¸åº”çš„å®ç°ã€‚</p>
<p>ç®€å•æ¦‚æ‹¬ redis pipeline çš„åŠŸèƒ½å°±æ˜¯å°†å•æ¬¡è¯·æ±‚å˜ä¸ºæ‰¹é‡è¯·æ±‚ã€‚</p>
<p>ç”±äºç½‘ç»œå¼€é”€å»¶è¿Ÿï¼Œå°±ç®— redis server ç«¯æœ‰å¾ˆå¼ºçš„å¤„ç†èƒ½åŠ›ï¼Œä¹Ÿä¼šç”±äºæ”¶åˆ°çš„ client æ¶ˆæ¯å°‘ï¼Œè€Œé€ æˆååé‡å°ã€‚å½“ client ä½¿ç”¨ pipelining å‘é€å‘½ä»¤æ—¶ï¼Œredis server ä¼šå°†è¯·æ±‚æ”¾åˆ°é˜Ÿåˆ—ä¸­ï¼ˆä½¿ç”¨å†…å­˜ï¼‰ï¼Œæ‰§è¡Œå®Œæ¯•åä¸€æ¬¡æ€§å‘é€ç»“æœã€‚</p>
<p>Pipeline åœ¨æŸäº›åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚æœ‰å¤šä¸ª command éœ€è¦è¢«â€œåŠæ—¶çš„â€æäº¤ï¼Œè€Œä¸”ä»–ä»¬å¯¹ç›¸åº”ç»“æœæ²¡æœ‰äº’ç›¸ä¾èµ–ï¼Œå¯¹ç»“æœå“åº”ä¹Ÿæ— éœ€ç«‹å³è·å¾—ï¼Œé‚£ä¹ˆ pipeline å°±å¯ä»¥å……å½“è¿™ç§â€œæ‰¹å¤„ç†â€çš„å·¥å…·ï¼›è€Œä¸”åœ¨ä¸€å®šç¨‹åº¦ä¸Šï¼Œå¯ä»¥è¾ƒå¤§çš„æå‡æ€§èƒ½ï¼Œæ€§èƒ½æå‡çš„åŸå› ä¸»è¦æ˜¯ TCP è¿æ¥ä¸­å‡å°‘äº†â€œäº¤äº’å¾€è¿”â€çš„æ—¶é—´ã€‚</p>
<p>ç®¡é“ï¼ˆpipelineï¼‰å¯ä»¥ä¸€æ¬¡æ€§å‘é€å¤šæ¡å‘½ä»¤å¹¶åœ¨æ‰§è¡Œå®Œåä¸€æ¬¡æ€§å°†ç»“æœè¿”å›ï¼Œpipeline é€šè¿‡å‡å°‘å®¢æˆ·ç«¯ä¸ redis çš„é€šä¿¡æ¬¡æ•°æ¥å®ç°é™ä½å¾€è¿”å»¶æ—¶æ—¶é—´ï¼Œè€Œä¸” Pipeline å®ç°çš„åŸç†æ˜¯é˜Ÿåˆ—ï¼Œè€Œé˜Ÿåˆ—çš„åŸç†æ˜¯æ—¶å…ˆè¿›å…ˆå‡ºï¼Œè¿™æ ·å°±ä¿è¯æ•°æ®çš„é¡ºåºæ€§ã€‚ Pipeline çš„é»˜è®¤çš„åŒæ­¥çš„ä¸ªæ•°ä¸º 53 ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´ arges ä¸­ç´¯åŠ åˆ° 53 æ¡æ•°æ®æ—¶ä¼šæŠŠæ•°æ®æäº¤ã€‚</p>
<p>éœ€è¦æ³¨æ„åˆ°æ˜¯ç”¨ pipeline æ–¹å¼æ‰“åŒ…å‘½ä»¤å‘é€ï¼Œredis å¿…é¡»åœ¨å¤„ç†å®Œæ‰€æœ‰å‘½ä»¤å‰å…ˆç¼“å­˜èµ·æ‰€æœ‰å‘½ä»¤çš„å¤„ç†ç»“æœã€‚æ‰“åŒ…çš„å‘½ä»¤è¶Šå¤šï¼Œç¼“å­˜æ¶ˆè€—å†…å­˜ä¹Ÿè¶Šå¤šã€‚æ‰€ä»¥å¹¶ä¸æ˜¯æ‰“åŒ…çš„å‘½ä»¤è¶Šå¤šè¶Šå¥½ã€‚å…·ä½“å¤šå°‘åˆé€‚éœ€è¦æ ¹æ®å…·ä½“æƒ…å†µæµ‹è¯•ã€‚</p>
<h2 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h2><p>æœ‰äº›ç³»ç»Ÿå¯èƒ½å¯¹å¯é æ€§è¦æ±‚å¾ˆé«˜ï¼Œæ¯æ¬¡æ“ä½œéƒ½éœ€è¦ç«‹é©¬çŸ¥é“è¿™æ¬¡æ“ä½œæ˜¯å¦æˆåŠŸï¼Œæ˜¯å¦æ•°æ®å·²ç»å†™è¿› redis äº†ï¼Œé‚£è¿™ç§åœºæ™¯å°±ä¸é€‚åˆã€‚</p>
<p>è¿˜æœ‰çš„ç³»ç»Ÿï¼Œå¯èƒ½æ˜¯æ‰¹é‡çš„å°†æ•°æ®å†™å…¥ redisï¼Œå…è®¸ä¸€å®šæ¯”ä¾‹çš„å†™å…¥å¤±è´¥ï¼Œé‚£ä¹ˆè¿™ç§åœºæ™¯å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œæ¯”å¦‚ 10000 æ¡ä¸€ä¸‹è¿›å…¥ redisï¼Œå¯èƒ½å¤±è´¥äº† 2 æ¡æ— æ‰€è°“ï¼ŒåæœŸæœ‰è¡¥å¿æœºåˆ¶å°±è¡Œäº†ï¼Œæ¯”å¦‚çŸ­ä¿¡ç¾¤å‘è¿™ç§åœºæ™¯ï¼Œå¦‚æœä¸€ä¸‹ç¾¤å‘ 10000 æ¡ï¼ŒæŒ‰ç…§ç¬¬ä¸€ç§æ¨¡å¼å»å®ç°ï¼Œé‚£è¿™ä¸ªè¯·æ±‚è¿‡æ¥ï¼Œè¦å¾ˆä¹…æ‰èƒ½ç»™å®¢æˆ·ç«¯å“åº”ï¼Œè¿™ä¸ªå»¶è¿Ÿå°±å¤ªé•¿äº†ï¼Œå¦‚æœå®¢æˆ·ç«¯è¯·æ±‚è®¾ç½®äº†è¶…æ—¶æ—¶é—´ 5 ç§’ï¼Œé‚£è‚¯å®šå°±æŠ›å‡ºå¼‚å¸¸äº†ï¼Œè€Œä¸”æœ¬èº«ç¾¤å‘çŸ­ä¿¡è¦æ±‚å®æ—¶æ€§ä¹Ÿæ²¡é‚£ä¹ˆé«˜ï¼Œè¿™æ—¶å€™ç”¨ pipeline æœ€å¥½äº†ã€‚</p>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>Pipeline</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP å°† DateTime å¯¹è±¡è½¬åŒ–ä¸ºå‹å¥½æ—¶é—´</title>
    <url>/PHP/create-a-friendly-date-format/</url>
    <content><![CDATA[<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‹å¥½çš„æ—¶é—´æ˜¾ç¤º</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * size = 1ï¼Œ æ˜¾ç¤º1ä½ï¼Œå¦‚: 1å¹´ã€3ä¸ªæœˆã€5å¤©ã€20å°æ—¶...</span></span><br><span class="line"><span class="comment"> * size = 2ï¼Œ æ˜¾ç¤º2ä½ï¼Œå¦‚: 1å¹´1ä¸ªæœˆã€1å¹´3å¤©ã€5å¤©4å°æ—¶ã€2å°æ—¶25åˆ†...</span></span><br><span class="line"><span class="comment"> * size = 3ï¼Œ æ˜¾ç¤º3ä½ï¼Œå¦‚: 1å¹´1ä¸ªæœˆ4å¤©ã€1å¹´3å¤©20å°æ—¶ã€5å¤©4å°æ—¶3ç§’ã€2å°æ—¶25åˆ†10ç§’...</span></span><br><span class="line"><span class="comment"> * size = 4ï¼Œ æ˜¾ç¤º4ä½ï¼Œå¦‚: 1å¹´1ä¸ªæœˆ4å¤©16å°æ—¶...</span></span><br><span class="line"><span class="comment"> * size &gt;= 5ï¼Œæ˜¾ç¤º5ä½ï¼Œå¦‚: 1å¹´1ä¸ªæœˆ4å¤©16å°æ—¶15åˆ†é’Ÿ...</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string|DateTime $datetime æ—¥æœŸå­—ç¬¦ä¸²æˆ–æ—¥æœŸ DateTime å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> int $size                 ç²¾ç¡®åˆ°ä½æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bool $absolute            æ­£æ•°çš„æ—¶é—´é—´éš”</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">friendlyDate</span>(<span class="params"><span class="variable">$datetime</span>, <span class="variable">$size</span> = <span class="number">1</span>, <span class="variable">$absolute</span> = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$datetime</span>)) &#123;</span><br><span class="line">        <span class="variable">$datetime</span> = <span class="keyword">new</span> <span class="title class_">DateTime</span>(<span class="variable">$datetime</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! (<span class="variable">$datetime</span> <span class="keyword">instanceof</span> DateTime)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">\InvalidArgumentException</span>(<span class="string">&#x27;invalid &quot;DateTime&quot; object&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$now</span> = <span class="keyword">new</span> <span class="title class_">DateTime</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$absolute</span> &amp;&amp; <span class="variable">$datetime</span> &lt;= <span class="variable">$now</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$interval</span> = <span class="variable">$now</span>-&gt;<span class="title function_ invoke__">diff</span>(<span class="variable">$datetime</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$intervalData</span> = [</span><br><span class="line">        <span class="variable">$interval</span>-&gt;y, <span class="variable">$interval</span>-&gt;m, <span class="variable">$interval</span>-&gt;d,</span><br><span class="line">        <span class="variable">$interval</span>-&gt;h, <span class="variable">$interval</span>-&gt;i, <span class="variable">$interval</span>-&gt;s,</span><br><span class="line">    ];</span><br><span class="line">    <span class="variable">$intervalFormat</span> = [<span class="string">&#x27;å¹´&#x27;</span>, <span class="string">&#x27;ä¸ªæœˆ&#x27;</span>, <span class="string">&#x27;å¤©&#x27;</span>, <span class="string">&#x27;å°æ—¶&#x27;</span>, <span class="string">&#x27;åˆ†é’Ÿ&#x27;</span>, <span class="string">&#x27;ç§’&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$intervalData</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$value</span>) &#123;</span><br><span class="line">            <span class="variable">$intervalData</span>[<span class="variable">$key</span>] = <span class="variable">$value</span> . <span class="variable">$intervalFormat</span>[<span class="variable">$key</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable">$intervalData</span>[<span class="variable">$key</span>]);</span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable">$intervalFormat</span>[<span class="variable">$key</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;&#x27;</span>, <span class="title function_ invoke__">array_slice</span>(<span class="variable">$intervalData</span>, <span class="number">0</span>, <span class="variable">$size</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>Git Submodule ç”¨æ³•ç¬”è®°</title>
    <url>/Git/git-submodule/</url>
    <content><![CDATA[<h2 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h2><div class="note info"><p>git version 2.21.0</p>
</div>

<h2 id="æ–°å¢-submodule"><a href="#æ–°å¢-submodule" class="headerlink" title="æ–°å¢ submodule"></a>æ–°å¢ submodule</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># git submodule add https://github.com/theme-next/hexo-theme-next.git themes/next/</span></span><br><span class="line">git submodule add &lt;url&gt; &lt;folder&gt;</span><br></pre></td></tr></table></figure>

<div class="note danger"><p>å¦‚æœå‡ºç° <code>xxx already exists in the index</code> çš„æç¤ºï¼Œåˆ™ç»™æ ¹æ®<a href="https://stackoverflow.com/questions/12898278/issue-with-adding-common-code-as-git-submodule-already-exists-in-the-index">Issue with adding common code as git submodule: â€œalready exists in the indexâ€
</a>é‡Œé¢çš„å›ç­”ï¼Œæ‰§è¡Œ <code>git rm -f --cached &lt;folder&gt;</code> åï¼Œåœ¨æ‰§è¡Œ <code>git submodule add</code></p>
</div>
<p>å¦‚æœè¿™ä¸ªä»“åº“å…ˆå‰æ²¡æœ‰ç”¨è¿‡ submoduleï¼Œé‚£ä¹ˆ Git ä¼šåœ¨ç›®å½•ä¸‹å»ºç«‹ä¸€ä¸ªå«åš <code>.gitmodules</code> çš„æ–‡ä»¶ï¼Œè¿™é‡Œè®°å½•äº† remote repo çš„ URL å’Œè¿™ä¸ª submodule åœ¨æ­¤ç›®å½•çš„è·¯å¾„ã€‚æ‰§è¡Œæ­¤å‘½ä»¤å submodule å’Œ <code>.gitmodules</code> ä¼šè‡ªåŠ¨ stagedï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ commit å’Œ pushã€‚</p>
<h2 id="æ›´æ–°-submodule"><a href="#æ›´æ–°-submodule" class="headerlink" title="æ›´æ–° submodule"></a>æ›´æ–° submodule</h2><p>å¿…é¡»åˆ°ä¸ªäººçš„ç›®å½•åº•ä¸‹æ‰§è¡Œ <code>git pull</code> å»æ‹‰å– upstream çš„ä»£ç ï¼Œå¯æ˜¯è¿™æ ·ä¼šæ¯”è¾ƒå®‰å…¨ï¼›è‹¥è¦ä¸€æ¬¡å…¨éƒ¨æ›´æ–°æ‰€æœ‰çš„ submoduleï¼Œå¯ä»¥ç”¨ <code>foreach</code> å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git submodule foreach --recursive git pull origin master</span><br></pre></td></tr></table></figure>

<h2 id="åˆ é™¤-submodule"><a href="#åˆ é™¤-submodule" class="headerlink" title="åˆ é™¤ submodule"></a>åˆ é™¤ submodule</h2><p>æœ¬ä»¥ä¸ºä¼šæœ‰åƒæ˜¯ <code>git submodule rm</code> è¿™æ ·çš„å‘½ä»¤ï¼Œç»“æœç«Ÿç„¶æ²¡æœ‰ï¼Œå¿…é¡»è¾›è‹¦çš„ä¸€ä¸ªä¸€ä¸ªæ‰‹åŠ¨ç§»é™¤ï¼Œä¸çŸ¥é“ä¸å®ç°è¿™ä¸ªå‘½ä»¤çš„è€ƒé‡æ˜¯ä»€ä¹ˆï¼Œå¸Œæœ›æœªæ¥çš„ç‰ˆæœ¬èƒ½æŠŠå®ƒåŠ ä¸Šå»ã€‚</p>
<span id="more"></span>

<p>ç§»é™¤ submodule æœ‰ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤è¦åšï¼Œå…ˆæŠŠ submodule ç›®å½•ä»ç‰ˆæœ¬æ§åˆ¶ç§»é™¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">rm</span> --cached &lt;folder&gt;</span><br><span class="line"><span class="built_in">rm</span> -rf &lt;folder&gt;</span><br></pre></td></tr></table></figure>

<p>å†æ¥æ˜¯ä¿®æ”¹ <code>.gitmodules</code> æ–‡ä»¶ï¼ŒæŠŠä¸ç”¨çš„ submodule åˆ æ‰ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">- [submodule <span class="string">&quot;themes/next&quot;</span>]</span><br><span class="line">-	path = themes/next</span><br><span class="line">-	url = https://github.com/theme-next/hexo-theme-next.git</span><br></pre></td></tr></table></figure>

<p>è¿˜è¦ä¿®æ”¹ <code>.git/config</code> çš„å…§å®¹ï¼Œè·Ÿ <code>.gitmodules</code> ä¸€æ ·ï¼ŒæŠŠéœ€è¦ç§»é™¤çš„ submodule åˆ æ‰ï¼Œæœ€åå† commitã€‚</p>
<h2 id="clone-æ—¶æŠŠ-submodule-ä¸€èµ·-clone-ä¸‹æ¥"><a href="#clone-æ—¶æŠŠ-submodule-ä¸€èµ·-clone-ä¸‹æ¥" class="headerlink" title="clone æ—¶æŠŠ submodule ä¸€èµ· clone ä¸‹æ¥"></a>clone æ—¶æŠŠ submodule ä¸€èµ· clone ä¸‹æ¥</h2><p>æ‰§è¡Œ <code>git clone</code> æ—¶ Git ä¸ä¼šè‡ªåŠ¨æŠŠ submodule ä¸€èµ· clone ä¸‹æ¥ï¼Œå¿…é¡»åŠ ä¸Š <code>--recursive</code> è¿™ä¸ªå‚æ•°ï¼Œè¿™æ ·å¯ä»¥è¿å¸¦ submodule çš„ submodule é€šé€šä¸€èµ· clone ä¸‹æ¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --recursive &lt;url&gt;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå·²ç» clone æ‰å‘ç° submodule æ˜¯ç©ºçš„ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤å» cloneï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git submodule init</span><br><span class="line">git submodule update --recursive</span><br></pre></td></tr></table></figure>

<p><code>init</code> ä¼šåœ¨ <code>.git/config</code> ä¸‹æ³¨å†Œ remote repo çš„ URL å’Œ local pathã€‚æˆ–æ˜¯åˆå¹¶æˆä¸€è¡Œ <code>git submodule update --init --recursive</code> ä¹Ÿå¯ä»¥ï¼Œå¦‚æœ upstream æœ‰äººæ”¹è¿‡ <code>.gitmodules</code>ï¼Œé‚£æœ¬åœ°å¥½åƒä¹Ÿæ˜¯ç”¨è¿™ä¸ªæ–¹æ³•æ›´æ–°ã€‚</p>
<h2 id="å‘½ä»¤è§£é‡Š"><a href="#å‘½ä»¤è§£é‡Š" class="headerlink" title="å‘½ä»¤è§£é‡Š"></a>å‘½ä»¤è§£é‡Š</h2><ul>
<li><p><code>git submodule init</code>ï¼šæ ¹æ® <code>.gitmodules</code> çš„åç§°å’Œ URLï¼Œå°†è¿™äº›ä¿¡æ¯æ³¨å†Œåˆ° <code>.git/config</code> å†…ï¼Œå¯æ˜¯æŠŠ <code>.gitmodules</code> å…§ä¸ç”¨çš„ submodule ç§»é™¤ï¼Œä½¿ç”¨å‘½ä»¤å¹¶æ²¡æœ‰åŠæ³•è‡ªåŠ¨åˆ é™¤ <code>.git/config</code> çš„ç›¸å…³å…§å®¹ï¼Œå¿…é¡»æ‰‹åŠ¨åˆªé™¤ï¼›</p>
</li>
<li><p><code>git submodule update</code>ï¼šæ ¹æ®å·²æ³¨å†Œï¼ˆä¹Ÿå°±æ˜¯ <code>.git/config</code> ï¼‰çš„ submodule è¿›è¡Œæ›´æ–°ï¼Œä¾‹å¦‚ clone é—å¤±çš„ submoduleï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€æ®µè®²çš„æ–¹æ³•ï¼Œæ‰€ä»¥æ‰§è¡Œè¿™ä¸ªå‘½ä»¤å‰æœ€å¥½åŠ ä¸Š <code>--init</code>ï¼›</p>
</li>
<li><p><code>git submodule sync</code>ï¼šå¦‚æœ submodule çš„ remote URL æœ‰å˜åŠ¨ï¼Œå¯ä»¥åœ¨ <code>.gitmodules</code> ä¿®æ­£ URLï¼Œç„¶åæ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œä¾¿ä¼šå°† submodule çš„ remote URL æ›´æ­£ã€‚</p>
</li>
</ul>
<div class="note default"><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.chh.tw/posts/git-submodule/">Git Submodule ç”¨æ³•ç­†è¨˜</a></p>
</div>]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>Git Submodule</tag>
      </tags>
  </entry>
  <entry>
    <title>CGI/FastCGI/php-cgi/php-fpmçš„åŒºåˆ«</title>
    <url>/PHP/CGI_FastCGI_php-cgi_php-fpm/</url>
    <content><![CDATA[<h2 id="ä¸€ã€æœ€æ—©çš„WebæœåŠ¡å™¨"><a href="#ä¸€ã€æœ€æ—©çš„WebæœåŠ¡å™¨" class="headerlink" title="ä¸€ã€æœ€æ—©çš„WebæœåŠ¡å™¨"></a>ä¸€ã€æœ€æ—©çš„WebæœåŠ¡å™¨</h2><p>æœ€æ—©çš„WebæœåŠ¡å™¨ç®€å•åœ°å“åº”æµè§ˆå™¨å‘æ¥çš„HTTPé™æ€æ–‡ä»¶è¯·æ±‚ï¼Œå¹¶å°†å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šçš„é™æ€æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼š jpgã€htmã€htmlï¼‰è¿”å›ç»™æµè§ˆå™¨ã€‚å¦‚å›¾æ˜¯å¤„ç†æµç¨‹</p>
<p><img src="/images/PHP/CGI_FastCGI_php-cgi_php-fpm/76df2b.png"></p>
<p>æ¯”å¦‚æˆ‘è®¿é—®ï¼š<code>http://www.example.com/index.html</code>ï¼Œé‚£ä¹ˆç½‘ç»œæœåŠ¡å™¨å°±ä¼šå»å¯¹åº”ç›®å½•ä¸­æ‰¾åˆ° <code>index.html</code>è¿™ä¸ªæ–‡ä»¶ï¼Œå¹¶è¿”å›ç»™æµè§ˆå™¨ã€‚</p>
<h2 id="äºŒã€CGIçš„å‡ºç°"><a href="#äºŒã€CGIçš„å‡ºç°" class="headerlink" title="äºŒã€CGIçš„å‡ºç°"></a>äºŒã€CGIçš„å‡ºç°</h2><p><strong>é¦–å…ˆè¯´æ˜ï¼šCGIæ˜¯ä¸€ç§åè®®</strong></p>
<p>äº‹ç‰©æ€»æ˜¯ä¸æ–­å‘å±•ï¼Œç½‘ç«™ä¹Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œæ‰€ä»¥å‡ºç°åŠ¨æ€æŠ€æœ¯ã€‚ä½†æ˜¯WebæœåŠ¡å™¨å¹¶ä¸èƒ½ç›´æ¥è¿è¡Œ php&#x2F;asp è¿™æ ·çš„æ–‡ä»¶ï¼Œè‡ªå·±ä¸èƒ½åšï¼Œå¤–åŒ…ç»™åˆ«äººå§ï¼Œä½†æ˜¯è¦ä¸ç¬¬ä¸‰åšä¸ªçº¦å®šï¼Œæˆ‘ç»™ä½ ä»€ä¹ˆï¼Œç„¶åä½ ç»™æˆ‘ä»€ä¹ˆï¼Œå°±æ˜¯æˆ‘æŠŠè¯·æ±‚å‚æ•°å‘é€ç»™ä½ ï¼Œç„¶åæˆ‘æ¥æ”¶ä½ çš„å¤„ç†ç»“æœå†ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸ªçº¦å®šå°±æ˜¯ CGIåè®®(Common Gateway Interface)ï¼Œåè®®åªæ˜¯ä¸€ä¸ªâ€œè§„å®šã€è§„åˆ™â€ï¼Œç†è®ºä¸Šç”¨ä»€ä¹ˆè¯­è¨€éƒ½èƒ½å®ç°ï¼Œæ¯”å¦‚ç”¨ vb&#x2F;c&#x2F;perl&#x2F;php&#x2F;python æ¥å®ç°ã€‚</p>
<p>åœ¨2000å¹´æˆ–æ›´æ—©çš„æ—¶å€™ï¼ŒCGI æ¯”è¾ƒç››è¡Œã€‚é‚£æ—¶ï¼ŒPerl æ˜¯ç¼–å†™ CGI çš„ä¸»æµè¯­è¨€ï¼Œä»¥è‡³äºä¸€èˆ¬çš„ CGI ç¨‹åº(éµå¾ª CGI åè®®çš„ç¨‹åº)å°±æ˜¯ Perl ç¨‹åºï¼ˆä¾‹å¦‚ä¸–ç•Œä¸Š80%çš„ç½‘ç«™æ‰€é‡‡ç”¨çš„ç¼–ç¨‹è¯­è¨€ php è¯­è¨€åˆšå¼€å§‹çš„ç‰ˆæœ¬å°±æ˜¯ç”¨Perlè¯­è¨€å†™çš„ï¼‰ã€‚</p>
<p>CGI æ˜¯ â€œCommon Gateway Interfaceâ€ çš„ç¼©å†™ï¼Œç¿»æˆä¸­æ–‡å«â€œå…¬å…±ç½‘å…³æ¥å£â€ï¼Œå®ƒæ˜¯ web æœåŠ¡å™¨ä¸å¤–éƒ¨åº”ç”¨ç¨‹åºï¼ˆCGI ç¨‹åºï¼‰ä¹‹é—´ä¼ é€’ä¿¡æ¯çš„æ¥å£æ ‡å‡†ã€‚é€šè¿‡ CGI æ¥å£ï¼Œweb æœåŠ¡å™¨å°±èƒ½å¤Ÿè·å–å®¢æˆ·ç«¯æäº¤çš„ä¿¡æ¯ï¼Œå¹¶è½¬äº¤ç»™æœåŠ¡å™¨ç«¯çš„ CGI ç¨‹åºå¤„ç†ï¼Œæœ€åè¿”å›ç»“æœç»™å®¢æˆ·ç«¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒCGI å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ¥å£æ ‡å‡†ã€‚æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„ CGI æ˜¯æŒ‡ CGI ç¨‹åºï¼Œå³å®ç°äº† CGI æ¥å£æ ‡å‡†çš„ç¨‹åºã€‚åªè¦æŸç§è¯­è¨€å…·æœ‰æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œç¯å¢ƒå˜é‡ï¼Œå¦‚ perl&#x2F;PHP&#x2F;C ç­‰ï¼Œå°±å¯ä»¥ç”¨æ¥ç¼–å†™ CGI ç¨‹åºã€‚CGI åªæ˜¯æ¥å£åè®®ï¼Œæ ¹æœ¬ä¸æ˜¯ä»€ä¹ˆè¯­è¨€ã€‚</p>
<span id="more"></span>

<h3 id="CGIç¨‹åºçš„å·¥ä½œæ–¹å¼"><a href="#CGIç¨‹åºçš„å·¥ä½œæ–¹å¼" class="headerlink" title="CGIç¨‹åºçš„å·¥ä½œæ–¹å¼"></a>CGIç¨‹åºçš„å·¥ä½œæ–¹å¼</h3><p>web æœåŠ¡å™¨ä¸€èˆ¬åªå¤„ç†é™æ€æ–‡ä»¶è¯·æ±‚ï¼ˆå¦‚ jpgã€htmã€htmlï¼‰ï¼Œå¦‚æœç¢°åˆ°ä¸€ä¸ªåŠ¨æ€è„šæœ¬è¯·æ±‚ï¼ˆå¦‚ phpï¼‰ï¼Œweb æœåŠ¡å™¨ä¸»è¿›ç¨‹ï¼Œå°± fork å‡ºä¸€ä¸ªæ–°çš„è¿›ç¨‹æ¥å¯åŠ¨ CGI ç¨‹åºï¼Œä¹Ÿå°±æ˜¯è¯´å°†åŠ¨æ€è„šæœ¬è¯·æ±‚äº¤ç»™ CGI ç¨‹åºæ¥å¤„ç†ã€‚å¯åŠ¨ CGI ç¨‹åºéœ€è¦ä¸€ä¸ªè¿‡ç¨‹ï¼Œæ¯”å¦‚ï¼Œè¯»å–é…ç½®æ–‡ä»¶ï¼ŒåŠ è½½æ‰©å±•ç­‰ã€‚CGI ç¨‹åºå¯åŠ¨åï¼Œå°±ä¼šè§£æåŠ¨æ€è„šæœ¬ï¼Œç„¶åå°†ç»“æœè¿”å›ç»™ web æœåŠ¡å™¨ï¼Œæœ€å web æœåŠ¡å™¨å†å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œåˆšæ‰ fork çš„è¿›ç¨‹ä¹Ÿä¼šéšä¹‹å…³é—­ã€‚è¿™æ ·ï¼Œæ¯æ¬¡ç”¨æˆ·è¯·æ±‚åŠ¨æ€è„šæœ¬ï¼Œweb æœåŠ¡å™¨éƒ½è¦é‡æ–° fork ä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œå»å¯åŠ¨ CGI ç¨‹åºï¼Œç”± CGI ç¨‹åºæ¥å¤„ç†åŠ¨æ€è„šæœ¬ï¼Œå¤„ç†å®Œåè¿›ç¨‹éšä¹‹å…³é—­ã€‚æ¯«æ— ç–‘é—®ï¼Œè¿™ç§å·¥ä½œæ–¹å¼çš„æ•ˆç‡æ˜¯éå¸¸ä½ä¸‹çš„ã€‚è¿è¡Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/images/PHP/CGI_FastCGI_php-cgi_php-fpm/42e54.png"></p>
<p>CGIç¨‹åºä¸webæœåŠ¡å™¨ä¼ é€’æ•°æ®ï¼š</p>
<p>CGI ç¨‹åºé€šè¿‡æ ‡å‡†è¾“å…¥ï¼ˆSTDINï¼‰å’Œæ ‡å‡†è¾“å‡ºï¼ˆSTDOUTï¼‰æ¥è¿›è¡Œè¾“å…¥è¾“å‡ºã€‚æ­¤å¤– CGI ç¨‹åºè¿˜é€šè¿‡ç¯å¢ƒå˜é‡æ¥å¾—åˆ°è¾“å…¥ï¼Œæ“ä½œç³»ç»Ÿæä¾›äº†è®¸å¤šç¯å¢ƒå˜é‡ï¼Œå®ƒä»¬å®šä¹‰äº†ç¨‹åºçš„æ‰§è¡Œç¯å¢ƒï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å­˜å–è¿™äº›ç¯å¢ƒå˜é‡ã€‚web æœåŠ¡å™¨å’Œ CGI æ¥å£åˆå¦å¤–è®¾ç½®äº†ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œç”¨æ¥å‘CGIç¨‹åºä¼ é€’ä¸€äº›é‡è¦çš„å‚ æ•°ã€‚CGI çš„ GET æ–¹æ³•è¿˜é€šè¿‡ç¯å¢ƒå˜é‡ QUERY-STRING å‘ CGI ç¨‹åºä¼ é€’ Form ä¸­çš„æ•°æ®ã€‚ ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„ CGI ç¯å¢ƒå˜é‡ï¼š</p>
<table>
<thead>
<tr>
<th align="left">å˜é‡å</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CONTENT_TYPE</td>
<td align="left">è¿™ä¸ªç¯å¢ƒå˜é‡çš„å€¼æŒ‡ç¤ºæ‰€ä¼ é€’æ¥çš„ä¿¡æ¯çš„MIMEç±»å‹ã€‚ç›®å‰ï¼Œç¯å¢ƒå˜é‡CONTENT_TYPEä¸€èˆ¬éƒ½æ˜¯ï¼šapplication&#x2F;x-www-form-urlencodedï¼Œä»–è¡¨ç¤ºæ•°æ®æ¥è‡ªäºHTMLè¡¨å•ã€‚</td>
</tr>
<tr>
<td align="left">CONTENT_LENGTH</td>
<td align="left">å¦‚æœæœåŠ¡å™¨ä¸CGIç¨‹åºä¿¡æ¯çš„ä¼ é€’æ–¹å¼æ˜¯POSTï¼Œè¿™ä¸ªç¯å¢ƒå˜é‡å³ä½¿ä»æ ‡å‡†è¾“å…¥STDINä¸­å¯ä»¥è¯»åˆ°çš„æœ‰æ•ˆæ•°æ®çš„å­—èŠ‚æ•°ã€‚è¿™ä¸ªç¯å¢ƒå˜é‡åœ¨è¯»å–æ‰€è¾“å…¥çš„æ•°æ®æ—¶å¿…é¡»ä½¿ç”¨ã€‚</td>
</tr>
<tr>
<td align="left">HTTP_COOKIE</td>
<td align="left">å®¢æˆ·æœºå†…çš„ COOKIE å†…å®¹ã€‚</td>
</tr>
<tr>
<td align="left">HTTP_USER_AGENT</td>
<td align="left">æä¾›åŒ…å«äº†ç‰ˆæœ¬æ•°æˆ–å…¶ä»–ä¸“æœ‰æ•°æ®çš„å®¢æˆ·æµè§ˆå™¨ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td align="left">PATH_INFO</td>
<td align="left">è¿™ä¸ªç¯å¢ƒå˜é‡çš„å€¼è¡¨ç¤ºç´§æ¥åœ¨CGIç¨‹åºåä¹‹åçš„å…¶ä»–è·¯å¾„ä¿¡æ¯ã€‚å®ƒå¸¸å¸¸ä½œä¸ºCGIç¨‹åºçš„å‚æ•°å‡ºç°ã€‚</td>
</tr>
<tr>
<td align="left">QUERY_STRING</td>
<td align="left">å¦‚æœæœåŠ¡å™¨ä¸CGIç¨‹åºä¿¡æ¯çš„ä¼ é€’æ–¹å¼æ˜¯GETï¼Œè¿™ä¸ªç¯å¢ƒå˜é‡çš„å€¼å³æ˜¯æ‰€ä¼ é€’çš„ä¿¡æ¯ã€‚è¿™ä¸ªä¿¡æ¯ç»è·Ÿåœ¨CGIç¨‹åºåçš„åé¢ï¼Œä¸¤è€…ä¸­é—´ç”¨ä¸€ä¸ªé—®å·?åˆ†éš”ï¼Œå¤šä¸ªå‚æ•°ç”¨&amp;å·è¿æ¥ã€‚</td>
</tr>
<tr>
<td align="left">REMOTE_ADDR</td>
<td align="left">è¿™ä¸ªç¯å¢ƒå˜é‡çš„å€¼æ˜¯å‘é€è¯·æ±‚çš„å®¢æˆ·æœºçš„IPåœ°å€ï¼Œä¾‹å¦‚ä¸Šé¢çš„192.168.1.67ã€‚è¿™ä¸ªå€¼æ€»æ˜¯å­˜åœ¨çš„ã€‚è€Œä¸”å®ƒæ˜¯Webå®¢æˆ·æœºéœ€è¦æä¾›ç»™WebæœåŠ¡å™¨çš„å”¯ä¸€æ ‡è¯†ï¼Œå¯ä»¥åœ¨CGIç¨‹åºä¸­ç”¨å®ƒæ¥åŒºåˆ†ä¸åŒçš„Webå®¢æˆ·æœºã€‚</td>
</tr>
<tr>
<td align="left">REMOTE_HOST</td>
<td align="left">è¿™ä¸ªç¯å¢ƒå˜é‡çš„å€¼åŒ…å«å‘é€CGIè¯·æ±‚çš„å®¢æˆ·æœºçš„ä¸»æœºåã€‚å¦‚æœä¸æ”¯æŒä½ æƒ³æŸ¥è¯¢ï¼Œåˆ™æ— éœ€å®šä¹‰æ­¤ç¯å¢ƒå˜é‡ã€‚</td>
</tr>
<tr>
<td align="left">REQUEST_METHOD</td>
<td align="left">æä¾›è„šæœ¬è¢«è°ƒç”¨çš„æ–¹æ³•ã€‚å¯¹äºä½¿ç”¨ HTTP&#x2F;1.0 åè®®çš„è„šæœ¬ï¼Œä»… GET å’Œ POST æœ‰æ„ä¹‰ã€‚</td>
</tr>
<tr>
<td align="left">SCRIPT_FILENAME</td>
<td align="left">CGIè„šæœ¬çš„å®Œæ•´è·¯å¾„ã€‚</td>
</tr>
<tr>
<td align="left">SCRIPT_NAME</td>
<td align="left">CGIè„šæœ¬çš„çš„åç§°ã€‚</td>
</tr>
<tr>
<td align="left">SERVER_NAME</td>
<td align="left">è¿™æ˜¯ä½ çš„ WEB æœåŠ¡å™¨çš„ä¸»æœºåã€åˆ«åæˆ–IPåœ°å€ã€‚</td>
</tr>
<tr>
<td align="left">SERVER_SOFTWARE</td>
<td align="left">è¿™ä¸ªç¯å¢ƒå˜é‡çš„å€¼åŒ…å«äº†è°ƒç”¨CGIç¨‹åºçš„HTTPæœåŠ¡å™¨çš„åç§°å’Œç‰ˆæœ¬å·ã€‚ä¾‹å¦‚ï¼Œä¸Šé¢çš„å€¼ä¸ºApache&#x2F;2.2.14(Unix)ã€‚</td>
</tr>
</tbody></table>
<h3 id="webæœåŠ¡å™¨å†…ç½®æ¨¡å—"><a href="#webæœåŠ¡å™¨å†…ç½®æ¨¡å—" class="headerlink" title="webæœåŠ¡å™¨å†…ç½®æ¨¡å—"></a>webæœåŠ¡å™¨å†…ç½®æ¨¡å—</h3><p>åæ¥ï¼Œå‡ºç°äº†ä¸€ç§æ¯”è¾ƒé«˜æ•ˆçš„æ–¹å¼ï¼šweb æœåŠ¡å™¨å†…ç½®æ¨¡å—ã€‚ä¾‹å¦‚ï¼Œapache çš„ mod_php æ¨¡å—ã€‚å°† php è§£é‡Šå™¨åšæˆæ¨¡å—ï¼Œç„¶ååŠ è½½åˆ° apache æœåŠ¡å™¨ä¸­ã€‚</p>
<p>è¿™æ ·ï¼Œapache æœåŠ¡å™¨åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šåŒæ—¶å¯åŠ¨ php æ¨¡å—ã€‚å½“å®¢æˆ·ç«¯è¯·æ±‚ php æ–‡ä»¶æ—¶ï¼Œapache æœåŠ¡å™¨å°±ä¸ç”¨å† fork å‡ºä¸€ä¸ªæ–°è¿›ç¨‹æ¥å¯åŠ¨ php è§£é‡Šå™¨ï¼Œè€Œæ˜¯ç›´æ¥å°† php æ–‡ä»¶äº¤ç»™è¿è¡Œä¸­çš„ php æ¨¡å—å¤„ç†ã€‚æ˜¾ç„¶ï¼Œè¿™ç§æ–¹å¼ä¸‹ï¼Œæ•ˆç‡ä¼šæ¯”è¾ƒé«˜ã€‚</p>
<p>ç”±äºåœ¨ apache æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œæ‰ä¼šè¯»å– php çš„é…ç½®æ–‡ä»¶ï¼ŒåŠ è½½ php æ¨¡å—ï¼Œåœ¨ apache çš„è¿è¡Œè¿‡ç¨‹ä¸­ ï¼Œä¸ä¼šå†é‡æ–°è¯»å– php çš„é…ç½®æ–‡ä»¶ã€‚æ‰€ä»¥ï¼Œæ¯æ¬¡æˆ‘ä»¬ä¿®æ”¹äº† php çš„é…ç½®æ–‡ä»¶åï¼Œå¿…é¡»é‡å¯ apacheï¼Œæ–°çš„phpé…ç½®æ–‡ä»¶æ‰ä¼šç”Ÿæ•ˆã€‚è¿è¡Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/images/PHP/CGI_FastCGI_php-cgi_php-fpm/081a0b3.png"></p>
<h3 id="FastCGI"><a href="#FastCGI" class="headerlink" title="FastCGI"></a>FastCGI</h3><p><strong>FastCGIæ˜¯ä¸€ç§åè®®</strong>ï¼Œå®ƒæ˜¯åœ¨<strong>CGIæ ‡å‡†åè®®</strong>åŸºç¡€ä¸Šå‘å±•å‡ºæ¥çš„ä¸€ä¸ªå˜ç§åè®®ï¼Œå®ƒçš„ä¸»è¦ç›®æ ‡æ˜¯å‡è½» web æœåŠ¡å™¨ä¸ CGI ç¨‹åºä¹‹é—´äº¤äº’æ—¶çš„è´Ÿè½½ï¼Œè¿™æ ·ä¸€å°æœåŠ¡å™¨å°±å¯ä»¥åœ¨åŒä¸€æ—¶é—´å¤„ç†æ›´å¤šçš„ web è¯·æ±‚ã€‚</p>
<p>FASTCGI çš„å®šä¹‰ç›¸å…³æ–‡ç« ï¼š<a href="http://www.mit.edu/~yandros/doc/specs/fcgi-spec.html#S1">FastCGI Specification</a>ã€<a href="http://www.mit.edu/afs.new/sipb/project/merakidev/src/openwrt-meraki/openwrt/build_mips/lighttpd-1.4.11/doc/fastcgi.txt">the FastCGI Interface</a></p>
<p><strong>FastCGIè¿›ç¨‹ç®¡ç†å™¨</strong>æ˜¯éµå¾ª<strong>FastCGIåè®®</strong>çš„ç¨‹åºï¼Œåªè¦ä½ æœ‰èƒ½åŠ›å°±å¯ä»¥å†™å‡ºéµå¾ª â€œFastCGIåè®®â€ çš„ â€œFastCGIè¿›ç¨‹ç®¡ç†å™¨â€ï¼Œæ¯«æ— ç–‘é—®ï¼Œâ€œFastCGIè¿›ç¨‹ç®¡ç†å™¨â€ å¹¶ä¸æ˜¯ä¸€ä¸ªç¨‹åºçš„åç§°ï¼Œè€Œæ˜¯æŒ‡éµå¾ª<strong>FastCGIåè®®</strong>çš„ä¸€ç±»ç¨‹åºã€‚</p>
<p>å½“å®¢æˆ·ç«¯è¯·æ±‚ Web æœåŠ¡å™¨ä¸Šçš„åŠ¨æ€è„šæœ¬æ—¶ï¼ŒWeb æœåŠ¡å™¨ä¼šå°†åŠ¨æ€è„šæœ¬é€šè¿‡ Unix åŸŸå¥—æ¥å­—(Unix domain socket)ï¼Œæˆ–å‘½åç®¡é“(named pipe)ï¼Œæˆ– TCP è¿æ¥(TCP connection)äº¤ç»™ FastCGI ä¸»è¿›ç¨‹ï¼ŒFastCGI ä¸»è¿›ç¨‹æ ¹æ®æƒ…å†µï¼Œå®‰æ’ä¸€ä¸ªç©ºé—²çš„å­è¿›ç¨‹æ¥è§£æåŠ¨æ€è„šæœ¬ï¼Œå¤„ç†å®Œæˆåå°†ç»“æœè¿”å›ç»™ Web æœåŠ¡å™¨ï¼ŒWeb æœåŠ¡å™¨å†å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¯¥å®¢æˆ·ç«¯è¯·æ±‚å¤„ç†å®Œæ¯•åï¼ŒFastCGI å­è¿›ç¨‹å¹¶ä¸ä¼šéšä¹‹å…³é—­ï¼Œè€Œæ˜¯ç»§ç»­ç­‰å¾…ä¸»è¿›ç¨‹å®‰æ’å·¥ä½œä»»åŠ¡ã€‚ç”±æ­¤å¯çŸ¥ï¼ŒFastCGI çš„å·¥ä½œæ•ˆç‡æ˜¯éå¸¸é«˜çš„ã€‚è¿è¡Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/images/PHP/CGI_FastCGI_php-cgi_php-fpm/6153419.png"></p>
<h3 id="php-fpm"><a href="#php-fpm" class="headerlink" title="php-fpm"></a>php-fpm</h3><p><strong>fpm</strong>æ˜¯<strong>FastCGI Process Manager</strong>çš„ç¼©å†™ï¼Œä¸­æ–‡å« â€œFastCGIè¿›ç¨‹ç®¡ç†å™¨â€ï¼Œè€Œ php-fpm å°±æ˜¯ç”¨äº php è¯­è¨€çš„ FastCGI è¿›ç¨‹ç®¡ç†å™¨ï¼ˆå‰é¢è¯´è¿‡ï¼Œâ€œFastCGIè¿›ç¨‹ç®¡ç†å™¨â€æ˜¯ä¸€ç±»ç¨‹åºï¼Œè€Œ php-fpm å°±å±äºè¿™ä¸€ç±»ç¨‹åºä¸­çš„å…¶ä¸­ä¸€ä¸ªï¼‰ã€‚å¯¹äº php5.3 ä¹‹å‰çš„ç‰ˆæœ¬æ¥è¯´ï¼Œphp-fpm æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„è¡¥ä¸åŒ…ï¼Œæ—¨åœ¨å°† FastCGI è¿›ç¨‹ç®¡ç†æ•´åˆè¿›PHPåŒ…ä¸­ã€‚åœ¨ php5.3 ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œphp-fpm ä¸å†æ˜¯ç¬¬ä¸‰æ–¹çš„åŒ…ï¼Œå®ƒå·²ç»è¢«é›†æˆåˆ° php çš„æºç ä¸­äº†ï¼Œå› ä¸º php-fpm æä¾›äº†æ›´å¥½çš„PHPè¿›ç¨‹ç®¡ç†æ–¹å¼ï¼Œå¯ä»¥æœ‰æ•ˆæ§åˆ¶å†…å­˜å’Œè¿›ç¨‹ã€å¯ä»¥å¹³æ»‘é‡è½½ PHP é…ç½®ï¼Œæ¯” spawn-fcgi å…·æœ‰æ›´å¤šä¼˜ç‚¹ï¼Œæ‰€ä»¥ php-fpm è¢« PHP å®˜æ–¹é›†æˆäº†ã€‚</p>
<h3 id="php-cgi"><a href="#php-cgi" class="headerlink" title="php-cgi"></a>php-cgi</h3><p>PHPä¸ºä»€ä¹ˆå«PHP</p>
<div class="note info"><p>PHPäº1994å¹´ç”±Rasmus Lerdorfåˆ›å»ºï¼Œåˆšåˆšå¼€å§‹æ˜¯Rasmus Lerdorfä¸ºäº†è¦ç»´æŠ¤ä¸ªäººç½‘é¡µè€Œåˆ¶ä½œçš„ä¸€ä¸ªç®€å•çš„ç”¨Perlè¯­è¨€ç¼–å†™çš„ç¨‹åºã€‚è¿™äº›å·¥å…·ç¨‹åºç”¨æ¥æ˜¾ç¤º Rasmus Lerdorf çš„ä¸ªäººå±¥å†ï¼Œä»¥åŠç»Ÿè®¡ç½‘é¡µæµé‡ã€‚åæ¥åˆç”¨Cè¯­è¨€é‡æ–°ç¼–å†™ï¼ŒåŒ…æ‹¬å¯ä»¥è®¿é—®æ•°æ®åº“ã€‚ä»–å°†è¿™äº›ç¨‹åºå’Œä¸€äº›è¡¨å•ç›´è¯‘å™¨æ•´åˆèµ·æ¥ï¼Œç§°ä¸º PHP&#x2F;FIã€‚</p>
<p>è€ŒPHP&#x2F;FIï¼Œæ˜¯â€œPersonal Home Page&#x2F;Form Interpreterâ€çš„ç¼©å†™ï¼Œæ„æ€æ˜¯â€œä¸ªäººä¸»é¡µ&#x2F;è¡¨å•è§£é‡Šå™¨â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒPHPæœ€åˆè¿˜ä¸æ˜¯ä¸€é—¨â€œè¯­è¨€â€ï¼Œè€Œæ˜¯â€œRasmus Lerdorfâ€ä¸ºäº†ç»´æŠ¤ä»–è‡ªå·±çš„ä¸ªäººä¸»é¡µè€Œå†™çš„ä¸€ä¸ªç®€å•çš„â€œè¡¨å•è§£é‡Šå™¨â€ã€‚</p>
<p>ä¸è¿‡åæ¥ï¼ŒPHPè¢«é‡æ–°å®šä¹‰ä¸º<strong>â€œPHP: HyperText Preprocessorâ€</strong>çš„ç¼©å†™ï¼Œæ³¨æ„ä¸æ˜¯â€œHyperText Preprocessorâ€è€Œæ˜¯â€œPHP: HyperText Preprocessorâ€ï¼Œè¿™ç§å°†åç§°æ”¾åˆ°å®šä¹‰ä¸­çš„å†™æ³•è¢«ç§°ä½œ<a href="https://baike.baidu.com/item/%E9%80%92%E5%BD%92%E7%BC%A9%E5%86%99">é€’å½’ç¼©å†™</a></p>
<p>æ‰€ä»¥ï¼ŒPHPç°åœ¨çš„å®šä¹‰å°±æ˜¯ä¸€ä¸ªâ€œè¶…æ–‡æœ¬é¢„å¤„ç†å™¨â€ï¼Œç”¨äºâ€œæŠŠphpè¯­è¨€å†™çš„ç¨‹åºè§£é‡Šæˆè¶…æ–‡æœ¬â€(è¯´ç™½äº†å°±æ˜¯æŠŠä½ å†™çš„phpä»£ç è½¬æ¢æˆhtmlï¼Œå½“ç„¶ç°åœ¨çš„èƒ½åŠ›ä¸æ­¢æ˜¯è§£é‡Šæˆhtml)ï¼Œå®‰è£…å¥½phpåï¼Œå¯¹äºLinux&#x2F;Macä¼šåœ¨å®‰è£…ç›®å½•ä¸‹æœ‰ä¸€ä¸ª <code>php</code> å’Œä¸€ä¸ª<code>php-cgi</code>ï¼Œå¯¹äºWinåˆ™æ˜¯<code>php.exe</code>å’Œ<code>php-cgi.exe</code>ã€‚</p>
</div>

<h3 id="php-cgiä¸phpçš„åŒºåˆ«"><a href="#php-cgiä¸phpçš„åŒºåˆ«" class="headerlink" title="php-cgiä¸phpçš„åŒºåˆ«"></a>php-cgiä¸phpçš„åŒºåˆ«</h3><p>php-cgiä¸phpçš„åŒºåˆ«(åœ¨winä¸‹å°±æ˜¯php-cgi.exeä¸php.exe)åœ¨äºï¼Œphp&#x2F;php.exeæ˜¯å‘½ä»¤æ¨¡å¼çš„phpè§£é‡Šå™¨ï¼Œè€Œphp-cgi&#x2F;php-cgi.exeæ˜¯æ”¯æŒâ€œé€šç”¨ç½‘å…³æ¥å£â€çš„phpè§£é‡Šå™¨ï¼Œè€Œé€šç”¨ç½‘å…³æ¥å£å°±æ˜¯æˆ‘ä»¬å‰é¢è¯´çš„â€œCGIâ€(ä»å®ƒçš„åç§°å°±èƒ½çœ‹å‡ºæ¥å•¦ï¼Œå®ƒéƒ½æ ‡æ˜äº†â€œ-cgiâ€äº†)ï¼Œä¸è¿‡ç°åœ¨çš„php-cgiæ˜¯å³æ”¯æŒâ€œCGIâ€åè®®ï¼Œä¹Ÿæ”¯æŒâ€œCGIåè®®â€çš„æ”¹è¿›ç‰ˆâ€”â€”â€œfastCGIåè®®â€çš„ã€‚</p>
<p><strong>ä¸¾ä¾‹è¯´æ˜phpä¸php-cgiéƒ½æ˜¯phpè§£é‡Šå™¨ï¼š</strong> è¿è¡Œ<code>php -i</code>æ˜¯â€œæŸ¥çœ‹phpçš„é…ç½®ä¿¡æ¯(iæ˜¯infoçš„ç¼©å†™)â€ï¼Œè€Œè¿è¡Œ<code>php-cgi -i</code>åŒæ ·æ˜¯â€œæŸ¥çœ‹phpçš„é…ç½®ä¿¡æ¯â€ï¼Œåªä¸è¿‡<code>php -i</code>æ˜¯ä»¥å‘½ä»¤ç‰ˆçš„æ ¼å¼è¿”å›(è¯´ç™½äº†å°±æ˜¯çº¯å­—ç¬¦ä¸²ï¼Œæœ€å¤šåŠ ä¸Šæ¢è¡Œ)ï¼Œè€Œ<code>php-cgi -i</code>è¿”å›çš„æ ¼å¼ï¼Œå´æ˜¯htmlæ ¼å¼çš„ï¼Œä½ å¯ä»¥ç”¨ <code>php-cgi -i &gt; /path/to/php-cgi.html</code>ä¿å­˜æˆhtmlæ–‡ä»¶å†æ¥æ‰“å¼€ï¼Œå¯ä»¥å‘ç°è·Ÿä½ åœ¨phpæ–‡ä»¶ä¸­ç”¨<code>phpinfo();</code>å‡½æ•°æ˜¯ä¸€æ ·çš„ã€‚</p>
<h3 id="php-cgiæ”¯æŒfastCGIåè®®"><a href="#php-cgiæ”¯æŒfastCGIåè®®" class="headerlink" title="php-cgiæ”¯æŒfastCGIåè®®"></a>php-cgiæ”¯æŒfastCGIåè®®</h3><p>ä¸ºä»€ä¹ˆè¯´<code>php-cgi</code>æ—¢æ”¯æŒæ™®é€šçš„CGIåè®®ï¼Œä¹Ÿæ”¯æŒâ€œfastCGIâ€åè®®å‘¢ï¼Ÿè¿è¡Œ<code>php-cgi -h</code>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Usage: php [-q] [-h] [-s] [-v] [-i] [-f &lt;file&gt;]</span><br><span class="line">       php &lt;file&gt; [args...]</span><br><span class="line">  -a               Run interactively</span><br><span class="line">  -b &lt;address:port&gt;|&lt;port&gt; Bind Path for external FASTCGI Server mode</span><br><span class="line">  -C               Do not chdir to the script&#x27;s directory</span><br><span class="line">  -c &lt;path&gt;|&lt;file&gt; Look for php.ini file in this directory</span><br><span class="line">  -n               No php.ini file will be used</span><br><span class="line">  -d foo[=bar]     Define INI entry foo with value &#x27;bar&#x27;</span><br><span class="line">  -e               Generate extended information for debugger/profiler</span><br><span class="line">  -f &lt;file&gt;        Parse &lt;file&gt;.  Implies `-q&#x27;</span><br><span class="line">  -h               This help</span><br><span class="line">  -i               PHP information</span><br><span class="line">  -l               Syntax check only (lint)</span><br><span class="line">  -m               Show compiled in modules</span><br><span class="line">  -q               Quiet-mode.  Suppress HTTP Header output.</span><br><span class="line">  -s               Display colour syntax highlighted source.</span><br><span class="line">  -v               Version number</span><br><span class="line">  -w               Display source with stripped comments and whitespace.</span><br><span class="line">  -z &lt;file&gt;        Load Zend extension &lt;file&gt;.</span><br><span class="line">  -T &lt;count&gt;       Measure execution time of script repeated &lt;count&gt; times.</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­æœ‰è¿™å¥â€œBind Path for external FASTCGI Server modeâ€ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-b &lt;address:port&gt;|&lt;port&gt; Bind Path for external FASTCGI Server mode</span><br></pre></td></tr></table></figure>

<p>æ„æ€æ˜¯â€œç»‘å®šè·¯å¾„ä»¥ä½œä¸ºå¤–éƒ¨FASTCGIæœåŠ¡å™¨æ¨¡å¼æ¥ä½¿ç”¨â€ï¼Œé‚£ä¹ˆä¸ç»‘å®šå‘¢ï¼Ÿä¸ç»‘å®šå°±æ˜¯ä½œä¸ºâ€œéFASTCGIâ€æ¨¡å¼ä½¿ç”¨å‘—ã€‚</p>
<p>å½“ç„¶ï¼Œphp-cgiæ”¯æŒâ€œæ ‡å‡†CGIâ€æ¥å£åªæ˜¯æˆ‘çš„çŒœæµ‹ï¼Œæˆ‘æ— æ³•ç”¨å®é™…çš„ä¾‹å­æ¥è§£é‡Šï¼ˆè€Œä¸”å°±ç®—å¯ä»¥ï¼Œä¹Ÿæ²¡äººä¼šç”¨è¿™ç§æ–¹å¼äº†ï¼‰ï¼Œä½†æ˜¯php-cgiæ”¯æŒâ€œFASTCGIâ€è¿™æ˜¯ç»å¯¹ç»å¯¹å¯ä»¥ç¡®å®šçš„ï¼Œå› ä¸ºæˆ‘æœ‰å®ä¾‹å¯ä»¥è¯æ˜ï¼ï¼</p>
<p>ç›¸ä¿¡ç°åœ¨ç»å¤§éƒ¨åˆ†äººéƒ½æ˜¯ç”¨nginx+php-fpmæ¨¡å¼æ¥è¿è¡Œç½‘ç«™çš„ï¼Œæˆ‘è¿™ä¸ªä¾‹å­å°±ä»¥è¿™ä¸ªæ¥è§£é‡Šï¼ä¸‹åˆ—é…ç½®ï¼Œåªè¦é…ç½®è¿‡nginx+php-fpmçš„ç«¥é‹åº”è¯¥éƒ½å¾ˆç†Ÿæ‚‰ï¼Œæ„æ€å°±æ˜¯å½“nginxé‡åˆ°<code>.php</code>ç»“å°¾çš„æ–‡ä»¶ï¼Œå°±â€œè°ƒç”¨php-fpmâ€æ¥è§£é‡Šè¿™ä¸ªphpæ–‡ä»¶ï¼Œæ­¤æ—¶php-fpmç›¸å½“äºâ€œæœåŠ¡å™¨â€ï¼Œâ€œ127.0.0.1:9000â€å°±æ˜¯php-fpmæœåŠ¡å™¨ç›‘å¬çš„ipå’Œç«¯å£ï¼Œè€Œnginxç›¸å½“äºâ€œå®¢æˆ·ç«¯â€ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">location ~ \.php$ &#123;</span><br><span class="line">    include fastcgi.conf;</span><br><span class="line">    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">    fastcgi_index  index.php;</span><br><span class="line">    fastcgi_buffer_size 128k;</span><br><span class="line">    fastcgi_buffers 4 256k;</span><br><span class="line">    fastcgi_busy_buffers_size 256k;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬æŠŠä¸Šè¿°é…ç½®ä¿®æ”¹ä¸€ä¸ªåœ°æ–¹ï¼ŒæŠŠ<code>9000</code>æ”¹æˆ<code>9001</code>(å¦‚æœä½ 9001è¢«å ç”¨äº†é‚£å°±ç”¨å…¶ä»–æœªå ç”¨çš„ç«¯å£ï¼Œåªè¦ä¸‹è¾¹å¯¹åº”å³å¯)ï¼Œç„¶å<code>sudo nginx -s reload</code>é‡è½½é…ç½®ï¼Œæ¯«æ— ç–‘é—®ï¼Œç°åœ¨ç”¨æµè§ˆå™¨è®¿é—®ä½ çš„phpæ–‡ä»¶ï¼Œæ¯”å¦‚<code>http://localhost/index.php</code>å°†ä¼šå‡ºç°<code>502 Bad Gateway</code>ï¼Œå› ä¸ºphp-fpmç›‘å¬çš„æ˜¯9000ç«¯å£ï¼Œç°åœ¨ä½ ä¿®æ”¹æˆ9001å®ƒå½“ç„¶æ‰¾ä¸åˆ°å•Šã€‚</p>
<p>è¿˜è®°å¾—åˆšæ‰å‰é¢è¯´åˆ°çš„â€œç»‘å®šè·¯å¾„ä»¥ä½œä¸ºå¤–éƒ¨FASTCGIæœåŠ¡å™¨æ¨¡å¼æ¥ä½¿ç”¨â€å—ï¼Ÿç°åœ¨æˆ‘ä»¬å°±æ¥ä½¿ç”¨å®ƒï¼Œè¿›å…¥php-cgiæ‰€åœ¨ç›®å½•ï¼Œè¿è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./php-cgi -b 127.0.0.1:9001</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡åˆ·æ–°ä½ çš„<code>http://localhost/index.php</code>ï¼Œæ€æ ·ï¼Ÿæ˜¯ä¸æ˜¯æ²¡æœ‰502äº†ï¼Ÿæ˜¯ä¸æ˜¯æ­£å¸¸äº†ï¼Ÿä½†ä½ è¦çŸ¥é“ï¼Œç°åœ¨è§£é‡Šä½ çš„<code>index.php</code>æ–‡ä»¶çš„æ˜¯<code>php-cgi</code>è€Œä¸å†æ˜¯<code>php-fpm</code>äº†ï¼Œè¿™å°±è¯æ˜äº†<code>php-cgi</code>ç¡®å®æ˜¯æ”¯æŒâ€œFASTCGIâ€åè®®çš„ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºnginxé‡Œç”¨çš„å‚æ•°ï¼Œéƒ½æ˜¯<code>fastcgi_</code>å¼€å¤´çš„å•Šï¼Œè¿™å°±æ˜¯â€œFASTCGIâ€åè®®å•Šã€‚</p>
<p>å®éªŒç»“æŸï¼Œ<code>ctrl+C</code>å°±å¯ä»¥å…³é—­ä½ åˆšæ‰è¿è¡Œçš„<code>php-cgi</code>äº†ï¼Œå› ä¸ºåˆšæ‰æ˜¯ç›´æ¥åœ¨å‰å°è¿è¡Œçš„ï¼Œç„¶åæŠŠ9001æ”¹åŠ 9000ï¼Œå†æ‰§è¡Œ<code>sudo nginx -s reload</code>å°±æ¢å¤åˆ°ç”¨<code>php-fpm</code>äº†ã€‚</p>
<p><strong>å¦ä¸€ä¸ªç”¨äºè¯æ˜php-cgiå³æ”¯æŒâ€œCGIâ€åˆæ”¯æŒâ€œfastCGIâ€çš„ä¾‹å­ï¼š</strong></p>
<p>ç”±äºWindowsä¸æ”¯æŒé»˜è®¤php-fpm(å› ä¸ºphp-fpmæ˜¯åŸºäºLinuxçš„fork()åˆ›å»ºå­è¿›ç¨‹çš„ï¼Œè€ŒWindowsä¸æ”¯æŒè¿™ä¸ªï¼Œä¸è¿‡å¯ä»¥ç”¨Cygwinæ¨¡æ‹Ÿ)ï¼Œè€Œåƒä¸€äº›é›†æˆå·¥å…·ä¸€èˆ¬éƒ½æ˜¯ç›´æ¥ä½¿ç”¨php-cgi.exeä»£æ›¿php-fpmï¼Œæ¯”å¦‚phpStudyï¼Œæˆ‘ä»¬é€‰æ‹©ç”¨php+nginxï¼š</p>
<p><img src="/images/PHP/CGI_FastCGI_php-cgi_php-fpm/6155930.jpg"></p>
<p>ç„¶åæŸ¥çœ‹phpStudyçš„å­è¿›ç¨‹ï¼Œé‡Œé¢å°±æœ‰ä¸€ä¸ª<code>CGI / FastCGI(32 bit)</code>ï¼Œè¿™ä¸ªå°±æ˜¯â€œphp-cgi.exeâ€ï¼Œä½ å¯ä»¥å³å‡»å®ƒâ†’ç‚¹å‡»â€œå±æ€§â€â†’ç‚¹å‡»â€œå®‰å…¨â€ï¼Œå°±èƒ½çœ‹åˆ°å®ƒçš„è·¯å¾„ï¼š</p>
<p><img src="/images/PHP/CGI_FastCGI_php-cgi_php-fpm/9f36463c.jpg"></p>
<p><strong>è¯æ˜ä¾‹å­3ï¼š</strong><a href="https://php.net/manual/en/install.fpm.php#121725">https://php.net/manual/en/install.fpm.php#121725</a>ï¼Œè¿™ä¸ªè€å¤–è¯´äº†ï¼Œphp-cgiæ˜¯fastCGIæ¥å£ä½†ä¸æ˜¯fpmï¼Œæ‰€ä»¥è¿™åˆè¯æ˜äº†â€œphp-cgiâ€æ˜¯æ”¯æŒfastCGIåè®®çš„ã€‚</p>
<p><img src="/images/PHP/CGI_FastCGI_php-cgi_php-fpm/60157.png"></p>
<p>å‰é¢è¯´äº†php-cgiä¸phpçš„ç›¸åŒç‚¹â€”â€”å®ƒä»¬éƒ½æ˜¯phpè§£é‡Šå™¨ï¼Œåªæ˜¯ä¸€ä¸ªåªæ”¯æŒä½¿ç”¨â€œå‘½ä»¤è¡Œæ–¹å¼è°ƒç”¨â€ï¼Œä¸€ä¸ªæ”¯æŒâ€œé€šç”¨ç½‘å…³æ¥å£â€æ–¹å¼è°ƒç”¨ã€‚</p>
<h3 id="php-cgiä¸php-fpmçš„åŒºåˆ«"><a href="#php-cgiä¸php-fpmçš„åŒºåˆ«" class="headerlink" title="php-cgiä¸php-fpmçš„åŒºåˆ«"></a>php-cgiä¸php-fpmçš„åŒºåˆ«</h3><p>é‚£ä¹ˆphp-cgiä¸php-fpmåˆæœ‰ä»€ä¹ˆä¸åŒï¼Ÿå…¶å®ä½ å¯ä»¥è®¤ä¸ºâ€œphp-fpmâ€å°±æ˜¯â€œphp-cgiâ€çš„æ”¹è¿›ç‰ˆï¼Œå‰é¢æˆ‘è¯´äº†php-cgiå°±æ˜¯ä¸€ä¸ªâ€œéµå¾ªé€šç”¨ç½‘å…³æ¥å£çš„phpè§£é‡Šå™¨â€ï¼Œè€Œphp-fpmæ˜¯php-cgiçš„æ”¹è¿›ç‰ˆï¼Œè¯´æ˜php-fpmåŒæ ·ä¹Ÿæ˜¯ä¸€ä¸ªâ€œéµå¾ªé€šç”¨ç½‘å…³æ¥å£çš„phpè§£é‡Šå™¨â€ï¼Œå¹¶ä¸”è¿™é‡Œçš„â€œé€šç”¨ç½‘å…³æ¥å£â€æŒ‡çš„æ˜¯â€œFASTCGIâ€è€Œä¸æ˜¯â€œCGIâ€ï¼Œå› ä¸ºå‰é¢éƒ½å·²ç»ç”¨å®ä¾‹è¯æ˜äº†â€œphp-cgiâ€æ˜¯æ”¯æŒâ€œFASTCGIâ€åè®®çš„ï¼Œæ—¢ç„¶php-cgiéƒ½æ”¯æŒï¼Œé‚£ä¹ˆå®ƒçš„æ”¹è¿›ç‰ˆâ€”â€”php-fpmè‚¯å®šå°±æ›´æ”¯æŒäº†ï¼Œä»å®ƒçš„åå­—â€œfpmâ€é‡Œå°±èƒ½çœ‹å‡ºæ¥ï¼Œâ€œfpmâ€æ˜¯â€œFastcgi Process Managerâ€ï¼Œæ„æ€æ˜¯â€œæ”¯æŒfastCGIåè®®çš„è¿›ç¨‹ç®¡ç†å™¨â€ï¼Œé‚£ä¹ˆâ€œphp-fpmâ€å°±æ˜¯ç”¨äºphpçš„â€œæ”¯æŒfastCGIåè®®çš„è¿›ç¨‹ç®¡ç†å™¨â€ï¼Œå› ä¸ºâ€œæ”¯æŒfastCGIåè®®çš„è¿›ç¨‹ç®¡ç†å™¨â€ä¸ä¸€å®šåªæœ‰ç”¨äºphpï¼Œä¹Ÿè®¸è¿˜æœ‰å…¶ä»–çš„å‘¢ï¼Ÿ</p>
<p>å¥½äº†ï¼Œæ—¢ç„¶php-fpmä¹Ÿæ˜¯â€œéµå¾ªé€šç”¨ç½‘å…³æ¥å£çš„phpè§£é‡Šå™¨â€ï¼Œé‚£ä¹ˆæœ‰ä¸€ç‚¹å¯ä»¥ç¡®å®šçš„æ˜¯ï¼Œphp-fpmä¸ä¼šè°ƒç”¨php-cgiä¹Ÿä¸ä¼šä¾èµ–php-cgiï¼Œå› ä¸ºå®ƒæœ¬èº«å°±æ˜¯â€œphp-cgiâ€çš„æ”¹è¿›ç‰ˆï¼Œæ²¡æœ‰ç†ç”±å»è°ƒç”¨(å»ä¾èµ–php-cgi)ï¼Œç¡®å®šæ–¹æ³•å¾ˆç®€å•ï¼Œå…ˆåœæ‰ä½ çš„php-fpmï¼Œç„¶åæŠŠphp-cgiæ”¹ä¸ªåæˆ–è€…ç§»åŠ¨åˆ°å¦ä¸€ä¸ªç›®å½•ï¼Œå†å¯åŠ¨php-fpmï¼Œçœ‹ä¸€åˆ‡æ˜¯å¦æ­£å¸¸ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šæ­£å¸¸çš„ï¼Œphp-fpmæ ¹æœ¬ä¸ä¾èµ–php-cgiã€‚</p>
<p>å‰é¢è¯´ï¼Œâ€œphp-fpmâ€æ˜¯â€œphp-cgiâ€çš„æ”¹è¿›ç‰ˆï¼ˆå½“ç„¶è¿™ä¸ªâ€œæ”¹è¿›ç‰ˆâ€æ˜¯æˆ‘è‡ªå·±çš„è¯´æ³•ï¼Œå®é™…ä¸Šphp-fpmæ˜¯ä¸æ˜¯åœ¨php-cgiçš„åŸºç¡€ä¸Šæ”¹è¿›çš„ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œä½†è¯´å®ƒæ˜¯æ”¹è¿›ç‰ˆæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼‰ï¼Œæ—¢ç„¶æ˜¯æ”¹è¿›ç‰ˆï¼Œé‚£æ”¹è¿›äº†ä»€ä¹ˆå‘¢ï¼Ÿè¯·çœ‹å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://www.php.net/manual/zh/install.fpm.php">FastCGI è¿›ç¨‹ç®¡ç†å™¨(fpm)</a></p>
<ul>
<li>æ”¯æŒå¹³æ»‘åœæ­¢&#x2F;å¯åŠ¨çš„é«˜çº§è¿›ç¨‹ç®¡ç†åŠŸèƒ½ï¼›</li>
<li>å¯ä»¥å·¥ä½œäºä¸åŒçš„ uid&#x2F;gid&#x2F;chroot ç¯å¢ƒä¸‹ï¼Œå¹¶ç›‘å¬ä¸åŒçš„ç«¯å£å’Œä½¿ç”¨ä¸åŒçš„ php.ini é…ç½®æ–‡ä»¶ï¼ˆå¯å–ä»£ safe_mode çš„è®¾ç½®ï¼‰ï¼›</li>
<li>stdout å’Œ stderr æ—¥å¿—è®°å½•;</li>
<li>åœ¨å‘ç”Ÿæ„å¤–æƒ…å†µçš„æ—¶å€™èƒ½å¤Ÿé‡æ–°å¯åŠ¨å¹¶ç¼“å­˜è¢«ç ´åçš„ opcode;</li>
<li>æ–‡ä»¶ä¸Šä¼ ä¼˜åŒ–æ”¯æŒ;</li>
<li>â€œæ…¢æ—¥å¿—â€ â€“ è®°å½•è„šæœ¬ï¼ˆä¸ä»…è®°å½•æ–‡ä»¶åï¼Œè¿˜è®°å½• PHP backtrace ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ ptraceæˆ–è€…ç±»ä¼¼å·¥å…·è¯»å–å’Œåˆ†æè¿œç¨‹è¿›ç¨‹çš„è¿è¡Œæ•°æ®ï¼‰è¿è¡Œæ‰€å¯¼è‡´çš„å¼‚å¸¸ç¼“æ…¢;</li>
<li>fastcgi_finish_request() â€“ ç‰¹æ®ŠåŠŸèƒ½ï¼šç”¨äºåœ¨è¯·æ±‚å®Œæˆå’Œåˆ·æ–°æ•°æ®åï¼Œç»§ç»­åœ¨åå°æ‰§è¡Œè€—æ—¶çš„å·¥ä½œï¼ˆå½•å…¥è§†é¢‘è½¬æ¢ã€ç»Ÿè®¡å¤„ç†ç­‰ï¼‰ï¼›</li>
<li>åŠ¨æ€ï¼é™æ€å­è¿›ç¨‹äº§ç”Ÿï¼›</li>
<li>åŸºæœ¬ SAPI è¿è¡ŒçŠ¶æ€ä¿¡æ¯ï¼ˆç±»ä¼¼Apacheçš„ mod_statusï¼‰ï¼›</li>
<li>åŸºäº php.ini çš„é…ç½®æ–‡ä»¶ã€‚</li>
</ul>
<p>ç”±å‰é¢çš„phpStudyæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿è¡Œphp-cgi.exe(åœ¨Mac&#x2F;Linuxä¸Šæ˜¯php-cgi)æ—¶ï¼Œåªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œå½“ç½‘ç«™å¹¶å‘æ•°å¤§æ—¶ï¼Œè¿™ä¸ªè¿›ç¨‹å¾ˆå®¹æ˜“å°±â€œæŒ‚æ‰â€ï¼ŒæŒ‚æ‰å°±å†ä¹Ÿæ— æ³•å¤„ç†nginxçš„è¯·æ±‚äº†ã€‚è€Œphp-fpmæ˜¯ä¸€ä¸ªè¿›ç¨‹ç®¡ç†å™¨ï¼Œå¯åŠ¨å®ƒæ—¶ï¼Œå®ƒé™¤äº†æœ‰ä¸€ä¸ªâ€œä¸»è¿›ç¨‹(master)â€å¤–ï¼Œè¿˜ä¼šåˆ›å»ºå¾ˆå¤šâ€œå­è¿›ç¨‹â€ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/images/PHP/CGI_FastCGI_php-cgi_php-fpm/b5a89c.jpeg"></p>
<p>è¿™äº›å­è¿›ç¨‹ï¼Œæ‰æ˜¯çœŸæ­£çš„â€œéµå¾ªé€šç”¨ç½‘å…³æ¥å£çš„phpè§£é‡Šå™¨â€ï¼Œè€Œä¸»è¿›ç¨‹åªä¸è¿‡æ˜¯æŠŠè¯·æ±‚åˆ†é…ç»™è¿™äº›å­è¿›ç¨‹è€Œå·²ï¼Œæ‰€ä»¥php-fpmæ‰å«â€œphp fastCGIè¿›ç¨‹ç®¡ç†å™¨â€ï¼Œå½“ç½‘ç«™å¹¶å‘æ•°å¤§æ—¶ï¼Œä¸»è¿›ç¨‹ä¼šä¸æ–­æŠŠè¯·æ±‚åˆ†é…ç»™è¿™äº›å­è¿›ç¨‹ï¼Œä»è€Œå¯ä»¥åŒæ—¶å¤„ç†é«˜å¹¶å‘è€Œä¸â€œæŒ‚æ‰â€ã€‚</p>
<p>å¦å¤–ï¼Œå­è¿›ç¨‹çš„å¤šå°‘ï¼Œä¸»è¿›ç¨‹è¿˜ä¼šâ€œè‡ªåŠ¨åˆ†é…â€ï¼Œæ¯”å¦‚å¹¶å‘æ•°å¤§æ—¶ï¼Œä¸»è¿›ç¨‹ä¼šå¤šåˆ›å»ºä¸€äº›å­è¿›ç¨‹ï¼Œç”¨äºåŒæ—¶å¤„ç†æ›´å¤šçš„è¯·æ±‚ï¼Œè€Œå½“å¹¶å‘æ•°å°æ—¶ï¼Œåˆ™ä¼šè‡ªåŠ¨å…³é—­ä¸€äº›è¿›ç¨‹ï¼Œä»è€Œâ€œå‡å°‘è¿™äº›å­è¿›ç¨‹å¯¹æœåŠ¡å™¨å†…å­˜çš„å ç”¨â€ï¼Œå½“ç„¶è¿™ä¸ªå–å†³äºphp-fpmé…ç½®çš„è¿›ç¨‹ç®¡ç†æ–¹å¼(staticæ–¹å¼ä¸ä¼šè‡ªåŠ¨)ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong>ç½‘ä¸Šå¾ˆå¤šäººè¯´ï¼Œphp-fpmæ˜¯ç”¨äºç®¡ç†php-cgiçš„ï¼Œè¿™ä¸ªè¯´æ³•å¯¹ä¹Ÿä¸å¯¹ï¼Œè¯´ä»–å¯¹ï¼Œæ˜¯å› ä¸ºåœ¨php5.4ä»¥å‰ç¡®å®æ˜¯è¿™æ ·çš„ï¼Œä½†php5.4ä»¥åï¼Œphp-fpmå·²è¢«phpå®˜æ–¹æ”¶ç¼–ï¼Œæœ¬èº«å·²ç»è‡ªå¸¦äº†è§£æphpçš„åŠŸèƒ½ï¼Œä¸åªæ˜¯åšè¿›ç¨‹ç®¡ç†ï¼Œä¹Ÿä¸å†ä¾èµ–php-cgiæ¥è§£æphpäº†ã€‚</p>
<h3 id="php-fpmç®¡ç†è¿›ç¨‹çš„ä¸‰ç§æ–¹å¼"><a href="#php-fpmç®¡ç†è¿›ç¨‹çš„ä¸‰ç§æ–¹å¼" class="headerlink" title="php-fpmç®¡ç†è¿›ç¨‹çš„ä¸‰ç§æ–¹å¼"></a>php-fpmç®¡ç†è¿›ç¨‹çš„ä¸‰ç§æ–¹å¼</h3><p>php-fpmçš„è¿›ç¨‹ç®¡ç†æ–¹å¼æœ‰ï¼š</p>
<ul>
<li>staticï¼šé™æ€æ–¹å¼ï¼Œå³å­è¿›ç¨‹æ•°æ˜¯å›ºå®šçš„ï¼Œä¸ä¼šéšç€å¹¶å‘æ•°çš„å¤šå°‘è€Œè‡ªåŠ¨è°ƒæ•´å­è¿›ç¨‹æ•°ï¼Œæœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼Œ1ã€å½“å¹¶å‘æ•°å°‘æ—¶ï¼Œå¦‚æœå­è¿›ç¨‹å¤ªå¤šä¼šæµªè´¹å†…å­˜ï¼Œ2ã€å½“å¹¶å‘æ•°å¤§æ—¶ä¹Ÿä¸ä¼šè‡ªåŠ¨å¢åŠ å­è¿›ç¨‹ï¼Œæ¯”å¦‚â€œæ­»æ¿â€ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šç”¨è¿™ç§æ–¹å¼ã€‚</li>
<li>dynamicï¼šåŠ¨æ€åˆ†é…ï¼Œå½“ç©ºé—²æ—¶ï¼Œä¼šè‡ªåŠ¨ç¼©å°åˆ°æœ€å°‘å­è¿›ç¨‹æ•°(é€šè¿‡pm.min_spare_serversæŒ‡å®š)ï¼Œå½“å¹¶å‘æ•°å¤§æ—¶ï¼Œä¼šæŒ‰éœ€æ±‚å¢åŠ å­è¿›ç¨‹æ•°ï¼Œå½“ç„¶è¿™ä¸ªå¢åŠ å¹¶ä¸æ˜¯æ— æ­¢å¢ƒçš„ï¼Œè€Œæ˜¯æœ‰æœ€å¤§å­è¿›ç¨‹æ•°çš„(é€šè¿‡pm.max_childrenæŒ‡å®šï¼Œå¦å¤–ä¹Ÿæœ‰ç©ºé—²æ—¶çš„æœ€å¤§å­è¿›ç¨‹æ•°ï¼Œé€šè¿‡pm.max_spare_serversæŒ‡å®š)ï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½é‡‡ç”¨è¿™ç§è¿›ç¨‹ç®¡ç†æ–¹å¼ã€‚</li>
<li>ondemandï¼šå¯åŠ¨php-fpmæ—¶ï¼Œåªæœ‰ä¸»è¿›ç¨‹ï¼Œæ²¡æœ‰å­è¿›ç¨‹ï¼Œå½“æœ‰è¯·æ±‚è¿‡æ¥æ—¶ï¼Œæ‰ä¼šåˆ›å»ºå­è¿›ç¨‹ï¼Œå¹¶å‘æ•°è¶Šå¤šåˆ›å»ºçš„å­è¿›ç¨‹æ•°å°±è¶Šå¤šï¼Œä½†æœ‰ä¸ªæé™å€¼(ç”±pm.max_childrenæŒ‡å®š)ï¼Œç©ºé—²çš„è¿›ç¨‹ä¼šåœ¨pm.process_idle_timeoutç§’å†…è¢«å…³é—­ï¼Œè¿™ç§æ–¹å¼æ— æ³•åŠæ—¶çš„â€œå“åº”å¹¶å¤„ç†â€nginxçš„è¯·æ±‚ï¼Œè™½ç„¶è¿™ä¼šè®©php-fpmåœ¨ç©ºé—²æ—¶å ç”¨å†…å­˜æœ€å°ï¼Œä½†æ²¡æœ‰å¿…è¦ï¼Œå› ä¸ºæœåŠ¡å™¨ä¸ç¼ºè¿™ç‚¹å†…å­˜ï¼Œè¿™ç§æ–¹å¼ä¸€èˆ¬ä¹Ÿä¸ä¼šä½¿ç”¨ã€‚</li>
</ul>
<h3 id="php-fpmå¹³æ»‘é‡å¯åŸç†"><a href="#php-fpmå¹³æ»‘é‡å¯åŸç†" class="headerlink" title="php-fpmå¹³æ»‘é‡å¯åŸç†"></a>php-fpmå¹³æ»‘é‡å¯åŸç†</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kill -SIGUSR2 ä¸»è¿›ç¨‹id</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºphp-fpmæœ¬èº«å¹¶æ²¡æœ‰ç±»ä¼¼nginxçš„<code>reload</code>ä¹‹ç±»çš„å‘½ä»¤ï¼Œä½ ç”¨<code>man php-fpm</code>ä¹Ÿèƒ½çœ‹å‡ºæ¥ï¼Œç¡®å®æ²¡æœ‰ï¼Œå¦‚æœä½ æœ‰åœ¨ç½‘ä¸Šçœ‹åˆ°è¿‡<code>php-fpm reload</code>æˆ–<code>service php-fpm reload</code>ä¹‹ç±»çš„å‘½ä»¤æˆ–è€…ä½ ä½¿ç”¨è¿‡ï¼Œå®ƒæœ¬èº«å¹¶ä¸æ˜¯<code>php-fpm</code>ï¼Œè€Œæ˜¯ä¸€ä¸ªshellè„šæœ¬è€Œå·²ï¼Œå®ƒæ‰€åœ¨çš„ä½ç½®æœ‰åœ¨<code>/etc/init.d/php-fpm</code>ï¼Œè€Œè¿™ä¸ª<code>reload</code>çš„æœ¬è´¨ï¼Œå…¶å®å°±æ˜¯ç»™php-fpmä¸»è¿›ç¨‹å‘é€<code>-SIGUSR2</code>ä¿¡å·ï¼Œè€Œphp-fpmè§„å®šäº†<code>-SIGUSR2</code>ä¿¡å·ä¸ºå¹³æ»‘é‡å¯ä¿¡å·(å‚è§<a href="https://www.jianshu.com/p/2ea78b789263">php-fpmä¿¡å·ï¼Œä½ é€ ä¹ˆï¼Ÿ</a>)ã€‚</p>
<p><img src="/images/PHP/CGI_FastCGI_php-cgi_php-fpm/3f6876.jpg"></p>
<p><strong>å¹³æ»‘é‡å¯æ­¥éª¤ï¼š</strong></p>
<ul>
<li>masteré€šè¿‡ç»™å­è¿›ç¨‹å‘é€SIGQUITä¿¡å·çš„æ–¹å¼ï¼Œå¹³æ»‘å…³é—­æ‰€æœ‰çš„å­è¿›ç¨‹</li>
<li>å¦‚æœè¿‡ä¸€æ®µæ—¶é—´ï¼Œæœ‰äº›å­è¿›ç¨‹è¿˜æ²¡é€€å‡ºï¼Œç»™å­è¿›ç¨‹å‘é€SIGTERMä¿¡å·ï¼Œå¼ºåˆ¶å…³é—­å­è¿›ç¨‹</li>
<li>å¦‚æœè¿˜æ²¡å…³é—­ï¼Œç»™å­è¿›ç¨‹å‘é€SIGKILLä¿¡å·ï¼Œå¼ºåˆ¶å…³é—­</li>
<li>ç­‰æ‰€æœ‰çš„å­è¿›ç¨‹é€€å‡ºåï¼Œmasteré‡æ–°å¯åŠ¨</li>
</ul>
<div class="note default"><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.xiebruce.top/606.html">CGI&#x2F;FastCGI&#x2F;php-cgi&#x2F;php-fpmçš„åŒºåˆ«</a></p>
</div>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>CGI</tag>
        <tag>FastCGI</tag>
        <tag>php-cgi</tag>
        <tag>php-fpm</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‹åŠ¡éš”ç¦»çº§åˆ«</title>
    <url>/MySQL/isolation-levels-in-mysql/</url>
    <content><![CDATA[<h2 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h2><div class="note info"><p>mysql version 8.0.13</p>
</div>

<h2 id="äº‹åŠ¡éš”ç¦»çº§åˆ«æ¦‚è¿°"><a href="#äº‹åŠ¡éš”ç¦»çº§åˆ«æ¦‚è¿°" class="headerlink" title="äº‹åŠ¡éš”ç¦»çº§åˆ«æ¦‚è¿°"></a>äº‹åŠ¡éš”ç¦»çº§åˆ«æ¦‚è¿°</h2><p>mysql ä¸­ï¼ŒInnoDB æ‰€æä¾›çš„äº‹åŠ¡ç¬¦åˆ ACID çš„è¦æ±‚ï¼Œè€Œäº‹åŠ¡é€šè¿‡äº‹åŠ¡æ—¥å¿—ä¸­çš„ redo log å’Œ undo log æ»¡è¶³äº†åŸå­æ€§ã€ä¸€è‡´æ€§ã€æŒä¹…æ€§ï¼Œäº‹åŠ¡è¿˜ä¼šé€šè¿‡é”æœºåˆ¶æ»¡è¶³éš”ç¦»æ€§ï¼Œåœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œæœ‰ä¸åŒçš„éš”ç¦»çº§åˆ«ï¼Œå®ƒä»¬æœ‰ç€ä¸åŒçš„éš”ç¦»æ€§ã€‚</p>
<p>ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Ÿå¦‚æœåªæ˜¯ä»æ¦‚å¿µä¸Šç†è§£çš„è¯å¯èƒ½æ¯”è¾ƒæ¨¡ç³Šï¼Œå’±ä»¬ç›´æ¥çœ‹çœ‹ä¸åŒéš”ç¦»çº§åˆ«ä¸‹çš„å®é™…è¡¨ç°æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œå†ç»“åˆç†è®ºå»ç†è§£ï¼Œå°±ä¼šæ˜äº†å¾ˆå¤šã€‚é¦–å…ˆï¼Œæ‰“å¼€ä¸¤ä¸ªç»ˆç«¯ï¼ŒåŒæ—¶è¿æ¥åˆ°å½“å‰æ•°æ®åº“ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯¹ä¸¤ä¸ªå›è¯è¿›è¡Œç¼–å·ï¼Œå¹¶ä¸”ä»¥é¢œè‰²åŒºåˆ†ï¼Œ1å·ä¼šè¯ä½¿ç”¨é»„è‰²è¿›è¡Œæ ‡è¯†ï¼Œ2å·ä¼šè¯ä½¿ç”¨çº¢è‰²è¿›è¡Œæ ‡è¯†ã€‚</p>
<p>ä¸¤ä¸ªä¼šè¯ä½¿ç”¨ç›¸åŒçš„æ•°æ®åº“ã€‚</p>
<p><img src="/images/MySQL/isolation-levels-in-mysql/20201204162840.png"></p>
<p>ä¸¤ä¸ªä¼šè¯ä¸­åŒæ—¶å„è‡ªå¼€å¯ä¸€ä¸ªäº‹åŠ¡ã€‚</p>
<p><img src="/images/MySQL/isolation-levels-in-mysql/20201204163421.png"></p>
<p>ç”±äºä¸‹é¢çš„æ‰€æœ‰æ“ä½œä¼šåœ¨ä¸¤ä¸ªä¼šè¯ä¸­æ¥å›åˆ‡æ¢ï¼Œæ‰€ä»¥ï¼Œä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªæ“ä½œçš„é¡ºåºè¿›è¡Œç¼–å·ï¼Œä¾‹å¦‚ä¸‹å›¾ä¸­ï¼Œæˆ‘ä»¬å…ˆåœ¨ä¼šè¯1çš„äº‹åŠ¡1ä¸­æ‰§è¡Œäº†æ›´æ–°æ“ä½œï¼Œç„¶ååœ¨äº‹åŠ¡1ä¸­æ‰§è¡Œäº†æŸ¥è¯¢æ“ä½œï¼Œæœ€ååˆåœ¨ä¼šè¯2ä¸­çš„äº‹åŠ¡2ä¸­æ‰§è¡Œäº†æŸ¥è¯¢æ“ä½œï¼ŒæŒ‰ç…§æ“ä½œé¡ºåºï¼Œä¸ºå„ä¸ªæ“ä½œè¿›è¡Œäº†é¡ºåºç¼–å·ã€‚</p>
<span id="more"></span>

<p><img src="/images/MySQL/isolation-levels-in-mysql/20201204163734.png"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œåœ¨äº‹åŠ¡1ä¸­æ˜¾ç¤ºçš„æ•°æ®å·²ç»å‘ç”Ÿäº†æ”¹å˜ï¼Œç¬¬2æ¡æ•°æ®å¯¹åº”çš„å­—ç¬¦ä¸²å·²ç»å˜ä¸ºtestï¼Œäº‹åŠ¡2ä¸­æ˜¾ç¤ºçš„æ•°æ®æœªå‘ç”Ÿæ”¹å˜ï¼Œæ²¡é”™ï¼Œä½ è‚¯å®šä¼šè¯´ï¼Œé‚£æ˜¯å› ä¸ºäº‹åŠ¡1è¿˜æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥ï¼Œäº‹åŠ¡2ä¸­è¿˜æ— æ³•çœ‹åˆ°è¢«ä¿®æ”¹çš„æ•°æ®ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å°†ä¼šè¯1ä¸­çš„äº‹åŠ¡æäº¤è¯•è¯•çœ‹ï¼Œçœ‹çœ‹äº‹åŠ¡1æäº¤åï¼Œäº‹åŠ¡2ä¸­çš„æ•°æ®ä¼šä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚</p>
<p>é‚£ä¹ˆï¼Œåœ¨äº‹åŠ¡æäº¤ä¹‹å‰ï¼Œæˆ‘ä»¬ç°åœ¨ä¸¤ä¸ªä¼šè¯ä¸­å†æ¬¡æŸ¥è¯¢ä¸€æ¬¡ï¼Œä¸¤ä¸ªäº‹åŠ¡ä¸­çš„æ•°æ®æ˜¾ç¤ºå¦‚ä¸‹å›¾ä¸­çš„æ“ä½œ1ä¸æ“ä½œ2çš„æ˜¾ç¤ºç»“æœã€‚</p>
<p><img src="/images/MySQL/isolation-levels-in-mysql/20201204164108.png"></p>
<p>ç„¶åæˆ‘ä»¬æ‰§è¡Œä¸Šå›¾ä¸­çš„ç¬¬3æ­¥ï¼Œå°†äº‹åŠ¡1ä¸­çš„ä¿®æ”¹æ“ä½œè¿›è¡Œæäº¤ï¼Œåœ¨äº‹åŠ¡2ä¸­å†æ¬¡æŸ¥çœ‹t1è¡¨ä¸­çš„æ•°æ®ï¼ˆç¬¬4æ­¥ï¼‰ï¼Œç»è¿‡æŸ¥çœ‹å‘ç°ï¼Œt1è¡¨ä¸­çš„ç¬¬2æ¡æ•°æ®å¯¹åº”çš„å­—ç¬¦ä¸²ä»ç„¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œè¿™ç§æƒ…å†µå¯èƒ½å’Œæˆ‘ä»¬ä¸€å¢æƒ…æ„¿æƒ³è±¡çš„çŠ¶å†µæœ‰äº›ä¸åŒï¼Œåœ¨ä¸äº†è§£äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ä¹‹å‰ï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºï¼Œå½“ä¸Šå›¾ä¸­çš„äº‹åŠ¡1æäº¤ä»¥åï¼Œåœ¨äº‹åŠ¡2ä¸­å†æ¬¡æŸ¥è¯¢åŒä¸€å¼ è¡¨çš„æ•°æ®æ—¶ï¼Œåº”è¯¥ä¼šçœ‹åˆ°äº‹åŠ¡1ä¸­çš„ä¿®æ”¹ï¼Œä½†æ˜¯å®é™…ä¸Šå¹¶æ²¡æœ‰ï¼Œåœ¨ä¼šè¯2æ²¡æœ‰æäº¤ä¹‹å‰ï¼Œä»t1è¡¨ä¸­æŸ¥è¯¢å‡ºçš„æ•°æ®ä¸€ç›´éƒ½æ˜¯ä¸å˜çš„ï¼Œç›´åˆ°ä¼šè¯2æäº¤ä»¥åï¼Œå†æ¬¡æŸ¥è¯¢t1è¡¨çš„æ•°æ®ï¼Œæ‰å‘ç°t1è¡¨çš„ç¬¬2æ¡æ•°æ®å¯¹åº”çš„å­—ç¬¦ä¸²å·²ç»å‘ç”Ÿäº†æ”¹å˜ï¼Œå‡ºç°è¿™ç§ç°è±¡ï¼Œæ˜¯å› ä¸º mysql é»˜è®¤çš„éš”ç¦»çº§åˆ«é€ æˆçš„ï¼Œè€Œä¸åŒçš„éš”ç¦»çº§åˆ«ä¼šä½“ç°å‡ºä¸åŒçš„éš”ç¦»æ•ˆæœï¼Œæ‰€ä»¥ï¼Œäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œå†³å®šäº†å„ä¸ªäº‹åŠ¡ä¹‹é—´çš„éš”ç¦»æ€§ï¼Œæˆ‘æƒ³ï¼Œçœ‹åˆ°è¿™é‡Œï¼Œä½ å·²ç»å¯¹äº‹åŠ¡çš„éš”ç¦»æ€§æœ‰äº†ä¸€ä¸ªå¤§æ¦‚çš„äº†è§£ï¼Œä½†æ˜¯å…·ä½“æœ‰å‡ ä¸ªéš”ç¦»çº§åˆ«ï¼Œæ¯ä¸ªéš”ç¦»çº§åˆ«ä¸‹æœ‰å“ªäº›ç‰¹æ€§ï¼Œæˆ‘ä»¬æ…¢æ…¢æ€»ç»“ã€‚</p>
<p>æ­¤å¤„ï¼Œæˆ‘ä»¬å…ˆåˆ—å‡ºinnodbä¸­äº‹åŠ¡çš„æ‰€æœ‰éš”ç¦»çº§åˆ«ï¼Œç„¶åå†é€ä¸ªäº†è§£å®ƒä»¬ï¼Œäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ä¸€å…±æœ‰å¦‚ä¸‹4ç§ã€‚</p>
<p><strong>READ-UNCOMMITTED</strong> : æ­¤éš”ç¦»çº§åˆ«ç¿»è¯‘ä¸º â€œè¯»æœªæäº¤â€ã€‚<br><strong>READ-COMMITTED</strong> : æ­¤éš”ç¦»çº§åˆ«ç¿»è¯‘ä¸º â€œè¯»å·²æäº¤â€ æˆ–è€… â€œè¯»æäº¤â€ã€‚<br><strong>REPEATABLE-READ</strong> : æ­¤éš”ç¦»çº§åˆ«ç¿»è¯‘ä¸º â€œå¯é‡å¤è¯»â€ æˆ–è€… â€œå¯é‡è¯»â€ã€‚<br><strong>SERIALIZABLE</strong> : æ­¤éš”ç¦»çº§åˆ«ç¿»è¯‘ä¸ºâ€ä¸²è¡ŒåŒ–â€ã€‚</p>
<p>è€Œ mysql é»˜è®¤è®¾ç½®çš„éš”ç¦»çº§åˆ«ä¸º <code>REPEATABLE-READ</code>ï¼Œå³ â€œå¯é‡è¯»â€ã€‚ä½¿ç”¨å¦‚ä¸‹è¯­å¥å¯ä»¥æŸ¥çœ‹å½“å‰è®¾ç½®çš„éš”ç¦»çº§åˆ«</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select @@global.transaction_isolation,@@transaction_isolation;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé»˜è®¤è®¾ç½®çš„éš”ç¦»çº§åˆ«ä¸ºå¯é‡è¯»ã€‚</p>
<p><img src="/images/MySQL/isolation-levels-in-mysql/20201204164404.png"></p>
<h2 id="éš”ç¦»çº§åˆ«ï¼šå¯é‡è¯»"><a href="#éš”ç¦»çº§åˆ«ï¼šå¯é‡è¯»" class="headerlink" title="éš”ç¦»çº§åˆ«ï¼šå¯é‡è¯»"></a>éš”ç¦»çº§åˆ«ï¼šå¯é‡è¯»</h2><p>æˆ‘ä»¬å…ˆæ¥æ€»ç»“ä¸€ä¸‹å¯é‡è¯»éš”ç¦»çº§åˆ«çš„ç‰¹æ€§ï¼Œä»ç„¶ä»¥åˆšæ‰æ–‡ç« å¼€å¤´çš„ç¤ºä¾‹ä¸ºä¾‹ï¼Œä¸‹å›¾ä¸­ï¼Œå†å›è¯1ä¸å›è¯2ä¸­åŒæ—¶å¼€å¯ä¸¤ä¸ªäº‹åŠ¡ï¼Œåœ¨äº‹åŠ¡1çš„äº‹åŠ¡ä¸­ä¿®æ”¹äº†tlè¡¨çš„æ•°æ®ä»¥åï¼ˆå°†ç¬¬äºŒæ¡æ•°æ®çš„tlstrçš„å€¼ä¿®æ”¹ä¸ºtestï¼‰ï¼Œäº‹åŠ¡2ä¸­æŸ¥çœ‹åˆ°çš„æ•°æ®ä»ç„¶æ˜¯äº‹åŠ¡1ä¿®æ”¹ä¹‹å‰çš„æ•°æ®ï¼Œå³ä½¿äº‹åŠ¡1æäº¤äº†ï¼Œåœ¨äº‹åŠ¡2æ²¡æœ‰æäº¤ä¹‹å‰ï¼Œäº‹åŠ¡2ä¸­æŸ¥çœ‹åˆ°çš„æ•°æ®éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ¯”å¦‚t1è¡¨ä¸­çš„ç¬¬2æ¡æ•°æ®ï¼Œä¸ç®¡äº‹åŠ¡1æ˜¯å¦æäº¤ï¼Œåœ¨äº‹åŠ¡2æ²¡æœ‰æäº¤ä¹‹å‰ï¼Œè¿™æ¡æ•°æ®å¯¹äºäº‹åŠ¡2æ¥è¯´ä¸€ç›´éƒ½æ˜¯æ²¡æœ‰å‘ç”Ÿæ”¹å˜çš„ï¼Œè¿™æ¡æ•°æ®åœ¨äº‹åŠ¡2ä¸­æ˜¯å¯ä»¥é‡å¤çš„è¢«è¯»åˆ°ï¼Œæ‰€ä»¥ï¼Œè¿™ç§éš”ç¦»çº§åˆ«è¢«ç§°ä¸ºâ€å¯é‡è¯»â€ã€‚</p>
<p><img src="/images/MySQL/isolation-levels-in-mysql/20201204165028.png"></p>
<p>ä½†æ˜¯ï¼Œä½ å¯èƒ½ä¼šæœ‰ä¸ªé—®é¢˜ï¼Œä¹‹å‰è¯´è¿‡ï¼Œäº‹åŠ¡çš„éš”ç¦»æ€§æ˜¯ç”±é”æ¥å®ç°çš„ï¼Œé‚£ä¹ˆï¼Œå½“ä¸Šå›¾ä¸­çš„äº‹åŠ¡1ä¸­æ‰§è¡Œæ›´æ–°è¯­å¥æ—¶ï¼Œäº‹åŠ¡1ä¸­åº”è¯¥å¯¹æ•°æ®å¢åŠ äº†å†™é”ï¼Œä½†æ˜¯åœ¨äº‹åŠ¡2ä¸­ï¼Œä»ç„¶å¯ä»¥è¿›è¡ŒæŸ¥è¯¢æ“ä½œï¼Œå³è¿›è¡Œè¯»æ“ä½œï¼Œå¯æ˜¯å†™é”æ˜¯æ’ä»–é”ï¼Œåœ¨äº‹åŠ¡1ä¸­å·²ç»æ·»åŠ äº†å†™é”çš„æƒ…å†µä¸‹ï¼Œä¸ºä»€ä¹ˆäº‹åŠ¡2è¿˜å¯ä»¥è¯»å–å‘¢ï¼Ÿè¿™æ˜¯å› ä¸º InnoDB é‡‡ç”¨äº†â€ä¸€è‡´æ€§éé”å®šè¯»â€çš„æœºåˆ¶æé«˜äº†æ•°æ®åº“å¹¶å‘æ€§ã€‚ä¸€è‡´æ€§éé”å®šè¯»è¡¨ç¤ºåœ¨å¦‚æœå½“å‰è¡Œè¢«æ–½åŠ äº†æ’ä»–é”ï¼Œé‚£ä¹ˆå½“éœ€è¦è¯»å–è¡Œæ•°æ®æ—¶ï¼Œåˆ™ä¸ä¼šç­‰å¾…è¡Œä¸Šçš„é”çš„é‡Šæ”¾ï¼Œè€Œæ˜¯ä¼šå»è¯»å–ä¸€ä¸ªå¿«ç…§æ•°æ®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="/images/MySQL/isolation-levels-in-mysql/02261710538155.png"></p>
<p>ä¸Šå›¾å±•ç¤ºäº† InnoDB ä¸­ä¸€è‡´æ€§éé”å®šè¯»çš„è¿‡ç¨‹ã€‚ä¹‹æ‰€ä»¥ç§°å…¶ä¸ºéé”å®šè¯»ï¼Œæ˜¯å› ä¸ºå®ƒä¸éœ€è¦ç­‰å¾…è¢«è®¿é—®çš„è¡Œä¸Šçš„æ’ä»–é”çš„é‡Šæ”¾ã€‚è€Œä¸Šå›¾ä¸­çš„å¿«ç…§çš„å®ç°æ˜¯ç”±äº‹åŠ¡æ—¥å¿—æ‰€å¯¹åº”çš„undoæ®µæ¥å®Œæˆï¼Œå…¶å®å¿«ç…§å°±æ˜¯è¯¥è¡Œæ‰€å¯¹åº”çš„ä¹‹å‰çš„ç‰ˆæœ¬çš„æ•°æ®ï¼Œå³å†å²æ•°æ®ï¼Œä¸€è¡Œè®°å½•å¯èƒ½æœ‰ä¸æ­¢ä¸€ä¸ªå¿«ç…§æ•°æ®ã€‚å¹¶ä¸æ˜¯æ‰€æœ‰éš”ç¦»çº§åˆ«éƒ½ä½¿ç”¨äº†ä¸€è‡´æ€§éé”å®šè¯»ï¼Œåœ¨â€å¯é‡è¯»â€å’Œâ€è¯»æäº¤â€çš„éš”ç¦»çº§åˆ«ä¸‹ï¼ŒInnoDB å­˜å‚¨å¼•æ“ä½¿ç”¨äº†ä¸€è‡´æ€§éé”å®šè¯»ï¼Œä½†æ˜¯åœ¨è¿™ä¸¤ä¸ªéš”ç¦»çº§åˆ«ä¸­ï¼Œå¯¹äºå¿«ç…§æ•°æ®çš„å®šä¹‰ä¹Ÿä¸ç›¸åŒï¼Œåœ¨â€å¯é‡è¯»â€éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¿«ç…§æ•°æ®æ˜¯æŒ‡å½“å‰äº‹åŠ¡å¼€å§‹æ—¶æ•°æ®çš„æ ·å­ï¼Œæ‰€ä»¥ï¼Œåœ¨åˆšæ‰çš„ç¤ºä¾‹ä¸­ï¼Œäº‹åŠ¡2ä¸­t1è¡¨å¯¹åº”çš„ç¬¬äºŒæ¡è®°å½•çš„tlstrçš„å€¼ä¸€ç›´éƒ½æ˜¯2ï¼Œå› ä¸ºåœ¨äº‹åŠ¡2å¼€å§‹çš„æ—¶å€™ï¼Œå…¶å€¼å°±æ˜¯2ï¼Œè¿™ä¹Ÿæ˜¯å…¶å¯é‡è¯»çš„ç‰¹æ€§ï¼Œä½†æ˜¯åœ¨â€è¯»æäº¤â€çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œç”±äºå¯¹äºå¿«ç…§çš„å®šä¹‰ä¸åŒï¼Œæ‰€ä»¥æ˜¾ç¤ºçš„ç°è±¡ä¹Ÿä¸åŒï¼Œè¿™åœ¨åšâ€è¯»æäº¤â€éš”ç¦»çº§åˆ«çš„å®éªŒæ—¶æˆ‘ä»¬è‡ªç„¶å°±ä¼šæ˜ç™½ã€‚</p>
<p>åœ¨å¯é‡è¯»çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°â€å¹»è¯»â€çš„é—®é¢˜ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯å¹»è¯»ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ã€‚<br>å½“å‰çš„éš”ç¦»çº§åˆ«ä»ç„¶æ˜¯â€å¯é‡è¯»â€ï¼Œç°åœ¨æ¥çœ‹ä¸€ä¸ªå¹»è¯»çš„ç¤ºä¾‹ï¼Œæ ¹æ®åºå·é¡ºåºæŸ¥çœ‹ä¸‹å›¾ä¸­çš„æ“ä½œå³å¯ã€‚</p>
<p><img src="/images/MySQL/isolation-levels-in-mysql/20201204170450.png"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œä»ä¸Šå›¾ä¸­çš„ç¬¬5æ­¥å¼€å§‹ï¼Œæ•°æ®å…¶å®å°±å·²ç»å‘ç”Ÿäº†æ”¹å˜ï¼Œåˆ°ç¬¬7æ­¥æ—¶ï¼Œäº‹åŠ¡2è¿˜æ˜¯æ— æ³•çœ‹åˆ°æ•°æ®çš„æ”¹å˜ï¼Œä½†æ˜¯å½“äº‹åŠ¡2æ›´æ–°æ•°æ®ä»¥åï¼Œå‘ç°è«åå…¶å¦™çš„å¤šå‡ºäº†ä¸€æ¡æ•°æ®ã€‚åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œæ‰§è¡Œä¸¤æ¬¡åŒæ ·çš„ sqlï¼Œç¬¬äºŒæ¬¡çš„ sql ä¼šè¿”å›ä¹‹å‰ä¸å­˜åœ¨çš„è¡Œï¼Œæˆ–è€…ä¹‹å‰å‡ºç°çš„æ•°æ®ä¸è§äº†ï¼Œè¿™ç§ç°è±¡è¢«ç§°ä¹‹ä¸ºâ€å¹»è¯»â€ã€‚</p>
<div class="note warning"><p>æ³¨æ„ï¼šä¸Šä¾‹ä¸­ç¬¬8æ­¥æ‰§è¡Œçš„updateè¯­å¥å¹¶æ²¡æœ‰æŒ‡å®šä»»ä½•æ¡ä»¶ï¼Œç›¸å½“äºæ›´æ–°è¡¨ä¸­çš„æ‰€æœ‰è¡Œçš„å¯¹åº”å­—æ®µï¼Œå¦‚æœä½ æŒ‡å®šäº†æ¡ä»¶ï¼Œå¹¶ä¸”æ²¡æœ‰æ›´æ–°åˆ°â€éšè—â€çš„è¡Œï¼Œé‚£ä¹ˆå¯èƒ½æ— æ³•çœ‹åˆ°å¹»è¯»ç°è±¡</p>
</div>

<h2 id="éš”ç¦»çº§åˆ«ï¼šä¸²è¡ŒåŒ–"><a href="#éš”ç¦»çº§åˆ«ï¼šä¸²è¡ŒåŒ–" class="headerlink" title="éš”ç¦»çº§åˆ«ï¼šä¸²è¡ŒåŒ–"></a>éš”ç¦»çº§åˆ«ï¼šä¸²è¡ŒåŒ–</h2><p>æ‰€ä»¥ï¼Œç»è¿‡ä¸Šè¿°å®éªŒæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œäº‹åŠ¡å¤„äº <code>REPEATABLE-READ</code> :â€å¯é‡å¤è¯»â€ çº§åˆ«æ—¶ï¼Œä¼šå‡ºç°å¹»è¯»çš„æƒ…å†µï¼Œè€Œåœ¨ä¹‹å‰ï¼Œæˆ‘ä»¬å·²ç»æåˆ°è¿‡ï¼Œä¸åŒçš„éš”ç¦»çº§åˆ«ï¼Œæ‰€å¼•å…¥çš„é—®é¢˜ä¼šæœ‰æ‰€ä¸åŒï¼Œéš”ç¦»æ€§ä¹Ÿæœ‰æ‰€ä¸åŒï¼Œé‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰ä¸€ç§éš”ç¦»çº§åˆ«ï¼Œèƒ½å¤Ÿè§£å†³å¹»è¯»çš„é—®é¢˜å‘¢ï¼Ÿ<br><code>SERIALIZABLE</code> : â€œä¸²è¡ŒåŒ–â€éš”ç¦»çº§åˆ«å°±ä¸ä¼šå‡ºç°å¹»è¯»çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ¥è¯•è¯•å°†äº‹åŠ¡çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºä¸²è¡ŒåŒ–æ—¶ï¼Œäº‹åŠ¡æ˜¯æ€æ ·å·¥ä½œçš„ã€‚<br>é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä¸¤ä¸ªä¼šè¯ä¸­çš„äº‹åŠ¡çš„éš”ç¦»çº§åˆ«éƒ½è®¾ç½®ä¸º <code>SERIALIZABLE</code> : â€œä¸²è¡ŒåŒ–â€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br></pre></td></tr></table></figure>

<p><img src="/images/MySQL/isolation-levels-in-mysql/20201204171329.png"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“å°†ä¸¤ä¸ªä¼šè¯ä¸­çš„äº‹åŠ¡éš”ç¦»çº§åˆ«åŒæ—¶è®¾ç½®ä¸ºä¸²è¡ŒåŒ–ä»¥åï¼Œåˆ†åˆ«åœ¨ä¸¤ä¸ªä¼šè¯ä¸­å¼€å¯äº†äº‹åŠ¡1ä¸äº‹åŠ¡2ï¼Œå¦‚ä¸Šå›¾ä¸­çš„ç¬¬1æ­¥å’Œç¬¬2æ­¥æ‰€ç¤ºï¼Œç„¶åï¼Œè¿›è¡Œç¬¬3æ­¥ï¼Œåœ¨äº‹åŠ¡1ä¸­æ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œæ­¤æ—¶ï¼Œæ‰§è¡Œç¬¬4æ­¥ï¼Œåœ¨äº‹åŠ¡2ä¸­æŸ¥è¯¢è¡¨tlçš„æ•°æ®ï¼Œå¯ä»¥ï¼Œç¬¬4æ­¥å¥½åƒè¢«â€å¡â€ä½äº†ï¼Œå¤šç­‰ä¸€ä¼šå„¿ï¼Œå‘ç°ç¬¬4æ­¥å¹¶æœªæ‰§è¡ŒæˆåŠŸï¼Œè€Œæ˜¯æŠ¥äº†ä¸€ä¸ªé”™è¯¯ï¼Œå¦‚ä¸‹å›¾ã€‚</p>
<p><img src="/images/MySQL/isolation-levels-in-mysql/20201204171558.png"></p>
<p>ä»æŠ¥é”™ä¿¡æ¯å¯ä»¥å‘ç°ï¼Œäº‹åŠ¡2ä¸­çš„é”è¯·æ±‚è¶…æ—¶äº†ï¼Œæˆ‘ä»¬ä¹‹å‰æåˆ°ï¼Œäº‹åŠ¡çš„éš”ç¦»æ€§æ˜¯ç”±é”æ¥å®ç°çš„ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ä¸²è¡ŒåŒ–çš„éš”ç¦»çº§åˆ«æ—¶ï¼Œç”±äºäº‹åŠ¡1å…ˆå¯¹t1è¡¨æ–½åŠ äº†å†™é”ï¼Œæ‰€ä»¥å½“äº‹åŠ¡2å¯¹tlè¡¨è¯·æ±‚è¯»é”æ—¶ï¼Œä¼šè¢«é˜»å¡ï¼Œé‚£ä¹ˆï¼Œå‡ºç°è¯·æ±‚é”è¶…æ—¶çš„æƒ…å†µï¼Œä¹Ÿå°±ç®—æ˜¯æ¯”è¾ƒæ­£å¸¸äº†ï¼Œæ‰€ä»¥ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•åœ¨äº‹åŠ¡2ä¸­è¯»åˆ°tlè¡¨çš„æ•°æ®çš„ã€‚</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æ¢ä¸€ç§å®éªŒæ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨äº‹åŠ¡1ä¸­æ’å…¥ä¸€æ¡æ•°æ®ï¼Œç„¶ååœ¨äº‹åŠ¡2ä¸­æ‰§è¡ŒæŸ¥è¯¢tlè¡¨çš„è¯­å¥ï¼Œæ­¤æ—¶äº‹åŠ¡2ä¸­çš„æŸ¥è¯¢è¯­å¥ä¼šè¢«é˜»å¡ï¼Œè¿™æ—¶ï¼Œæˆ‘ä»¬æäº¤äº‹åŠ¡1ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µã€‚</p>
<p>è¶ç€äº‹åŠ¡2ä¸­çš„æŸ¥è¯¢è¯­å¥è¢«é˜»å¡çš„æ—¶å€™ï¼Œå°†äº‹åŠ¡1è¿›è¡Œæäº¤ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="/images/MySQL/isolation-levels-in-mysql/20201204172455.png"></p>
<p>å½“åœ¨äº‹åŠ¡2ä¸­æ‰§è¡ŒæŸ¥è¯¢è¯­å¥æ—¶ï¼ŒæŸ¥è¯¢è¢«é˜»å¡ï¼Œæ­¤æ—¶äº‹åŠ¡1è¢«æäº¤ï¼Œå½“äº‹åŠ¡1è¢«æäº¤åçš„ä¸€ç¬é—´ï¼Œäº‹åŠ¡2ä¸­çš„è¯­å¥å·²ç»æŸ¥è¯¢å‡ºç»“æœï¼Œä»è¿”å›ç»“æœå¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªæŸ¥è¯¢è¯­å¥è¢«é˜»å¡äº†20ç§’å·¦å³çš„æ—¶é—´ï¼Œå½“äº‹åŠ¡1ä¸­çš„å†™é”é‡Šæ”¾æ—¶ï¼Œäº‹åŠ¡2æ‰è¯»å‡ºäº†æ•°æ®ã€‚ä»ä¸Šè¿°å®éªŒä¸Šæ¥çœ‹ï¼Œå½“äº‹åŠ¡å¤„äºä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«æ—¶ï¼Œæ˜¯ä¸å¯èƒ½å‡ºç°å¹»è¯»çš„æƒ…å†µçš„ï¼Œå› ä¸ºå¦‚æœå¦ä¸€ä¸ªäº‹åŠ¡ä¸­å¯¹è¡¨æ·»åŠ äº†å†™é”ï¼Œé‚£ä¹ˆåœ¨å½“å‰äº‹åŠ¡ä¸­æ˜¯æ— æ³•è¯»åˆ°æ•°æ®çš„ï¼Œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªäº‹åŠ¡æäº¤ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡é‡Šæ”¾äº†å¯¹è¡¨çš„å†™é”ï¼Œå½“å‰äº‹åŠ¡æ‰èƒ½è¿›è¡Œç”³è¯·è¯»é”ï¼Œä½¿ç”¨ä¸²è¡ŒåŒ–çš„éš”ç¦»çº§åˆ«ä¸ä¼šå‡ºç°å¹»è¯»çš„æƒ…å†µï¼Œä½†æ˜¯ï¼Œèªæ˜å¦‚ä½ ä¸€å®šå‘ç°äº†ï¼Œå½“äº‹åŠ¡çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºä¸²è¡ŒåŒ–æ—¶ï¼Œæ•°æ®åº“å¤±å»äº†å¹¶å‘çš„èƒ½åŠ›ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¾ˆå°‘å°†éš”ç¦»çº§åˆ«è®¾ç½®ä¸ºä¸²è¡ŒåŒ–ï¼Œå› ä¸ºè¿™ç§éš”ç¦»æ€§è¿‡äºä¸¥æ ¼äº†ã€‚</p>
<h2 id="éš”ç¦»çº§åˆ«ï¼šè¯»å·²æäº¤"><a href="#éš”ç¦»çº§åˆ«ï¼šè¯»å·²æäº¤" class="headerlink" title="éš”ç¦»çº§åˆ«ï¼šè¯»å·²æäº¤"></a>éš”ç¦»çº§åˆ«ï¼šè¯»å·²æäº¤</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†ä¸¤ç§éš”ç¦»çº§åˆ«ï¼Œå¯é‡è¯»ä¸ä¸²è¡ŒåŒ–ï¼Œè€Œä¸”ï¼Œæˆ‘ä»¬å·²ç»äº†è§£åˆ°ï¼Œä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«çš„éš”ç¦»æ€§æ˜¯æœ€å¼ºçš„ï¼Œæ²¡æœ‰å¹¶å‘èƒ½åŠ›ï¼Œå¯é‡è¯»éš”ç¦»çº§åˆ«çš„éš”ç¦»æ€§ç¨å¾®æ¬¡ä¹‹ï¼Œä½†æ˜¯æ¯”è¾ƒä¸²è¡ŒåŒ–è€Œè¨€ï¼Œå¹¶å‘èƒ½åŠ›è¾ƒå¥½ï¼Œä¸è¿‡å­˜åœ¨â€å¹»è¯»â€çš„é—®é¢˜ã€‚</p>
<p>ä¿®æ”¹ä¼šè¯éš”ç¦»çº§åˆ«ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆï¼Œæœ‰äº†ä¹‹å‰çš„åŸºç¡€ï¼Œå†å»ç†è§£å¦å¤–ä¸¤ä¸ªéš”ç¦»çº§åˆ«å°±å®¹æ˜“äº†ï¼Œæˆ‘ä»¬å…ˆæ¥èŠèŠâ€è¯»æäº¤â€ã€‚</p>
<p>åŒæ ·ï¼Œåœ¨ä¸¤ä¸ªä¼šè¯ä¸­åŒæ—¶å¼€å¯ä¸¤ä¸ªäº‹åŠ¡ï¼Œåœ¨äº‹åŠ¡1ä¸­ä¿®æ”¹tlè¡¨ä¸­çš„ç¬¬äºŒæ¡æ•°æ®ï¼Œå¦‚ä¸‹å›¾ä¸­çš„1ã€2æ­¥æ‰€ç¤ºï¼Œæ­¤æ—¶ï¼Œäº‹åŠ¡1å¹¶æœªæäº¤ï¼Œæ‰€ä»¥å¦‚ç¬¬3æ­¥æ‰€ç¤ºï¼Œåœ¨äº‹åŠ¡2ä¸­å¹¶æ— æ³•çœ‹åˆ°äº‹åŠ¡1ä¸­çš„ä¿®æ”¹ï¼Œè€Œå½“äº‹åŠ¡1æäº¤ä»¥åï¼Œäº‹åŠ¡2ä¸­å³å¯çœ‹åˆ°äº‹åŠ¡1ä¸­çš„ä¿®æ”¹ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯äº‹åŠ¡2èƒ½å¤Ÿè¯»åˆ°äº‹åŠ¡1æäº¤åçš„æ›´æ”¹ï¼Œè¿™ç§éš”ç¦»çº§åˆ«è¢«ç§°ä¸ºâ€è¯»æäº¤â€ã€‚</p>
<p><img src="/images/MySQL/isolation-levels-in-mysql/20201204173249.png"></p>
<p>åœ¨â€è¯»æäº¤â€çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¹Ÿä¼šå‡ºç°â€å¹»è¯»â€çš„é—®é¢˜ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/images/MySQL/isolation-levels-in-mysql/20201204173507.png"></p>
<p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œäº‹åŠ¡1å‘tlè¡¨ä¸­æ’å…¥äº†ä¸€è¡Œæ•°æ®ï¼Œåœ¨äº‹åŠ¡1æäº¤ä»¥åï¼Œäº‹åŠ¡2ä¸­å³å¯çœ‹åˆ°ï¼Œä½†æ˜¯äº‹åŠ¡2è¿˜æ²¡æœ‰æäº¤ï¼Œåœ¨äº‹åŠ¡2ä¸­æ‰§è¡Œä¸¤æ¬¡ç›¸åŒçš„æŸ¥è¯¢è¯­å¥ï¼Œè«åå…¶å¦™çš„å¤šå‡ºäº†ä¸€è¡Œï¼Œå‡ºç°äº†â€å¹»è¯»â€çš„æƒ…å†µã€‚</p>
<p>åœ¨è¯»å·²æäº¤çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œé™¤äº†ä¼šå‡ºç°å¹»è¯»çš„æƒ…å†µï¼Œè¿˜ä¼šå‡ºç°ä¸å¯é‡è¯»çš„æƒ…å†µã€‚â€ä¸å¯é‡è¯»â€è¡¨ç¤ºâ€ä¸ä¸€å®šå¯é‡è¯»â€ï¼Œä¸è¦ç†è§£ä¸ºâ€ä¸€å®šä¸å¯é‡è¯»â€ã€‚ä»€ä¹ˆå«â€ä¸ä¸€å®šå¯é‡è¯»â€å‘¢ï¼Ÿ</p>
<p>ä»ç„¶ä»¥åˆšæ‰çš„ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸ºä¾‹ï¼Œä¸‹å›¾ä¸­çš„ç¬¬3æ­¥ä¸­ï¼Œè·å–åˆ°çš„ç¬¬2æ¡è®°å½•å¯¹åº”çš„tlstrå­—æ®µå€¼ä¸ºâ€testâ€:ï¼Œè€Œåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œç¬¬5æ­¥æ‰€æŸ¥å‡ºç¬¬äºŒæ¡è®°å½•å¯¹åº”çš„tlstrå­—æ®µå´å˜æˆäº†â€tttâ€ï¼Œæ‰€ä»¥ï¼Œå½“æˆ‘ä»¬æƒ³è¦å†æ¬¡é‡å¤è¯»åˆ°åˆšæ‰çš„â€testâ€ï¼Œå°±å˜æˆäº†â€ä¸å¯é‡è¯»â€ã€‚</p>
<p><img src="/images/MySQL/isolation-levels-in-mysql/20201204173941.png"></p>
<p>å…¶å®ï¼Œâ€ä¸å¯é‡è¯»â€ä¸â€å¹»è¯»â€çš„è¡¨è±¡éƒ½éå¸¸ç›¸ä¼¼ï¼Œéƒ½æ˜¯åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¹¶æ²¡æœ‰æ“ä½œæŸäº›æ•°æ®ï¼Œå¯æ˜¯è¿™äº›æ•°æ®å´è«åçš„è¢«æ”¹å˜äº†ï¼Œæˆ–è€…çªç„¶å¤šå‡ºäº†æŸäº›æ•°æ®ï¼Œåˆæˆ–è€…çªç„¶å°‘äº†æŸäº›æ•°æ®ï¼Œè¿™äº›çŠ¶å†µå¥½åƒéƒ½èƒ½ç”¨â€å¹»è±¡â€è¿™ä¸ªè¯å»ç†è§£ï¼Œæ‰€ä»¥æˆ‘ä¸€å¼€å§‹æ€»æ˜¯åˆ†ä¸æ¸…åˆ°åº•ä»€ä¹ˆæ˜¯å¹»è¯»ï¼Œè€Œä¸”ï¼Œmysql å®˜æ–¹æ–‡æ¡£ä¸­ä¹ŸæŠŠä¸å¯é‡è¯»å½’ä¸ºå¹»è¯»ï¼Œåªæ˜¯å¤§å®¶ä¸ºäº†æ›´åŠ çš„ç»†åŒ–å®ƒä»¬çš„åŒºåˆ«ï¼ŒæŠŠä»–ä»¬åˆ†æˆäº†â€ä¸å¯é‡è¯»â€ä¸â€å¹»è¯»â€ï¼Œå¦‚æœæˆ‘ä»¬å®åœ¨æ— æ³•åˆ†æ¸…ä»–ä»¬ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£ï¼Œâ€å¹»è¯»â€çš„é‡ç‚¹åœ¨äºè«åå…¶å¦™çš„å¢åŠ äº†æˆ–å‡å°‘äº†æŸäº›æ•°æ®ï¼Œâ€ä¸å¯é‡è¯»â€çš„é‡ç‚¹åœ¨äºè«åçš„æƒ…å†µä¸‹ï¼Œæ•°æ®è¢«ä¿®æ”¹æ›´æ–°äº†ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å†æ¥æ€»ç»“ä¸€ä¸‹â€è¯»æäº¤â€è¿™ä¸ªéš”ç¦»çº§åˆ«ï¼Œåœ¨â€è¯»æäº¤â€éš”ç¦»çº§åˆ«ä¸‹ï¼Œå›å‡ºç°â€ä¸å¯é‡è¯»â€ï¼Œâ€å¹»è¯»â€çš„é—®é¢˜ï¼Œæ¯”â€å¯é‡è¯»â€éš”ç¦»çº§åˆ«çš„é—®é¢˜æ›´å¤šï¼Œä½†æ˜¯å®ƒçš„å¹¶å‘èƒ½åŠ›æ¯”â€å¯é‡è¯»â€æ›´å¼ºï¼Œæˆ‘ä»¬ä¼¼ä¹å‘ç°äº†ä¸€ä¸ªè§„å¾‹ï¼Œéš”ç¦»çº§åˆ«çš„éš”ç¦»æ€§è¶Šä½ï¼Œå¹¶å‘èƒ½åŠ›å°±è¶Šå¼ºï¼Œå­˜åœ¨çš„é—®é¢˜å°±è¶Šå¤šï¼Œé‚£ä¹ˆç°åœ¨ï¼Œæˆ‘ä»¬åªå‰©ä¸‹æœ€åä¸€ä¸ªéš”ç¦»çº§åˆ«æ²¡æœ‰äº†è§£äº†ï¼Œé‚£å°±æ˜¯â€è¯»æœªæäº¤â€ã€‚å®ƒçš„å¹¶å‘èƒ½åŠ›æ›´å¼ºå—ï¼Œå®ƒä¼šæœ‰æ›´å¤šçš„é—®é¢˜å—ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹ã€‚</p>
<h2 id="éš”ç¦»çº§åˆ«ï¼šè¯»æœªæäº¤"><a href="#éš”ç¦»çº§åˆ«ï¼šè¯»æœªæäº¤" class="headerlink" title="éš”ç¦»çº§åˆ«ï¼šè¯»æœªæäº¤"></a>éš”ç¦»çº§åˆ«ï¼šè¯»æœªæäº¤</h2><p>ä¿®æ”¹ä¼šè¯éš”ç¦»çº§åˆ«ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br></pre></td></tr></table></figure>

<p>è€è§„çŸ©ï¼Œæˆ‘ä»¬åœ¨ä¸¤ä¸ªä¼šè¯ä¸­åŒæ—¶å¼€å¯ä¸¤ä¸ªäº‹åŠ¡ï¼Œç„¶åè¿›è¡Œå®éªŒã€‚</p>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å°†ä¸¤ä¸ªä¼šè¯çš„äº‹åŠ¡éš”ç¦»çº§åˆ«åŒæ—¶è®¾ç½®ä¸ºè¯»æœªæäº¤ï¼Œç„¶ååœ¨ä¸¤ä¸ªä¼šè¯ä¸­å„è‡ªå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œç„¶ååœ¨äº‹åŠ¡1ä¸­æ’å…¥ä¸€æ¡æ•°æ®ï¼Œå¹¶ä¸”åˆ é™¤ä¸€æ¡æ•°æ®ï¼Œå¦‚ä¸‹å›¾ä¸­çš„ç¬¬1æ­¥ä¸ç¬¬2æ­¥æ‰€ç¤ºã€‚</p>
<p><img src="/images/MySQL/isolation-levels-in-mysql/20201204174532.png"></p>
<p>ç¬¬1ã€2æ­¥æ‰§è¡Œå®Œæ¯•ä»¥åï¼Œäº‹åŠ¡1å¹¶æœªæäº¤ï¼Œæ­¤æ—¶æ‰§è¡Œæ­¥éª¤3ï¼Œåœ¨äº‹åŠ¡2ä¸­æŸ¥çœ‹tlè¡¨ä¸­çš„æ•°æ®ï¼Œæ˜¯å¯ä»¥çœ‹åˆ°äº‹åŠ¡1ä¸­æ‰€åšå‡ºçš„ä¿®æ”¹çš„ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨è¯»æœªæäº¤è¿™ä¸ªéš”ç¦»çº§åˆ«ä¸‹ï¼Œå³ä½¿åˆ«çš„äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹å¹¶æœªæäº¤ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½çœ‹åˆ°å…¶ä¿®æ”¹çš„æ•°æ®ã€‚</p>
<p>å½“å‰äº‹åŠ¡èƒ½å¤Ÿçœ‹åˆ°åˆ«çš„äº‹åŠ¡ä¸­æœªæäº¤çš„æ•°æ®ï¼Œæˆ‘ä»¬ç§°è¿™ç§ç°è±¡ä¸ºâ€è„è¯»â€ï¼Œä¸Šä¾‹ä¸­ï¼Œäº‹åŠ¡1å¹¶æœªæäº¤ï¼Œä½†æ˜¯å…¶æ‰€ä½œå‡ºçš„ä¿®æ”¹å·²ç»èƒ½åœ¨äº‹åŠ¡2ä¸­æŸ¥çœ‹åˆ°ï¼Œç”±äºäº‹åŠ¡1ä¸­çš„ä¿®æ”¹æœ‰å¯èƒ½è¢«å›æ»šï¼Œæˆ–è€…æ•°æ®æœ‰å¯èƒ½ç»§ç»­è¢«ä¿®æ”¹ï¼Œæ‰€ä»¥äº‹åŠ¡2ä¸­çœ‹åˆ°æ•°æ®æ˜¯é£˜å¿½ä¸å®šçš„ï¼Œå¹¶ä¸æ˜¯æœ€ç»ˆçš„æ•°æ®ï¼Œå¹¶ä¸æ˜¯æäº¤åçš„æ•°æ®ï¼Œæ˜¯â€è„â€çš„ï¼Œä½†æ˜¯äº‹åŠ¡2ä¸­ä»ç„¶èƒ½çœ‹åˆ°è¿™äº›æ•°æ®ï¼Œæ‰€ä»¥ï¼Œè¿™ç§æ˜¾ç°è¢«ç§°ä¹‹ä¸ºè„è¯»ï¼Œå½“äº‹åŠ¡çš„éš”ç¦»çº§åˆ«å¤„äºâ€è¯»æœªæäº¤â€æ—¶ï¼Œå…¶å¹¶å‘æ€§èƒ½æ˜¯æœ€å¼ºçš„ï¼Œä½†æ˜¯å…¶éš”ç¦»æ€§ä¸å®‰å…¨æ€§æ˜¯æœ€å·®çš„ã€‚</p>
<p>èªæ˜å¦‚ä½ ä¸€å®šæƒ³åˆ°äº†ï¼Œå½“äº‹åŠ¡å¤„äºâ€è¯»æœªæäº¤â€è¿™ç§éš”ç¦»çº§åˆ«æ—¶ï¼Œä¼šå‡ºç°â€è„è¯»â€çš„æƒ…å†µï¼ŒåŒæ—¶ï¼Œä¹Ÿä¼šå‡ºç°â€ä¸å¯é‡è¯»â€ï¼Œâ€å¹»è¯»â€çš„é—®é¢˜ã€‚</p>
<h2 id="è„è¯»ã€å¹»è¯»ã€ä¸å¯é‡è¯»çš„åŒºåˆ«"><a href="#è„è¯»ã€å¹»è¯»ã€ä¸å¯é‡è¯»çš„åŒºåˆ«" class="headerlink" title="è„è¯»ã€å¹»è¯»ã€ä¸å¯é‡è¯»çš„åŒºåˆ«"></a>è„è¯»ã€å¹»è¯»ã€ä¸å¯é‡è¯»çš„åŒºåˆ«</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯æ›´å®¹æ˜“æŠŠè„è¯»ã€å¹»è¯»ã€ä¸å¯é‡è¯»æ··æ·†äº†å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬ä¸€èµ·æ¥æ€»ç»“ä¸€ä¸‹å®ƒä»¬ä¹‹å‰çš„åŒºåˆ«ï¼š</p>
<p><strong>è„è¯»</strong>ï¼šå½“å‰äº‹åŠ¡å¯ä»¥æŸ¥çœ‹åˆ°åˆ«çš„äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼ˆä¾§é‡ç‚¹åœ¨äºåˆ«çš„äº‹åŠ¡æœªæäº¤ï¼‰ã€‚</p>
<p><strong>å¹»è¯»</strong>ï¼šå¹»è¯»çš„è¡¨è±¡ä¸ä¸å¯é‡è¯»çš„è¡¨è±¡éƒ½è®©äººâ€æ‡µé€¼â€ï¼Œå¾ˆå®¹æ˜“ææ··ï¼Œä½†æ˜¯å¦‚æœéè¦ç»†åˆ†çš„è¯ï¼Œå¹»è¯»çš„ä¾§é‡ç‚¹åœ¨äºæ–°å¢å’Œåˆ é™¤ã€‚è¡¨ç¤ºåœ¨åŒä¸€äº‹åŠ¡ä¸­ï¼Œä½¿ç”¨ç›¸åŒçš„æŸ¥è¯¢è¯­å¥ï¼Œç¬¬äºŒæ¬¡æŸ¥è¯¢æ—¶ï¼Œè«åçš„å¤šå‡ºäº†ä¸€äº›ä¹‹å‰ä¸å­˜åœ¨æ•°æ®ï¼Œæˆ–è€…è«åçš„ä¸è§äº†ä¸€äº›æ•°æ®ã€‚</p>
<p><strong>ä¸å¯é‡è¯»</strong>ï¼šä¸å¯é‡è¯»çš„ä¾§é‡ç‚¹åœ¨äºæ›´æ–°ä¿®æ”¹æ•°æ®ã€‚è¡¨ç¤ºåœ¨åŒä¸€äº‹åŠ¡ä¸­ï¼ŒæŸ¥è¯¢ç›¸åŒçš„æ•°æ®èŒƒå›´æ—¶ï¼ŒåŒä¸€ä¸ªæ•°æ®èµ„æºè«åçš„æ”¹å˜äº†ã€‚</p>
<h2 id="ä¸åŒçš„éš”ç¦»çº§åˆ«æ‰€æ‹¥æœ‰çš„é—®é¢˜"><a href="#ä¸åŒçš„éš”ç¦»çº§åˆ«æ‰€æ‹¥æœ‰çš„é—®é¢˜" class="headerlink" title="ä¸åŒçš„éš”ç¦»çº§åˆ«æ‰€æ‹¥æœ‰çš„é—®é¢˜"></a>ä¸åŒçš„éš”ç¦»çº§åˆ«æ‰€æ‹¥æœ‰çš„é—®é¢˜</h2><p><img src="/images/MySQL/isolation-levels-in-mysql/20201204174835.png"></p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>array_merge å’Œ array+ çš„åŒºåˆ«</title>
    <url>/PHP/combining-arrays-using-plus-versus-array-merge/</url>
    <content><![CDATA[<h2 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h2><div class="note info"><p>PHP version 7.1.26</p>
</div>

<h2 id="é”®åæ˜¯stringï¼Œä¸¤è€…åŒºåˆ«"><a href="#é”®åæ˜¯stringï¼Œä¸¤è€…åŒºåˆ«" class="headerlink" title="é”®åæ˜¯stringï¼Œä¸¤è€…åŒºåˆ«"></a>é”®åæ˜¯stringï¼Œä¸¤è€…åŒºåˆ«</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$arr1</span> = [<span class="string">&#x27;a&#x27;</span> =&gt; <span class="string">&#x27;PHP&#x27;</span>];</span><br><span class="line"><span class="variable">$arr2</span> = [<span class="string">&#x27;a&#x27;</span> =&gt; <span class="string">&#x27;PYTHON&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">array_merge</span>(<span class="variable">$arr1</span>, <span class="variable">$arr2</span>));</span><br><span class="line"><span class="comment">// Array ( [a] =&gt; PYTHON ) å¦‚æœé”®åä¸ºå­—ç¬¦ï¼Œä¸”é”®åç›¸åŒï¼Œarray_merge()åé¢æ•°ç»„å…ƒç´ å€¼ä¼šè¦†ç›–å‰é¢æ•°ç»„å…ƒç´ å€¼</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$arr1</span> + <span class="variable">$arr2</span>);</span><br><span class="line"><span class="comment">// Array ( [a] =&gt; PHP )å¦‚æœé”®åä¸ºå­—ç¬¦ï¼Œä¸”é”®åç›¸åŒï¼Œæ•°ç»„ç›¸åŠ ä¼šå°†æœ€å…ˆå‡ºç°çš„å€¼ä½œä¸ºç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å†æ¯”å¦‚</span></span><br><span class="line"><span class="variable">$arr1</span> = [<span class="string">&#x27;a&#x27;</span> =&gt; <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;b&#x27;</span> =&gt; <span class="string">&#x27;2&#x27;</span>];</span><br><span class="line"><span class="variable">$arr2</span> = [<span class="string">&#x27;a&#x27;</span> =&gt; <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;b&#x27;</span> =&gt; <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;c&#x27;</span> =&gt; <span class="string">&#x27;2&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">array_merge</span>(<span class="variable">$arr1</span>,<span class="variable">$arr2</span>));</span><br><span class="line"><span class="comment">// Array ( [a] =&gt; 1 [b] =&gt; 3 [c] =&gt; 2 )</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$arr1</span> + <span class="variable">$arr2</span>);</span><br><span class="line"><span class="comment">// Array ( [a] =&gt; 1 [b] =&gt; 2 [c] =&gt; 2 )</span></span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h2 id="é”®åæ˜¯æ•°å­—ï¼Œä¸¤è€…åŒºåˆ«"><a href="#é”®åæ˜¯æ•°å­—ï¼Œä¸¤è€…åŒºåˆ«" class="headerlink" title="é”®åæ˜¯æ•°å­—ï¼Œä¸¤è€…åŒºåˆ«"></a>é”®åæ˜¯æ•°å­—ï¼Œä¸¤è€…åŒºåˆ«</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$arr1</span> = [<span class="string">&#x27;JAVA&#x27;</span>, <span class="string">&#x27;PHP&#x27;</span>];</span><br><span class="line"><span class="variable">$arr2</span> = [<span class="string">&#x27;PYTHON&#x27;</span>, <span class="string">&#x27;PHP&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">array_merge</span>(<span class="variable">$arr1</span>, <span class="variable">$arr2</span>));</span><br><span class="line"><span class="comment">// Array ( [0] =&gt; JAVA [1] =&gt; PHP [2] =&gt; PYTHON [3] =&gt; PHP ) å¦‚æœé”®åä¸ºæ•°å­—ï¼Œarray_merge()ä¸ä¼šè¿›è¡Œè¦†ç›–</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$arr1</span> + <span class="variable">$arr2</span>);</span><br><span class="line"><span class="comment">// Array ( [0] =&gt; JAVA [1] =&gt; PHP )å¦‚æœé”®åä¸ºæ•°å­—ï¼Œæ•°ç»„ç›¸åŠ ä¼šå°†æœ€å…ˆå‡ºç°çš„å€¼ä½œä¸ºç»“æœï¼Œåé¢é”®åç›¸åŒçš„ä¼šè¢«æŠ›å¼ƒ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å†æ¯”å¦‚</span></span><br><span class="line"><span class="variable">$arr1</span> = [<span class="number">1</span> =&gt; <span class="string">&#x27;1&#x27;</span>, <span class="number">2</span> =&gt; <span class="string">&#x27;2&#x27;</span>];</span><br><span class="line"><span class="variable">$arr2</span> = [<span class="number">1</span> =&gt; <span class="string">&#x27;1&#x27;</span>, <span class="number">2</span> =&gt; <span class="string">&#x27;3&#x27;</span>, <span class="number">8</span> =&gt; <span class="string">&#x27;2&#x27;</span>];</span><br><span class="line"><span class="variable">$ret</span> = <span class="title function_ invoke__">array_merge</span>(<span class="variable">$arr1</span>,<span class="variable">$arr2</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$ret</span>);</span><br><span class="line"><span class="comment">// Array ( [0] =&gt; 1 [1] =&gt; 2 [2] =&gt; 1 [3] =&gt; 3 [4] =&gt; 2 ) å¦‚æœæ•°ç»„ä¸­çš„é”®åä¸ºæ•°å­—æ—¶ï¼Œä¼šæ ¼å¼åŒ–é”®åå¹¶ä¿ç•™æ‰€æœ‰é”®å€¼ã€‚</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$arr1</span> + <span class="variable">$arr2</span>);</span><br><span class="line"><span class="comment">// Array ( [1] =&gt; 1 [2] =&gt; 2 [8] =&gt; 2 ) å¦‚æœæ•°ç»„ä¸­çš„é”®åä¸ºæ•°å­—æ—¶ï¼Œæ•°ç»„ç›¸åŠ ä¼šå°†æœ€å…ˆå‡ºç°çš„å€¼ä½œä¸ºç»“æœï¼Œåé¢é”®åç›¸åŒçš„ä¼šè¢«æŠ›å¼ƒ</span></span><br></pre></td></tr></table></figure>

<h2 id="å»¶ä¼¸"><a href="#å»¶ä¼¸" class="headerlink" title="å»¶ä¼¸"></a>å»¶ä¼¸</h2><p>å¦‚ä½•æœ€æœ‰æ•ˆçš„è·å–å­—ç¬¦é”®åç›¸åŒï¼Œå€¼ä¸åŒçš„ä¸¤ä¸ªæ•°ç»„å€¼é›†åˆå‘¢</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$arr1</span> = [<span class="string">&#x27;a&#x27;</span> =&gt; <span class="string">&#x27;PHP&#x27;</span>, <span class="string">&#x27;C&#x27;</span>];</span><br><span class="line"><span class="variable">$arr2</span> = [<span class="string">&#x27;a&#x27;</span> =&gt; <span class="string">&#x27;JAVA&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;PYTHON&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">array_merge_recursive</span>(<span class="variable">$arr1</span>, <span class="variable">$arr2</span>));</span><br><span class="line"><span class="comment">// Array ( [a] =&gt; Array ( [0] =&gt; PHP [1] =&gt; JAVA ) [0] =&gt; C [1] =&gt; C [2] =&gt; PYTHON )</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis äº‹åŠ¡</title>
    <url>/Redis/redis-transactions/</url>
    <content><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><strong>æ¦‚å¿µï¼š</strong> å¯ä»¥ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œæœ¬è´¨æ˜¯ä¸€ç»„å‘½ä»¤çš„é›†åˆã€‚ä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ï¼ŒæŒ‰é¡ºåºåœ°ä¸²è¡ŒåŒ–æ‰§è¡Œè€Œä¸ä¼šè¢«å…¶å®ƒå‘½ä»¤æ’å…¥ï¼Œä¸è®¸åŠ å¡ã€‚</p>
<p><strong>Redis éƒ¨åˆ†æ”¯æŒäº‹åŠ¡ï¼Œä¸æ”¯æŒçš„æ˜¯ï¼šå¼ºä¸€è‡´æ€§</strong></p>
<p><strong>èƒ½å¹²å˜›ï¼š</strong> ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œä¸€æ¬¡æ€§ã€é¡ºåºæ€§ã€æ’ä»–æ€§çš„æ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤</p>
<p><strong>å¸¸ç”¨å‘½ä»¤ï¼š</strong></p>
<ul>
<li><code>MULTI</code>ï¼šå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œ<code>MULTI</code> æ‰§è¡Œä¹‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­å‘æœåŠ¡å™¨å‘é€ä»»æ„å¤šæ¡å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤ä¸ä¼šç«‹å³è¢«æ‰§è¡Œï¼Œè€Œæ˜¯è¢«æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ã€‚</li>
<li><code>EXEC</code>ï¼šæ‰§è¡Œé˜Ÿåˆ—ä¸­æ‰€æœ‰çš„å‘½ä»¤</li>
<li><code>DISCARD</code>ï¼šæ¸…ç©ºäº‹åŠ¡é˜Ÿåˆ—,å¹¶æ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡</li>
<li><code>UNWATCH</code>ï¼šå–æ¶ˆ <code>WATCH</code> å‘½ä»¤å¯¹æ‰€æœ‰ key çš„ç›‘è§†</li>
<li><code>WATCH key1 key2 ...</code>    ï¼šç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª) key ï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ª(æˆ–è¿™äº›) key è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­ã€‚</li>
</ul>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p><strong>æ­£å¸¸æ‰§è¡Œï¼š</strong></p>
<p><img src="/images/Redis/redis-transactions/16a167bf936bde78.png"></p>
<span id="more"></span>

<p><strong>æ”¾å¼ƒäº‹åŠ¡ï¼š</strong></p>
<p><img src="/images/Redis/redis-transactions/16a167bf97fab508.png"></p>
<p><strong>å…¨ä½“è¿åï¼š</strong></p>
<p>ä¸€ä¸ªæŒ‡ä»¤è¯­æ³•é”™è¯¯ï¼Œæ³¨æ„ï¼šæˆ‘è¯´çš„æ˜¯è¯­æ³•é”™è¯¯ï¼EXECæ‰§è¡ŒæŠ¥é”™ã€‚</p>
<p><img src="/images/Redis/redis-transactions/16a167bf9860844a.png"></p>
<p><strong>å†¤å¤´å€ºä¸»ï¼ˆéƒ¨åˆ†æ”¯æŒäº‹åŠ¡ï¼‰ï¼š</strong></p>
<p>å†¤æœ‰å¤´ï¼Œå€ºæœ‰ä¸»ï¼Œå¯¹çš„æ”¾è¡Œï¼Œè°é”™æ‰¾è°ã€‚è¿™ä¹Ÿå°±è¯´æ˜ï¼šRedis éƒ¨åˆ†æ”¯æŒäº‹åŠ¡ï¼Œå¯¹çš„æ”¾è¡Œï¼Œé”™çš„æŠ¥é”™ã€‚</p>
<p><img src="/images/Redis/redis-transactions/16a1cc44c6ab8001.png"></p>
<p><strong>WATCHç›‘æ§ï¼šå…ˆç›‘æ§ï¼Œåå¼€å¯äº‹åŠ¡</strong></p>
<p>ç¼“å­˜çš„æ•°æ®ï¼Œè°éƒ½å¯ä»¥æ‹¿ï¼Œå¯ä»¥æ”¹ï¼Œæ‰€ä»¥å¿…é¡»æ‰“æ ‡è®°æ¥ç›‘æ§è¡Œä¸ºã€‚è¿™é‡Œæ¶‰åŠåˆ°é”çš„é—®é¢˜ï¼šæ‚²è§‚é”&#x2F;ä¹è§‚é”&#x2F;CAS(Check And Set)</p>
<ul>
<li><code>æ‚²è§‚é”(Pessimistic Lock)</code>ï¼š é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šblockç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚</li>
<li><code>ä¹è§‚é”(Optimistic Lock)</code>ï¼š é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹ï¼Œåœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ï¼Œ</li>
<li>ä¹è§‚é”ç­–ç•¥ï¼ˆå¸¸ç”¨ï¼‰ï¼šæäº¤ç‰ˆæœ¬å¿…é¡»å¤§äºè®°å½•å½“å‰ç‰ˆæœ¬æ‰èƒ½æ‰§è¡Œæ›´æ–°ã€‚è¿™æ ·æ—¢ä¸å½±å“å¹¶å‘æ€§ï¼Œæœ‰å¯ä»¥æ»¡è¶³éœ€æ±‚ã€‚</li>
</ul>
<p><strong>æ¡ˆä¾‹æ¼”ç¤ºï¼šä¿¡ç”¨å¡å’Œæ¬ é¢</strong></p>
<p>æ­£å¸¸æƒ…å†µï¼šæ— åŠ å¡ç¯¡æ”¹</p>
<p><img src="/images/Redis/redis-transactions/16a167ddd704b271.png"></p>
<p>æœ‰åŠ å¡ç¯¡æ”¹çš„æƒ…å†µï¼š</p>
<p><img src="/images/Redis/redis-transactions/16a167c0051f8812.png"></p>
<p>åœ¨ WATCH ç›‘æ§åï¼Œæœ‰äººä¿®æ”¹äº†balanceï¼Œä¼šå¯¼è‡´äº‹åŠ¡ä¼šè¢«æ‰“æ–­ï¼Œå¿…é¡»æ›´æ–°æœ€æ–°å€¼ï¼Œæ‰èƒ½æˆåŠŸæ‰§è¡Œäº‹åŠ¡ï¼Œç±»ä¼¼äºä¹è§‚é”çš„ç‰ˆæœ¬å·æœºåˆ¶ã€‚</p>
<h2 id="äº‹åŠ¡ä¸‰é˜¶æ®µ"><a href="#äº‹åŠ¡ä¸‰é˜¶æ®µ" class="headerlink" title="äº‹åŠ¡ä¸‰é˜¶æ®µ"></a>äº‹åŠ¡ä¸‰é˜¶æ®µ</h2><ol>
<li>å¼€å¯ï¼šä»¥ <code>MULTI</code> å¼€å§‹ä¸€ä¸ªäº‹åŠ¡</li>
<li>å…¥é˜Ÿï¼šå°†å¤šä¸ªå‘½ä»¤å…¥é˜Ÿåˆ°äº‹åŠ¡ä¸­ï¼Œæ¥åˆ°è¿™äº›å‘½ä»¤å¹¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯æ”¾åˆ°ç­‰å¾…æ‰§è¡Œçš„äº‹åŠ¡é˜Ÿåˆ—é‡Œé¢</li>
<li>æ‰§è¡Œï¼šç”± <code>EXEC</code> å‘½ä»¤è§¦å‘äº‹åŠ¡</li>
</ol>
<h2 id="äº‹åŠ¡ä¸‰ç‰¹æ€§"><a href="#äº‹åŠ¡ä¸‰ç‰¹æ€§" class="headerlink" title="äº‹åŠ¡ä¸‰ç‰¹æ€§"></a>äº‹åŠ¡ä¸‰ç‰¹æ€§</h2><ol>
<li>å•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚</li>
<li>æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µï¼šé˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ²¡æœ‰æäº¤ä¹‹å‰éƒ½ä¸ä¼šå®é™…çš„è¢«æ‰§è¡Œï¼Œå› ä¸ºäº‹åŠ¡æäº¤å‰ä»»ä½•æŒ‡ä»¤éƒ½ä¸ä¼šè¢«å®é™…æ‰§è¡Œï¼Œä¹Ÿå°±ä¸å­˜åœ¨â€äº‹åŠ¡å†…çš„æŸ¥è¯¢è¦çœ‹åˆ°äº‹åŠ¡é‡Œçš„æ›´æ–°ï¼Œåœ¨äº‹åŠ¡å¤–æŸ¥è¯¢ä¸èƒ½çœ‹åˆ°â€è¿™ä¸ªè®©äººä¸‡åˆ†å¤´ç—›çš„é—®é¢˜</li>
<li><strong>ï¼ˆé‡ç‚¹ï¼‰</strong>ä¸ä¿è¯åŸå­æ€§ï¼šredisåŒä¸€ä¸ªäº‹åŠ¡ä¸­å¦‚æœæœ‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œæ²¡æœ‰å›æ»šï¼Œè¿™ä¹Ÿå°±æ˜¯ï¼šRedis éƒ¨åˆ†æ”¯æŒäº‹åŠ¡ã€‚</li>
</ol>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>é€šè¿‡ <code>WATCH</code> å‘½ä»¤åœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰ç›‘æ§äº†å¤šä¸ª <code>Keys</code>ï¼Œå€˜è‹¥åœ¨ <code>WATCH</code> ä¹‹åæœ‰ä»»ä½• <code>Key</code> çš„å€¼å‘ç”Ÿäº†å˜åŒ–ï¼Œ<code>EXEC</code> å‘½ä»¤æ‰§è¡Œçš„äº‹åŠ¡éƒ½å°†è¢«æ”¾å¼ƒï¼ŒåŒæ—¶è¿”å› <code>Null multi-bulk</code> åº”ç­”ä»¥é€šçŸ¥è°ƒç”¨è€…äº‹åŠ¡æ‰§è¡Œå¤±è´¥</p>
<div class="note default"><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://juejin.im/post/6844903818010837006">è°è¯´Redisä¸æ”¯æŒäº‹åŠ¡ï¼Ÿ</a></p>
</div>]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>äº‹åŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»¤äººå›°æƒ‘çš„strtotime</title>
    <url>/PHP/confusing-strtotime/</url>
    <content><![CDATA[<p>ä»Šå¤©æ˜¯ <code>2018-07-31</code> æ‰§è¡Œä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">date</span>(<span class="string">&quot;Y-m-d&quot;</span>,<span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;-1 month&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>æŒ‰æ­£å¸¸ç†è§£è¾“å‡ºåº”è¯¥æ˜¯ <code>2018-06-30</code>ï¼Œä½†å®é™…è¾“å‡ºæ˜¯ <code>2018-07-01</code></p>
<p>è™½ç„¶è¿™ä¸ªé—®é¢˜çœ‹èµ·æ¥å¾ˆè¿·æƒ‘ï¼Œä½†ä»å†…éƒ¨é€»è¾‘ä¸Šæ¥è¯´å‘¢ï¼Œå…¶å®æ˜¯â€å¯¹â€çš„ã€‚<br>æˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸‹dateå†…éƒ¨çš„å¯¹äºè¿™ç§äº‹æƒ…çš„å¤„ç†é€»è¾‘ï¼š</p>
<ol>
<li>å…ˆåš-1 monthï¼Œé‚£ä¹ˆå½“å‰æ˜¯07-31ï¼Œå‡å»ä¸€ä»¥åå°±æ˜¯06-31</li>
<li>å†åšæ—¥æœŸè§„èŒƒåŒ–ï¼Œå› ä¸º6æœˆæ²¡æœ‰31å·ï¼Œæ‰€ä»¥å°±å¥½åƒ2ç‚¹60ç­‰äº3ç‚¹ä¸€æ ·ï¼Œ6æœˆ31å°±ç­‰äºäº†7æœˆ1</li>
</ol>
<p>æ˜¯ä¸æ˜¯é€»è¾‘å¾ˆâ€æ¸…æ™°â€å‘¢? æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨éªŒè¯ç¬¬äºŒä¸ªæ­¥éª¤ï¼Œæ¯”å¦‚:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">date</span>(<span class="string">&quot;Y-m-d&quot;</span>, <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;2017-06-31&quot;</span>)));</span><br><span class="line"><span class="comment">//è¾“å‡º2017-07-01</span></span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æ¶‰åŠåˆ°å¤§å°æœˆçš„æœ€åä¸€å¤©ï¼Œéƒ½å¯èƒ½ä¼šæœ‰è¿™ä¸ªè¿·æƒ‘ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆè½»æ¾çš„éªŒè¯ç±»ä¼¼çš„å…¶ä»–æœˆä»½ï¼Œå°è¯è¿™ä¸ªç»“è®º:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">date</span>(<span class="string">&quot;Y-m-d&quot;</span>, <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;-1 month&quot;</span>, <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;2017-03-31&quot;</span>))));</span><br><span class="line"><span class="comment">//è¾“å‡º2017-03-03</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">date</span>(<span class="string">&quot;Y-m-d&quot;</span>, <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;+1 month&quot;</span>, <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;2017-08-31&quot;</span>))));</span><br><span class="line"><span class="comment">//è¾“å‡º2017-10-01</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">date</span>(<span class="string">&quot;Y-m-d&quot;</span>, <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;next month&quot;</span>, <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;2017-01-31&quot;</span>))));</span><br><span class="line"><span class="comment">//è¾“å‡º2017-03-03</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">date</span>(<span class="string">&quot;Y-m-d&quot;</span>, <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;last month&quot;</span>, <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;2017-03-31&quot;</span>))));</span><br><span class="line"><span class="comment">//è¾“å‡º2017-03-03</span></span><br></pre></td></tr></table></figure>

<p>é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>ä»PHP5.3å¼€å§‹å‘¢ï¼Œdateæ–°å¢äº†ä¸€ç³»åˆ—ä¿®æ­£çŸ­è¯­ï¼Œæ¥æ˜ç¡®è¿™ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯â€first day ofâ€ å’Œ â€œlast day ofâ€ï¼Œä¹Ÿå°±æ˜¯ä½ å¯ä»¥é™å®šå¥½ä¸è¦è®©dateè‡ªåŠ¨â€è§„èŒƒåŒ–â€ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">date</span>(<span class="string">&quot;Y-m-d&quot;</span>, <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;last day of -1 month&quot;</span>, <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;2017-03-31&quot;</span>))));</span><br><span class="line"><span class="comment">//è¾“å‡º2017-02-28</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">date</span>(<span class="string">&quot;Y-m-d&quot;</span>, <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;first day of +1 month&quot;</span>, <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;2017-08-31&quot;</span>))));</span><br><span class="line"><span class="comment">////è¾“å‡º2017-09-01</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">date</span>(<span class="string">&quot;Y-m-d&quot;</span>, <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;first day of next month&quot;</span>, <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;2017-01-31&quot;</span>))));</span><br><span class="line"><span class="comment">////è¾“å‡º2017-02-01</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">date</span>(<span class="string">&quot;Y-m-d&quot;</span>, <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;last day of last month&quot;</span>, <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;2017-03-31&quot;</span>))));</span><br><span class="line"><span class="comment">////è¾“å‡º2017-02-28</span></span><br></pre></td></tr></table></figure>

<p>é‚£å¦‚æœæ˜¯5.3ä¹‹å‰çš„ç‰ˆæœ¬(è¿˜æœ‰äººç”¨ä¹ˆ?)ï¼Œä½ å¯ä»¥ä½¿ç”¨mktimeä¹‹ç±»çš„ï¼ŒæŠŠæ‰€æœ‰çš„æ—¥å­å¿½ç•¥æ‰ï¼Œæ¯”å¦‚éƒ½é™å®šä¸ºæ¯æœˆ1å·å°±å¯ä»¥äº†ï¼Œåªä¸è¿‡å°±ä¸å¦‚ç›´æ¥ç”¨first dayæ¥çš„æ›´åŠ ä¼˜é›…ã€‚</p>
<div class="note default"><p>åŸæ–‡é“¾æ¥ï¼š<a href="http://www.laruence.com/2018/07/31/3188.html">ä»¤äººå›°æƒ‘çš„strtotime</a></p>
</div>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>strtotime</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¥å£é™æµå¸¸ç”¨ç®—æ³•å®è·µ</title>
    <url>/PHP/api-rate-limiting-algorithm-practices/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä¸ºäº†æ›´å¥½çš„è¯´æ˜å‡ ç§ç®—æ³•ï¼Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹æ–‡å°±è¿™ä¸ªä¾‹å­åˆ†åˆ«å‡ ç§ç®—æ³•å®ç°ã€‚</p>
<ul>
<li>å¦‚ä½•é™åˆ¶æ¯åˆ†é’Ÿè®¿é—® <code>/api/books</code> æ¥å£ä¸èƒ½è¶…è¿‡ 120 æ¬¡ ï¼Ÿ</li>
</ul>
<p>æˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªæ¥å£ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">RateLimiter</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">access</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å›ºå®šæ—¶é—´çª—å£ç®—æ³•"><a href="#å›ºå®šæ—¶é—´çª—å£ç®—æ³•" class="headerlink" title="å›ºå®šæ—¶é—´çª—å£ç®—æ³•"></a>å›ºå®šæ—¶é—´çª—å£ç®—æ³•</h2><p>å›ºå®šæ—¶é—´çª—å£ç®—æ³•åˆå«è®¡æ•°å™¨ç®—æ³•ï¼Œé€»è¾‘å°±æ˜¯å¯¹å›ºå®šæ—¶é—´æ®µå†…çš„è®¿é—®æ¬¡æ•°è¿›è¡Œè®¡æ•°ï¼Œå¦‚æœè®¡æ•°ç»“æœè¶…è¿‡æ¬¡æ•°é™åˆ¶ï¼Œåˆ™æ‹’ç»è®¿é—®ã€‚</p>
<p>å›ºå®šæ—¶é—´çª—å£ç®—æ³•çš„åŠ£åŠ¿å°±åœ¨äºå…¶åªå…³å¿ƒæ—¶é—´æ®µå†…çš„æ€»è®¿é—®æ¬¡æ•°ï¼Œè€Œå¿½ç•¥äº†ç¬é—´é›†ä¸­è¯·æ±‚çš„é—®é¢˜ï¼Œæ¢è€Œè¨€ä¹‹ï¼Œè¿™ç§ç»Ÿè®¡æ–¹æ³•çš„ç²’åº¦å¤ªç²—äº†ï¼Œç„¶è€Œæˆ‘ä»¬æ— æ³•ä¿è¯è¯·æ±‚åœ¨æ—¶é—´æ®µå†…çš„åˆ†å¸ƒæ˜¯å¹³å‡çš„ã€‚</p>
<p><img src="/images/PHP/api-rate-limiting-algorithm-practices/fixed_window.png"></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœ A ç”¨æˆ·è®¿é—®æ¥å£çš„æ—¶é—´åˆ†å¸ƒå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>æ—¶é—´æ®µ</th>
<th>è®¿é—®æ¬¡æ•°</th>
</tr>
</thead>
<tbody><tr>
<td>00:00 ~ 00:30</td>
<td>20</td>
</tr>
<tr>
<td>00:30 ~ 01:00</td>
<td>100</td>
</tr>
<tr>
<td>01:00 ~ 01:30</td>
<td>100</td>
</tr>
<tr>
<td>01:30 ~ 02:00</td>
<td>20</td>
</tr>
</tbody></table>
<p>æ˜¾ç„¶åœ¨ç¬¬ä¸€åˆ†é’Ÿï¼Œæˆ‘ä»¬æœ‰ 120 æ¬¡è¯·æ±‚ï¼Œç¬¬äºŒåˆ†é’Ÿä¹Ÿæ˜¯ 120 æ¬¡è¯·æ±‚ï¼Œä½†æ˜¯ <code>00:30 ~ 01:30</code> è¿™ä¸€åˆ†é’Ÿæ—¶é—´å†…ï¼Œæ˜¾ç„¶æ˜¯è¯·æ±‚ä¹¦è¶…è¿‡ 120 æ¬¡çš„ï¼Œæ‰€ä»¥ï¼Œè¿™ç§æƒ…å†µè™½ç„¶å®ç°äº†éœ€æ±‚ï¼Œä½†æ˜¯å¾ˆå‹‰å¼ºï¼Œç²’åº¦ä¸å¤Ÿç»†ã€‚</p>
<span id="more"></span>

<h3 id="PHPå®ç°"><a href="#PHPå®ç°" class="headerlink" title="PHPå®ç°"></a>PHPå®ç°</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FixedWindowRateLimiter</span> <span class="keyword">implements</span> <span class="title">RateLimiter</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$prefix</span> = <span class="string">&quot;ratelimiter:&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$key</span>    = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$window</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$limit</span>  = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string  $key      è®¡æ•°KEY</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> integer $window   çª—å£æ—¶é—´ï¼ˆç§’ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> integer $limit    æ¬¡æ•°é™åˆ¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$key</span>, <span class="keyword">int</span> <span class="variable">$window</span>, <span class="keyword">int</span> <span class="variable">$limit</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key    = <span class="variable language_">$this</span>-&gt;prefix . <span class="variable">$key</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;window = <span class="variable">$window</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;limit  = <span class="variable">$limit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">access</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$count</span> = <span class="title class_">Redis</span>::<span class="title function_ invoke__">get</span>(<span class="variable language_">$this</span>-&gt;key);</span><br><span class="line">        <span class="comment">//é¦–æ¬¡è®¿é—®</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$count</span>) &#123;</span><br><span class="line">            <span class="title class_">Redis</span>::<span class="title function_ invoke__">pipeline</span>(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$pipe</span></span>) </span>&#123;</span><br><span class="line">                <span class="variable">$pipe</span>-&gt;<span class="title function_ invoke__">incr</span>(<span class="variable language_">$this</span>-&gt;key);</span><br><span class="line">                <span class="variable">$pipe</span>-&gt;<span class="title function_ invoke__">expire</span>(<span class="variable language_">$this</span>-&gt;key, <span class="variable language_">$this</span>-&gt;window);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­è®¡æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$count</span> &gt;= <span class="variable language_">$this</span>-&gt;limit) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Redis</span>::<span class="title function_ invoke__">incr</span>(<span class="variable language_">$this</span>-&gt;key);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$rateLimiter</span> = <span class="keyword">new</span> <span class="title class_">FixedWindowRateLimiter</span>(<span class="string">&quot;api:books&quot;</span>, <span class="number">60</span>, <span class="number">120</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$rateLimiter</span>-&gt;<span class="title function_ invoke__">access</span>()) &#123;</span><br><span class="line">    <span class="title function_ invoke__">abort</span>(<span class="number">404</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Luaå®ç°"><a href="#Luaå®ç°" class="headerlink" title="Luaå®ç°"></a>Luaå®ç°</h3><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">--- èµ„æºå”¯ä¸€æ ‡è¯†</span></span><br><span class="line"><span class="keyword">local</span> key = KEYS[<span class="number">1</span>]</span><br><span class="line"><span class="comment">--- æ—¶é—´çª—æœ€å¤§å¹¶å‘æ•°</span></span><br><span class="line"><span class="keyword">local</span> max_window_concurrency = <span class="built_in">tonumber</span>(ARGV[<span class="number">1</span>])  </span><br><span class="line"><span class="comment">--- æ—¶é—´çª—</span></span><br><span class="line"><span class="keyword">local</span> window = <span class="built_in">tonumber</span>(ARGV[<span class="number">2</span>])   </span><br><span class="line"><span class="comment">--- æ—¶é—´çª—å†…å½“å‰å¹¶å‘æ•°</span></span><br><span class="line"><span class="keyword">local</span> curr_window_concurrency = <span class="built_in">tonumber</span>(redis.call(<span class="string">&#x27;get&#x27;</span>, key) <span class="keyword">or</span> <span class="number">0</span>)  </span><br><span class="line"><span class="keyword">if</span> current + <span class="number">1</span> &gt; limit <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    redis.call(<span class="string">&quot;INCRBY&quot;</span>, key,<span class="number">1</span>)    </span><br><span class="line">    <span class="keyword">if</span> window &gt; <span class="number">-1</span> <span class="keyword">then</span></span><br><span class="line">        redis.call(<span class="string">&quot;expire&quot;</span>, key,window)    </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h2 id="æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•"><a href="#æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•" class="headerlink" title="æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•"></a>æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•</h2><p>å›ºå®šæ—¶é—´çª—å£ç®—æ³•çš„é—®é¢˜æ˜¯ç»Ÿè®¡åŒºé—´å¤ªå¤§ï¼Œé™æµä¸å¤Ÿç²¾ç¡®ï¼Œè€Œä¸”åœ¨ç¬¬äºŒä¸ªç»Ÿè®¡åŒºé—´ <code>01:00 ~ 02:00</code> æ—¶æ²¡æœ‰è€ƒè™‘ä¸å‰ä¸€ä¸ªç»Ÿè®¡åŒºé—´çš„å…³ç³»ä¸å½±å“ï¼ˆç¬¬ä¸€ä¸ªåŒºé—´ååŠæ®µ + ç¬¬äºŒä¸ªåŒºé—´å‰åŠæ®µä¹Ÿæ˜¯ä¸€åˆ†é’Ÿï¼‰ã€‚</p>
<p>ä¸ºäº†è§£å†³ä¸Šé¢æˆ‘ä»¬æåˆ°çš„ä¸´ç•Œé—®é¢˜ï¼Œæˆ‘ä»¬è¯•å›¾æŠŠæ¯ä¸ªç»Ÿè®¡åŒºé—´åˆ†ä¸ºæ›´å°çš„ç»Ÿè®¡åŒºé—´ï¼Œæ›´ç²¾ç¡®çš„ç»Ÿè®¡è®¡æ•°ã€‚</p>
<p><img src="/images/PHP/api-rate-limiting-algorithm-practices/sliding_window1.png"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬æŠŠæ¯åˆ†é’Ÿåˆ†ä¸ºä¸‰ä»½ï¼Œæ¯ä¸ªå°æ ¼æ˜¯20ç§’ï¼Œå¯¹æ¯ä¸ªå°æ ¼éƒ½ä¼šåˆ†åˆ«è®¡æ•°ï¼š</p>
<table>
<thead>
<tr>
<th>æ—¶é—´æ®µ</th>
<th>è®¿é—®æ¬¡æ•°</th>
</tr>
</thead>
<tbody><tr>
<td>00:00 ~ 00:20</td>
<td>2</td>
</tr>
<tr>
<td>00:20 ~ 00:40</td>
<td>2</td>
</tr>
<tr>
<td>00:40 ~ 01:00</td>
<td>116</td>
</tr>
<tr>
<td>01:00 ~ 01:20</td>
<td>116</td>
</tr>
</tbody></table>
<p>ç¬¬ä¸€æ¬¡ç»Ÿè®¡ï¼Œæˆ‘ä»¬å…ˆçœ‹ <code>01:00 ~ 02:00</code>ï¼Œè®¡æ•° 120 æ¬¡ï¼Œæ²¡æœ‰è¶…è¿‡æµé‡é™åˆ¶ï¼Œç„¶è€Œåœ¨ä¸‹ä¸€ä¸ª 20 ç§’ä¸­ï¼Œæµé‡è¯·æ±‚é›†ä¸­ï¼Œåœ¨ <code>00:20 ~ 01:20</code> è¿™ä¸€åˆ†é’Ÿçš„ç»Ÿè®¡èŒƒå›´å†…ï¼Œæµé‡è¶…è¿‡äº†é™åˆ¶ï¼Œåˆ™å¯ä»¥é™åˆ¶è®¿é—®ã€‚</p>
<p>è®¡æ•°å™¨ç®—æ³•å…¶å®å°±æ˜¯æ»‘åŠ¨çª—å£ç®—æ³•ã€‚åªæ˜¯å®ƒæ²¡æœ‰å¯¹æ—¶é—´çª—å£åšè¿›ä¸€æ­¥åœ°åˆ’åˆ†ï¼Œæ‰€ä»¥åªæœ‰1æ ¼ï¼›ç”±æ­¤å¯è§ï¼Œå½“æ»‘åŠ¨çª—å£çš„æ ¼å­åˆ’åˆ†çš„è¶Šå¤šï¼Œé‚£ä¹ˆæ»‘åŠ¨çª—å£çš„æ»šåŠ¨å°±è¶Šå¹³æ»‘ï¼Œé™æµçš„ç»Ÿè®¡å°±ä¼šè¶Šç²¾ç¡®ã€‚</p>
<h3 id="PHPå®ç°v1"><a href="#PHPå®ç°v1" class="headerlink" title="PHPå®ç°v1"></a>PHPå®ç°v1</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SlidingWindowRateLimiter</span> <span class="keyword">implements</span> <span class="title">RateLimiter</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>    <span class="variable">$remaining</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$prefix</span>    = <span class="string">&quot;ratelimiter:sliding:&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$key</span>       = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$window</span>    = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$limit</span>     = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$blocks</span>    = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string  $key      è®¡æ•°KEY</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> integer $window   çª—å£æ—¶é—´ï¼ˆç§’ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> integer $limit    æ¬¡æ•°é™åˆ¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> integer $blocks   çª—å£åˆ†å—æ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$key</span>, <span class="keyword">int</span> <span class="variable">$window</span>, <span class="keyword">int</span> <span class="variable">$limit</span>, <span class="keyword">int</span> <span class="variable">$blocks</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key    = <span class="variable language_">$this</span>-&gt;prefix . <span class="variable">$key</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;window = <span class="variable">$window</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;limit  = <span class="variable">$limit</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;blocks = <span class="variable">$blocks</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">access</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$time</span>           = <span class="title function_ invoke__">time</span>();</span><br><span class="line">        <span class="variable">$lastBlockTime</span>  = <span class="variable">$time</span> - <span class="variable">$time</span> % (<span class="title function_ invoke__">ceil</span>(<span class="variable language_">$this</span>-&gt;window / <span class="variable language_">$this</span>-&gt;blocks));</span><br><span class="line">        <span class="variable">$firstBlockTime</span> = <span class="variable">$lastBlockTime</span> - <span class="variable language_">$this</span>-&gt;window;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç§»é™¤å·²ç»è¿‡æœŸçš„ blocks</span></span><br><span class="line">        <span class="title class_">Redis</span>::<span class="title function_ invoke__">zremrangebylex</span>(<span class="variable language_">$this</span>-&gt;key, <span class="string">&#x27;[0&#x27;</span>, <span class="string">&#x27;(&#x27;</span>.<span class="variable">$firstBlockTime</span>);</span><br><span class="line">        <span class="variable">$blocks</span>    = <span class="title class_">Redis</span>::<span class="title function_ invoke__">zrange</span>(<span class="variable language_">$this</span>-&gt;key, <span class="number">0</span>, -<span class="number">1</span>, <span class="string">&#x27;WITHSCORES&#x27;</span>);</span><br><span class="line">        <span class="variable">$scores</span>    = <span class="title function_ invoke__">array_sum</span>(<span class="variable">$blocks</span>);</span><br><span class="line">        <span class="variable">$remaining</span> = <span class="variable language_">$this</span>-&gt;limit - <span class="variable">$scores</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$remaining</span> &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Redis</span>::<span class="title function_ invoke__">zincrby</span>(<span class="variable language_">$this</span>-&gt;key, <span class="number">1</span>, <span class="variable">$lastBlockTime</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;remaining = <span class="variable">$remaining</span> - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ»‘åŠ¨çª—å£çœŸçš„å¯ä»¥è§£å†³ä¸´ç•Œé—®é¢˜ä¹ˆï¼Ÿ</strong></p>
<p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæµé‡ä¸»è¦é›†ä¸­äºæ»‘åŠ¨çª—å£çš„ last block å’Œ çª—å£æ»‘åŠ¨åçš„ next blockã€‚</p>
<p><img src="/images/PHP/api-rate-limiting-algorithm-practices/sliding_window2.png"></p>
<p>åŒæ ·çš„è¯·æ±‚æƒ…å†µï¼Œæˆ‘ä»¬å…ˆæŠŠä¸€ä¸ªæ»‘åŠ¨çª—å£åˆ†ä¸ºä¸‰æ ¼ï¼Œçª—å£æ»‘åŠ¨å‰åéƒ½æ˜¯ç¬¦åˆé™æµè¦æ±‚çš„ï¼›ç„¶åæˆ‘ä»¬æŠŠåŸæ¥çš„æ¯ä¸€æ ¼éƒ½åˆ†ä¸ºä¸¤æ ¼ï¼Œå¦‚å›¾2ï¼Œé‚£ä¹ˆæ­¤æ—¶ï¼Œçª—å£æ»‘åŠ¨å‰åçš„çŠ¶å†µå°±ä¸åŒäº†ã€‚</p>
<p>ç”±æ­¤å¯è§ï¼Œæ»‘åŠ¨çª—å£ç®—æ³•å¾ˆéš¾å®Œå…¨ç¬¦åˆé™æµéœ€æ±‚ï¼Œé™¤éæˆ‘ä»¬æŠŠç»Ÿè®¡åŒºé—´å˜å¾—æ›´å°ï¼Œæ›´ç”šè‡³ç»†åŒ–åˆ°æ¯ä¸ªè¯·æ±‚ï¼Œéšä¹‹å¸¦æ¥çš„é—®é¢˜æ˜¯æˆ‘ä»¬éœ€è¦æ¶ˆè€—æ›´å¤šå­˜å‚¨ç©ºé—´ã€‚</p>
<h3 id="PHPå®ç°v2"><a href="#PHPå®ç°v2" class="headerlink" title="PHPå®ç°v2"></a>PHPå®ç°v2</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SlidingWindowRateLimiter</span> <span class="keyword">implements</span> <span class="title">RateLimiter</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>    <span class="variable">$remaining</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$prefix</span>    = <span class="string">&quot;ratelimiter:sliding:&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$key</span>       = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$window</span>    = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$limit</span>     = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$blocks</span>    = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string  $key      è®¡æ•°KEY</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> integer $window   çª—å£æ—¶é—´ï¼ˆç§’ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> integer $limit    æ¬¡æ•°é™åˆ¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> integer $blocks   çª—å£åˆ†å—æ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$key</span>, <span class="keyword">int</span> <span class="variable">$window</span>, <span class="keyword">int</span> <span class="variable">$limit</span>, <span class="keyword">int</span> <span class="variable">$blocks</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key    = <span class="variable language_">$this</span>-&gt;prefix . <span class="variable">$key</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;window = <span class="variable">$window</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;limit  = <span class="variable">$limit</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;blocks = <span class="variable">$blocks</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">access</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$now</span> = <span class="title function_ invoke__">microtime</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="variable">$result</span> = <span class="title class_">Redis</span>::<span class="title function_ invoke__">pipeline</span>(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$pipe</span></span>) <span class="keyword">use</span> (<span class="params"><span class="variable">$now</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$pipe</span>-&gt;<span class="title function_ invoke__">zrangebyscore</span>(<span class="variable language_">$this</span>-&gt;key, <span class="number">0</span>, <span class="variable">$now</span> - <span class="variable language_">$this</span>-&gt;window);</span><br><span class="line">            <span class="variable">$pipe</span>-&gt;<span class="title function_ invoke__">zrange</span>(<span class="variable language_">$this</span>-&gt;key, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">            <span class="variable">$pipe</span>-&gt;<span class="title function_ invoke__">zadd</span>(<span class="variable language_">$this</span>-&gt;key, <span class="variable">$now</span>, <span class="variable">$now</span>);</span><br><span class="line">            <span class="variable">$pipe</span>-&gt;<span class="title function_ invoke__">expire</span>(<span class="variable language_">$this</span>-&gt;key, <span class="variable language_">$this</span>-&gt;window);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The second command inside the transaction was ZRANGE,</span></span><br><span class="line">        <span class="comment">// which returns a list of timestamps within the last hour.</span></span><br><span class="line">        <span class="variable">$timestamps</span> = <span class="variable">$result</span>[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;remaining = <span class="title function_ invoke__">max</span>(<span class="number">0</span>, <span class="variable language_">$this</span>-&gt;limit - <span class="title function_ invoke__">count</span>(<span class="variable">$timestamps</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;remaining &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Luaå®ç°v2"><a href="#Luaå®ç°v2" class="headerlink" title="Luaå®ç°v2"></a>Luaå®ç°v2</h3><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> token = KEYS[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">local</span> now = <span class="built_in">tonumber</span>(ARGV[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">local</span> window = <span class="built_in">tonumber</span>(ARGV[<span class="number">2</span>])</span><br><span class="line"><span class="keyword">local</span> limit = <span class="built_in">tonumber</span>(ARGV[<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> clearBefore = now - window</span><br><span class="line">redis.call(<span class="string">&#x27;ZREMRANGEBYSCORE&#x27;</span>, token, <span class="number">0</span>, clearBefore)</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> amount = redis.call(<span class="string">&#x27;ZCARD&#x27;</span>, token)</span><br><span class="line"><span class="keyword">if</span> amount &lt; limit <span class="keyword">then</span></span><br><span class="line">    redis.call(<span class="string">&#x27;ZADD&#x27;</span>, token, now, now)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">redis.call(<span class="string">&#x27;EXPIRE&#x27;</span>, token, window)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> limit - amount</span><br></pre></td></tr></table></figure>

<h2 id="æ¼æ¡¶ç®—æ³•"><a href="#æ¼æ¡¶ç®—æ³•" class="headerlink" title="æ¼æ¡¶ç®—æ³•"></a>æ¼æ¡¶ç®—æ³•</h2><p>æ¼æ¡¶ç®—æ³•ï¼ˆLeaky Bucketï¼‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¤§å®¶éƒ½ç”¨è¿‡æ°´é¾™å¤´ï¼Œæ‰“å¼€é¾™å¤´å¼€å…³æ°´å°±ä¼šæµä¸‹æ»´åˆ°æ°´æ¡¶é‡Œï¼Œè€Œæ¼æ¡¶æŒ‡çš„æ˜¯æ°´æ¡¶ä¸‹é¢æœ‰ä¸ªæ¼æ´å¯ä»¥å‡ºæ°´ã€‚å¦‚æœæ°´é¾™å¤´å¼€çš„ç‰¹åˆ«å¤§é‚£ä¹ˆæ°´æµé€Ÿå°±ä¼šè¿‡å¤§ï¼Œè¿™æ ·å°±å¯èƒ½å¯¼è‡´æ°´æ¡¶çš„æ°´æ»¡äº†ç„¶åæº¢å‡ºã€‚</p>
<p>è€Œæˆ‘ä»¬è®¨è®ºçš„æ¼æ¡¶ç®—æ³•çš„æ€è·¯ä¹Ÿå¾ˆç®€å•ï¼Œæ°´é¾™å¤´æ‰“å¼€åæµä¸‹çš„æ°´ï¼ˆè¯·æ±‚ï¼‰ä»¥ä¸€å®šçš„é€Ÿç‡æµåˆ°æ¼æ¡¶é‡Œï¼ˆé™æµå®¹å™¨ï¼‰ï¼Œæ¼æ¡¶ä»¥ä¸€å®šçš„é€Ÿåº¦å‡ºæ°´ï¼ˆæ¥å£å“åº”é€Ÿç‡ï¼‰ï¼Œå¦‚æœæ°´æµé€Ÿåº¦è¿‡å¤§ï¼ˆè¯·æ±‚è¿‡å¤šï¼‰å°±å¯èƒ½ä¼šå¯¼è‡´æ¼æ¡¶çš„æ°´æº¢å‡ºï¼ˆè®¿é—®é¢‘ç‡è¶…è¿‡æ¥å£å“åº”é€Ÿç‡ï¼‰ï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦å…³æ‰æ°´é¾™å¤´ï¼ˆæ‹’ç»è¯·æ±‚ï¼‰ï¼Œä¸‹é¢æ˜¯ç»å…¸çš„æ¼æ¡¶ç®—æ³•å›¾ç¤ºï¼š</p>
<p><img src="/images/PHP/api-rate-limiting-algorithm-practices/leaky_bucket.png"></p>
<h3 id="PHPå®ç°v3"><a href="#PHPå®ç°v3" class="headerlink" title="PHPå®ç°v3"></a>PHPå®ç°v3</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LeakyBucketRateLimiter</span> <span class="keyword">implements</span> <span class="title">RateLimiter</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$prefix</span>   = <span class="string">&quot;ratelimiter:leaky:&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$key</span>      = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$rate</span>     = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$capacity</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string  $key      è®¡æ•°KEY</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> integer $rate     è¯·æ±‚å¤„ç†é€Ÿç‡ï¼ˆä¸ª/ç§’ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int     $capacity æ¼æ¡¶å®¹é‡ï¼ˆæœ€å¤§é˜Ÿåˆ—é•¿åº¦ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$key</span>, <span class="keyword">int</span> <span class="variable">$rate</span>, <span class="keyword">int</span> <span class="variable">$capacity</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;capacity = <span class="variable">$capacity</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key      = <span class="variable language_">$this</span>-&gt;prefix . <span class="variable">$key</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;rate     = <span class="variable">$rate</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">access</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//å½“å‰æ—¶é—´</span></span><br><span class="line">        <span class="variable">$time</span> = <span class="title function_ invoke__">time</span>();</span><br><span class="line">        [<span class="variable">$lastTime</span>, <span class="variable">$tokensPend</span>] = <span class="title class_">Redis</span>::<span class="title function_ invoke__">hmget</span>(<span class="variable language_">$this</span>-&gt;key, <span class="string">&#x27;last_time&#x27;</span>, <span class="string">&#x27;tokens_pend&#x27;</span>);</span><br><span class="line">        <span class="comment">//æ¨ç®—å·²ç»å¤„ç†è¿‡çš„æ•°é‡</span></span><br><span class="line">        <span class="variable">$tokensHandled</span> = (<span class="variable">$time</span> - <span class="variable">$lastTime</span>) * <span class="variable">$rate</span>;</span><br><span class="line">        <span class="comment">//å½“å‰å‰©ä½™ tokens æ•°é‡ï¼ˆé˜Ÿåˆ—å¾…å¤„ç†ï¼‰</span></span><br><span class="line">        <span class="variable">$tokensPend</span> = <span class="title function_ invoke__">max</span>(<span class="number">0</span>, <span class="variable">$tokensPend</span> - <span class="variable">$tokensHandled</span>);</span><br><span class="line">        <span class="comment">//æ›´æ–°ä¸Šæ¬¡è¯·æ±‚çš„æ—¶é—´</span></span><br><span class="line">        <span class="title class_">Redis</span>::<span class="title function_ invoke__">hSet</span>(<span class="variable language_">$this</span>-&gt;key, <span class="string">&#x27;last_time&#x27;</span>, <span class="variable">$time</span>);</span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ¼æ¡¶æ˜¯å¦æ»¡äº†</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$tokensPend</span> &lt; <span class="variable language_">$this</span>-&gt;capacity) &#123;</span><br><span class="line">            <span class="comment">//å¯ä»¥åŠ å…¥é˜Ÿåˆ—ç­‰å¾…å¤„ç†</span></span><br><span class="line">            <span class="title class_">Redis</span>::<span class="title function_ invoke__">hSet</span>(<span class="variable language_">$this</span>-&gt;key, <span class="string">&#x27;tokens_pend&#x27;</span>, <span class="variable">$tokensPend</span> + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//é˜Ÿåˆ—å·²ç»æ»¡äº†</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å¤‡æ³¨ï¼š</strong></p>
<ul>
<li>ä»£ç ä¸­å¯¹ redis çš„æ“ä½œå­˜åœ¨å¹¶å‘é—®é¢˜ï¼Œä»£ç ä»…ä¾›å‚è€ƒç¨‹åºé€»è¾‘ï¼Œä½¿ç”¨ redis+lua è„šæœ¬æ‰æ˜¯æ›´é è°±çš„æ–¹æ¡ˆã€‚</li>
<li>ä»£ç ä»…å¤„ç†äº†æ¼æ¡¶æ»¡æ—¶æº¢å‡ºã€æ¼æ¡¶ä¸æ»¡æ—¶å…è®¸è¿›å…¥é˜Ÿåˆ—ï¼Œä½†æ˜¯å®é™…è¯·æ±‚çš„å¤„ç†ï¼Œè¿˜éœ€è¦åç»­ä½¿ç”¨é˜Ÿåˆ—æˆ–å»¶æ—¶å¤„ç†ä¿è¯æ¼æ¡¶æµå‡ºçš„é€Ÿç‡ã€‚</li>
</ul>
<p>è°ƒç”¨ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$mobile</span>      = <span class="string">&quot;13888888888&quot;</span>;</span><br><span class="line"><span class="variable">$rateLimiter</span> = <span class="keyword">new</span> <span class="title class_">LeakyBucketRateLimiter</span>(<span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;api:sms:send:%s&quot;</span>, <span class="variable">$mobile</span>), <span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$rateLimiter</span>-&gt;<span class="title function_ invoke__">access</span>()) &#123;</span><br><span class="line">    <span class="title function_ invoke__">abort</span>(<span class="number">404</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Queue</span>::<span class="title function_ invoke__">smsSend</span>(<span class="variable">$mobile</span>, <span class="variable">$sms</span>);</span><br></pre></td></tr></table></figure>

<p>æ¼æ¡¶ç®—æ³•ä¸­å¿…é¡»ä¿è¯è¯·æ±‚å¤„ç†é€Ÿç‡æ˜¯æ’å®šçš„ï¼Œä¸ç„¶é™æµå°±åªèƒ½åšåˆ°ã€æ¼æ¡¶æ»¡æ—¶æº¢å‡ºã€çš„ç¨‹åº¦äº†ã€‚<br>å› æ­¤ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œè¿™ç§é™æµå¤„ç†åç½®çš„ç®—æ³•ï¼Œå¯èƒ½æ›´é€‚åˆå¼‚æ­¥ä»»åŠ¡æˆ–è€…ç¦»çº¿å¤„ç†ã€‚</p>
<h3 id="Luaå®ç°v3"><a href="#Luaå®ç°v3" class="headerlink" title="Luaå®ç°v3"></a>Luaå®ç°v3</h3><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> token = KEYS[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">local</span> now = <span class="built_in">tonumber</span>(ARGV[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> rate = <span class="built_in">tonumber</span>(ARGV[<span class="number">2</span>])</span><br><span class="line"><span class="keyword">local</span> capacity = <span class="built_in">tonumber</span>(ARGV[<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> lastTime = <span class="built_in">tonumber</span>(redis.call(<span class="string">&#x27;HGET&#x27;</span>, token, <span class="string">&#x27;last_time&#x27;</span>) <span class="keyword">or</span> <span class="number">0</span>)</span><br><span class="line"><span class="keyword">local</span> tokensPend = <span class="built_in">tonumber</span>(redis.call(<span class="string">&#x27;HGET&#x27;</span>, token, <span class="string">&#x27;tokens_pend&#x27;</span>) <span class="keyword">or</span> <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">tokensPend = <span class="built_in">math</span>.<span class="built_in">max</span>(<span class="number">0</span>, tokensPend - (now - lastTime) * rate)</span><br><span class="line">redis.call(<span class="string">&#x27;HSET&#x27;</span>, token, <span class="string">&#x27;last_time&#x27;</span>, now)</span><br><span class="line"><span class="keyword">if</span> tokensPend &lt; capacity <span class="keyword">then</span></span><br><span class="line">    redis.call(<span class="string">&#x27;HSET&#x27;</span>, token, <span class="string">&#x27;tokens_pend&#x27;</span>, tokensPend + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>æ¼æ¡¶ç®—æ³•æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ¼æ¡¶å®¹é‡å›ºå®šï¼Œæ¼æ´å‡ºæ°´é€Ÿç‡æ˜¯å›ºå®šçš„ï¼ˆè¯·æ±‚å¤„ç†é€Ÿåº¦å›ºå®šï¼‰</li>
<li>æµé‡è¿›å…¥æ¼æ¡¶çš„é€Ÿç‡æ˜¯æ²¡æœ‰é™åˆ¶çš„ï¼ˆä½†ä¸ä¼šç«‹å³å¤„ç†ï¼Œéœ€è¦æ’é˜Ÿç­‰å¾…ç»è¿‡æ¼æ´ï¼‰</li>
<li>æ¡¶æ»¡äº†ä»¥åä¼šæº¢å‡ºï¼ˆæ‹’ç»æ–°çš„è¯·æ±‚ï¼‰</li>
</ul>
<p>æ¼æ¡¶ç®—æ³•é™åˆ¶çš„å…³é”®ã€è¯·æ±‚å¤„ç†é€Ÿåº¦ã€ï¼Œå³ä½¿é‡åˆ°çªå‘æµé‡ï¼Œæˆ‘ä»¬çš„å¤„ç†é€Ÿåº¦ä¾ç„¶ä¸å˜ï¼Œå› æ­¤ä¼šæœ‰ä¸€éƒ¨åˆ†è¯·æ±‚åœ¨æ’é˜Ÿï¼Œä¼šç­‰å¾…å»¶è¿Ÿå¤„ç†ï¼Œä½†ç»“æœè¾“å‡ºå§‹ç»ˆä¸ä¼šè¶…å‡ºã€è¯·æ±‚å¤„ç†é€Ÿåº¦ã€çš„é™åˆ¶ã€‚</p>
<h2 id="ä»¤ç‰Œæ¡¶ç®—æ³•"><a href="#ä»¤ç‰Œæ¡¶ç®—æ³•" class="headerlink" title="ä»¤ç‰Œæ¡¶ç®—æ³•"></a>ä»¤ç‰Œæ¡¶ç®—æ³•</h2><p>ä»¤ç‰Œæ¡¶ç®—æ³•ç”¨æ¥æ§åˆ¶å‘é€åˆ°ç½‘ç»œä¸Šçš„æ•°æ®çš„æ•°ç›®ï¼Œå¹¶å…è®¸çªå‘æ•°æ®çš„å‘é€ã€‚</p>
<p><img src="/images/PHP/api-rate-limiting-algorithm-practices/token_bucket_1.png"></p>
<p>ä»¤ç‰Œæ¡¶ç®—æ³•å’Œæ¼æ¡¶ç®—æ³•çš„æ–¹å‘åˆšå¥½æ˜¯ç›¸åçš„ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå›ºå®šçš„æ¡¶ï¼Œæ¡¶é‡Œå­˜æ”¾ç€ä»¤ç‰Œï¼ˆtokenï¼‰ã€‚ä¸€å¼€å§‹æ¡¶æ˜¯ç©ºçš„ï¼Œç³»ç»ŸæŒ‰å›ºå®šçš„æ—¶é—´ï¼ˆrateï¼‰å¾€æ¡¶é‡Œæ·»åŠ ä»¤ç‰Œï¼Œç›´åˆ°æ¡¶é‡Œçš„ä»¤ç‰Œæ•°æ»¡ï¼Œå¤šä½™çš„è¯·æ±‚ä¼šè¢«ä¸¢å¼ƒã€‚å½“è¯·æ±‚æ¥çš„æ—¶å€™ï¼Œä»æ¡¶é‡Œç§»é™¤ä¸€ä¸ªä»¤ç‰Œï¼Œå¦‚æœæ¡¶æ˜¯ç©ºçš„åˆ™æ‹’ç»è¯·æ±‚æˆ–è€…é˜»å¡ã€‚</p>
<p><img src="/images/PHP/api-rate-limiting-algorithm-practices/token_bucket.png"></p>
<h3 id="PHPå®ç°v4"><a href="#PHPå®ç°v4" class="headerlink" title="PHPå®ç°v4"></a>PHPå®ç°v4</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tokenBucketRateLimiter</span> <span class="keyword">implements</span> <span class="title">RateLimiter</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$prefix</span>   = <span class="string">&quot;ratelimiter:tokenbucket:&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$key</span>      = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$rate</span>     = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$capacity</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string  $key      è®¡æ•°KEY</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> integer $rate     äº§ç”Ÿä»¤ç‰Œçš„é€Ÿç‡ï¼ˆä¸ª/ç§’ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int     $capacity æ¼æ¡¶å®¹é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$key</span>, <span class="keyword">int</span> <span class="variable">$rate</span>, <span class="keyword">int</span> <span class="variable">$capacity</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;capacity = <span class="variable">$capacity</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key      = <span class="variable language_">$this</span>-&gt;prefix . <span class="variable">$key</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;rate     = <span class="variable">$rate</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">access</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//å½“å‰æ—¶é—´</span></span><br><span class="line">        <span class="variable">$time</span> = <span class="title function_ invoke__">time</span>();</span><br><span class="line">        [<span class="variable">$lastTime</span>, <span class="variable">$tokensLeft</span>] = <span class="title class_">Predis</span>::<span class="title function_ invoke__">hmget</span>(<span class="variable language_">$this</span>-&gt;key, <span class="string">&#x27;last_time&#x27;</span>, <span class="string">&#x27;tokens_left&#x27;</span>);</span><br><span class="line">        <span class="comment">//æ¨ç®—æ–°äº§ç”Ÿçš„tokenæ•°é‡</span></span><br><span class="line">        <span class="variable">$tokensAppend</span> = (<span class="variable">$time</span> - <span class="variable">$lastTime</span>) * <span class="variable">$rate</span>;</span><br><span class="line">        <span class="comment">//å½“å‰å‰©ä½™ tokens æ•°é‡</span></span><br><span class="line">        <span class="variable">$tokensLeft</span> = <span class="title function_ invoke__">min</span>(<span class="variable language_">$this</span>-&gt;capacity, <span class="variable">$tokensLeft</span> + <span class="variable">$tokensAppend</span>);</span><br><span class="line">        <span class="comment">//æ›´æ–°ä¸Šæ¬¡è¯·æ±‚çš„æ—¶é—´</span></span><br><span class="line">        <span class="title class_">Predis</span>::<span class="title function_ invoke__">hSet</span>(<span class="variable language_">$this</span>-&gt;key, <span class="string">&#x27;last_time&#x27;</span>, <span class="variable">$time</span>);</span><br><span class="line">        <span class="comment">//åˆ¤æ–­tokenæ˜¯å¦è¶³å¤Ÿ</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$tokensLeft</span> &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title class_">Predis</span>::<span class="title function_ invoke__">hSet</span>(<span class="variable language_">$this</span>-&gt;key, <span class="string">&#x27;tokens_left&#x27;</span>, <span class="variable">$tokensPend</span> - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Luaå®ç°v4"><a href="#Luaå®ç°v4" class="headerlink" title="Luaå®ç°v4"></a>Luaå®ç°v4</h3><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> token = KEYS[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">local</span> now = <span class="built_in">tonumber</span>(ARGV[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> rate = <span class="built_in">tonumber</span>(ARGV[<span class="number">2</span>])</span><br><span class="line"><span class="keyword">local</span> capacity = <span class="built_in">tonumber</span>(ARGV[<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> lastTime = <span class="built_in">tonumber</span>(redis.call(<span class="string">&#x27;HGET&#x27;</span>, token, <span class="string">&#x27;last_time&#x27;</span>) <span class="keyword">or</span> <span class="number">0</span>)</span><br><span class="line"><span class="keyword">local</span> tokensLeft = <span class="built_in">tonumber</span>(redis.call(<span class="string">&#x27;HGET&#x27;</span>, token, <span class="string">&#x27;tokens_left&#x27;</span>) <span class="keyword">or</span> <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">tokensLeft = <span class="built_in">math</span>.<span class="built_in">min</span>(capacity, tokensLeft + (now - lastTime) * rate)</span><br><span class="line">redis.call(<span class="string">&#x27;HSET&#x27;</span>, token, <span class="string">&#x27;last_time&#x27;</span>, now)</span><br><span class="line"><span class="keyword">if</span> tokensLeft &gt;= <span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">    redis.call(<span class="string">&#x27;HSET&#x27;</span>, token, <span class="string">&#x27;tokens_left&#x27;</span>, tokensLeft - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å¾€ä»¤ç‰Œæ¡¶ä¸­ä»¥å›ºå®šé€Ÿç‡å¢åŠ ä»¤ç‰Œ</li>
<li>ä»¤ç‰Œæ¡¶çš„å®¹é‡æœ‰é™ï¼Œå¦‚æœæ¡¶æ»¡äº†ï¼Œæ–°ä»¤ç‰Œæº¢å‡ºä¸¢å¼ƒ</li>
<li>å¦‚æœæ¡¶ä¸­å¯ç”¨ä»¤ç‰Œä¸è¶³æ—¶ï¼Œè¯¥è¯·æ±‚ä¼šè¢«é™æµ</li>
</ul>
<p>ä»¤ç‰Œæ¡¶ç®—æ³•ä¸­æµé‡çš„æµå…¥é€Ÿç‡æ˜¯ä¸é™åˆ¶çš„ï¼Œæµå‡ºé€Ÿç‡ä¹Ÿæ˜¯æ²¡æœ‰å¼ºåˆ¶é™åˆ¶çš„ï¼ˆä»¤ç‰Œæ¶ˆè€—ç¬é—´å³°å€¼æ˜¯æ¡¶çš„å¤§å°ï¼‰ï¼Œä½†æ˜¯ä»¤ç‰Œçš„äº§ç”Ÿå’Œç§¯æ”’éœ€è¦æ—¶é—´ï¼Œå› æ­¤æ—¢æ”¯æŒä¸€å®šç¨‹åº¦çªå‘æµé‡ï¼Œåˆèƒ½æ»¡è¶³æ€»ä½“é™æµçš„ç›®æ ‡ã€‚</p>
<p>å¯¹æ¯”<code>æ¼æ¡¶ç®—æ³•</code>å’Œ<code>ä»¤ç‰Œæ¡¶ç®—æ³•</code>ï¼Œæˆ‘ä»¬å‘ç°ï¼Œ<code>æ¼æ¡¶ç®—æ³•</code>èƒ½å¤Ÿå¼ºè¡Œé™åˆ¶æ•°æ®çš„ä¼ è¾“é€Ÿç‡ï¼Œè€Œ<code>ä»¤ç‰Œæ¡¶ç®—æ³•</code>åœ¨èƒ½å¤Ÿé™åˆ¶æ•°æ®çš„å¹³å‡ä¼ è¾“é€Ÿç‡å¤–ï¼Œè¿˜å…è®¸æŸç§ç¨‹åº¦çš„çªå‘ä¼ è¾“ã€‚</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Api</tag>
        <tag>rate-limiter</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP å•ä¸€å…¥å£æ¨¡å¼</title>
    <url>/PHP/php-single-entry-mode/</url>
    <content><![CDATA[<h2 id="å•ä¸€å…¥å£"><a href="#å•ä¸€å…¥å£" class="headerlink" title="å•ä¸€å…¥å£"></a>å•ä¸€å…¥å£</h2><blockquote>
<p>å•ä¸€å…¥å£çš„æ¦‚å¿µå…¶å®å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ•´ä¸ªåº”ç”¨æƒ³è±¡ä¸ºä¸€ä¸ªé»‘è‰²çš„ç›’å­ï¼Œæ•´ä¸ªç›’å­åªæœ‰ä¸€ä¸ªå…¥å£ï¼Œè¿™ä¸ªå…¥å£ç”±ä¸€ä¸ªæ–‡ä»¶æŠŠå®ˆï¼Œå®ƒè¦æ±‚æ‰€æœ‰çš„è¯·æ±‚å¿…é¡»é€šè¿‡è¿™ä¸ªå…¥å£æ–‡ä»¶æ£€éªŒæ‰èƒ½è¿›å…¥ã€‚</p>
</blockquote>
<p>åœ¨èŠå•ä¸€å…¥å£çš„åº”ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€çœ‹ä¼ ç»Ÿåº”ç”¨çš„å¤šå…¥å£æ¨¡å¼ï¼Œè¿™é‡Œæˆ‘ä»¬å‚è€ƒä¸€ä¸‹ ECSHOP çš„ç½‘ç«™æ ¹ç›®å½•çš„éƒ¨åˆ†ç›®å½•ç»“æ„ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">- article.php æ–‡ç« å†…å®¹</span><br><span class="line">- article_cat.php æ–‡ç« åˆ†ç±»</span><br><span class="line">- auction.php æ‹å–å‰å°æ–‡ä»¶</span><br><span class="line">- brand.php å“ç‰Œåˆ—è¡¨</span><br><span class="line">- captcha.php ç”ŸæˆéªŒè¯ç </span><br><span class="line">- catalog.php åˆ—å‡ºæ‰€ä»¥åˆ†ç±»åŠå“ç‰Œ</span><br><span class="line">- category.php å•†å“åˆ†ç±»</span><br><span class="line">- comment.php æäº¤ç”¨æˆ·è¯„è®º</span><br><span class="line">- compare.php å•†å“æ¯”è¾ƒç¨‹åº</span><br><span class="line">- cycle_image.php è½®æ’­å›¾ç‰‡ç¨‹åº</span><br><span class="line">- feed.php RSS Feed ç”Ÿæˆç¨‹åº</span><br><span class="line">- flow.php è´­ç‰©æµç¨‹</span><br><span class="line">- gallery.php å•†å“ç›¸å†Œ</span><br><span class="line">- goods.php å•†å“è¯¦æƒ…</span><br><span class="line">- goods_script.php ç”Ÿæˆå•†å“åˆ—è¡¨</span><br><span class="line">- group_buy.php å›¢è´­å•†å“å‰å°æ–‡ä»¶</span><br><span class="line">- index.php é¦–é¡µæ–‡ä»¶</span><br><span class="line">- myship.php æ”¯ä»˜é…é€DEMO</span><br><span class="line">- pick_out.php é€‰è´­ä¸­å¿ƒ</span><br><span class="line">- receive.php å¤„ç†æ”¶å›ç¡®è®¤çš„é¡µé¢</span><br><span class="line">- index.php é¦–é¡µæ–‡ä»¶</span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥çœ‹åˆ°ä¸Šè¿°ç›®å½•å°±æ˜¯ç½‘ç«™çš„æ ¹ç›®å½•ï¼Œè¿™ä¸ªç›®å½•ä¸‹å­˜æ”¾ç€ç›¸åº”é¡µé¢çš„å“åº”ä»£ç ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è®¿é—®é¦–é¡µï¼Œæˆ‘ä»¬å°±åœ¨ç½‘å€ä¸­è®¿é—® <code>index.php</code>ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è®¿é—®å•†å“é¡µï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦è®¿é—® <code>goods.php</code> æ–‡ä»¶ï¼Œè¿™å°±æ˜¯ä¼ ç»Ÿåº”ç”¨çš„å¤šå…¥å£æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸åŒçš„æ–‡ä»¶å…¥å£æ¥å¾—åˆ°åº”ç”¨å“åº”ã€‚</p>
<span id="more"></span>

<p>è°ˆåˆ°è¿™é‡Œï¼Œä½ åº”è¯¥æ„è¯†åˆ°äº† <strong>ç½‘ç«™çš„æ ¹ç›®å½•</strong> å’Œ <strong>åº”ç”¨çš„æ ¹ç›®å½•</strong> æ˜¯ä¸¤ä¸ªä¸åŒçš„å®šä¹‰ã€‚<br>æˆ‘ä»¬çœ‹ä¸‹ Laravel åº”ç”¨çš„æ ¹ç›®å½•ä¸‹åŒ…å«äº†å¤šä¸ªç›®å½•ï¼Œå…¶ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">- app</span><br><span class="line">- bootstrap</span><br><span class="line">- config</span><br><span class="line">- database</span><br><span class="line">- public</span><br><span class="line">  - index.php</span><br><span class="line">- resources</span><br><span class="line">- storage</span><br><span class="line">- tests</span><br><span class="line">- vendor</span><br></pre></td></tr></table></figure>

<p>è¿™å…¶ä¸­ <code>public</code> ç›®å½•æ‰æ˜¯ç½‘ç«™çš„æ ¹ç›®å½•ï¼Œ<code>index.php</code> å°±æ˜¯æ•´ä¸ªåº”ç”¨çš„å®ˆå«ï¼Œå®ƒéœ€è¦è§†å¯Ÿæ‰€æœ‰è¿›å…¥åº”ç”¨çš„è¯·æ±‚ã€‚</p>
<h2 id="å•ä¸€å…¥å£çš„ä¼˜åŠ¿"><a href="#å•ä¸€å…¥å£çš„ä¼˜åŠ¿" class="headerlink" title="å•ä¸€å…¥å£çš„ä¼˜åŠ¿"></a>å•ä¸€å…¥å£çš„ä¼˜åŠ¿</h2><p>èŠåˆ°è¿™é‡Œï¼Œä½ ä¸€å®šä¼šæœ‰æ‰€ç–‘æƒ‘ï¼ŒLaravel ä¸ºä½•è¦é‡‡ç”¨å•ä¸€å…¥å£çš„æ¨¡å¼ï¼Œè¿™ç§å•ä¸€å…¥å£æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ</p>
<p>å¦‚æœè¯´è¿™ç§å•ä¸€å…¥å£ç›®å½•ç»“æ„çš„ä¼˜åŠ¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸å¾—ä¸æåŠåº”ç”¨æ ¸å¿ƒä»£ç ä¸é™æ€èµ„æºçš„åˆ†ç¦»ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸å®Œç¾çš„å°†æœåŠ¡ç«¯æ ¸å¿ƒä»£ç ä¸é™æ€èµ„æºå®Œå…¨åˆ†ç¦»å¼€æ¥ï¼Œè¿™å°±æ„å‘³ç€å¦‚æœä½ æƒ³è¦è®¿é—® <code>public</code> ç›®å½•å¤–çš„èµ„æºéƒ½å¿…é¡»è¦ç»è¿‡å®ˆå«çš„å®¡æŸ¥ã€‚è¿™å°±ä¸ºç»Ÿä¸€çš„å®‰å…¨æ€§æä¾›äº†ä¾¿åˆ©ã€‚</p>
<p>æˆ‘æ›¾ç»è§åˆ°è¿‡è¿™ä¹ˆä¸€ä¸ªæœ‰è¶£çš„æƒ…å†µï¼ŒæŸäººåœ¨ ECSHOP ç¨‹åºçš„é…ç½®æ–‡ä»¶ç›®å½•ä¸‹æ‹·è´äº†ä¸€ä»½é…ç½®å¹¶é‡å‘½åä¸º <code>config.php.bak</code>ï¼ŒåŸæ„å¯èƒ½æ˜¯ä¸ºäº†é˜²æ­¢è‡ªå·±å¿˜è®°æ•°æ®åº“çš„å¯†ç ï¼Œä½†æ˜¯è¿™å°±æ„å‘³ç€ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®åˆ°è¿™ä¸ªæ–‡ä»¶äº†ï¼Œå› ä¸ºå¯¹äº Nginx æˆ–è€… Apache æ¥è¯´è¿™äº› HTTP è¯·æ±‚åªè¦è·¯å¾„æ­£ç¡®ï¼Œå¦‚æœä¸æ˜¯ PHP ç¨‹åºçš„è¯ï¼Œä»–ä»¬å°±ä¼šä»¥é™æ€èµ„æºçš„æ–¹å¼è¿›è¡Œè¾“å‡ºï¼Œå½“ç„¶ï¼Œè¿™åªæ˜¯ä¸ªä¸ªä¾‹ï¼Œä½†å´è¶³ä»¥è®©ä½ æ˜ç™½åŠ¨é™åˆ†ç¦»çš„å¥½å¤„äº†ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨ç©¿é€åˆ°é»‘ç›’çš„å†…éƒ¨çœ‹ä¸€ä¸‹ï¼Œå¦‚æœè¯´é»‘ç›’æ˜¯ä¸€ä¸ªå·¥å‚ï¼Œå®ˆå«æŠŠä¸€ä¸ªè¯·æ±‚äº¤ç”±å·¥å‚æ¥å¤„ç†ï¼Œé‚£ä¹ˆå®ƒä¸€å®šéœ€è¦é€šè¿‡ä¸€å®šçš„æµç¨‹æ¥äº§å‡ºä¸€ä¸ªå“åº”ã€‚é‚£ä¹ˆå®ƒçš„æµç¨‹ä¸€èˆ¬æ˜¯è¿™æ ·çš„ï¼š</p>
<div class="note success"><ul>
<li>åˆå§‹åŒ–åº”ç”¨æ‰€éœ€çš„æ¨¡å—èµ„æº</li>
<li>æ ¹æ®ä¸åŒçš„è¯·æ±‚ç±»å‹å°†å…¶å¯¼å‘ç›¸åº”çš„ä¸šåŠ¡</li>
<li>ä¸šåŠ¡å¤„ç†</li>
<li>è¿”å›å“åº”</li>
</ul>
</div>

<p>é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¯ä»¥çœ‹å‡ºï¼Œå…¶å®å•ä¸€å…¥å£æœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯è§„èŒƒäº†å¼€å‘æµç¨‹ã€‚</p>
<p>æˆ‘ä»¬å¯èƒ½å¾ˆéš¾æƒ³è±¡è§„èŒƒåŒ–çš„æµç¨‹èƒ½å¸¦æ¥å¤šå¤§çš„å¼€å‘æ•ˆç‡ä¸Šçš„æå‡ï¼Œä½†æ˜¯å®ƒç¡®å®èƒ½æœ€å¤§åŒ–çš„æå‡æ•ˆç‡ã€‚</p>
<p>åŸºäºä¼ ç»Ÿçš„å¤šå…¥å£åº”ç”¨ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ä¿å­˜ä¸€ä¸ªç”¨æˆ·çš„è®¤è¯çŠ¶æ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸€å®šä¼šä½¿ç”¨æœåŠ¡ç«¯çš„ session åŠŸèƒ½ã€‚æ‰€ä»¥ä½ ä¼šåœ¨è¿™äº›åº”ç”¨çš„æ¯ä¸ªç‰µæ¶‰åˆ°ç”¨æˆ·ç›¸å…³çš„å…¥å£é¡µé¢çš„ PHP æ–‡ä»¶ä¸­å‘ç°è¢«å¼•å…¥äº†ç›¸å…³çš„ session å®ç°ã€‚è¿™æ ·ï¼Œæ¯æ¬¡æˆ‘ä»¬å¢åŠ ä¸€ä¸ªé¡µé¢å°±è¦æ‰‹åŠ¨çš„å¼•å…¥ä¸€æ¬¡ï¼Œè¿™å®Œå…¨èƒŒç¦»çš„ DRYï¼ˆDonâ€™t Repeat Yourself) åŸåˆ™ã€‚</p>
<p>è€Œåœ¨å•å…¥å£åº”ç”¨ä¸­ï¼Œå¦‚æœæŠ½è±¡åº¦éå¸¸é«˜çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠ session å®ç°æŠ½è±¡ä¸ºå…¶ä¸­çš„ä¸€ä¸ªä¸­é—´ä»¶ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå®Œå…¨å¯ä»¥åœ¨è¯·æ±‚è¢«å®ˆå«è¿›è¡Œåˆ†å‘æ—¶ç”±ç¨‹åºè‡ªåŠ¨çš„åˆ¤æ–­æ˜¯å¦éœ€è¦å¯ç”¨ session åŠŸèƒ½ï¼Œè¿™å®Œå…¨å¯ä»¥æ˜¯è‡ªåŠ¨åŒ–çš„ã€‚</p>
<p>å†æ¯”å¦‚è¯´ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å¯¹åº”ç”¨çš„è¯·æ±‚å¯ç”¨æ—¥å¿—åŠŸèƒ½ï¼Œé‚£ä¹ˆåŸºäºä¼ ç»Ÿçš„å¤šå…¥å£åº”ç”¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸€ä¸ªå…¥å£ä¸­éƒ½åŠ å…¥æ—¥å¿—åŠŸèƒ½ï¼Œæ‰èƒ½è¾¾åˆ°è®°å½•æ‰€æœ‰æ—¥å¿—çš„æ•ˆæœï¼Œè€Œåœ¨å•å…¥å£åº”ç”¨ä¸­æˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ä¸ªæ—¥å¿—ä¸­é—´ä»¶å°±å¯ä»¥è®©å®ƒæ¥è®°å½•æ‰€æœ‰çš„æ—¥å¿—äº†ã€‚</p>
<p>å¯¹äºå¤šå…¥å£çš„åº”ç”¨æ¯å½“æˆ‘å¢åŠ ä¸€ä¸ªå…¥å£é¡µé¢æ—¶ï¼Œæˆ‘ä¸€å®šä¸èƒ½å¿˜è®°å¼•å…¥åŸºå±‚çš„ç»„ä»¶åº“ã€‚</p>
<div class="note default"><p>åŸæ–‡é“¾æ¥ï¼š<a href="http://www.jianshu.com/p/d93d79b2699f">Laravel æºç åˆ†æç³»åˆ— â€”â€” å•ä¸€å…¥å£</a></p>
</div>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP empty å‡½æ•°åˆ¤æ–­ç»“æœä¸ºç©ºï¼Œä½†å®é™…å€¼å´ä¸ºéç©º</title>
    <url>/PHP/When-empty-is-not-empty/</url>
    <content><![CDATA[<h2 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h2><div class="note info"><p>PHP 7.1.16</p>
</div>

<p>æœ€è¿‘æˆ‘åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨ <code>empty</code> æ—¶è·å–åˆ°äº†ä¸€äº›æ„æ–™ä¹‹å¤–çš„ç»“æœã€‚ä¸‹é¢æ˜¯æˆ‘å¤„ç†åçš„è°ƒè¯•è®°å½•ï¼Œåœ¨è¿™é‡Œåˆ†äº«ç»™ä½ ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>(</span><br><span class="line">    <span class="variable">$person</span>-&gt;firstName,</span><br><span class="line">    <span class="keyword">empty</span>(<span class="variable">$person</span>-&gt;firstName)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>å®ƒçš„ç»“æœæ˜¯ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;Freek&quot;</span></span><br><span class="line"><span class="keyword">bool</span>(<span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>ç»“æœå‡ºäººæ„æ–™ã€‚ä¸ºä»€ä¹ˆå˜é‡çš„å€¼ä¸ºå­—ç¬¦ä¸²ï¼Œä½†åŒæ—¶ä¼šæ˜¯ç©ºå€¼å‘¢ï¼Ÿè®©æˆ‘ä»¬åœ¨ <code>$person-&gt;firstName</code> å˜é‡ä¸Šå°è¯•ä½¿ç”¨å…¶å®ƒä¸€äº›å‡½æ•°æ¥è¿›è¡Œåˆ¤æ–­å§ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>(</span><br><span class="line">    <span class="variable">$person</span>-&gt;firstName,</span><br><span class="line">    <span class="keyword">empty</span>(<span class="variable">$person</span>-&gt;firstName),</span><br><span class="line">    <span class="keyword">isset</span>(<span class="variable">$person</span>-&gt;firstName),</span><br><span class="line">    <span class="title function_ invoke__">is_null</span>(<span class="variable">$person</span>-&gt;firstName)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šç»“æœä¸ºï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;Freek&quot;</span></span><br><span class="line"><span class="keyword">bool</span>(<span class="literal">true</span>) <span class="comment">// empty</span></span><br><span class="line"><span class="keyword">bool</span>(<span class="literal">true</span>) <span class="comment">// isset</span></span><br><span class="line"><span class="keyword">bool</span>(<span class="literal">false</span>) <span class="comment">// is_null</span></span><br></pre></td></tr></table></figure>

<div class="note info"><p>æ³¨ï¼šè¿™è¾¹æˆ‘æµ‹è¯•ç»“æœ isset çš„ç»“æœåŒæ ·ä¸º falseï¼Œå¯ä»¥åˆ° <a href="http://www.dooccn.com/php7/#id/3f2d2339a9c74415c472e8637cda74a9">è¿™é‡Œ</a> å»è¿è¡Œä¸‹æŸ¥çœ‹ç»“æœã€‚</p>
</div>

<p><code>isset</code> å’Œ <code>is_null</code> å‡½æ•°æ‰§è¡Œç»“æœç¬¦åˆé¢„æœŸåˆ¤æ–­ï¼Œå”¯ç‹¬ <code>empty</code> å‡½æ•°è¿”å›äº†é”™è¯¯ç»“æœã€‚</p>
<p>è¿™é‡Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ <code>Person</code> ç±»çš„å®ç°ä»£ç å§ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$attributes</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$attributes</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;attributes = <span class="variable">$attributes</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;attributes[<span class="variable">$name</span>] ?? <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šè¿°ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>Person</code> å¯¹è±¡çš„æˆå‘˜å˜é‡æ˜¯é€šè¿‡ <code>__get</code> é­”æœ¯æ–¹æ³•ä» <code>$attributes</code> æ•°ç»„ä¸­æ£€ç´¢å‡ºæ¥çš„ã€‚</p>
<p>å½“å°†å˜é‡ä¼ å…¥ä¸€ä¸ªæ™®é€šå‡½æ•°æ—¶ï¼Œ<code>$person-&gt;firstName</code> ä¼šå…ˆè¿›è¡Œå–å€¼å¤„ç†ï¼Œç„¶åå†å°†è·å–åˆ°çš„ç»“æœä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°å†…ã€‚</p>
<p>ä½†æ˜¯ <code>empty</code> ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯ä¸€ç§æ•°æ®ç»“æ„ã€‚æ‰€ä»¥å½“å°† <code>$person-&gt;firstName</code> ä¼ å…¥ <code>empty</code> æ—¶ï¼Œå¹¶ä¸ä¼šå…ˆè¿›è¡Œå–å€¼å¤„ç†ã€‚è€Œæ˜¯ä¼šå…ˆåˆ¤æ–­ <code>$person</code> å¯¹è±¡æˆå‘˜å±æ€§ <code>firstName</code> çš„å†…å®¹ï¼Œç”±äºè¿™ä¸ªå±æ€§å¹¶æœªçœŸå®å­˜åœ¨ï¼Œæ‰€ä»¥è¿”å› <code>false</code>ã€‚</p>
<p>åœ¨è¿™ç§åº”ç”¨åœºæ™¯ä¸‹ï¼Œ<a href="http://php.net/manual/zh/language.oop5.overloading.php">å®˜æ–¹æ–‡æ¡£</a>æœ‰ç»™å‡ºè§£é‡Š:</p>
<div class="note warning"><p>åœ¨é™¤ isset() å¤–çš„å…¶å®ƒè¯­è¨€ç»“æ„ä¸­æ— æ³•ä½¿ç”¨é‡è½½çš„å±æ€§ï¼Œè¿™æ„å‘³ç€å½“å¯¹ä¸€ä¸ªé‡è½½çš„å±æ€§ä½¿ç”¨ empty() æ—¶ï¼Œé‡è½½é­”æœ¯æ–¹æ³•å°†ä¸ä¼šè¢«è°ƒç”¨ã€‚</p>
<p>ä¸ºé¿å¼€æ­¤é™åˆ¶ï¼Œå¿…é¡»å°†é‡è½½å±æ€§èµ‹å€¼åˆ°æœ¬åœ°å˜é‡å†ä½¿ç”¨ empty()</p>
</div>

<p>æ‰€ä»¥å¦‚æœä½ å¸Œæœ› <code>empty</code> å‡½æ•°èƒ½å¤Ÿæ­£å¸¸å¤„ç†ç±»å±æ€§ï¼Œå¯ä»¥å°†ç±»å±æ€§èµ‹å€¼åˆ°æœ¬åœ°å˜é‡å†ä½¿ç”¨ <code>empty()</code>ï¼Œæˆ–è€…æˆ‘ä»¬åœ¨ç±»ä¸­å®ç° <code>__isset</code> é­”æœ¯æ–¹æ³•ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$attributes</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$attributes</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;attributes = <span class="variable">$attributes</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;attributes[<span class="variable">$name</span>] ?? <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$attribute</span> = <span class="variable language_">$this</span>-&gt;<span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> !<span class="keyword">empty</span>(<span class="variable">$attribute</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å½“ <code>empty</code> è¿›è¡Œæ§åˆ¶åˆ¤æ–­æ—¶ï¼Œä¼šä½¿ç”¨è¿™ä¸ªé­”æœ¯æ–¹æ³•æ¥åˆ¤æ–­æœ€ç»ˆçš„ç»“æœã€‚</p>
<p>æˆ‘ä»¬å†æ¥çœ‹çœ‹è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>(</span><br><span class="line">   <span class="variable">$person</span>-&gt;firstName,</span><br><span class="line">   <span class="keyword">empty</span>(<span class="variable">$person</span>-&gt;firstName)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>æ–°çš„æ£€æµ‹ç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;Freek&quot;</span></span><br><span class="line"><span class="keyword">bool</span>(<span class="literal">false</span>)</span><br></pre></td></tr></table></figure>

<p>å®Œç¾ï¼</p>
<div class="note default"><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://murze.be/when-empty-is-not-empty">When empty is not empty</a></p>
</div>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>empty</tag>
      </tags>
  </entry>
  <entry>
    <title>å¿…é¡»äº†è§£çš„mysqlä¸‰å¤§æ—¥å¿—-binlogã€redo logå’Œundo log</title>
    <url>/MySQL/redolog-undolog-binlog-of-MySQL/</url>
    <content><![CDATA[<p>æ—¥å¿—æ˜¯<code>mysql</code>æ•°æ®åº“çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œè®°å½•ç€æ•°æ®åº“è¿è¡ŒæœŸé—´å„ç§çŠ¶æ€ä¿¡æ¯ã€‚<code>mysql</code>æ—¥å¿—ä¸»è¦åŒ…æ‹¬é”™è¯¯æ—¥å¿—ã€æŸ¥è¯¢æ—¥å¿—ã€æ…¢æŸ¥è¯¢æ—¥å¿—ã€äº‹åŠ¡æ—¥å¿—ã€äºŒè¿›åˆ¶æ—¥å¿—å‡ å¤§ç±»ã€‚ä½œä¸ºå¼€å‘ï¼Œæˆ‘ä»¬é‡ç‚¹éœ€è¦å…³æ³¨çš„æ˜¯äºŒè¿›åˆ¶æ—¥å¿—(<code>binlog</code>)å’Œäº‹åŠ¡æ—¥å¿—(åŒ…æ‹¬<code>redo log</code>å’Œ<code>undo log</code>)ï¼Œæœ¬æ–‡æ¥ä¸‹æ¥ä¼šè¯¦ç»†ä»‹ç»è¿™ä¸‰ç§æ—¥å¿—ã€‚</p>
<h2 id="binlog"><a href="#binlog" class="headerlink" title="binlog"></a>binlog</h2><p><code>binlog</code>ç”¨äºè®°å½•æ•°æ®åº“æ‰§è¡Œçš„å†™å…¥æ€§æ“ä½œ(ä¸åŒ…æ‹¬æŸ¥è¯¢)ä¿¡æ¯ï¼Œä»¥äºŒè¿›åˆ¶çš„å½¢å¼ä¿å­˜åœ¨ç£ç›˜ä¸­ã€‚<code>binlog</code>æ˜¯<code>mysql</code>çš„é€»è¾‘æ—¥å¿—ï¼Œå¹¶ä¸”ç”±<code>Server</code>å±‚è¿›è¡Œè®°å½•ï¼Œä½¿ç”¨ä»»ä½•å­˜å‚¨å¼•æ“çš„<code>mysql</code>æ•°æ®åº“éƒ½ä¼šè®°å½•<code>binlog</code>æ—¥å¿—ã€‚</p>
<blockquote>
<p>é€»è¾‘æ—¥å¿—ï¼š<strong>å¯ä»¥ç®€å•ç†è§£ä¸ºè®°å½•çš„å°±æ˜¯sqlè¯­å¥</strong>ã€‚<br>ç‰©ç†æ—¥å¿—ï¼š<strong>å› ä¸º<code>mysql</code>æ•°æ®æœ€ç»ˆæ˜¯ä¿å­˜åœ¨æ•°æ®é¡µä¸­çš„ï¼Œç‰©ç†æ—¥å¿—è®°å½•çš„å°±æ˜¯æ•°æ®é¡µå˜æ›´</strong>ã€‚</p>
</blockquote>
<p><code>binlog</code>æ˜¯é€šè¿‡è¿½åŠ çš„æ–¹å¼è¿›è¡Œå†™å…¥çš„ï¼Œå¯ä»¥é€šè¿‡<code>max_binlog_size</code>å‚æ•°è®¾ç½®æ¯ä¸ª<code>binlog</code>æ–‡ä»¶çš„å¤§å°ï¼Œå½“æ–‡ä»¶å¤§å°è¾¾åˆ°ç»™å®šå€¼ä¹‹åï¼Œä¼šç”Ÿæˆæ–°çš„æ–‡ä»¶æ¥ä¿å­˜æ—¥å¿—ã€‚</p>
<h3 id="binlogä½¿ç”¨åœºæ™¯"><a href="#binlogä½¿ç”¨åœºæ™¯" class="headerlink" title="binlogä½¿ç”¨åœºæ™¯"></a>binlogä½¿ç”¨åœºæ™¯</h3><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œ<code>binlog</code>çš„ä¸»è¦ä½¿ç”¨åœºæ™¯æœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯<strong>ä¸»ä»å¤åˆ¶</strong>å’Œ<strong>æ•°æ®æ¢å¤</strong>ã€‚</p>
<ol>
<li><strong>ä¸»ä»å¤åˆ¶</strong>ï¼šåœ¨<code>Master</code>ç«¯å¼€å¯<code>binlog</code>ï¼Œç„¶åå°†<code>binlog</code>å‘é€åˆ°å„ä¸ª<code>Slave</code>ç«¯ï¼Œ<code>Slave</code>ç«¯é‡æ”¾<code>binlog</code>ä»è€Œè¾¾åˆ°ä¸»ä»æ•°æ®ä¸€è‡´ã€‚</li>
<li><strong>æ•°æ®æ¢å¤</strong>ï¼šé€šè¿‡ä½¿ç”¨<code>mysqlbinlog</code>å·¥å…·æ¥æ¢å¤æ•°æ®ã€‚</li>
</ol>
<h3 id="binlogåˆ·ç›˜æ—¶æœº"><a href="#binlogåˆ·ç›˜æ—¶æœº" class="headerlink" title="binlogåˆ·ç›˜æ—¶æœº"></a>binlogåˆ·ç›˜æ—¶æœº</h3><p>å¯¹äº<code>InnoDB</code>å­˜å‚¨å¼•æ“è€Œè¨€ï¼Œåªæœ‰åœ¨äº‹åŠ¡æäº¤æ—¶æ‰ä¼šè®°å½•<code>biglog</code>ï¼Œæ­¤æ—¶è®°å½•è¿˜åœ¨å†…å­˜ä¸­ï¼Œé‚£ä¹ˆ<code>biglog</code>æ˜¯ä»€ä¹ˆæ—¶å€™åˆ·åˆ°ç£ç›˜ä¸­çš„å‘¢ï¼Ÿ<code>mysql</code>é€šè¿‡<code>sync_binlog</code>å‚æ•°æ§åˆ¶<code>biglog</code>çš„åˆ·ç›˜æ—¶æœºï¼Œå–å€¼èŒƒå›´æ˜¯<code>0-N</code>ï¼š</p>
<ul>
<li>0ï¼šä¸å»å¼ºåˆ¶è¦æ±‚ï¼Œç”±ç³»ç»Ÿè‡ªè¡Œåˆ¤æ–­ä½•æ—¶å†™å…¥ç£ç›˜ï¼›</li>
<li>1ï¼šæ¯æ¬¡<code>commit</code>çš„æ—¶å€™éƒ½è¦å°†<code>binlog</code>å†™å…¥ç£ç›˜ï¼›</li>
<li>Nï¼šæ¯Nä¸ªäº‹åŠ¡ï¼Œæ‰ä¼šå°†<code>binlog</code>å†™å…¥ç£ç›˜ã€‚</li>
</ul>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œ<code>sync_binlog</code>æœ€å®‰å…¨çš„æ˜¯è®¾ç½®æ˜¯<code>1</code>ï¼Œè¿™ä¹Ÿæ˜¯<code>MySQL 5.7.7</code>ä¹‹åç‰ˆæœ¬çš„é»˜è®¤å€¼ã€‚ä½†æ˜¯è®¾ç½®ä¸€ä¸ªå¤§ä¸€äº›çš„å€¼å¯ä»¥æå‡æ•°æ®åº“æ€§èƒ½ï¼Œå› æ­¤å®é™…æƒ…å†µä¸‹ä¹Ÿå¯ä»¥å°†å€¼é€‚å½“è°ƒå¤§ï¼Œç‰ºç‰²ä¸€å®šçš„ä¸€è‡´æ€§æ¥è·å–æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<span id="more"></span>

<h3 id="binlogæ—¥å¿—æ ¼å¼"><a href="#binlogæ—¥å¿—æ ¼å¼" class="headerlink" title="binlogæ—¥å¿—æ ¼å¼"></a>binlogæ—¥å¿—æ ¼å¼</h3><p><code>binlog</code>æ—¥å¿—æœ‰ä¸‰ç§æ ¼å¼ï¼Œåˆ†åˆ«ä¸º<code>STATMENT</code>ã€<code>ROW</code>å’Œ<code>MIXED</code>ã€‚</p>
<blockquote>
<p>åœ¨ <code>MySQL 5.7.7</code>ä¹‹å‰ï¼Œé»˜è®¤çš„æ ¼å¼æ˜¯<code>STATEMENT</code>ï¼Œ<code>MySQL 5.7.7</code>ä¹‹åï¼Œé»˜è®¤å€¼æ˜¯<code>ROW</code>ã€‚æ—¥å¿—æ ¼å¼é€šè¿‡<code>binlog-format</code>æŒ‡å®šã€‚</p>
</blockquote>
<ul>
<li><code>STATMENT</code><br>åŸºäº<code>SQL</code>è¯­å¥çš„å¤åˆ¶(<code>statement-based replication, SBR</code>)ï¼Œæ¯ä¸€æ¡ä¼šä¿®æ”¹æ•°æ®çš„sqlè¯­å¥ä¼šè®°å½•åˆ°<code>binlog</code>ä¸­ã€‚<br>ä¼˜ç‚¹ï¼šä¸éœ€è¦è®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–ï¼Œå‡å°‘äº†<code>binlog</code>æ—¥å¿—é‡ï¼ŒèŠ‚çº¦äº†<code>IO</code>, ä»è€Œæé«˜äº†æ€§èƒ½ï¼›<br>ç¼ºç‚¹ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ä¼šå¯¼è‡´ä¸»ä»æ•°æ®ä¸ä¸€è‡´ï¼Œæ¯”å¦‚æ‰§è¡Œ<code>sysdate()</code>ã€<code>slepp()</code>ç­‰ã€‚</li>
<li><code>ROW</code><br>åŸºäºè¡Œçš„å¤åˆ¶(<code>row-based replication, RBR</code>)ï¼Œä¸è®°å½•æ¯æ¡sqlè¯­å¥çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»…éœ€è®°å½•å“ªæ¡æ•°æ®è¢«ä¿®æ”¹äº†ã€‚<br>ä¼˜ç‚¹ï¼šä¸ä¼šå‡ºç°æŸäº›ç‰¹å®šæƒ…å†µä¸‹çš„å­˜å‚¨è¿‡ç¨‹ã€æˆ–functionã€æˆ–triggerçš„è°ƒç”¨å’Œè§¦å‘æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„é—®é¢˜ï¼›<br>ç¼ºç‚¹ï¼šä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿—ï¼Œå°¤å…¶æ˜¯<code>alter table</code>çš„æ—¶å€™ä¼šè®©æ—¥å¿—æš´æ¶¨</li>
<li><code>MIXED</code><br>åŸºäº<code>STATMENT</code>å’Œ<code>ROW</code>ä¸¤ç§æ¨¡å¼çš„æ··åˆå¤åˆ¶(<code>mixed-based replication, MBR</code>)ï¼Œä¸€èˆ¬çš„å¤åˆ¶ä½¿ç”¨<code>STATEMENT</code>æ¨¡å¼ä¿å­˜<code>binlog</code>ï¼Œå¯¹äº<code>STATEMENT</code>æ¨¡å¼æ— æ³•å¤åˆ¶çš„æ“ä½œä½¿ç”¨<code>ROW</code>æ¨¡å¼ä¿å­˜<code>binlog</code></li>
</ul>
<h2 id="redo-log"><a href="#redo-log" class="headerlink" title="redo log"></a>redo log</h2><h3 id="ä¸ºä»€ä¹ˆéœ€è¦redo-log"><a href="#ä¸ºä»€ä¹ˆéœ€è¦redo-log" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦redo log"></a>ä¸ºä»€ä¹ˆéœ€è¦redo log</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œäº‹åŠ¡çš„å››å¤§ç‰¹æ€§é‡Œé¢æœ‰ä¸€ä¸ªæ˜¯<strong>æŒä¹…æ€§</strong>ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯<strong>åªè¦äº‹åŠ¡æäº¤æˆåŠŸï¼Œé‚£ä¹ˆå¯¹æ•°æ®åº“åšçš„ä¿®æ”¹å°±è¢«æ°¸ä¹…ä¿å­˜ä¸‹æ¥äº†ï¼Œä¸å¯èƒ½å› ä¸ºä»»ä½•åŸå› å†å›åˆ°åŸæ¥çš„çŠ¶æ€</strong>ã€‚é‚£ä¹ˆ<code>mysql</code>æ˜¯å¦‚ä½•ä¿è¯ä¸€è‡´æ€§çš„å‘¢ï¼Ÿæœ€ç®€å•çš„åšæ³•æ˜¯åœ¨æ¯æ¬¡äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå°†è¯¥äº‹åŠ¡æ¶‰åŠä¿®æ”¹çš„æ•°æ®é¡µå…¨éƒ¨åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚ä½†æ˜¯è¿™ä¹ˆåšä¼šæœ‰ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼Œä¸»è¦ä½“ç°åœ¨ä¸¤ä¸ªæ–¹é¢ï¼š</p>
<ol>
<li>å› ä¸º<code>Innodb</code>æ˜¯ä»¥<code>é¡µ</code>ä¸ºå•ä½è¿›è¡Œç£ç›˜äº¤äº’çš„ï¼Œè€Œä¸€ä¸ªäº‹åŠ¡å¾ˆå¯èƒ½åªä¿®æ”¹ä¸€ä¸ªæ•°æ®é¡µé‡Œé¢çš„å‡ ä¸ªå­—èŠ‚ï¼Œè¿™ä¸ªæ—¶å€™å°†å®Œæ•´çš„æ•°æ®é¡µåˆ·åˆ°ç£ç›˜çš„è¯ï¼Œå¤ªæµªè´¹èµ„æºäº†ï¼</li>
<li>ä¸€ä¸ªäº‹åŠ¡å¯èƒ½æ¶‰åŠä¿®æ”¹å¤šä¸ªæ•°æ®é¡µï¼Œå¹¶ä¸”è¿™äº›æ•°æ®é¡µåœ¨ç‰©ç†ä¸Šå¹¶ä¸è¿ç»­ï¼Œä½¿ç”¨éšæœºIOå†™å…¥æ€§èƒ½å¤ªå·®ï¼</li>
</ol>
<p>å› æ­¤<code>mysql</code>è®¾è®¡äº†<code>redo log</code>ï¼Œ<strong>å…·ä½“æ¥è¯´å°±æ˜¯åªè®°å½•äº‹åŠ¡å¯¹æ•°æ®é¡µåšäº†å“ªäº›ä¿®æ”¹</strong>ï¼Œè¿™æ ·å°±èƒ½å®Œç¾åœ°è§£å†³æ€§èƒ½é—®é¢˜äº†(ç›¸å¯¹è€Œè¨€æ–‡ä»¶æ›´å°å¹¶ä¸”æ˜¯é¡ºåºIO)ã€‚</p>
<h3 id="redo-logåŸºæœ¬æ¦‚å¿µ"><a href="#redo-logåŸºæœ¬æ¦‚å¿µ" class="headerlink" title="redo logåŸºæœ¬æ¦‚å¿µ"></a>redo logåŸºæœ¬æ¦‚å¿µ</h3><p><code>redo log</code>åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šä¸€ä¸ªæ˜¯å†…å­˜ä¸­çš„æ—¥å¿—ç¼“å†²(<code>redo log buffer</code>)ï¼Œå¦ä¸€ä¸ªæ˜¯ç£ç›˜ä¸Šçš„æ—¥å¿—æ–‡ä»¶(<code>redo log file</code>)ã€‚<code>mysql</code>æ¯æ‰§è¡Œä¸€æ¡<code>DML</code>è¯­å¥ï¼Œå…ˆå°†è®°å½•å†™å…¥<code>redo log buffer</code>ï¼Œåç»­æŸä¸ªæ—¶é—´ç‚¹å†ä¸€æ¬¡æ€§å°†å¤šä¸ªæ“ä½œè®°å½•å†™åˆ°<code>redo log file</code>ã€‚è¿™ç§<strong>å…ˆå†™æ—¥å¿—ï¼Œå†å†™ç£ç›˜</strong>çš„æŠ€æœ¯å°±æ˜¯<code>MySQL</code>é‡Œç»å¸¸è¯´åˆ°çš„<code>WAL(Write-Ahead Logging)</code>Â æŠ€æœ¯ã€‚</p>
<p>åœ¨è®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸­ï¼Œç”¨æˆ·ç©ºé—´(<code>user space</code>)ä¸‹çš„ç¼“å†²åŒºæ•°æ®ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯æ— æ³•ç›´æ¥å†™å…¥ç£ç›˜çš„ï¼Œä¸­é—´å¿…é¡»ç»è¿‡æ“ä½œç³»ç»Ÿå†…æ ¸ç©ºé—´(<code>kernel space</code>)ç¼“å†²åŒº(<code>OS Buffer</code>)ã€‚å› æ­¤ï¼Œ<code>redo log buffer</code>å†™å…¥<code>redo log file</code>å®é™…ä¸Šæ˜¯å…ˆå†™å…¥<code>OS Buffer</code>ï¼Œç„¶åå†é€šè¿‡ç³»ç»Ÿè°ƒç”¨<code>fsync()</code>å°†å…¶åˆ·åˆ°<code>redo log file</code>ä¸­ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š<br><img src="/images/MySQL/redolog-undolog-binlog-of-MySQL/KjiB4LpnPY.png"></p>
<p><code>mysql</code>æ”¯æŒä¸‰ç§å°†<code>redo log buffer</code>å†™å…¥<code>redo log file</code>çš„æ—¶æœºï¼Œå¯ä»¥é€šè¿‡<code>innodb_flush_log_at_trx_commit</code>å‚æ•°é…ç½®ï¼Œå„å‚æ•°å€¼å«ä¹‰å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°å€¼</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>0ï¼ˆå»¶è¿Ÿå†™ï¼‰</td>
<td>äº‹åŠ¡æäº¤æ—¶ä¸ä¼šå°†<code>redo log buffer</code>ä¸­æ—¥å¿—å†™å…¥åˆ°<code>os buffer</code>ï¼Œè€Œæ˜¯æ¯ç§’å†™å…¥<code>os buffer</code>å¹¶è°ƒç”¨<code>fsync()</code>å†™å…¥åˆ°<code>redo log file</code>ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´è®¾ç½®ä¸º0æ—¶æ˜¯(å¤§çº¦)æ¯ç§’åˆ·æ–°å†™å…¥åˆ°ç£ç›˜ä¸­çš„ï¼Œå½“ç³»ç»Ÿå´©æºƒï¼Œä¼šä¸¢å¤±1ç§’é’Ÿçš„æ•°æ®ã€‚</td>
</tr>
<tr>
<td>1ï¼ˆå®æ—¶å†™ï¼Œå®æ—¶åˆ·ï¼‰</td>
<td>äº‹åŠ¡æ¯æ¬¡æäº¤éƒ½ä¼šå°†<code>redo log buffer</code>ä¸­çš„æ—¥å¿—å†™å…¥<code>os buffer</code>å¹¶è°ƒç”¨<code>fsync()</code>åˆ·åˆ°<code>redo log file</code>ä¸­ã€‚è¿™ç§æ–¹å¼å³ä½¿ç³»ç»Ÿå´©æºƒä¹Ÿä¸ä¼šä¸¢å¤±ä»»ä½•æ•°æ®ï¼Œä½†æ˜¯å› ä¸ºæ¯æ¬¡æäº¤éƒ½å†™å…¥ç£ç›˜ï¼ŒIOçš„æ€§èƒ½è¾ƒå·®ã€‚</td>
</tr>
<tr>
<td>2ï¼ˆå®æ—¶å†™ï¼Œå»¶è¿Ÿåˆ·ï¼‰</td>
<td>æ¯æ¬¡æäº¤éƒ½ä»…å†™å…¥åˆ°<code>os buffer</code>ï¼Œç„¶åæ˜¯æ¯ç§’è°ƒç”¨<code>fsync()</code>å°†<code>os buffer</code>ä¸­çš„æ—¥å¿—å†™å…¥åˆ°<code>redo log file</code>ã€‚</td>
</tr>
</tbody></table>
<p><img src="/images/MySQL/redolog-undolog-binlog-of-MySQL/TDIN69GdQ6.png"></p>
<h3 id="redo-logè®°å½•å½¢å¼"><a href="#redo-logè®°å½•å½¢å¼" class="headerlink" title="redo logè®°å½•å½¢å¼"></a>redo logè®°å½•å½¢å¼</h3><p>å‰é¢è¯´è¿‡ï¼Œ<code>redo log</code>å®é™…ä¸Šè®°å½•æ•°æ®é¡µçš„å˜æ›´ï¼Œè€Œè¿™ç§å˜æ›´è®°å½•æ˜¯æ²¡å¿…è¦å…¨éƒ¨ä¿å­˜ï¼Œå› æ­¤<code>redo log</code>å®ç°ä¸Šé‡‡ç”¨äº†å¤§å°å›ºå®šï¼Œå¾ªç¯å†™å…¥çš„æ–¹å¼ï¼Œå½“å†™åˆ°ç»“å°¾æ—¶ï¼Œä¼šå›åˆ°å¼€å¤´å¾ªç¯å†™æ—¥å¿—ã€‚å¦‚ä¸‹å›¾ï¼š<br><img src="/images/MySQL/redolog-undolog-binlog-of-MySQL/M1bGsdyr8a.png"><br>åŒæ—¶æˆ‘ä»¬å¾ˆå®¹æ˜“å¾—çŸ¥ï¼Œ<strong>åœ¨innodbä¸­ï¼Œæ—¢æœ‰<code>redo log</code>éœ€è¦åˆ·ç›˜ï¼Œè¿˜æœ‰<code>æ•°æ®é¡µ</code>ä¹Ÿéœ€è¦åˆ·ç›˜ï¼Œ<code>redo log</code>å­˜åœ¨çš„æ„ä¹‰ä¸»è¦å°±æ˜¯é™ä½å¯¹<code>æ•°æ®é¡µ</code>åˆ·ç›˜çš„è¦æ±‚</strong>ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œ<code>write pos</code>è¡¨ç¤º<code>redo log</code>å½“å‰è®°å½•çš„<code>LSN</code>(é€»è¾‘åºåˆ—å·)ä½ç½®ï¼Œ<code>check point</code>è¡¨ç¤º<strong>æ•°æ®é¡µæ›´æ”¹è®°å½•</strong>åˆ·ç›˜åå¯¹åº”<code>redo log</code>æ‰€å¤„çš„<code>LSN</code>(é€»è¾‘åºåˆ—å·)ä½ç½®ã€‚<code>write pos</code>åˆ°<code>check point</code>ä¹‹é—´çš„éƒ¨åˆ†æ˜¯<code>redo log</code>ç©ºç€çš„éƒ¨åˆ†ï¼Œç”¨äºè®°å½•æ–°çš„è®°å½•ï¼›<code>check point</code>åˆ°<code>write pos</code>ä¹‹é—´æ˜¯<code>redo log</code>å¾…è½ç›˜çš„æ•°æ®é¡µæ›´æ”¹è®°å½•ã€‚å½“<code>write pos</code>è¿½ä¸Š<code>check point</code>æ—¶ï¼Œä¼šå…ˆæ¨åŠ¨<code>check point</code>å‘å‰ç§»åŠ¨ï¼Œç©ºå‡ºä½ç½®å†è®°å½•æ–°çš„æ—¥å¿—ã€‚</p>
<p>å¯åŠ¨<code>innodb</code>çš„æ—¶å€™ï¼Œä¸ç®¡ä¸Šæ¬¡æ˜¯æ­£å¸¸å…³é—­è¿˜æ˜¯å¼‚å¸¸å…³é—­ï¼Œæ€»æ˜¯ä¼šè¿›è¡Œæ¢å¤æ“ä½œã€‚å› ä¸º<code>redo log</code>è®°å½•çš„æ˜¯æ•°æ®é¡µçš„ç‰©ç†å˜åŒ–ï¼Œå› æ­¤æ¢å¤çš„æ—¶å€™é€Ÿåº¦æ¯”é€»è¾‘æ—¥å¿—(å¦‚<code>binlog</code>)è¦å¿«å¾ˆå¤šã€‚<br>é‡å¯<code>innodb</code>æ—¶ï¼Œé¦–å…ˆä¼šæ£€æŸ¥ç£ç›˜ä¸­æ•°æ®é¡µçš„<code>LSN</code>ï¼Œå¦‚æœæ•°æ®é¡µçš„<code>LSN</code>å°äºæ—¥å¿—ä¸­çš„<code>LSN</code>ï¼Œåˆ™ä¼šä»<code>checkpoint</code>å¼€å§‹æ¢å¤ã€‚<br>è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œåœ¨å®•æœºå‰æ­£å¤„äº<code>checkpoint</code>çš„åˆ·ç›˜è¿‡ç¨‹ï¼Œä¸”æ•°æ®é¡µçš„åˆ·ç›˜è¿›åº¦è¶…è¿‡äº†æ—¥å¿—é¡µçš„åˆ·ç›˜è¿›åº¦ï¼Œæ­¤æ—¶ä¼šå‡ºç°æ•°æ®é¡µä¸­è®°å½•çš„<code>LSN</code>å¤§äºæ—¥å¿—ä¸­çš„<code>LSN</code>ï¼Œè¿™æ—¶è¶…å‡ºæ—¥å¿—è¿›åº¦çš„éƒ¨åˆ†å°†ä¸ä¼šé‡åšï¼Œå› ä¸ºè¿™æœ¬èº«å°±è¡¨ç¤ºå·²ç»åšè¿‡çš„äº‹æƒ…ï¼Œæ— éœ€å†é‡åšã€‚</p>
<h3 id="redo-logä¸binlogåŒºåˆ«"><a href="#redo-logä¸binlogåŒºåˆ«" class="headerlink" title="redo logä¸binlogåŒºåˆ«"></a>redo logä¸binlogåŒºåˆ«</h3><table>
<thead>
<tr>
<th></th>
<th>redo log</th>
<th>binlog</th>
</tr>
</thead>
<tbody><tr>
<td>æ–‡ä»¶å¤§å°</td>
<td><code>redo log</code>çš„å¤§å°æ˜¯å›ºå®šçš„ã€‚</td>
<td><code>binlog</code>å¯é€šè¿‡é…ç½®å‚æ•°<code>max_binlog_size</code>è®¾ç½®æ¯ä¸ª<code>binlog</code>æ–‡ä»¶çš„å¤§å°ã€‚</td>
</tr>
<tr>
<td>å®ç°æ–¹å¼</td>
<td><code>redo log</code>æ˜¯<code>InnoDB</code>å¼•æ“å±‚å®ç°çš„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰å¼•æ“éƒ½æœ‰ã€‚</td>
<td><code>binlog</code>æ˜¯<code>Server</code>å±‚å®ç°çš„ï¼Œæ‰€æœ‰å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨Â <code>binlog</code>æ—¥å¿—</td>
</tr>
<tr>
<td>è®°å½•æ–¹å¼</td>
<td>redo log é‡‡ç”¨å¾ªç¯å†™çš„æ–¹å¼è®°å½•ï¼Œå½“å†™åˆ°ç»“å°¾æ—¶ï¼Œä¼šå›åˆ°å¼€å¤´å¾ªç¯å†™æ—¥å¿—ã€‚</td>
<td>binlog é€šè¿‡è¿½åŠ çš„æ–¹å¼è®°å½•ï¼Œå½“æ–‡ä»¶å¤§å°å¤§äºç»™å®šå€¼åï¼Œåç»­çš„æ—¥å¿—ä¼šè®°å½•åˆ°æ–°çš„æ–‡ä»¶ä¸Š</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td><code>redo log</code>é€‚ç”¨äºå´©æºƒæ¢å¤(crash-safe)</td>
<td><code>binlog</code>é€‚ç”¨äºä¸»ä»å¤åˆ¶å’Œæ•°æ®æ¢å¤</td>
</tr>
</tbody></table>
<p>ç”±<code>binlog</code>å’Œ<code>redo log</code>çš„åŒºåˆ«å¯çŸ¥ï¼š<code>binlog</code>æ—¥å¿—åªç”¨äºå½’æ¡£ï¼Œåªä¾é <code>binlog</code>æ˜¯æ²¡æœ‰<code>crash-safe</code>èƒ½åŠ›çš„ã€‚ä½†åªæœ‰<code>redo log</code>ä¹Ÿä¸è¡Œï¼Œå› ä¸º<code>redo log</code>æ˜¯<code>InnoDB</code>ç‰¹æœ‰çš„ï¼Œä¸”æ—¥å¿—ä¸Šçš„è®°å½•è½ç›˜åä¼šè¢«è¦†ç›–æ‰ã€‚å› æ­¤éœ€è¦<code>binlog</code>å’Œ<code>redo log</code>äºŒè€…åŒæ—¶è®°å½•ï¼Œæ‰èƒ½ä¿è¯å½“æ•°æ®åº“å‘ç”Ÿå®•æœºé‡å¯æ—¶ï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±ã€‚</p>
<h2 id="undo-log"><a href="#undo-log" class="headerlink" title="undo log"></a>undo log</h2><p>æ•°æ®åº“äº‹åŠ¡å››å¤§ç‰¹æ€§ä¸­æœ‰ä¸€ä¸ªæ˜¯<strong>åŸå­æ€§</strong>ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯Â <strong>åŸå­æ€§æ˜¯æŒ‡å¯¹æ•°æ®åº“çš„ä¸€ç³»åˆ—æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¸å¯èƒ½å‡ºç°éƒ¨åˆ†æˆåŠŸçš„æƒ…å†µ</strong>ã€‚å®é™…ä¸Šï¼Œ<strong>åŸå­æ€§</strong>åº•å±‚å°±æ˜¯é€šè¿‡<code>undo log</code>å®ç°çš„ã€‚<code>undo log</code>ä¸»è¦è®°å½•äº†æ•°æ®çš„é€»è¾‘å˜åŒ–ï¼Œæ¯”å¦‚ä¸€æ¡<code>INSERT</code>è¯­å¥ï¼Œå¯¹åº”ä¸€æ¡<code>DELETE</code>çš„<code>undo log</code>ï¼Œå¯¹äºæ¯ä¸ª<code>UPDATE</code>è¯­å¥ï¼Œå¯¹åº”ä¸€æ¡ç›¸åçš„<code>UPDATE</code>çš„<code>undo log</code>ï¼Œè¿™æ ·åœ¨å‘ç”Ÿé”™è¯¯æ—¶ï¼Œå°±èƒ½å›æ»šåˆ°äº‹åŠ¡ä¹‹å‰çš„æ•°æ®çŠ¶æ€ã€‚åŒæ—¶ï¼Œ<code>undo log</code>ä¹Ÿæ˜¯<code>MVCC</code>(å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)å®ç°çš„å…³é”®ï¼Œè¿™éƒ¨åˆ†å†…å®¹åœ¨<a href="https://juejin.im/post/6855129007336521741">é¢è¯•ä¸­çš„è€å¤§éš¾-mysqläº‹åŠ¡å’Œé”ï¼Œä¸€æ¬¡æ€§è®²æ¸…æ¥šï¼</a>ä¸­æœ‰ä»‹ç»ï¼Œä¸å†èµ˜è¿°ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol>
<li><a href="https://juejin.im/post/6844903794073960455">https://juejin.im/post/6844903794073960455</a></li>
<li><a href="https://www.cnblogs.com/f-ck-need-u/archive/2018/05/08/9010872.html">https://www.cnblogs.com/f-ck-need-u/archive/2018/05/08/9010872.html</a></li>
<li><a href="https://www.cnblogs.com/ivy-zheng/p/11094528.html">https://www.cnblogs.com/ivy-zheng/p/11094528.html</a></li>
<li><a href="https://yq.aliyun.com/articles/592937">https://yq.aliyun.com/articles/592937</a></li>
<li><a href="https://www.jianshu.com/p/5af73b203f2a">https://www.jianshu.com/p/5af73b203f2a</a></li>
<li><a href="https://www.jianshu.com/p/20e10ed721d0">https://www.jianshu.com/p/20e10ed721d0</a></li>
</ol>
<div class="note default"><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://juejin.cn/post/6860252224930070536">å¿…é¡»äº†è§£çš„mysqlä¸‰å¤§æ—¥å¿—-binlogã€redo logå’Œundo log</a></p>
</div>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>foreach ($data as &amp;$item) å¾ªç¯å¼•ç”¨äº§ç”Ÿçš„é—®é¢˜</title>
    <url>/PHP/foreach_problems_caused_by_circular_references/</url>
    <content><![CDATA[<h2 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h2><div class="note info"><p>PHP version 7.4</p>
</div>

<h2 id="é—®é¢˜å‘ˆç°"><a href="#é—®é¢˜å‘ˆç°" class="headerlink" title="é—®é¢˜å‘ˆç°"></a>é—®é¢˜å‘ˆç°</h2><p>æœ€å°åŒ–åˆ†æä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$data</span> = [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> &amp;<span class="variable">$item</span>) &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$item</span>) &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$data</span>);</span><br></pre></td></tr></table></figure>


<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">Array</span></span><br><span class="line">(</span><br><span class="line">[<span class="number">0</span>] =&gt; <span class="string">&#x27;foo&#x27;</span></span><br><span class="line">[<span class="number">1</span>] =&gt; <span class="string">&#x27;foo&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ$dataçš„å€¼è«åå¥‡å¦™å˜äº†ï¼Œè€Œå®ƒåªæ˜¯ç»è¿‡äº†ä¸¤ä¸ªç©ºå¾ªç¯è€Œå·²ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿï¼</p>
<p>å…ˆæ€»ç»“ä¸€ä¸‹ PHP ä¸­ä¸¤æ¡å…³äºå¼•ç”¨çš„ä¸¤ä¸ªè§„åˆ™ï¼š</p>
<ul>
<li>ç»™å¼•ç”¨å˜é‡èµ‹å€¼ï¼Œå®é™…ä¸Šæ˜¯ç»™å¼•ç”¨æ‰€æŒ‡å‘çš„å˜é‡èµ‹å€¼</li>
<li>ä¸€ä¸ªå¼•ç”¨å˜é‡å¯ä»¥è¢«ä¿®æ”¹ä¸ºå¯¹å¦å¤–ä¸€ä¸ªå˜é‡çš„å¼•ç”¨</li>
</ul>
<p>ä¸‹é¢æˆ‘æ¥ä¸€è¡Œè¡Œä»£ç åˆ†æäº§ç”Ÿè¿™ä¸ªé—®é¢˜çš„åŸå› ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$data</span> = [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¾ªç¯å¼€å§‹ï¼Œ$item å˜é‡ä¸å­˜åœ¨ï¼Œæ–°å»ºä¸€ä¸ª$item å˜é‡ï¼Œä¸”æ˜¯ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œå®ƒä¸æŒ‡å‘ä»»ä½•å˜é‡åœ°å€</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> &amp;<span class="variable">$item</span>) &#123;</span><br><span class="line">    <span class="comment">// loop 1: æ‰§è¡Œäº† $item = &amp;$data[0]ï¼›$item æŒ‡å‘ $data[0] çš„åœ°å€</span></span><br><span class="line">    <span class="comment">// loop 2: æ‰§è¡Œäº† $item = &amp;$data[1]ï¼›$item æŒ‡å‘ $data[1] çš„åœ°å€</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æç¤ºï¼šè¿™ä¸ªå¾ªç¯æ²¡æœ‰æ”¹å˜ $data çš„æ•°æ®ï¼Œåªæ˜¯ $item ä¾ç„¶æŒ‡å‘ç¬¬äºŒä¸ªå…ƒç´  çš„åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¾ªç¯å¼€å§‹ï¼Œ$item å˜é‡å­˜åœ¨ï¼Œä¸ä¼šæ–°å»ºå˜é‡</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$item</span>) &#123;</span><br><span class="line">    <span class="comment">// loop 1: æ‰§è¡Œäº† $item = $data[0]ï¼›$item æ‰€æŒ‡å‘çš„å˜é‡ï¼ˆå³ ç¬¬äºŒä¸ªå…ƒç´ ï¼‰çš„å€¼è¢«ä¿®æ”¹ä¸º$data[0]ï¼ˆå³&#x27;foo&#x27;ï¼‰ï¼Œè¿™é‡Œå·²ç»å¯¼è‡´äº†$data ä¸¤ä¸ªå…ƒç´ éƒ½ç­‰äº &#x27;foo&#x27;</span></span><br><span class="line">    <span class="comment">// loop 2: æ‰§è¡Œäº† $item = $data[1]ï¼›ç”±äº$item æŒ‡å‘çš„æ˜¯$data[1]ï¼Œå®é™…ä¸Šç›¸å½“äºæ‰§è¡Œ$data[1] = $data[1]ï¼Œæ²¡æœ‰ä»»ä½•æ„ä¹‰</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æœ€å$data ä¸­çš„ä¸¤ä¸ªå…ƒç´ éƒ½æ˜¯ &#x27;foo&#x27;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚ä½•é¿å…è¿™ä¸ªé—®é¢˜1ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> &amp;<span class="variable">$item</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯æ¬¡ loop é”€æ¯$item ï¼ˆå®é™…ä¸Šåªè¦åœ¨æœ€åä¸€æ¬¡ loop é”€æ¯å³å¯ï¼Œå› æ­¤ä½ å¯ä»¥æŠŠ unset å†™åˆ° foreach åé¢ï¼Œå°±æ˜¯ä¸æ˜¯å¾ˆå¥½çœ‹ï¼‰</span></span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$item</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä½•é¿å…è¿™ä¸ªé—®é¢˜2ï¼š</p>
<div class="note primary"><p>ä¸ä½¿ç”¨å¼•ç”¨</p>
</div>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>WSL2 + Docker + Laradock é…ç½®</title>
    <url>/WSL/WSL2+Docker+Laradock/</url>
    <content><![CDATA[<h2 id="ç³»ç»Ÿç¯å¢ƒä»‹ç»"><a href="#ç³»ç»Ÿç¯å¢ƒä»‹ç»" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒä»‹ç»"></a>ç³»ç»Ÿç¯å¢ƒä»‹ç»</h2><div class="note info"><p>Win 10 2004<br>WSL2(Ubuntu 20.04)<br>Docker 19.03.13</p>
</div>

<h2 id="å¯ç”¨-Linux-å­ç³»ç»Ÿ"><a href="#å¯ç”¨-Linux-å­ç³»ç»Ÿ" class="headerlink" title="å¯ç”¨ Linux å­ç³»ç»Ÿ"></a>å¯ç”¨ Linux å­ç³»ç»Ÿ</h2><p>æ‰“å¼€ <code>æ§åˆ¶é¢æ¿ -&gt; ç¨‹åº -&gt; å¯ç”¨æˆ–å…³é—­WindowsåŠŸèƒ½</code>ã€‚æ‰¾åˆ°<code>é€‚ç”¨äºLinuxçš„Windowså­ç³»ç»Ÿ</code>å’Œ<code>è™šæ‹Ÿæœºå¹³å°</code>ï¼Œå‹¾é€‰è¿™ä¸¤é¡¹ä¹‹åç¡®å®šï¼Œå¹¶é‡æ–°å¯åŠ¨è®¡ç®—æœºã€‚</p>
<h2 id="åˆ‡æ¢ç³»ç»Ÿ-WSL-é»˜è®¤ç‰ˆæœ¬åˆ°-2"><a href="#åˆ‡æ¢ç³»ç»Ÿ-WSL-é»˜è®¤ç‰ˆæœ¬åˆ°-2" class="headerlink" title="åˆ‡æ¢ç³»ç»Ÿ WSL é»˜è®¤ç‰ˆæœ¬åˆ° 2"></a>åˆ‡æ¢ç³»ç»Ÿ WSL é»˜è®¤ç‰ˆæœ¬åˆ° 2</h2><p>ä½¿ç”¨ç®¡ç†å‘˜ç”¨æˆ·æ‰“å¼€ <code>Windows PowerShell</code>ï¼Œè¿è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wsl --set-default-version 2</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹æç¤ºï¼š</p>
<div class="note warning"><p>WSL 2 éœ€è¦æ›´æ–°å…¶å†…æ ¸ç»„ä»¶ã€‚æœ‰å…³ä¿¡æ¯ï¼Œè¯·è®¿é—® <a href="https://aka.ms/wsl2kernel">https://aka.ms/wsl2kernel</a></p>
</div>

<p>å‡ºç°è¿™ä¸ªæç¤ºï¼Œè¯´æ˜éœ€è¦æ›´æ–° WSL2 çš„å†…æ ¸ã€‚æŒ‰ç…§æç¤ºæ‰“å¼€é“¾æ¥ã€‚ç‚¹å‡»ä¸‹å›¾ä¸­çš„ä¸‹è½½é“¾æ¥ï¼Œä¸‹è½½å¹¶å®‰è£… WSL2 å†…æ ¸ã€‚</p>
<p><img src="/images/WSL/WSL2+Docker+Laradock/72ab658461070fe25ee5e27.png"></p>
<span id="more"></span>

<h2 id="å®‰è£…-Ubuntu-å‘è¡Œç‰ˆ"><a href="#å®‰è£…-Ubuntu-å‘è¡Œç‰ˆ" class="headerlink" title="å®‰è£… Ubuntu å‘è¡Œç‰ˆ"></a>å®‰è£… Ubuntu å‘è¡Œç‰ˆ</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>æ‰“å¼€ <code>Microsoft Store</code>ï¼Œæœç´¢ Ubuntuï¼Œç•Œé¢å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="/images/WSL/WSL2+Docker+Laradock/1327b4d296971908b11e2d.png"></p>
<p>æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œé€‰æ‹©å¯¹åº”çš„ Ubuntu ç‰ˆæœ¬å¹¶å®‰è£…ã€‚<br>å®Œæˆä¹‹ååœ¨å¼€å§‹èœå•ä¼šå‡ºç° Ubuntu èœå•é¡¹ã€‚æ‰“å¼€å®ƒï¼ŒUbuntu å°†ä¼šè¿›è¡Œåˆå§‹åŒ–æ“ä½œã€‚ç­‰å¾…å‡ åˆ†é’ŸåæŒ‰ç…§æç¤ºï¼Œä¸º Ubuntu è®¾ç½®ç”¨æˆ·åå’Œå¯†ç ã€‚<br>æœ€åï¼Œæˆ‘ä»¬éœ€è¦éªŒè¯ Ubuntu æ˜¯å¦åœ¨ WSL2 çš„ç¯å¢ƒä¸‹å¯åŠ¨ã€‚ä»¥ç®¡ç†å‘˜ç”¨æˆ·æ‰“å¼€ <code>Windows PowerShell</code>ï¼Œæ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wsl -l -v</span><br></pre></td></tr></table></figure>

<p>å¦‚æœçœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">  NAME            STATE           VERSION</span><br><span class="line">* Ubuntu-20.04    Running         2</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜ Ubuntu åœ¨ WSL2 ç¯å¢ƒä¸‹è¿è¡Œã€‚åˆ°æ­¤ä¸ºæ­¢å®‰è£…å®Œæ¯•ã€‚<br>å¦‚æœå‘ç° VERSION ä¸º 1ï¼Œè¯´æ˜ Ubuntu è¿è¡Œåœ¨ WSL1 ä¸‹ã€‚éœ€è¦æ‰‹å·¥åˆ‡æ¢ã€‚<br>é¦–å…ˆå…³é—­ WSLä¸‹è¿è¡Œçš„ Linuxï¼Œæ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wsl --shutdown</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wsl --set-version &lt;Linuxå‘è¡Œç‰ˆåç§°&gt; 2</span><br><span class="line">è¿™è¾¹å°±æ˜¯è¾“å…¥ wsl --set-version Ubuntu-20.04 2</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>Linuxå‘è¡Œç‰ˆåç§°</code> ä¸ºå‰é¢å®‰è£…çš„ Linux åç§°ï¼Œå¯ä»¥é€šè¿‡ <code>wsl -l -v</code> å‘½ä»¤æŸ¥çœ‹ã€‚æ‰§è¡Œå‘½ä»¤åç­‰å¾…ç‰‡åˆ»ã€‚ç­‰å‘½ä»¤è¡Œæç¤ºè½¬æ¢å®Œæˆï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸå°† Linux åˆ‡æ¢åˆ° WSL2 ç¯å¢ƒã€‚</p>
<h3 id="systemctl-æ— æ³•ä½¿ç”¨çš„é—®é¢˜"><a href="#systemctl-æ— æ³•ä½¿ç”¨çš„é—®é¢˜" class="headerlink" title="systemctl æ— æ³•ä½¿ç”¨çš„é—®é¢˜"></a>systemctl æ— æ³•ä½¿ç”¨çš„é—®é¢˜</h3><p>WSL2 ç»è¿‡æµ‹è¯•æ— æ³•ä½¿ç”¨ <code>systemctl</code> å‘½ä»¤ï¼ŒæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">System has not been booted with systemd as init system (PID 1). Can<span class="string">&#x27;t operate.</span></span><br><span class="line"><span class="string">Failed to connect to bus: Host is down</span></span><br></pre></td></tr></table></figure>

<p>å‚è€ƒäº†<a href="https://forum.snapcraft.io/t/running-snaps-on-wsl2-insiders-only-for-now/13033">Running Snaps on WSL2 (Insiders only for now)</a> ä¹‹åç»™å‡ºå¦‚ä¸‹è§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li>å®‰è£… <code>daemonize</code> å’Œ <code>fontconfig</code></li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install -y fontconfig daemonize</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ç¼–è¾‘ <code>/etc/profile</code> è„šæœ¬ï¼ŒåŠ å…¥å¦‚ä¸‹å†…å®¹ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SYSTEMD_PID=$(ps -ef | grep <span class="string">&#x27;/lib/systemd/systemd --system-unit=basic.target$&#x27;</span> | grep -v unshare | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$SYSTEMD_PID</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">   sudo /usr/bin/daemonize /usr/bin/unshare --fork --pid --mount-proc /lib/systemd/systemd --system-unit=basic.target</span><br><span class="line">   SYSTEMD_PID=$(ps -ef | grep <span class="string">&#x27;/lib/systemd/systemd --system-unit=basic.target$&#x27;</span> | grep -v unshare | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$SYSTEMD_PID</span>&quot;</span> ] &amp;&amp; [ <span class="string">&quot;<span class="variable">$SYSTEMD_PID</span>&quot;</span> != <span class="string">&quot;1&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">exec</span> sudo /usr/bin/nsenter -t <span class="variable">$SYSTEMD_PID</span> -a su - <span class="variable">$LOGNAME</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ä¿®æ”¹ <code>/etc/sudoers</code> æ–‡ä»¶ï¼ŒåŠ å…¥å¦‚ä¸‹å†…å®¹ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">%sudo ALL=(ALL) NOPASSWD: /usr/sbin/daemonize /usr/bin/unshare --fork --pid --mount-proc /lib/systemd/systemd --system-unit=basic.target</span><br><span class="line">%sudo ALL=(ALL) NOPASSWD: /usr/bin/nsenter -t [0-9]* -a su - [a-zA-Z0-9]*</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>æ‰§è¡Œ <code>source /etc/profile</code> æˆ–è€…æ˜¯é‡æ–°æ‰“å¼€ <code>terminal</code>ï¼Œæ‰§è¡Œ <code>systemctl</code> éªŒè¯æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸æ“ä½œã€‚</li>
</ol>
<h3 id="å¼€å¯-ssh"><a href="#å¼€å¯-ssh" class="headerlink" title="å¼€å¯ ssh"></a>å¼€å¯ ssh</h3><ul>
<li>å¸è½½æ—§ ssh server</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt remove openssh-server</span><br></pre></td></tr></table></figure>

<ul>
<li>å®‰è£… ssh server</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt install openssh-server</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¿®æ”¹ ssh server é…ç½®</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Port 22 #é»˜è®¤å³å¯ï¼Œå¦‚æœæœ‰ç«¯å£å ç”¨å¯ä»¥è‡ªå·±ä¿®æ”¹</span><br><span class="line">PasswordAuthentication yesï¼ˆå…è®¸ç”¨æˆ·åå¯†ç æ–¹å¼ç™»å½•ï¼‰</span><br><span class="line">PermitRootLogin yes ï¼ˆå…è®¸rootç”¨æˆ·è¿œç¨‹ç™»å½•ï¼Œæœ‰éœ€è¦ root ç™»å½•å°±å¼€èµ·æ¥ï¼‰</span><br></pre></td></tr></table></figure>

<ul>
<li>é‡å¯æœåŠ¡</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo service ssh --full-restart</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿æ¥</li>
</ul>
<p><img src="/images/WSL/WSL2+Docker+Laradock/200d2ce9b2c039eed97770.png"></p>
<ul>
<li>è®¾ç½® ssh å¼€æœºè‡ªåŠ¨å¯åŠ¨</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¼€æœºè‡ªåŠ¨å¯åŠ¨sshå‘½ä»¤</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> ssh</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­sshå¼€æœºè‡ªåŠ¨å¯åŠ¨å‘½ä»¤</span></span><br><span class="line">sudo systemctl <span class="built_in">disable</span> ssh</span><br><span class="line"></span><br><span class="line"><span class="comment"># å•æ¬¡å¼€å¯ssh</span></span><br><span class="line">sudo systemctl start ssh</span><br><span class="line"></span><br><span class="line"><span class="comment"># å•æ¬¡å…³é—­ssh</span></span><br><span class="line">sudo systemctl stop ssh</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¥½åé‡å¯ç³»ç»Ÿ</span></span><br><span class="line">reboot</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹sshæ˜¯å¦å¯åŠ¨ï¼Œçœ‹åˆ°Active: active (running)å³è¡¨ç¤ºæˆåŠŸ</span></span><br><span class="line">sudo systemctl status ssh</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…-Docker-Desktop-in-Windows-10"><a href="#å®‰è£…-Docker-Desktop-in-Windows-10" class="headerlink" title="å®‰è£… Docker Desktop in Windows 10"></a>å®‰è£… Docker Desktop in Windows 10</h2><p>å®˜ç½‘ï¼š<a href="https://www.docker.com/products/Docker-desktop">https://www.Docker.com/products/Docker-desktop</a></p>
<p>ç°åœ¨ <code>Docker Desktop Windows</code> ç‰ˆå·²ç»èƒ½å¤Ÿæ”¯æŒ WSL ä½œä¸º Docker Engine è¿è¡Œï¼Œå¯ä»¥åŒæ—¶æ”¯æŒåœ¨ Linux å’Œ Windows å‘½ä»¤è¡Œä¸‹æ“ä½œ Dockerã€‚</p>
<ul>
<li>ç¡®ä¿ Ubuntu å†…çš„ Docker å·²ç»å¸è½½ï¼Œå¦‚æœæ²¡æœ‰å¸è½½ï¼Œå¯ä»¥æ‰§è¡Œï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt remove docker-ce</span><br><span class="line">sudo apt remove docker-ce-cli</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šå¦‚æœå‘ç°åœ¨ Ubuntu å†…æ— æ³•æ‰§è¡Œ <code>docker</code> å‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ“ä½œæ‰“å¼€ï¼š<br>è¿›å…¥ Docker Desktop çš„ settingsï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="/images/WSL/WSL2+Docker+Laradock/6ed5b7509e226ff601af04fc.png"></p>
<p>ä¿å­˜ä¸‹ï¼Œå³å¯åœ¨ Ubuntu å†…ç›´æ¥ä½¿ç”¨ <code>docker</code> å‘½ä»¤ã€‚</p>
<h2 id="è¿ç§»-WSL-åˆ°éç³»ç»Ÿç›˜"><a href="#è¿ç§»-WSL-åˆ°éç³»ç»Ÿç›˜" class="headerlink" title="è¿ç§» WSL åˆ°éç³»ç»Ÿç›˜"></a>è¿ç§» WSL åˆ°éç³»ç»Ÿç›˜</h2><p>é»˜è®¤ WSL æ€»æ˜¯å®‰è£…åˆ° C ç›˜ï¼Œè¿™æ ·å¯¹äºCç›˜ç©ºé—´ç´§å¼ çš„ç”¨æˆ·å®Œå…¨ä¸å‹å¥½ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>LxRunOffline</code> å·¥å…·æ¥è¿ç§»WSLåˆ°å…¶ä»–ç£ç›˜åˆ†åŒºã€‚</p>
<p><code>LxRunOffline</code> çš„<a href="https://github.com/DDoSolitary/LxRunOffline/releases">ä¸‹è½½é“¾æ¥</a>ã€‚åœ¨ Windows PowerShell è¿è¡Œéœ€è¦ä¸‹è½½ <code>LxRunOffline-vx.x.x-msvc.zip</code> ç‰ˆæœ¬ã€‚è§£å‹åˆ°ä»»æ„ç›®å½•å³å¯ä½¿ç”¨ã€‚</p>
<blockquote>
<p><code>LxRunOffline</code> æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹ WSL Linux å‘è¡Œç‰ˆç®¡ç†å·¥å…·ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ WSL å‘½ä»¤çš„å¢å¼ºç‰ˆã€‚å®ƒå¯ä»¥å®‰è£…å’Œå¸è½½ Linux å‘è¡Œç‰ˆï¼Œè¿ç§»ï¼Œå¤åˆ¶ï¼Œå¯¼å…¥å¯¼å‡ºå’Œè®¾ç½®ç¯å¢ƒå˜é‡ç­‰ã€‚å…·ä½“çš„ä½¿ç”¨å¸®åŠ©å¯æ‰§è¡Œ <code>.\LxRunOffline.exe \h</code> æŸ¥çœ‹å‘½ä»¤ä»‹ç»ã€‚</p>
</blockquote>
<p>è¿ç§»è¿‡ç¨‹åˆ†ä¸º3æ­¥ï¼š</p>
<ol>
<li>è·å–å‡†å¤‡è¿ç§»çš„å‘è¡Œç‰ˆåç§°ã€‚æ‰§è¡Œï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PS C:\Users\xxx\Desktop&gt; .\LxRunOffline.exe list</span><br><span class="line">Ubuntu-20.04</span><br></pre></td></tr></table></figure>

<p>è·å–ç³»ç»Ÿå½“å‰å·²å®‰è£…çš„å‘è¡Œç‰ˆã€‚ä¾‹å­ä¸­è¿”å›çš„å‘è¡Œç‰ˆåç§°ä¸º <code>Ubuntu-20.04</code></p>
<ol start="2">
<li>æ‰§è¡Œè¿ç§»å‘½ä»¤ã€‚æ ¼å¼å¦‚ä¸‹ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.\LxRunOffline.exe m -n &lt;å‘è¡Œç‰ˆåç§°&gt; -d &lt;ç›®æ ‡è·¯å¾„&gt;</span><br></pre></td></tr></table></figure>

<p>æ¯”å¦‚æˆ‘ä»¬è¦å°† <code>Ubuntu-20.04</code> ç§»åŠ¨åˆ° <code>D:\wsl\Ubuntu-20.04</code>(è¦ç¡®ä¿ D:\wsl ç›®å½•å­˜åœ¨)ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.\LxRunOffline.exe m -n Ubuntu-20.04 -d D:\wsl\Ubuntu-20.04</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ Ubuntu æ­£åœ¨è¿è¡Œï¼Œéœ€è¦å…ˆå…³é—­åœ¨è¿›è¡Œè¿ç§»ï¼Œå…³é—­å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PS C:\Users\xxx\Desktop&gt; wsl --shutdown</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨å‘½ä»¤ä¸º wsl -d Ubuntu-20.04</span></span><br></pre></td></tr></table></figure>

<p>ç­‰å¾…å‘½ä»¤æ‰§è¡Œå®Œæ¯•è¿”å›ã€‚</p>
<ol start="3">
<li>æŸ¥çœ‹è¿ç§»åå‘è¡Œç‰ˆçš„å®‰è£…è·¯å¾„ã€‚æ‰§è¡Œï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PS C:\Users\xxx\Desktop&gt; .\LxRunOffline.exe di -n Ubuntu-20.04</span><br><span class="line">D:\wsl\Ubuntu-20.04</span><br></pre></td></tr></table></figure>

<p>è¿”å›çš„å®‰è£…ä½ç½®æ˜¯ <code>D:\wsl\Ubuntu-20.04</code>ï¼Œè¯´æ˜è¿ç§»æˆåŠŸã€‚</p>
<h2 id="æ–‡ä»¶ç³»ç»Ÿç›¸äº’è®¿é—®"><a href="#æ–‡ä»¶ç³»ç»Ÿç›¸äº’è®¿é—®" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿç›¸äº’è®¿é—®"></a>æ–‡ä»¶ç³»ç»Ÿç›¸äº’è®¿é—®</h2><h3 id="åœ¨-Win10-ä¸‹è®¿é—®-Linux-å­ç³»ç»Ÿæ–‡ä»¶"><a href="#åœ¨-Win10-ä¸‹è®¿é—®-Linux-å­ç³»ç»Ÿæ–‡ä»¶" class="headerlink" title="åœ¨ Win10 ä¸‹è®¿é—® Linux å­ç³»ç»Ÿæ–‡ä»¶"></a>åœ¨ Win10 ä¸‹è®¿é—® Linux å­ç³»ç»Ÿæ–‡ä»¶</h3><p>è¿›å…¥ <code>CMD</code> æˆ–è€… <code>Windows PowerShell</code>ï¼Œè¾“å…¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> \\wsl$\Ubuntu-20.04\</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥è¿›å…¥åˆ° Linux å­ç³»ç»Ÿæ ¹ç›®å½•ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/images/WSL/WSL2+Docker+Laradock/c1d97508855edd74660c4.png"></p>
<p>æˆ–è€…æ‰“å¼€æ–‡ä»¶èµ„æºç®¡ç†å™¨ï¼Œåœ¨åœ°å€æ è¾“å…¥ <code>\\wsl$\Ubuntu-20.04</code>ï¼Œä¹Ÿå¯ä»¥è·³è½¬åˆ° Linux å­ç³»ç»Ÿæ ¹ç›®å½•ã€‚</p>
<p><img src="/images/WSL/WSL2+Docker+Laradock/b35aa3e075c9c062cf121ae7d5.png"></p>
<p>æˆ–è€…åœ¨ Linux å­ç³»ç»Ÿä¸­ï¼Œè¾“å…¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">explorer.exe .</span><br></pre></td></tr></table></figure>

<p>ä¼šè‡ªåŠ¨æ‰“å¼€Linux å­ç³»ç»Ÿç›®å½•ã€‚</p>
<h3 id="Linux-å­ç³»ç»Ÿè®¿é—®-Win10-æ–‡ä»¶"><a href="#Linux-å­ç³»ç»Ÿè®¿é—®-Win10-æ–‡ä»¶" class="headerlink" title="Linux å­ç³»ç»Ÿè®¿é—® Win10 æ–‡ä»¶"></a>Linux å­ç³»ç»Ÿè®¿é—® Win10 æ–‡ä»¶</h3><p>è¿›å…¥Linuxå­ç³»ç»Ÿè¿è¡Œ <code>df -h</code>ï¼Œçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p>
<p><img src="/images/WSL/WSL2+Docker+Laradock/bab99324dd79668c4ff76.png"></p>
<p>æ³¨æ„è§‚å¯Ÿåä¸¤è¡Œã€‚æœ¬äººç”µè„‘æœ‰ä¸¤ä¸ªåˆ†åŒºã€‚<code>/mnt/c</code> å’Œ <code>/mnt/d</code> æ­£å¥½åˆ†åˆ«å¯¹åº”æœ¬æœºçš„Cç›˜å’ŒDç›˜ã€‚</p>
<h2 id="Laradock"><a href="#Laradock" class="headerlink" title="Laradock"></a>Laradock</h2><h3 id="ä¸‹è½½-Laradockï¼Œåœ¨-Ubuntu-é‡Œè¿è¡Œï¼š"><a href="#ä¸‹è½½-Laradockï¼Œåœ¨-Ubuntu-é‡Œè¿è¡Œï¼š" class="headerlink" title="ä¸‹è½½ Laradockï¼Œåœ¨ Ubuntu é‡Œè¿è¡Œï¼š"></a>ä¸‹è½½ Laradockï¼Œåœ¨ Ubuntu é‡Œè¿è¡Œï¼š</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /www <span class="comment"># ç›®å½•è‡ªå·±éšæ„</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/laradock/laradock.git</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥ <code>./laradock</code> ç›®å½•ï¼Œå°† <code>env-example</code> å¤åˆ¶ä¸º <code>.env</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> laradock/</span><br><span class="line"><span class="built_in">cp</span> env-example .<span class="built_in">env</span></span><br></pre></td></tr></table></figure>

<p><code>.env</code> æ–‡ä»¶ä¸­éƒ¨åˆ†éœ€è¦æ³¨æ„çš„å˜é‡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># è¿™ä¸ªå˜é‡é€šå¸¸é»˜è®¤å°±è¡Œï¼Œæœ€åæ­¤æ—¶çš„é¡¹ç›®ç›®å½•ä¼šæ˜ å°„åˆ° workspace å®¹å™¨çš„ `/var/www/` ç›®å½•ä¸­</span><br><span class="line">APP_CODE_PATH_HOST=../</span><br><span class="line"></span><br><span class="line"># åƒmysqlç­‰éœ€è¦volumeçš„æ•°æ®ä¼šå­˜æ”¾åœ¨å®¿ä¸»æœºä¸­çš„ä½ç½®ï¼Œå¦‚æœæœ‰éœ€è¦å¯ä»¥ä¿®æ”¹ä¸€ä¸‹</span><br><span class="line">DATA_PATH_HOST=~/.laradock/data</span><br><span class="line"></span><br><span class="line"># phpç‰ˆæœ¬ï¼ˆ7.4 - 7.3 - 7.2 - 7.1 - 7.0 - 5.6ï¼‰</span><br><span class="line">PHP_VERSION=7.4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### MYSQL #################################################</span><br><span class="line"># mysqlç‰ˆæœ¬ï¼Œé»˜è®¤æ˜¯lastestï¼Œæ ¹æ®éœ€è¦ä¿®æ”¹</span><br><span class="line">MYSQL_VERSION=5.7</span><br><span class="line"># é»˜è®¤æ•°æ®åº“åå­—</span><br><span class="line">MYSQL_DATABASE=laravel</span><br><span class="line"># æ•°æ®åº“ç”¨æˆ·å</span><br><span class="line">MYSQL_USER=default</span><br><span class="line"># æ•°æ®åº“ç”¨æˆ·å¯†ç </span><br><span class="line">MYSQL_PASSWORD=secret</span><br><span class="line"># æ•°æ®åº“ç«¯å£</span><br><span class="line">MYSQL_PORT=3306</span><br><span class="line"># æ•°æ®åº“rootç”¨æˆ·çš„å¯†ç </span><br><span class="line">MYSQL_ROOT_PASSWORD=root</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æ›´æ¢ä¸­å›½é•œåƒæºï¼Œæ”¹ä¸ºtrue</span><br><span class="line">CHANGE_SOURCE=true</span><br><span class="line"># ä¸Šé¢ `CHANGE_SOURCE` æ”¹ä¸º`true`ä¹‹åï¼Œå°±ä¼šæ›´æ¢ä¸ºaliyuné•œåƒæº</span><br><span class="line">UBUNTU_SOURCE=aliyun</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### WORKSPACE #############################################</span><br><span class="line"># å°†comoseræ›´æ¢ä¸ºé˜¿é‡Œé•œåƒæºï¼ˆæ›´æ”¹ä¸ºå…¶ä»–å›½å†…é•œåƒæºä¹Ÿå¯ä»¥ï¼Œå¦åˆ™é€Ÿåº¦ä¸ç¨³å®šï¼‰</span><br><span class="line">WORKSPACE_COMPOSER_REPO_PACKAGIST=https://mirrors.aliyun.com/composer/</span><br><span class="line"># è®¾ç½®NVMå®‰è£…nodeçš„æ·˜å®é•œåƒæº</span><br><span class="line">WORKSPACE_NVM_NODEJS_ORG_MIRROR=https://npm.taobao.org/mirrors/node</span><br><span class="line"># è®¾ç½®nodeçš„æ·˜å®çš„registry</span><br><span class="line">WORKSPACE_NPM_REGISTRY=https://registry.npm.taobao.org/</span><br><span class="line"># æ—¶é—´æ”¹ä¸ºPRC</span><br><span class="line">WORKSPACE_TIMEZONE=PRC</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸éœ€è¦ nodeï¼Œå¯ä»¥å°†ä»¥ä¸‹é…ç½®æ”¹ä¸º falseï¼Œä¸Šé¢çš„ node æ·˜å®é•œåƒæºå°±ä¸éœ€è¦é…ç½®äº†</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WORKSPACE_INSTALL_NODE=false</span><br><span class="line">WORKSPACE_INSTALL_YARN=false</span><br><span class="line">WORKSPACE_INSTALL_NPM_GULP=false</span><br><span class="line">WORKSPACE_INSTALL_NPM_BOWER=false</span><br><span class="line">WORKSPACE_INSTALL_NPM_VUE_CLI=false</span><br><span class="line">WORKSPACE_INSTALL_NPM_ANGULAR_CLI=false</span><br></pre></td></tr></table></figure>

<h3 id="æ„å»ºå¹¶å¯åŠ¨-Docker-å®¹å™¨"><a href="#æ„å»ºå¹¶å¯åŠ¨-Docker-å®¹å™¨" class="headerlink" title="æ„å»ºå¹¶å¯åŠ¨ Docker å®¹å™¨"></a>æ„å»ºå¹¶å¯åŠ¨ Docker å®¹å™¨</h3><div class="note default"><p>è¦åœ¨ .&#x2F;laradock ç›®å½•ä¸‹ æ‰§è¡Œå‘½ä»¤</p>
</div>

<p>é»˜è®¤ä¼šå¯åŠ¨ <code>workspace</code>ã€<code>php-fpm</code> å’Œ <code>composer</code> ç­‰ï¼Œéƒ½ä¼šè‡ªåŠ¨é…ç½®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose up -d nginx mysql</span><br></pre></td></tr></table></figure>

<div class="note success"><p>æ¯æ¬¡æ‰“ <code>docker-compose</code> å‘½ä»¤å¤ªé•¿äº†ï¼Œè¿™è¾¹è®¾ç½®ä¸ª <code>dc</code> åˆ«åï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim  ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ åˆ«åï¼š<code>alias dc=&#39;docker-compose&#39;</code></p>
<p>ä¿å­˜é€€å‡ºï¼Œç„¶åæ‰§è¡Œå‘½ä»¤ï¼š<code>source ~/.bashrc</code></p>
</div>

<p>æ„å»ºå®Œæˆåï¼Œè¿›å…¥ workspaceï¼Œå®‰è£… Laravel æ¡†æ¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥workspaceå®¹å™¨</span></span><br><span class="line">$ dc <span class="built_in">exec</span> workspace bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨å®¹å™¨ä¸­æ‰§è¡Œcomposerå‘½ä»¤å°†Laravelæ¡†æ¶å®‰è£…åœ¨ ./laravel ç›®å½•ä¸­</span></span><br><span class="line">root@b0cf8f8333e4:/var/www<span class="comment"># composer create-project --prefer-dist laravel/laravel laravel</span></span><br></pre></td></tr></table></figure>

<p>é…ç½® nginx ç«™ç‚¹ï¼š<code>./laradock/nginx/sites/</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> laravel.conf.example laravel.conf</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ <code>laravel.conf</code> é…ç½®ï¼š</p>
<p><img src="/images/WSL/WSL2+Docker+Laradock/ef5861f77083d6f5c2a25.png"></p>
<p>é‡å¯ nginx å®¹å™¨ï¼Œä½¿ç«™ç‚¹é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dc restart nginx</span><br><span class="line">æˆ–è€…</span><br><span class="line">dc <span class="built_in">exec</span> nginx nginx -s reload</span><br></pre></td></tr></table></figure>

<p>åœ¨ <strong>Win10 hosts æ–‡ä»¶</strong> ä¸­åŠ å…¥å¯¹åº”çš„ ip å’ŒåŸŸåï¼Œå³å¯è®¿é—®ã€‚</p>
<p><img src="/images/WSL/WSL2+Docker+Laradock/a003d1980439b74f569cda3ff6.png"></p>
<p>å‡ºç°è¿™ä¸ªé”™è¯¯ï¼Œè¯´æ˜ç›®å½•æ²¡æœ‰æƒé™ï¼Œéœ€è¦æ›´æ”¹ç›®å½•æƒé™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R www-data:www-data /var/www/laravel</span><br><span class="line">é¡¹ç›®ç›®å½•çš„ storage æ–‡ä»¶å¤¹æ²¡æœ‰å†™å…¥æƒé™ã€‚åœ¨é¡¹ç›®ç›®å½•æ‰§è¡Œ <span class="built_in">chmod</span> -R 777 storage</span><br></pre></td></tr></table></figure>

<h3 id="Laravel-ä¸­æ•°æ®åº“é…ç½®ï¼š-laravel-env"><a href="#Laravel-ä¸­æ•°æ®åº“é…ç½®ï¼š-laravel-env" class="headerlink" title="Laravel ä¸­æ•°æ®åº“é…ç½®ï¼š./laravel/.env"></a>Laravel ä¸­æ•°æ®åº“é…ç½®ï¼š<code>./laravel/.env</code></h3><blockquote>
<p>laradock çš„ mysql å®¹å™¨ä¸æ˜¯ä»¥ ip åœ°å€è¿æ¥çš„ï¼Œè€Œæ˜¯ä»¥ mysql æ ‡ç­¾åè¿æ¥çš„æ‰€ä»¥ .&#x2F;laravel&#x2F;.env ä¸­å…³äº DB_HOST çš„å€¼ä¸æ˜¯ ip åœ°å€ï¼Œè€Œæ˜¯ mysql è¿™ä¸ªå•è¯</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DB_CONNECTION=mysql</span><br><span class="line">DB_HOST=mysql</span><br><span class="line">DB_PORT=3306</span><br><span class="line">DB_DATABASE=laravel</span><br><span class="line">DB_USERNAME=root</span><br><span class="line">DB_PASSWORD=root</span><br></pre></td></tr></table></figure>

<h3 id="å…³äº-mysql-æ•°æ®åº“ç®¡ç†å·¥å…·"><a href="#å…³äº-mysql-æ•°æ®åº“ç®¡ç†å·¥å…·" class="headerlink" title="å…³äº mysql æ•°æ®åº“ç®¡ç†å·¥å…·"></a>å…³äº mysql æ•°æ®åº“ç®¡ç†å·¥å…·</h3><ul>
<li>é€”å¾„ä¸€ï¼šé€šè¿‡ phpmyadmin</li>
</ul>
<p>workspace å ç”¨ç€ 8080 ç«¯å£ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹ <code>./laradock/.env</code> ä¸­çš„ç«¯å£</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># æŠŠphpmyadminé»˜è®¤çš„8080æ”¹ä¸ºä¸è¢«å ç”¨çš„ç«¯å£</span><br><span class="line">PMA_PORT=8081</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨ phpmyadmin</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dc up -d phpmyadmin</span><br></pre></td></tr></table></figure>

<p>æµè§ˆå™¨ç½‘å€ï¼š<code>localhost:8081</code></p>
<p><img src="/images/WSL/WSL2+Docker+Laradock/bb86447b7020a080ece5cfc0a0cd1467.png"></p>
<div class="note warning"><p>å¦‚æœç”¨æˆ·åï¼šrootï¼Œå¯†ç ï¼šroot å¹¶ä¸èƒ½æ­£å¸¸ç™»å½• phpmyadmin</p>
</div>

<p>è¿™æ˜¯ PHP7 å’Œ MySQL8 çš„ authentication æ–¹æ³•ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œé‡æ–°ä¿®æ”¹ç”¨æˆ·åå¯†ç å³å¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;root&#x27;;</span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;root&#x27;;</span><br><span class="line">ALTER USER &#x27;default&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;secret&#x27;;</span><br></pre></td></tr></table></figure>

<p>å›åˆ° phpmyadmin ä¸­ï¼Œä½¿ç”¨ host: mysql, user: root, password: root å°±å¯ä»¥æ­£å¸¸ç™»å½•äº†</p>
<ul>
<li>é€”å¾„äºŒï¼šé€šè¿‡ adminer</li>
</ul>
<p>ä¿®æ”¹ <code>./laradock/.env</code> ä¸­çš„ç«¯å£</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># æŠŠadmineré»˜è®¤çš„8080æ”¹ä¸ºä¸è¢«å ç”¨çš„ç«¯å£</span><br><span class="line">ADM_PORT=8082</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨ adminer</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dc up -d adminer</span><br></pre></td></tr></table></figure>

<p>æµè§ˆå™¨ç½‘å€ï¼š<code>localhost:8082</code></p>
<p><img src="/images/WSL/WSL2+Docker+Laradock/fec42f8e94bef61b14a6ce.png"></p>
<ul>
<li>é€”å¾„ä¸‰ï¼šé€šè¿‡å®¿ä¸»æœºæ•°æ®åº“ç®¡ç†å·¥å…·ç®¡ç†</li>
</ul>
<p>ä¿®æ”¹ <code>./laradock/.env</code> ä¸­ mysql å®¢æˆ·ç«¯ç«¯å£å·</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">MYSQL_PORT=3308</span><br></pre></td></tr></table></figure>

<p><img src="/images/WSL/WSL2+Docker+Laradock/b8cd1be2af0c5eb55946633.png"></p>
<p>è‡³æ­¤ï¼ŒåŸºæœ¬çš„é…ç½®å’Œå®‰è£…éƒ½ç»“æŸäº†ã€‚</p>
<h2 id="WSL2-çš„ä¸€äº›ç½‘ç»œè®¿é—®é—®é¢˜"><a href="#WSL2-çš„ä¸€äº›ç½‘ç»œè®¿é—®é—®é¢˜" class="headerlink" title="WSL2 çš„ä¸€äº›ç½‘ç»œè®¿é—®é—®é¢˜"></a>WSL2 çš„ä¸€äº›ç½‘ç»œè®¿é—®é—®é¢˜</h2><p>å‚è€ƒæ­¤<a href="https://lengthmin.me/posts/wsl2-network-tricks/">é“¾æ¥</a></p>
]]></content>
      <categories>
        <category>WSL</category>
      </categories>
      <tags>
        <tag>WSL2</tag>
        <tag>Docker</tag>
        <tag>Laradock</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP7ä¸­çš„å¼‚å¸¸ä¸é”™è¯¯å¤„ç†</title>
    <url>/PHP/throwable-exceptions-and-errors-in-php7/</url>
    <content><![CDATA[<h2 id="PHP-ä¸­çš„-Exception-Error-Throwable"><a href="#PHP-ä¸­çš„-Exception-Error-Throwable" class="headerlink" title="PHP ä¸­çš„ Exception, Error, Throwable"></a>PHP ä¸­çš„ Exception, Error, Throwable</h2><ul>
<li>PHP ä¸­å°†ä»£ç è‡ªèº«å¼‚å¸¸(ä¸€èˆ¬æ˜¯ç¯å¢ƒæˆ–è€…è¯­æ³•éæ³•æ‰€è‡´)ç§°ä½œé”™è¯¯ <code>Error</code>ï¼Œå°†è¿è¡Œä¸­å‡ºç°çš„é€»è¾‘é”™è¯¯ç§°ä¸ºå¼‚å¸¸ <code>Exception</code></li>
<li>é”™è¯¯æ˜¯æ²¡æ³•é€šè¿‡ä»£ç å¤„ç†çš„ï¼Œè€Œå¼‚å¸¸åˆ™å¯ä»¥é€šè¿‡ <code>try/catch</code> æ¥å¤„ç†</li>
<li>PHP7 ä¸­å‡ºç°äº† <code>Throwable</code> æ¥å£ï¼Œè¯¥æ¥å£ç”± <code>Error</code> å’Œ <code>Exception</code> å®ç°ï¼Œç”¨æˆ·ä¸èƒ½ç›´æ¥å®ç° <code>Throwable</code> æ¥å£ï¼Œè€Œåªèƒ½é€šè¿‡ç»§æ‰¿ <code>Exception</code> æ¥å®ç°æ¥å£</li>
</ul>
<h2 id="PHP7-å¼‚å¸¸å¤„ç†æœºåˆ¶"><a href="#PHP7-å¼‚å¸¸å¤„ç†æœºåˆ¶" class="headerlink" title="PHP7 å¼‚å¸¸å¤„ç†æœºåˆ¶"></a>PHP7 å¼‚å¸¸å¤„ç†æœºåˆ¶</h2><p>è¿‡å»çš„ PHPï¼Œå¤„ç†è‡´å‘½é”™è¯¯å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚è‡´å‘½é”™è¯¯ä¸ä¼šè°ƒç”¨ç”± <code>set_error_handler()</code> è®¾ç½®çš„å¤„ç†æ–¹å¼ï¼Œè€Œæ˜¯ç®€å•çš„åœæ­¢è„šæœ¬çš„æ‰§è¡Œã€‚</p>
<p>åœ¨ PHP7 ä¸­ï¼Œå½“è‡´å‘½é”™è¯¯å’Œå¯æ•è·çš„é”™è¯¯(<code>E_ERROR</code> å’Œ <code>E_RECOVERABLE_ERROR</code>)å‘ç”Ÿæ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¸æ˜¯ç›´æ¥åœæ­¢è„šæœ¬çš„è¿è¡Œã€‚å¯¹äºæŸäº›æƒ…å†µï¼Œæ¯”å¦‚å†…å­˜æº¢å‡ºï¼Œè‡´å‘½é”™è¯¯åˆ™ä»ç„¶åƒä¹‹å‰ä¸€æ ·ç›´æ¥åœæ­¢è„šæœ¬æ‰§è¡Œã€‚åœ¨ PHP7 ä¸­ï¼Œ<strong>ä¸€ä¸ªæœªæ•è·çš„å¼‚å¸¸ä¹Ÿä¼šæ˜¯ä¸€ä¸ªè‡´å‘½é”™è¯¯</strong>ã€‚è¿™æ„å‘³ç€åœ¨ PHP5.x ä¸­è‡´å‘½é”™è¯¯æŠ›å‡ºçš„å¼‚å¸¸æœªæ•è·ï¼Œåœ¨ PHP7 ä¸­ä¹Ÿæ˜¯è‡´å‘½é”™è¯¯ã€‚</p>
<div class="note danger"><p>æ³¨æ„ï¼šå…¶ä»–çº§åˆ«çš„é”™è¯¯å¦‚ <code>warning</code> å’Œ <code>notice</code>ï¼Œå’Œä¹‹å‰ä¸€æ ·ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œåªæœ‰ <code>fatal</code> å’Œ <code>recoverable</code> çº§åˆ«çš„é”™è¯¯ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
</div>

<span id="more"></span>

<p>ä» <code>fatal</code> å’Œ <code>recoverable</code> çº§åˆ«é”™è¯¯æŠ›å‡ºçš„å¼‚å¸¸å¹¶éç»§æ‰¿è‡ª <code>Exception</code> ç±»ã€‚è¿™ç§åˆ†ç¦»æ˜¯ä¸ºäº†é˜²æ­¢ç°æœ‰ PHP5.x çš„ç”¨äºåœæ­¢è„šæœ¬è¿è¡Œçš„ä»£ç ä¹Ÿæ•è·åˆ°é”™è¯¯æŠ›å‡ºçš„å¼‚å¸¸ã€‚<code>fatal</code> å’Œ <code>recoverable</code> çº§åˆ«çš„é”™è¯¯æŠ›å‡ºçš„å¼‚å¸¸æ˜¯ä¸€ä¸ªå…¨æ–°åˆ†ç¦»å‡ºæ¥çš„ç±» <code>Error</code> ç±»çš„å®ä¾‹ã€‚è·Ÿå…¶ä»–å¼‚å¸¸ä¸€æ ·ï¼Œ<code>Error</code> ç±»å¼‚å¸¸ä¹Ÿèƒ½è¢«æ•è·å’Œå¤„ç†ï¼ŒåŒæ ·å…è®¸åœ¨ <code>finally</code> ä¹‹ç±»çš„å—ç»“æ„ä¸­è¿è¡Œã€‚</p>
<h2 id="Throwable"><a href="#Throwable" class="headerlink" title="Throwable"></a>Throwable</h2><p>ä¸ºäº†ç»Ÿä¸€ä¸¤ä¸ªå¼‚å¸¸åˆ†æ”¯ï¼Œ<code>Exception</code> å’Œ <code>Error</code> éƒ½å®ç°äº†ä¸€ä¸ªå…¨æ–°çš„æ¥å£ï¼š<code>Throwable</code></p>
<p>PHP7 ä¸­æ–°çš„å¼‚å¸¸ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">interface Throwable</span><br><span class="line">    |- Exception implements Throwable</span><br><span class="line">        |- ...</span><br><span class="line">    |- Error implements Throwable</span><br><span class="line">        |- TypeError extends Error</span><br><span class="line">        |- ParseError extends Error</span><br><span class="line">        |- ArithmeticError extends Error</span><br><span class="line">            |- DivisionByZeroError extends ArithmeticError</span><br><span class="line">        |- AssertionError extends Error</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåœ¨ PHP7 çš„ä»£ç ä¸­å®šä¹‰äº† <code>Throwable</code> ç±»ï¼Œå®ƒå°†ä¼šæ˜¯å¦‚ä¸‹è¿™æ ·ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Throwable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getMessage</span>(<span class="params"></span>): <span class="title">string</span></span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCode</span>(<span class="params"></span>): <span class="title">int</span></span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFile</span>(<span class="params"></span>): <span class="title">string</span></span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getLine</span>(<span class="params"></span>): <span class="title">int</span></span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getTrace</span>(<span class="params"></span>): <span class="title">array</span></span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getTraceAsString</span>(<span class="params"></span>): <span class="title">string</span></span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPrevious</span>(<span class="params"></span>): <span class="title">Throwable</span></span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>): <span class="title">string</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ¥å£çœ‹èµ·æ¥å¾ˆç†Ÿæ‚‰ã€‚<code>Throwable</code> è§„å®šçš„æ–¹æ³•è·Ÿ <code>Exception</code> å‡ ä¹æ˜¯ä¸€æ ·çš„ã€‚å”¯ä¸€ä¸åŒçš„æ˜¯ <code>Throwable::getPrevious()</code> è¿”å›çš„æ˜¯ <code>Throwable</code> çš„å®ä¾‹è€Œä¸æ˜¯ <code>Exception</code> çš„ã€‚<code>Exception</code> å’Œ <code>Error</code> çš„æ„é€ å‡½æ•°è·Ÿä¹‹å‰ <code>Exception</code> ä¸€æ ·ï¼Œå¯ä»¥æ¥å—ä»»ä½• <code>Throwable</code> çš„å®ä¾‹ã€‚<br><code>Throwable</code> å¯ä»¥ç”¨äº <code>try/catch</code> å—ä¸­æ•è· <code>Exception</code> å’Œ <code>Error</code> å¯¹è±¡(æˆ–æ˜¯ä»»ä½•æœªæ¥å¯èƒ½çš„å¼‚å¸¸ç±»å‹)ã€‚è®°ä½æ•è·æ›´å¤šç‰¹å®šç±»å‹çš„å¼‚å¸¸å¹¶ä¸”å¯¹ä¹‹åšç›¸åº”çš„å¤„ç†æ˜¯æ›´å¥½çš„å®è·µã€‚ç„¶è€Œåœ¨æŸç§æƒ…å†µä¸‹æˆ‘ä»¬æƒ³æ•è·ä»»ä½•ç±»å‹çš„å¼‚å¸¸(æ¯”å¦‚æ—¥å¿—æˆ–æ¡†æ¶ä¸­é”™è¯¯å¤„ç†)ã€‚**åœ¨ PHP7 ä¸­ï¼Œè¦æ•è·æ‰€æœ‰çš„åº”è¯¥ä½¿ç”¨ <code>Throwable</code> è€Œä¸æ˜¯ <code>Exception</code>**ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// Code that may throw an Exception or Error.</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="built_in">Throwable</span> <span class="variable">$t</span>) &#123;</span><br><span class="line"><span class="comment">// Handle exception</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·å®šä¹‰çš„ç±»ä¸èƒ½å®ç° <code>Throwable</code> æ¥å£ã€‚åšå‡ºè¿™ä¸ªå†³å®šä¸€å®šç¨‹åº¦ä¸Šæ˜¯ä¸ºäº†é¢„æµ‹æ€§å’Œä¸€è‡´æ€§â€”â€”åªæœ‰ <code>Exception</code> å’Œ <code>Error</code> çš„å¯¹è±¡å¯ä»¥è¢«æŠ›å‡ºã€‚æ­¤å¤–ï¼Œå¼‚å¸¸éœ€è¦æºå¸¦å¯¹è±¡åœ¨è¿½æº¯å †æ ˆä¸­åˆ›å»ºä½ç½®çš„ä¿¡æ¯ï¼Œè€Œç”¨æˆ·å®šä¹‰çš„å¯¹è±¡ä¸ä¼šè‡ªåŠ¨çš„æœ‰å‚æ•°æ¥å­˜å‚¨è¿™äº›ä¿¡æ¯ã€‚<br><code>Throwable</code> å¯ä»¥è¢«ç»§æ‰¿ä»è€Œåˆ›å»ºç‰¹å®šçš„åŒ…æ¥å£æˆ–è€…æ·»åŠ é¢å¤–çš„æ–¹æ³•ã€‚ä¸€ä¸ªç»§æ‰¿è‡ª <code>Throwable</code> çš„æ¥å£åªèƒ½è¢« <code>Exception</code> æˆ– <code>Error</code> çš„å­ç±»æ¥å®ç°ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MyPackageThrowable</span> <span class="keyword">extends</span> <span class="title">Throwable</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPackageException</span> <span class="keyword">extends</span> <span class="title">Exception</span> <span class="keyword">implements</span> <span class="title">MyPackageThrowable</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MyPackageException</span>();</span><br></pre></td></tr></table></figure>

<h2 id="Error"><a href="#Error" class="headerlink" title="Error"></a>Error</h2><p>äº‹å®ä¸Šï¼ŒPHP5.x ä¸­æ‰€æœ‰çš„é”™è¯¯éƒ½æ˜¯ <code>fatal</code> æˆ– <code>recoverable</code> çº§åˆ«çš„é”™è¯¯ï¼Œåœ¨ PHP7 ä¸­éƒ½èƒ½æŠ›å‡ºä¸€ä¸ª <code>Error</code> å®ä¾‹ã€‚è·Ÿå…¶ä»–ä»»ä½•å¼‚å¸¸ä¸€æ ·ï¼Œ<code>Error</code> å¯¹è±¡å¯ä»¥ä½¿ç”¨ <code>try/catch</code> å—æ¥æ•è·ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$var</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="variable">$var</span>-&gt;<span class="title function_ invoke__">method</span>(); <span class="comment">// Throws an Error object in PHP 7.</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="built_in">Error</span> <span class="variable">$e</span>) &#123;</span><br><span class="line"><span class="comment">// Handle error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œä¹‹å‰çš„è‡´å‘½é”™è¯¯éƒ½ä¼šæŠ›å‡ºä¸€ä¸ªåŸºæœ¬çš„ <code>Error</code> ç±»å®ä¾‹ï¼Œä½†æŸäº›é”™è¯¯ä¼šæŠ›å‡ºä¸€ä¸ªæ›´å…·ä½“çš„ <code>Error</code> å­ç±»ï¼š<code>TypeError</code>ã€<code>ParseError</code> ä»¥åŠ <code>AssertionError</code>ã€‚</p>
<h3 id="TypeError"><a href="#TypeError" class="headerlink" title="TypeError"></a>TypeError</h3><p>å½“å‡½æ•°å‚æ•°æˆ–è¿”å›å€¼ä¸ç¬¦åˆå£°æ˜çš„ç±»å‹æ—¶ï¼Œ<code>TypeError</code> çš„å®ä¾‹ä¼šè¢«æŠ›å‡ºã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"><span class="keyword">int</span> <span class="variable">$left</span>, <span class="keyword">int</span> <span class="variable">$right</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$left</span> + <span class="variable">$right</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="variable">$value</span> = <span class="title function_ invoke__">add</span>(<span class="string">&#x27;left&#x27;</span>, <span class="string">&#x27;right&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="built_in">TypeError</span> <span class="variable">$e</span>) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>(), <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Argument 1 passed to add() must be of the type integer, string given</span></span><br></pre></td></tr></table></figure>

<h3 id="ParseError"><a href="#ParseError" class="headerlink" title="ParseError"></a>ParseError</h3><p>å½“ <code>include/require</code> æ–‡ä»¶æˆ– <code>eval()</code> ä»£ç å­˜åœ¨è¯­æ³•é”™è¯¯æ—¶ï¼Œ<code>ParseError</code> ä¼šè¢«æŠ›å‡ºã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;file-with-parse-error.php&#x27;</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="built_in">ParseError</span> <span class="variable">$e</span>) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>(), <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ArithmeticError"><a href="#ArithmeticError" class="headerlink" title="ArithmeticError"></a>ArithmeticError</h3><p><code>ArithmeticError</code> åœ¨ä¸¤ç§æƒ…å†µä¸‹ä¼šè¢«æŠ›å‡ºã€‚ä¸€æ˜¯ä½ç§»æ“ä½œè´Ÿæ•°ä½ã€‚äºŒæ˜¯è°ƒç”¨ <code>intdiv()</code> æ—¶åˆ†å­æ˜¯ <code>PHP_INT_MIN</code> ä¸”åˆ†æ¯æ˜¯ -1 (è¿™ä¸ªä½¿ç”¨é™¤æ³•è¿ç®—ç¬¦çš„è¡¨è¾¾å¼ï¼š<code>PHP_INT_MIN / -1</code>ï¼Œç»“æœæ˜¯æµ®ç‚¹å‹)ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="variable">$value</span> = <span class="number">1</span> &lt;&lt; -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">catch</span> (<span class="built_in">ArithmeticError</span> <span class="variable">$e</span>) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();<span class="comment">//Bit shift by negative number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="DevisionByZeroError"><a href="#DevisionByZeroError" class="headerlink" title="DevisionByZeroError"></a>DevisionByZeroError</h3><p>å½“ <code>intdiv()</code> çš„åˆ†æ¯æ˜¯ 0 æˆ–è€…å–æ¨¡æ“ä½œ (%) ä¸­åˆ†æ¯æ˜¯ 0 æ—¶ï¼Œ<code>DivisionByZeroError</code> ä¼šè¢«æŠ›å‡ºã€‚æ³¨æ„åœ¨é™¤æ³•è¿ç®—ç¬¦ (&#x2F;) ä¸­ä½¿ç”¨ 0 ä½œé™¤æ•°ï¼ˆä¹Ÿå³xxx&#x2F;0è¿™æ ·å†™ï¼‰æ—¶åªä¼šè§¦å‘ä¸€ä¸ª warningï¼Œè¿™æ—¶å€™è‹¥åˆ†å­éé›¶ç»“æœæ˜¯ INFï¼Œè‹¥åˆ†å­æ˜¯ 0 ç»“æœæ˜¯ NaNã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="variable">$value</span> = <span class="number">1</span> % <span class="number">0</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="built_in">DivisionByZeroError</span> <span class="variable">$e</span>) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();<span class="comment">//Modulo by zero</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AssertionError"><a href="#AssertionError" class="headerlink" title="AssertionError"></a>AssertionError</h3><p>å½“ <code>assert()</code> çš„æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œ<code>AssertionError</code> ä¼šè¢«æŠ›å‡ºã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;zend.assertions&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;assert.exception&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$test</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="variable">$test</span> === <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Fatal error: Uncaught AssertionError: assert($test === 0)</span></span><br></pre></td></tr></table></figure>

<p>åªæœ‰æ–­è¨€å¯ç”¨å¹¶ä¸”æ˜¯è®¾ç½® ini é…ç½®çš„ <code>zend.assertions = 1</code> å’Œ <code>assert.exception = 1</code> æ—¶ï¼Œ<code>assert()</code> æ‰ä¼šæ‰§è¡Œå¹¶æŠ› <code>AssertionError</code>ã€‚</p>
<h2 id="åœ¨ä½ çš„ä»£ç ä¸­ä½¿ç”¨-Error"><a href="#åœ¨ä½ çš„ä»£ç ä¸­ä½¿ç”¨-Error" class="headerlink" title="åœ¨ä½ çš„ä»£ç ä¸­ä½¿ç”¨ Error"></a>åœ¨ä½ çš„ä»£ç ä¸­ä½¿ç”¨ Error</h2><p>ç”¨æˆ·å¯ä»¥é€šè¿‡ç»§æ‰¿ <code>Error</code> æ¥åˆ›å»ºç¬¦åˆè‡ªå·±å±‚çº§è¦æ±‚çš„ <code>Error</code> ç±»ã€‚è¿™å°±å½¢æˆäº†ä¸€ä¸ªé—®é¢˜ï¼šä»€ä¹ˆæƒ…å†µä¸‹åº”è¯¥æŠ›å‡º <code>Exception</code>ï¼Œä»€ä¹ˆæƒ…å†µä¸‹åº”è¯¥æŠ›å‡º <code>Error</code>ã€‚</p>
<p><code>Error</code> åº”è¯¥ç”¨æ¥è¡¨ç¤ºéœ€è¦ç¨‹åºå‘˜å…³æ³¨çš„ä»£ç é—®é¢˜ã€‚ä» PHP å¼•æ“æŠ›å‡ºçš„ <code>Error</code> å¯¹è±¡å±äºè¿™äº›åˆ†ç±»ï¼Œé€šå¸¸éƒ½æ˜¯ä»£ç çº§åˆ«çš„é”™è¯¯ï¼Œæ¯”å¦‚ä¼ é€’äº†é”™è¯¯ç±»å‹çš„å‚æ•°ç»™ä¸€ä¸ªå‡½æ•°æˆ–è€…è§£æä¸€ä¸ªæ–‡ä»¶å‘ç”Ÿé”™è¯¯ã€‚<code>Exception</code> åˆ™åº”è¯¥ç”¨äºåœ¨è¿è¡Œæ—¶èƒ½å®‰å…¨çš„å¤„ç†ï¼Œå¹¶ä¸”å¦ä¸€ä¸ªåŠ¨ä½œèƒ½ç»§ç»­æ‰§è¡Œçš„æƒ…å†µã€‚</p>
<p>ç”±äº <code>Error</code> å¯¹è±¡ä¸åº”è¯¥åœ¨è¿è¡Œæ—¶è¢«å¤„ç†ï¼Œå› æ­¤æ•è· <code>Error</code> å¯¹è±¡ä¹Ÿåº”è¯¥æ˜¯ä¸é¢‘ç¹çš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ<code>Error</code> å¯¹è±¡ä»…è¢«æ•è·ç”¨äºæ—¥å¿—è®°å½•ã€æ‰§è¡Œå¿…è¦çš„æ¸…ç†ä»¥åŠå±•ç¤ºé”™è¯¯ä¿¡æ¯ç»™ç”¨æˆ·ã€‚</p>
<h2 id="ç¼–å†™ä»£ç æ”¯æŒ-PHP5-x-å’Œ-PHP7-çš„å¼‚å¸¸"><a href="#ç¼–å†™ä»£ç æ”¯æŒ-PHP5-x-å’Œ-PHP7-çš„å¼‚å¸¸" class="headerlink" title="ç¼–å†™ä»£ç æ”¯æŒ PHP5.x å’Œ PHP7 çš„å¼‚å¸¸"></a>ç¼–å†™ä»£ç æ”¯æŒ PHP5.x å’Œ PHP7 çš„å¼‚å¸¸</h2><p>ä¸ºäº†åœ¨åŒæ ·çš„ä»£ç ä¸­æ•è·ä»»ä½• PHP5.x å’Œ PHP7 çš„å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ª <code>catch</code>ï¼Œå…ˆæ•è· <code>Throwable</code>ï¼Œç„¶åæ˜¯ <code>Exception</code>ã€‚å½“ PHP5.x ä¸å†éœ€è¦æ”¯æŒæ—¶ï¼Œæ•è· <code>Exception</code> çš„ <code>catch</code> å—å¯ä»¥ç§»é™¤ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// Code that may throw an Exception or Error.</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="built_in">Throwable</span> <span class="variable">$t</span>) &#123;</span><br><span class="line"><span class="comment">// Executed only in PHP 7, will not match in PHP 5.x</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line"><span class="comment">// Executed only in PHP 5.x, will not be reached in PHP 7</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸å¹¸çš„æ˜¯ï¼Œå¤„ç†å¼‚å¸¸çš„å‡½æ•°ä¸­çš„ç±»å‹å£°æ˜ä¸å®¹æ˜“ç¡®å®šã€‚å½“ <code>Exception</code> ç”¨äºå‡½æ•°å‚æ•°ç±»å‹å£°æ˜æ—¶ï¼Œå¦‚æœå‡½æ•°è°ƒç”¨æ—¶å€™èƒ½ç”¨ <code>Error</code> çš„å®ä¾‹ï¼Œè¿™ä¸ªç±»å‹å£°æ˜å°±è¦å»æ‰ã€‚å½“ PHP5.x ä¸éœ€è¦è¢«æ”¯æŒæ—¶ï¼Œç±»å‹å£°æ˜åˆ™å¯ä»¥è¿˜åŸä¸º <code>Throwable</code>ã€‚</p>
<div class="note default"><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://trowski.com/2015/06/24/throwable-exceptions-and-errors-in-php7/">Throwable Exceptions and Errors in PHP 7</a></p>
</div>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>PHP7</tag>
        <tag>Exception</tag>
        <tag>Error</tag>
        <tag>Throwable</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£å†³åœ¨ Chrome network preview æ ‡ç­¾ä¸­ä¸èƒ½æ¸²æŸ“ dd æ–¹æ³•</title>
    <url>/PHP/resolve-cannot-render-dd-function-in-chrome-network-preview-tab/</url>
    <content><![CDATA[<h2 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h2><div class="note info"><p>Chrome version 63.0.3239.84</p>
</div>

<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><blockquote>
<p><code>dd</code> æ–¹æ³•æŒ‡çš„æ˜¯ <a href="../php-global-uses-the-laravel-helper-function-dd">PHP å…¨å±€ä½¿ç”¨ Laravel è¾…åŠ©å‡½æ•° dd</a> ä¸­è®¾ç½®çš„æ–¹æ³•ã€‚</p>
</blockquote>
<p>åœ¨ Chrome 63 ä¸­ï¼Œpreview å¹¶æ²¡æœ‰æ¸²æŸ“ html æ ‡ç­¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/images/PHP/resolve-cannot-render-dd-function-in-chrome-network-preview-tab/bd9f206bgy1fmafyt9sgsj213s09j3yv.png"></p>
<span id="more"></span>

<h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><p>è¿™æ˜¯ Chrome çš„ä¸€ä¸ª bugï¼Œç›®å‰å¯ä»¥è®¾ç½® http response code ä¸º 500 æš‚æ—¶è§£å†³è¿™ä¸ªé—®é¢˜</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">http_response_code</span>(<span class="number">500</span>);</span><br><span class="line"><span class="title function_ invoke__">dd</span>(<span class="string">&#x27;foo&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…åœ¨ <code>dd</code> æ–¹æ³•é‡Œé¢ç›´æ¥è®¾ç½®</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dd</span>(<span class="params">...<span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">http_response_code</span>(<span class="number">500</span>);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$args</span> <span class="keyword">as</span> <span class="variable">$x</span>) &#123;</span><br><span class="line">        (<span class="keyword">new</span> Dumper)-&gt;<span class="title function_ invoke__">dump</span>(<span class="variable">$x</span>);</span><br><span class="line">    &#125;        </span><br><span class="line">    <span class="keyword">die</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ›´æ–°ä¸€ä¸‹ Composer è‡ªåŠ¨åŠ è½½</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">composer dump-autoload</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å†ä½¿ç”¨ <code>dd</code> æ–¹æ³•çš„æ—¶å€™ä¸€åˆ‡æ­£å¸¸äº†</p>
<p><img src="/images/PHP/resolve-cannot-render-dd-function-in-chrome-network-preview-tab/bd9f206bgy1fmag3truzjj20mp06hdfo.png"></p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>dd</tag>
        <tag>Chrome</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿­ä»£å™¨å’Œç”Ÿæˆå™¨</title>
    <url>/PHP/iterator-and-generator/</url>
    <content><![CDATA[<h2 id="ä¸€é“é¢è¯•é¢˜"><a href="#ä¸€é“é¢è¯•é¢˜" class="headerlink" title="ä¸€é“é¢è¯•é¢˜"></a>ä¸€é“é¢è¯•é¢˜</h2><div class="note primary"><p>å¦‚æœè®©ä½ ç”¨ PHP ç”Ÿæˆä» 1 åˆ°100 ä¸‡ä¸ªæ•°å€¼ï¼Œè¯·é—®æ€ä¹ˆåšæ‰èƒ½æœ€çœå†…å­˜ï¼Ÿ</p>
</div>

<p>æ²¡é”™ï¼Œè¿™æ˜¯ä¸€é“é¢è¯•é¢˜ï¼Œå¦‚æœè®©ä½ å†™å‡ºç­”æ¡ˆï¼Œä½ ä¼šæœ‰ä»€ä¹ˆæ ·çš„æ€è·¯å‘¢ï¼Ÿè¯·å…ˆç‹¬è‡ªæ€è€ƒå‡ åˆ†é’Ÿã€‚</p>
<p>å¯èƒ½ä½ æƒ³åˆ°çš„ä¼šæ˜¯è¿™ç§æ–¹å¼ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// æˆ‘è‡ªå·±æœ¬åœ°æµ‹è¯•å¤§æ¦‚ç”¨äº† 34MB å†…å­˜</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeLargeArray</span>(<span class="params"><span class="variable">$length</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$dataset</span> = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$dataset</span>[] = <span class="variable">$i</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$dataset</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$customRange</span> = <span class="title function_ invoke__">makeLargeArray</span>(<span class="number">1000000</span>);</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$customRange</span> <span class="keyword">as</span> <span class="variable">$i</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$i</span>, PHP_EOL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®°å½•ä½¿ç”¨çš„å†…å­˜</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatBytes</span>(<span class="params"><span class="variable">$bytes</span>, <span class="variable">$precision</span> = <span class="number">2</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$units</span> = <span class="keyword">array</span>(<span class="string">&quot;b&quot;</span>, <span class="string">&quot;kb&quot;</span>, <span class="string">&quot;mb&quot;</span>, <span class="string">&quot;gb&quot;</span>, <span class="string">&quot;tb&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$bytes</span> = <span class="title function_ invoke__">max</span>(<span class="variable">$bytes</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$pow</span> = <span class="title function_ invoke__">floor</span>((<span class="variable">$bytes</span> ? <span class="title function_ invoke__">log</span>(<span class="variable">$bytes</span>) : <span class="number">0</span>) / <span class="title function_ invoke__">log</span>(<span class="number">1024</span>));</span><br><span class="line">    <span class="variable">$pow</span> = <span class="title function_ invoke__">min</span>(<span class="variable">$pow</span>, <span class="title function_ invoke__">count</span>(<span class="variable">$units</span>) - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$bytes</span> /= (<span class="number">1</span> &lt;&lt; (<span class="number">10</span> * <span class="variable">$pow</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">round</span>(<span class="variable">$bytes</span>, <span class="variable">$precision</span>) . <span class="string">&quot; &quot;</span> . <span class="variable">$units</span>[<span class="variable">$pow</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="title function_ invoke__">formatBytes</span>(<span class="title function_ invoke__">memory_get_peak_usage</span>());</span><br></pre></td></tr></table></figure>

<p>ä½ å¦‚æœç»™å‡ºè¿™ç§ç­”æ¡ˆçš„è¯ï¼Œè‚¯å®šä¸ä¼šè®©é¢è¯•å®˜æ»¡æ„çš„ã€‚å› ä¸ºè¿™é“é¢˜çš„é‡ç‚¹æ˜¯èŠ‚çœå†…å­˜ï¼Œå¦‚æœæ˜¯å¦‚ä¸Šçš„ç¨‹åºï¼Œè™½ç„¶èƒ½å¤Ÿå®ç°é¢˜ç›®çš„å‰åŠéƒ¨åˆ†è¦æ±‚ï¼Œä½†å®é™…è¿è¡Œèµ·æ¥å´æ˜¯ä¸€ä¸ªéå¸¸åƒå†…å­˜çš„è€è™ã€‚å› ä¸ºä» PHP åº•å±‚åˆ†æï¼Œ <code>makeLargeArray()</code> ä¼šé¢„å…ˆåˆ›å»ºä¸€ä¸ªç”±ä¸€ç™¾ä¸‡ä¸ªæ•´æ•°ç»„æˆçš„æ•°ç»„åˆ†é…å†…å­˜ï¼</p>
<p>é‚£ä¹ˆåˆ°åº•è¦æ€ä¹ˆåšæ‰èƒ½æ—¢èŠ‚çœå†…å­˜ï¼Œåˆèƒ½å®ç°è¿™é“é¢˜çš„ç›®æ ‡å‘¢ï¼Ÿ</p>
<span id="more"></span>

<p>æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼Œä½¿ç”¨ <strong>PHPç”Ÿæˆå™¨</strong> ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// æˆ‘æœ¬åœ°æµ‹è¯•å¤§æ¦‚ç”¨äº† 718KB å†…å­˜</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeLargeArray</span>(<span class="params"><span class="variable">$length</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="variable">$i</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="title function_ invoke__">makeLargeArray</span>(<span class="number">1000000</span>) <span class="keyword">as</span> <span class="variable">$i</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$i</span>, PHP_EOL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾ˆå°‘ç”¨ PHP ç”Ÿæˆå™¨çš„åŒå­¦æ˜¯ä¸æ˜¯çœ‹ä¸å¤ªæ‡‚ï¼Ÿæ²¡å…³ç³»ï¼Œæœ¬æ–‡æ‰åˆšåˆšå¼€å§‹ã€‚</p>
<h2 id="PHP-è¿­ä»£å™¨"><a href="#PHP-è¿­ä»£å™¨" class="headerlink" title="PHP è¿­ä»£å™¨"></a>PHP è¿­ä»£å™¨</h2><p>åœ¨è®² PHP ç”Ÿæˆå™¨ä¹‹å‰ï¼Œæˆ‘è§‰å¾—æœ‰å¿…è¦ç»™å¤§å®¶è®²ä¸€è®²è¿­ä»£å™¨çš„æ¦‚å¿µã€‚å¦‚æœä½ å¯¹ PHP è¿­ä»£å™¨çš„æ¦‚å¿µå¾ˆäº†è§£ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡è¿™ä¸ªç« èŠ‚ï¼Œç›´æ¥å‰å¾€æ–‡ä¸­ä¸‹åŠéƒ¨åˆ†ã€‚</p>
<p>è¿­ä»£æ˜¯æŒ‡åå¤æ‰§è¡Œä¸€ä¸ªè¿‡ç¨‹ï¼Œæ¯æ‰§è¡Œä¸€æ¬¡å«åšä¸€æ¬¡è¿­ä»£ã€‚è¿™ä¹ˆè¯´ä½ å¯èƒ½ä¸æ˜¯å¾ˆç†è§£ï¼Œäº‹å®ä¸Šï¼Œæˆ‘ä»¬æ¯å¤©éƒ½åœ¨å’Œè¿­ä»£æ‰“äº¤é“ï¼Œå°±æ¯”å¦‚ PHP çš„ <code>foreach()</code> å‡½æ•°ï¼Œåƒè¿™æ ·ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$home</span> = [</span><br><span class="line">    <span class="string">&#x27;bed&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;television&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;computer&#x27;</span></span><br><span class="line">];</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$home</span> <span class="keyword">as</span> <span class="variable">$furniture</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;There is a &#x27;</span>.<span class="variable">$furniture</span>.<span class="string">&#x27;in my home!&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä¸€ä¸ªç®€å•çš„ <code>foreach()</code> å°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå®ƒå°† <code>home</code> ä¸€æ¬¡åˆä¸€æ¬¡çš„éå†ï¼Œè¾“å‡ºä¸‰ä¸ªå®¶å…· <code>furniture</code>ã€‚å®é™…ä¸Šï¼Œå‘ç”Ÿå˜åŒ–çš„æ˜¯ <code>home</code> è¿™ä¸ªæ•°ç»„ï¼Œä½ å¯ä»¥æŠŠå®ƒå½“åšæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œ<code>foreach</code> åœ¨æ¯æ¬¡éå†å®ƒæ—¶ï¼Œéƒ½ä¼šè°ƒç”¨è¿™ä¸ªå¯¹è±¡é‡Œçš„ä¸€ä¸ªæ–¹æ³•ï¼Œè®©æ•°ç»„åœ¨è‡ªå·±å†…éƒ¨çš„æŒ‡é’ˆå‘ç”Ÿä¸€æ¬¡å˜åŒ–ï¼ˆè¿­ä»£ï¼‰ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ç§° <code>home</code> æ•°ç»„ä¸º è¿­ä»£å™¨å¯¹è±¡ï¼Œè€Œ <code>foreach</code> å°±æ˜¯ä¸€ä¸ª è¿­ä»£å™¨æ¥å£ï¼ˆ<code>Iterator</code>ï¼‰ã€‚</p>
<h2 id="PHP-ç”Ÿæˆå™¨"><a href="#PHP-ç”Ÿæˆå™¨" class="headerlink" title="PHP ç”Ÿæˆå™¨"></a>PHP ç”Ÿæˆå™¨</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæƒ³å¿…å¤§å®¶å¯¹ç”Ÿæˆå™¨æœ‰ä¸€ä¸ªå¤§æ¦‚çš„ç†è§£ï¼Œå…ˆæ¥çœ‹çœ‹å®˜æ–¹çš„è§£é‡Šï¼ˆæ…¢ç‚¹å„¿åº¦è¯»ï¼Œå¥½å¥½ç†è§£ï¼‰ï¼šç”Ÿæˆå™¨å…è®¸ä½ åœ¨ <code>foreach</code> ä»£ç å—ä¸­å†™ä»£ç æ¥è¿­ä»£ä¸€ç»„æ•°æ®è€Œä¸éœ€è¦åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªæ•°ç»„, é‚£ä¼šä½¿ä½ çš„å†…å­˜è¾¾åˆ°ä¸Šé™ï¼Œæˆ–è€…ä¼šå æ®å¯è§‚çš„å¤„ç†æ—¶é—´ã€‚ç›¸åï¼Œä½ å¯ä»¥å†™ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œå°±åƒä¸€ä¸ªæ™®é€šçš„è‡ªå®šä¹‰å‡½æ•°ä¸€æ ·, å’Œæ™®é€šå‡½æ•°åªè¿”å›ä¸€æ¬¡ä¸åŒçš„æ˜¯, ç”Ÿæˆå™¨å¯ä»¥æ ¹æ®éœ€è¦ <code>yield</code> å¤šæ¬¡ï¼Œä»¥ä¾¿ç”Ÿæˆéœ€è¦è¿­ä»£çš„å€¼ã€‚</p>
<p>ç”Ÿæˆå™¨ï¼ˆ<code>Generator</code>ï¼‰æ˜¯ PHP5.5 å¼•å…¥çš„åŠŸèƒ½ï¼Œå¾€å¾€æ²¡æœ‰è¢«å¤§å®¶å……åˆ†åˆ©ç”¨ã€‚å…¶å®è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œæˆ‘ç›¸ä¿¡å¤§å¤šæ•°å¼€å‘è€…å’Œæˆ‘ä¸€æ ·ä¸çŸ¥é“æœ‰ç”Ÿæˆå™¨è¿™ç§ä¸œè¥¿ï¼Œå› ä¸ºå¹³æ—¶å·¥ä½œä¸­ä¸å¸¸ç”¨ï¼Œå…¶å®å¾ˆç®€å•ï¼Œç”Ÿæˆå™¨å°±æ˜¯è¿­ä»£å™¨ï¼Œä»…æ­¤è€Œå·²ã€‚</p>
<h3 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><p>ç”Ÿæˆå™¨æä¾›äº†ä¸€ç§æ›´å®¹æ˜“çš„æ–¹æ³•æ¥å®ç°ç®€å•çš„å¯¹è±¡è¿­ä»£ï¼Œç›¸æ¯”è¾ƒå®šä¹‰ç±»å®ç° <code>Iterator</code> æ¥å£çš„æ–¹å¼ï¼Œæ€§èƒ½å¼€é”€å’Œå¤æ‚æ€§å¤§å¤§é™ä½ã€‚</p>
<h3 id="ç”Ÿæˆå™¨çš„ç”¨æ³•"><a href="#ç”Ÿæˆå™¨çš„ç”¨æ³•" class="headerlink" title="ç”Ÿæˆå™¨çš„ç”¨æ³•"></a>ç”Ÿæˆå™¨çš„ç”¨æ³•</h3><p>æˆ‘è§‰å¾—é™¤äº†æˆ‘ç»™çš„ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œå®˜æ–¹ç»™çš„ç”¨ä¾‹æ˜¯ä¹Ÿèƒ½å¾ˆå¥½çš„è§£é‡Šç”Ÿæˆå™¨çš„ç›Šå¤„ã€‚æ¯”å¦‚ PHP çš„ä¸€ä¸ªå‡½æ•°ï¼šrange ï¼Œå®ƒå¯ä»¥å»ºç«‹ä¸€ä¸ªåŒ…å«æŒ‡å®šèŒƒå›´å•å…ƒçš„æ•°ç»„ï¼Œæ ‡å‡†çš„ <code>range()</code> å‡½æ•°éœ€è¦åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªæ•°ç»„åŒ…å«æ¯ä¸€ä¸ªåœ¨å®ƒèŒƒå›´å†…çš„å€¼ï¼Œç„¶åè¿”å›è¯¥æ•°ç»„, ç»“æœå°±æ˜¯ä¼šäº§ç”Ÿå¤šä¸ªå¾ˆå¤§çš„æ•°ç»„ã€‚ æ¯”å¦‚ï¼Œè°ƒç”¨ <code>range(0, 1000000)</code> å°†å¯¼è‡´å†…å­˜å ç”¨è¶…è¿‡ <strong>100 MB</strong>ã€‚</p>
<p>åšä¸ºä¸€ç§æ›¿ä»£æ–¹æ³•, æˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ª <code>xrange()</code> ç”Ÿæˆå™¨, åªéœ€è¦è¶³å¤Ÿçš„å†…å­˜æ¥åˆ›å»º <code>Iterator</code> å¯¹è±¡å¹¶åœ¨å†…éƒ¨è·Ÿè¸ªç”Ÿæˆå™¨çš„å½“å‰çŠ¶æ€ï¼Œè¿™æ ·åªéœ€è¦ä¸åˆ° <strong>1K</strong> å­—èŠ‚çš„å†…å­˜ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xrange</span>(<span class="params"><span class="variable">$start</span>, <span class="variable">$limit</span>, <span class="variable">$step</span> = <span class="number">1</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$start</span> &lt; <span class="variable">$limit</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$step</span> &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">LogicException</span>(<span class="string">&#x27;Step must be +ve&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="variable">$start</span>; <span class="variable">$i</span> &lt;= <span class="variable">$limit</span>; <span class="variable">$i</span> += <span class="variable">$step</span>) &#123;</span><br><span class="line">            <span class="keyword">yield</span> <span class="variable">$i</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$step</span> &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">LogicException</span>(<span class="string">&#x27;Step must be -ve&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="variable">$start</span>; <span class="variable">$i</span> &gt;= <span class="variable">$limit</span>; <span class="variable">$i</span> += <span class="variable">$step</span>) &#123;</span><br><span class="line">            <span class="keyword">yield</span> <span class="variable">$i</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* æ³¨æ„ä¸‹é¢range()å’Œxrange()è¾“å‡ºçš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ */</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Single digit odd numbers from range():  &#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="title function_ invoke__">range</span>(<span class="number">1</span>, <span class="number">9</span>, <span class="number">2</span>) <span class="keyword">as</span> <span class="variable">$number</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$number</span> &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Single digit odd numbers from xrange(): &#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="title function_ invoke__">xrange</span>(<span class="number">1</span>, <span class="number">9</span>, <span class="number">2</span>) <span class="keyword">as</span> <span class="variable">$number</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$number</span> &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä»¥ä¸Šä¾‹ç¨‹ä¼šè¾“å‡ºï¼š</span></span><br><span class="line">Single digit odd numbers <span class="keyword">from</span> <span class="title function_ invoke__">range</span>():  <span class="number">1</span> <span class="number">3</span> <span class="number">5</span> <span class="number">7</span> <span class="number">9</span></span><br><span class="line">Single digit odd numbers <span class="keyword">from</span> <span class="title function_ invoke__">xrange</span>(): <span class="number">1</span> <span class="number">3</span> <span class="number">5</span> <span class="number">7</span> <span class="number">9</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h3><p>æˆ‘ä»¬éœ€è¦æ³¨æ„çš„å…³é”®æ˜¯ <code>yield</code>ï¼Œè¿™æ˜¯ç”Ÿæˆå™¨çš„å…³é”®ã€‚æˆ‘ä»¬é€šè¿‡ä¸Šé¢ä¾‹å­ï¼Œå¯ä»¥çœ‹å¾—å‡ºï¼Œ<code>yield</code> ä¼šå°†å½“å‰ä¸€ä¸ªå€¼ä¼ é€’ç»™ <code>foreach</code>ï¼Œæ¢å¥è¯è¯´ï¼Œ <code>foreach</code> æ¯ä¸€æ¬¡è¿­ä»£è¿‡ç¨‹éƒ½ä¼šä» <code>yield</code> å¤„å–ä¸€ä¸ªå€¼ï¼Œç›´åˆ°æ•´ä¸ªéå†è¿‡ç¨‹ä¸å†å­˜åœ¨ <code>yield</code> ä¸ºæ­¢çš„æ—¶å€™ï¼Œéå†ç»“æŸã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°ï¼Œ <code>yield</code> å’Œ <code>return</code> éƒ½ä¼šè¿”å›å€¼ï¼Œä½†åŒºåˆ«åœ¨äºä¸€ä¸ª <code>return</code> æ˜¯è¿”å›æ—¢å®šç»“æœï¼Œä¸€æ¬¡è¿”å›å®Œæ¯•å°±ä¸å†è¿”å›æ–°çš„ç»“æœï¼Œè€Œ <code>yield</code> æ˜¯ ä¸æ–­äº§å‡º ç›´åˆ°æ— æ³•äº§å‡ºä¸ºæ­¢ã€‚</p>
<p>å®é™…ä¸Šå­˜åœ¨ <code>yield</code> çš„å‡½æ•°è¿”å›å€¼è¿”å›çš„æ˜¯ä¸€ä¸ª <code>Generator</code> å¯¹è±¡ï¼ˆè¿™ä¸ªå¯¹è±¡ä¸èƒ½æ‰‹åŠ¨é€šè¿‡ new å®ä¾‹åŒ–ï¼‰ï¼Œè¯¥å¯¹è±¡å®ç°äº† <code>Iterator</code> æ¥å£ã€‚</p>
<p>ä½ å¯èƒ½è§‰å¾—ä»¥ä¸Šä¾‹å­æ²¡å•¥å®é™…ç”¨é€”ï¼Œæˆ‘å†ä¸¾ä¸€ä¸ªæ¯”è¾ƒæœ‰ç”¨çš„ä¾‹å­ï¼ˆæ¥è‡ª Modern PHP ä¸€ä¹¦ï¼‰ï¼Œæ¯”å¦‚æˆ‘æƒ³å¯¼å…¥ä¸€ä¸ªå¤§å°çº¦ä¸º 4GB çš„ CSV æ–‡ä»¶ï¼ˆä½ å¯ä»¥ç†è§£ä¸º Excelï¼‰ï¼Œè€Œä¸”æˆ‘ä»¬çš„æœåŠ¡å™¨è¿è¡Œåœ¨ä¸€ä¸ªå…±äº«çš„ VPS ä¸­ï¼Œåªæä¾›äº† 1 GB çš„å†…å­˜ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥æŠŠ CSV è¿™ä¸ªç”Ÿæˆçš„æ•°ç»„ç›´æ¥éƒ½æ”¾åœ¨å†…å­˜é‡Œã€‚é‚£æˆ‘ä»¬æ€ä¹ˆç”¨ç”Ÿæˆå™¨+è¿­ä»£å™¨æ¥å®ç°å‘¢ï¼Ÿä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿæˆå™¨äº§å‡º</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRows</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$handel</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file</span>, <span class="string">&#x27;rb&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$handel</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Error Processing&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (<span class="title function_ invoke__">feof</span>(<span class="variable">$handel</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_ invoke__">fgetcsv</span>(<span class="variable">$handel</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$handel</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿­ä»£å™¨è¯»å–</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="title function_ invoke__">getRows</span>(<span class="string">&#x27;./data.csv&#x27;</span>) <span class="keyword">as</span> <span class="variable">$row</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="variable">$row</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¼å…¥å¯¼å‡ºè¿™ç§éœ€æ±‚åœ¨ç°å®åœºæ™¯ä¸­æ˜¯ä¸æ˜¯å¾ˆå¸¸è§ï¼Œå¤§å®¶å¯ä»¥åœ¨é¡¹ç›®é‡Œå°è¯•ä½¿ç”¨ç”Ÿæˆå™¨æ¥å–ä»£ä¼ ç»Ÿçš„æ•°ç»„å£°æ˜ï¼Œå¯ä»¥å¸®å…¬å¸çœæ‰ä¸€å¤§ç¬”å†…å­˜è´­ä¹°è´¹ç”¨~</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç”Ÿæˆå™¨æ˜¯åŠŸèƒ½å¤šæ ·æ€§å’Œç®€æ´æ€§ä¹‹é—´çš„æŠ˜ä¸­æ–¹æ¡ˆã€‚ç”Ÿæˆå™¨æ˜¯åªèƒ½å‘å‰è¿›çš„è¿­ä»£å™¨ï¼Œè¿™æ„å‘³ç€ä¸èƒ½ä½¿ç”¨ç”Ÿæˆå™¨åœ¨æ•°æ®é›†ä¸­æ‰§è¡Œåé€€ã€å¿«è¿›æˆ–æŸ»æ‰¾æ“ä½œï¼Œåªèƒ½è®©ç”Ÿæˆå™¨è®¡ç®—å¹¶äº§ç”Ÿä¸‹ä¸€ä¸ªå€¼ã€‚è¿­ä»£å¤§å‹æ•°æ®é›†æˆ–æ•°åˆ—æ—¶æœ€é€‚åˆä½¿ç”¨ç”Ÿæˆå™¨ï¼Œå› ä¸ºè¿™æ ·å ç”¨çš„ç³»ç»Ÿå†…å­˜é‡æå°ã€‚ç”Ÿæˆå™¨ä¹Ÿèƒ½å®Œæˆè¿­ä»£å™¨èƒ½å®Œæˆçš„ç®€å•ä»»åŠ¡ï¼Œè€Œä¸”ä½¿ç”¨çš„ä»£ç è¾ƒå°‘ã€‚</p>
<div class="note default"><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://wowphp.com/square/KW7p046mxOMedpeq1ogAQ3N82n">è¿°è¿­ä»£å™¨å’Œç”Ÿæˆå™¨</a></p>
</div>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Iterator</tag>
        <tag>Generator</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨å››èˆå…­å…¥ä¿è¯ç²¾ç¡®çš„ç»“ç®—é‡‘é¢</title>
    <url>/PHP/ensure-accurate-for-digital-transformation/</url>
    <content><![CDATA[<p>æˆ‘ä»¬åœ¨è®¡ç®—é‡‘é¢æ—¶ï¼Œéš¾å…å­˜åœ¨ä¿ç•™ä½æ•°æœ‰é™ï¼Œè®¡ç®—ç»“æœéœ€è¦å–èˆçš„æƒ…å†µã€‚å¾€å¾€åœ¨ç”µå•†ã€é“¶è¡Œç³»ç»Ÿä¸­ï¼Œé‡‘é¢æ˜¯ä»¥æ•´æ•°å½¢å¼ä¿å­˜ï¼Œå•ä½ä¸ºè´§å¸æœ€å°å•ä½ï¼Œä¾‹å¦‚åˆ†ã€‚ä½†æ˜¯åœ¨ç»“ç®—æ—¶é¢å¤–çš„å‚æ•°å¦‚æŠ˜æ‰£ã€åˆ©ç‡ã€ç¨ç‡ç­‰å­˜åœ¨ç€å¤§é‡çš„æµ®ç‚¹æ•°ï¼Œè®¡ç®—ç»“æœåˆ™éœ€è¦è½¬æ¢ä¸ºæ•´æ•°ã€‚</p>
<p>ç®€å•å¤„ç†ä¸€èˆ¬æ˜¯å››èˆäº”å…¥ï¼Œä½†æ˜¯è¿™æ ·å­˜åœ¨å¾ˆæ˜æ˜¾çš„é—®é¢˜ï¼Œå°±æ˜¯ â€œå…¥â€ çš„æ¦‚ç‡å¤§äº â€œèˆâ€ï¼Œæ˜æ˜¾çš„ï¼Œé‡åˆ° 1ã€2ã€3ã€4 èˆï¼Œé‡åˆ° 5ã€6ã€7ã€8ã€9 å…¥ï¼Œç²—çœ‹è¿™ç§å°±å¯ä»¥å‘ç°é—®é¢˜ã€‚å¦‚æœæƒ³è¦ä¸¤è¾¹å¹³è¡¡ï¼Œåˆ™ â€œå››èˆå…­å…¥â€ æ‰æ˜¯åˆç†çš„ï¼Œä½†æ˜¯ï¼Œ5 æ€ä¹ˆåŠï¼Ÿ</p>
<h2 id="æœ‰è¶£çš„æ¨ç†"><a href="#æœ‰è¶£çš„æ¨ç†" class="headerlink" title="æœ‰è¶£çš„æ¨ç†"></a>æœ‰è¶£çš„æ¨ç†</h2><p>è½¬è‡ªçŸ¥ä¹ç”¨æˆ·ç»™å‡ºçš„ä¸€ä¸ªä¾‹å­ï¼ˆ<a href="https://www.zhihu.com/question/28943072/answer/42673180">çŸ¥ä¹ç­”æ¡ˆåœ°å€</a>ï¼‰</p>
<p>æŸå®æ•° r &#x3D; 0.4445ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯”ä¹åˆ†ä¹‹å››ç¨å¾®å¤§ä¸€ç‚¹ç‚¹ã€‚ï¼ˆæ„é€ å…¶ä»–å°æ•°ä¹Ÿå¯ä»¥ï¼Œæœ‰é™å°æ•°è¿˜æ˜¯æ— é™å°æ•°ã€çº¯å°æ•°è¿˜æ˜¯å¸¦å°æ•°éƒ½æ²¡å…³ç³»ï¼‰</p>
<p>å¥½äº†ï¼Œæ ¹æ®å››èˆäº”å…¥ç®—æ³• fï¼Œç›´æ¥æŠŠè¿™ä¸ª r ä¿ç•™åˆ°æ•´æ•°ã€‚é‚£ä¹ˆï¼Œæ˜æ˜¾ï¼Œç»“æœæ˜¯ 0ï¼Œå°æ•°ç‚¹åç¬¬ä¸€ä½æ˜¯ 4 ä¹ˆã€‚</p>
<p>è¿™æ—¶ï¼Œè¯·å¼€æ”¾ä¸€ä¸‹è„‘æ´ã€‚æœ‰ä¸€ç¾¤ç§‘å­¦å®¶æ‹¿åˆ°äº†è¿™ä¸ªæ•°å­—ã€‚ç„¶åâ€¦â€¦</p>
<p>ç§‘å­¦å®¶ s3 æŠŠ r ä¿ç•™åˆ°å°æ•°ç‚¹åç¬¬ 3 ä½ï¼Œå¾— r3 &#x3D; 0.445ã€‚ç¬¬ 4 ä½æ˜¯ 5 ä¹ˆï¼ŒæŒ‰å››èˆäº”å…¥çš„ç²¾ç¥ï¼ŒæŠŠè¿™ä¸ª 1 è¿›åˆ°ç¬¬ 3 ä½ï¼Œä½¿ä¹‹å˜æˆ 5ã€‚</p>
<span id="more"></span>

<p>ç§‘å­¦å®¶ s2 æŠŠ r ä¿ç•™åˆ°å°æ•°ç‚¹åç¬¬ 2 ä½ï¼Œå¾— r3 &#x3D; 0.45ã€‚ç¬¬ 3 ä½æ˜¯ 5 ä¹ˆï¼ŒæŒ‰å››èˆäº”å…¥çš„ç²¾ç¥ï¼ŒæŠŠè¿™ä¸ª 1 è¿›åˆ°ç¬¬ 2 ä½ï¼Œä½¿ä¹‹å˜æˆ 5ã€‚</p>
<p>ç§‘å­¦å®¶ s1 æŠŠ r ä¿ç•™åˆ°å°æ•°ç‚¹åç¬¬ 1 ä½ï¼Œå¾— r1 &#x3D; 0.5ã€‚ç¬¬ 2 ä½æ˜¯ 5 ä¹ˆï¼ŒæŒ‰å››èˆäº”å…¥çš„ç²¾ç¥ï¼ŒæŠŠè¿™ä¸ª 1 è¿›åˆ°ç¬¬ 1 ä½ï¼Œä½¿ä¹‹å˜æˆ 5ã€‚</p>
<p>ç§‘å­¦å®¶ s0 æŠŠ r ä¿ç•™åˆ°å°æ•°ç‚¹åç¬¬ 0 ä½ï¼Œå¾— r0 &#x3D; 1ã€‚ç¬¬ 1 ä½æ˜¯ 5 ä¹ˆï¼ŒæŒ‰å››èˆäº”å…¥çš„ç²¾ç¥ï¼ŒæŠŠè¿™ä¸ª 1 è¿›åˆ°ç¬¬ 0 ä½ï¼Œä½¿ä¹‹å˜æˆ 1ã€‚</p>
<p>æœ€ç»ˆç»“æœå’Œ 0.4445 ç›´æ¥å››èˆäº”å…¥ç»“æœå­˜åœ¨æ˜æ˜¾å·®å¼‚ã€‚</p>
<p>è¿˜æœ‰ä¸ªä¾‹å­ä¹Ÿèƒ½è¯´æ˜ï¼š</p>
<p>2.55 + 3.45 &#x3D; 6</p>
<p>å¦‚æœæˆ‘ä»¬æŠŠ 2.55 å’Œ 3.45 å››èˆäº”å…¥ä¿ç•™ä¸€ä½å°æ•°ï¼Œé‚£ä¹ˆä¸Šè¿°å¼å­å°±æˆäº†ï¼š</p>
<p>2.6 + 3.5 &#x3D; 6.1</p>
<p>è¿™æ ·çš„é—®é¢˜éå¸¸å¸¸è§ï¼Œä¹Ÿå¯¼è‡´äº†åœ¨å¤§é‡æ ·æœ¬ä¸­ï¼Œå››èˆäº”å…¥åè®¡ç®—ç»“æœçš„æ€»å’Œä¼šæ˜æ˜¾å¤§äºç›´æ¥è®¡ç®—æ€»å’Œçš„ç»“æœï¼Œå¯¹äºé‡‘èå•ä½è®¡ç®—åˆ©æ¯è€Œè¨€ï¼Œè¿™æ ·å¾ˆæ˜¾ç„¶æ˜¯ä¸€ä¸ªäºæœ¬çš„è¡Œä¸ºã€‚å¦‚æœä¸äºæœ¬çš„ç®—ï¼Œä¾æ—§æ˜¯ç®€å•å¤„ç†å¯èƒ½ç»“æœç›¸åï¼Œé‚£ä¹ˆå®¢æˆ·å°±ä¸å¼€å¿ƒäº†ã€‚</p>
<h2 id="é“¶è¡Œå®¶èˆå…¥ï¼ˆBankerâ€™s-Roundï¼‰"><a href="#é“¶è¡Œå®¶èˆå…¥ï¼ˆBankerâ€™s-Roundï¼‰" class="headerlink" title="é“¶è¡Œå®¶èˆå…¥ï¼ˆBankerâ€™s Roundï¼‰"></a>é“¶è¡Œå®¶èˆå…¥ï¼ˆBankerâ€™s Roundï¼‰</h2><p>äº¦å«åš â€œå››èˆå…­å…¥äº”æˆåŒâ€ ï¼Œå››èˆå…­å…¥ï¼Œä½¿å¾—ä¸¤å¤´ï¼ˆå³è¿›å’Œèˆï¼‰æ¦‚ç‡ç›¸ç­‰ï¼Œä½†æ˜¯ï¼Œåœ¨ 4 å’Œ 6 ä¹‹é—´çš„ 5 å°±éœ€è¦ç‰¹åˆ«å¯¹å¾…ã€‚å…·ä½“è§„åˆ™å¦‚ä¸‹ï¼š</p>
<div class="note info"><ul>
<li>èˆå»ä½çš„æ•°å€¼å°äº5æ—¶ï¼Œç›´æ¥èˆå»ï¼›</li>
<li>èˆå»ä½çš„æ•°å€¼å¤§äºç­‰äº6æ—¶ï¼Œè¿›ä½åèˆå»ï¼›</li>
<li>å½“èˆå»ä½çš„æ•°å€¼ç­‰äº5æ—¶ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼š5åé¢è¿˜æœ‰å…¶ä»–æ•°å­—ï¼ˆé0ï¼‰ï¼Œåˆ™è¿›ä½åèˆå»ï¼›è‹¥5åé¢æ˜¯0ï¼ˆå³5æ˜¯æœ€åä¸€ä½ï¼‰ï¼Œåˆ™æ ¹æ®5å‰ä¸€ä½æ•°çš„å¥‡å¶æ€§æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›ä½ï¼Œå¥‡æ•°è¿›ä½ï¼Œå¶æ•°èˆå»ã€‚</li>
</ul>
</div>

<p>èˆå»ä½ï¼Œå½“å°äº 5ï¼Œå³ 0 ~ 4.999999â€¦â€¦ åˆ™èˆå»ï¼Œå¤§äº 6ï¼Œå³ 6 ~ 10 åˆ™è¿›ä½ï¼Œåˆ™ä¸­é—´åŒºé—´é‚£ä¸ªæ•°å­—ï¼Œ5 ~ 5.999999â€¦â€¦ ï¼Œåªè¦ä½¿è¯¥åŒºé—´å†…å­˜åœ¨çš„æ•°å­—å¹³å‡åˆ†å¸ƒï¼Œå³å¯ä¿è¯å–èˆæ¦‚ç‡ç›¸ç­‰ã€‚äºæ˜¯å¾—åˆ°ä¸Šè¿°ç®—æ³•ã€‚</p>
<p>æŒ‰ä¸Šè¿°è§„åˆ™ï¼Œä¹‹å‰çš„ 2.55 + 3.45 &#x3D; 6 å¾—å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p>
<p>2.6 + 3.4 &#x3D; 6</p>
<p>ç»“æœæ­£ç¡®ã€‚</p>
<h2 id="PHP-å››èˆå…­å…¥"><a href="#PHP-å››èˆå…­å…¥" class="headerlink" title="PHP å››èˆå…­å…¥"></a>PHP å››èˆå…­å…¥</h2><p>å…¶å® PHP æ—©å°±æ”¯æŒå››èˆå…­å…¥ï¼Œä½¿ç”¨ <code>round()</code> å‡½æ•°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥ <code>PHP_ROUND_HALF_EVEN</code> å³å¯å®ç°ä¸Šè¿°è§„åˆ™ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ouput 2.6</span></span><br><span class="line"><span class="title function_ invoke__">round</span>(<span class="number">2.55</span>, <span class="number">1</span>, PHP_ROUND_HALF_EVEN);</span><br><span class="line"><span class="comment">// ouput 3.4</span></span><br><span class="line"><span class="title function_ invoke__">round</span>(<span class="number">3.45</span>, <span class="number">1</span>, PHP_ROUND_HALF_EVEN);</span><br></pre></td></tr></table></figure>

<h2 id="å…³äºæµ®ç‚¹æ•°è¿ç®—"><a href="#å…³äºæµ®ç‚¹æ•°è¿ç®—" class="headerlink" title="å…³äºæµ®ç‚¹æ•°è¿ç®—"></a>å…³äºæµ®ç‚¹æ•°è¿ç®—</h2><p>è¯·ç‰¢è®°ï¼Œ<strong>ä¸è¦ä½¿ç”¨ PHP å†…ç½®çš„ +-*&#x2F; æ“ä½œç¬¦</strong>ï¼Œè¯·ä½¿ç”¨ <a href="http://php.net/manual/en/ref.bc.php">BC Math Functions</a>ï¼Œæ‰§è¡Œä¸‹é¢è¿™æ®µä»£ç å°±çŸ¥é“åŸå› äº†ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// output 0.099999999999998</span></span><br><span class="line"><span class="keyword">echo</span> <span class="number">19.45</span>-<span class="number">19.35</span>;</span><br></pre></td></tr></table></figure>

<div class="note default"><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.insp.top/article/how-to-ensure-accurate-for-digital-transformation">å››èˆäº”å…¥ä¸å¯å–ï¼ç»“ç®—é‡‘é¢ï¼Œå¦‚ä½•ä¿è¯ç²¾ç¡®ï¼Ÿ</a></p>
</div>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>PhpStorm + Xdebug è°ƒè¯•é…ç½®</title>
    <url>/PhpStorm/PhpStorm-Xdebug-configuration/</url>
    <content><![CDATA[<h2 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h2><div class="note info"><p>PhpStorm 2017.3.3<br>Postman 5.5.0<br>php-7.1.12-Win32-VC14-x64 TS</p>
</div>

<h2 id="å®‰è£…-xdebug-æ¨¡å—"><a href="#å®‰è£…-xdebug-æ¨¡å—" class="headerlink" title="å®‰è£… xdebug æ¨¡å—"></a>å®‰è£… xdebug æ¨¡å—</h2><p>å‰å¾€ <a href="https://xdebug.org/download.php">xdebug å®˜æ–¹ç½‘ç«™</a> ä¸‹è½½ä¸è‡ªå·±çš„ PHP ç‰ˆæœ¬åŒ¹é…çš„ xdebugæ¨¡å—æ–‡ä»¶ï¼Œå¦‚æœä¸çŸ¥é“è¦é€‰æ‹©å“ªä¸ªç‰ˆæœ¬çš„ <code>xdebug</code>ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸ŠæŸ¥çœ‹ <code>phpinfo()</code>ï¼Œå¤åˆ¶å…¨éƒ¨ <code>phpinfo()</code> åˆ°<a href="https://xdebug.org/wizard.php">è¿™é‡Œ</a>è‡ªåŠ¨è§£æã€‚æœ€åï¼Œå°† <code>xdebug</code> æ¨¡å—æ–‡ä»¶æ”¾å…¥PHPå®‰è£…ç›®å½•&#x2F;extæ–‡ä»¶å¤¹ä¸­ã€‚</p>
<h2 id="é…ç½®-php-ini"><a href="#é…ç½®-php-ini" class="headerlink" title="é…ç½® php.ini"></a>é…ç½® php.ini</h2><p><code>php.ini</code> æ·»åŠ å¦‚ä¸‹å‡ è¡Œé…ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[xdebug]</span><br><span class="line">;æŒ‡å®šXdebugæ‰©å±•æ–‡ä»¶</span><br><span class="line">zend_extension = php_xdebug.dll</span><br><span class="line">xdebug.default_enable = 1</span><br><span class="line">;è¿œç¨‹è°ƒè¯•</span><br><span class="line">xdebug.remote_enable = on</span><br><span class="line">;è‡ªåŠ¨æ‰“å¼€è¿œç¨‹è°ƒè¯•</span><br><span class="line">xdebug.remote_autostart = 1</span><br><span class="line">;ä»£ç è‡ªåŠ¨è·Ÿè¸ª</span><br><span class="line">xdebug.auto_trace = off</span><br><span class="line">;æ”¶é›†ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°å˜é‡</span><br><span class="line">xdebug.collect_params=on</span><br><span class="line">;æ”¶é›†å‡½æ•°è°ƒç”¨çš„è¿”å›å€¼</span><br><span class="line">xdebug.collect_return=on</span><br><span class="line">;æ€§èƒ½æ£€æµ‹åˆ†æ</span><br><span class="line">xdebug.profiler_enable_trigger = on</span><br><span class="line">;ç”Ÿæˆçš„åˆ†ææ–‡ä»¶</span><br><span class="line">xdebug.profiler_output_name = cachegrind.out.%t.%p</span><br><span class="line">;å †æ ˆè·Ÿè¸ªæ–‡ä»¶çš„å­˜æ”¾ç›®å½•</span><br><span class="line">xdebug.profiler_output_dir = &quot;D:/laragon/tmp&quot;</span><br><span class="line">extension=php_printer.dll</span><br><span class="line">;æŒ‡å®šä¼ é€’ç»™DBGpè°ƒè¯•å™¨å¤„ç†ç¨‹åºçš„IDE Key åœ¨Chromeä»¥åŠFireFoxä¸­æ’ä»¶é…ç½®çš„æ—¶å€™è¦ç”¨åˆ°</span><br><span class="line">xdebug.idekey=PHPSTORM</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>é‡å¯æœåŠ¡å™¨ï¼ŒæŸ¥çœ‹ <code>phpinfo()</code>ï¼Œå³å¯çœ‹åˆ° <code>xdebug</code>æ¨¡å—çš„ç›¸å…³ä¿¡æ¯</p>
<p><img src="/images/PhpStorm/PhpStorm-Xdebug-configuration/bd9f206bgy1fnqo4lrkfaj20s303vt8m.jpg"></p>
<h2 id="é…ç½®-PhpStorm"><a href="#é…ç½®-PhpStorm" class="headerlink" title="é…ç½® PhpStorm"></a>é…ç½® PhpStorm</h2><ul>
<li>è®¾ç½®xdebugç«¯å£å·</li>
</ul>
<p><img src="/images/PhpStorm/PhpStorm-Xdebug-configuration/bd9f206bgy1fnqo81tanhj20t60lojt7.jpg"></p>
<ul>
<li>è®¾ç½® servers</li>
</ul>
<p><img src="/images/PhpStorm/PhpStorm-Xdebug-configuration/bd9f206bgy1fnqoc4r7s6j20t40lnmya.jpg"></p>
<ul>
<li>å¼€å¯ç›‘å¬</li>
</ul>
<p><img src="/images/PhpStorm/PhpStorm-Xdebug-configuration/bd9f206bgy1fnqoj40trwj20o601nt8s.jpg"></p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>åœ¨éœ€è¦æ‰“æ–­ç‚¹çš„åœ°æ–¹æ‰“æ–­ç‚¹ï¼Œè®¿é—®ç›¸åº”çš„ web é¡µé¢æˆ–æ¥å£å³å¯å¯åŠ¨æ–­ç‚¹ï¼Œè¿˜å¯ä»¥çœ‹åˆ°æ‰§è¡Œåˆ°è¯¥æ–­ç‚¹å‰çš„æ‰€æœ‰å˜é‡ã€‚</p>
]]></content>
      <categories>
        <category>PhpStorm</category>
      </categories>
      <tags>
        <tag>PhpStorm</tag>
        <tag>Xdebug</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP å…¨å±€ä½¿ç”¨ Laravel è¾…åŠ©å‡½æ•° dd</title>
    <url>/PHP/php-global-uses-the-laravel-helper-function-dd/</url>
    <content><![CDATA[<h2 id="å…¨å±€å®‰è£…"><a href="#å…¨å±€å®‰è£…" class="headerlink" title="å…¨å±€å®‰è£…"></a>å…¨å±€å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ composer global require symfony/var-dumper 2.7.*</span><br></pre></td></tr></table></figure>

<div class="note warning"><p>åŠ ä¸Šå›ºå®šç‰ˆæœ¬å·æ˜¯å› ä¸ºå¦‚æœæœ¬åœ°ä½ç‰ˆæœ¬çš„ Laravel é¡¹ç›®(æ¯”å¦‚ Laravel 5.1)ï¼Œå®ƒé‡Œé¢ä¾èµ–çš„ç‰ˆæœ¬æ˜¯ <code>2.7.*</code> ï¼Œå¦‚æœä¸æŒ‡å®šç‰ˆæœ¬ä¼šå®‰è£…æœ€æ–°çš„ <code>3.3.*</code>ï¼Œç”±äºåœ¨ Laravel é¡¹ç›®ä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if (! function_exists(&#x27;dd&#x27;)) &#123;</span><br><span class="line">     function dd()&#123;</span><br><span class="line">        ...</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çš„ç¼˜æ•…ï¼Œå¯¼è‡´ä½¿ç”¨å…¨å±€å®šä¹‰çš„ dd function ã€‚ä¼šå‡ºç°ä¸å…¼å®¹æŠ¥é”™çš„æƒ…å†µã€‚</p>
</div>

<h2 id="é…ç½®-php-ini"><a href="#é…ç½®-php-ini" class="headerlink" title="é…ç½® php.ini"></a>é…ç½® php.ini</h2><p>åœ¨ php.ini ä¸­æ‰¾åˆ° <code>auto_prepend_file</code>ï¼Œç„¶åå†™ä¸Šä½ ç›¸å¯¹åº”çš„è·¯å¾„ï¼Œæ¯”å¦‚æˆ‘çš„è·¯å¾„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">auto_prepend_file = &quot;C:/Users/Administrator.N27NDU1NHONBOGF/AppData/Roaming/Composer/vendor/autoload.php&quot;</span><br></pre></td></tr></table></figure>

<h2 id="æ›´æ–°-composer"><a href="#æ›´æ–°-composer" class="headerlink" title="æ›´æ–° composer"></a>æ›´æ–° composer</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ composer global update</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ä¸€æ¥å°±å¯ä»¥ä½¿ç”¨ <code>dump()</code> äº†ã€‚ä¸è¿‡è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬è¿˜è¦æŠŠ <code>dd()</code> çš„ä»£ç æ”¾è¿›æ¥ã€‚</p>
<span id="more"></span>

<h2 id="å‡†å¤‡-dd"><a href="#å‡†å¤‡-dd" class="headerlink" title="å‡†å¤‡ dd()"></a>å‡†å¤‡ dd()</h2><p>æ‰¾ä¸ªåœ°æ–¹å¤åˆ¶ä»¥ä¸‹ä»£ç ï¼ˆæˆ‘ç›´æ¥å‘½åæˆ <code>debugHelper.php</code> ï¼‰</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># install symfony/var-dump to your project</span></span><br><span class="line"><span class="comment"># composer require symfony/var-dumper</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// use namespace</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">VarDumper</span>\<span class="title">Cloner</span>\<span class="title">VarCloner</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">VarDumper</span>\<span class="title">Dumper</span>\<span class="title">CliDumper</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">VarDumper</span>\<span class="title">Dumper</span>\<span class="title">HtmlDumper</span> <span class="keyword">as</span> <span class="title">SymfonyHtmlDumper</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Class HtmlDumper</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HtmlDumper</span> <span class="keyword">extends</span> <span class="title">SymfonyHtmlDumper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Colour definitions for output.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$styles</span> = [</span><br><span class="line">        <span class="string">&#x27;default&#x27;</span> =&gt; <span class="string">&#x27;background-color:#fff; color:#222; line-height:1.2em; font-weight:normal; font:12px Monaco, Consolas, monospace; word-wrap: break-word; white-space: pre-wrap; position:relative; z-index:100000&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;num&#x27;</span> =&gt; <span class="string">&#x27;color:#a71d5d&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;const&#x27;</span> =&gt; <span class="string">&#x27;color:#795da3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;str&#x27;</span> =&gt; <span class="string">&#x27;color:#df5000&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;cchr&#x27;</span> =&gt; <span class="string">&#x27;color:#222&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;note&#x27;</span> =&gt; <span class="string">&#x27;color:#a71d5d&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;ref&#x27;</span> =&gt; <span class="string">&#x27;color:#a0a0a0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;public&#x27;</span> =&gt; <span class="string">&#x27;color:#795da3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;protected&#x27;</span> =&gt; <span class="string">&#x27;color:#795da3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;private&#x27;</span> =&gt; <span class="string">&#x27;color:#795da3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;meta&#x27;</span> =&gt; <span class="string">&#x27;color:#b729d9&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;key&#x27;</span> =&gt; <span class="string">&#x27;color:#df5000&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;index&#x27;</span> =&gt; <span class="string">&#x27;color:#a71d5d&#x27;</span>,</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Class Dumper</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dumper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Dump a value with elegance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  mixed  $value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">dump</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">class_exists</span>(<span class="title class_">CliDumper</span>::<span class="variable language_">class</span>)) &#123;</span><br><span class="line">            <span class="variable">$dumper</span> = <span class="string">&#x27;cli&#x27;</span> === PHP_SAPI ? <span class="keyword">new</span> CliDumper : <span class="keyword">new</span> HtmlDumper;</span><br><span class="line">            <span class="variable">$dumper</span>-&gt;<span class="title function_ invoke__">dump</span>((<span class="keyword">new</span> VarCloner)-&gt;<span class="title function_ invoke__">cloneVar</span>(<span class="variable">$value</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">var_dump</span>(<span class="variable">$value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (! <span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;dd&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Dump the passed variables and end the script.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  mixed</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">dd</span>(<span class="params">...<span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$args</span> <span class="keyword">as</span> <span class="variable">$x</span>) &#123;</span><br><span class="line">            (<span class="keyword">new</span> Dumper)-&gt;<span class="title function_ invoke__">dump</span>(<span class="variable">$x</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">die</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (! <span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;dda&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Dump the passed array variables and end the script.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  mixed</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">dda</span>(<span class="params">...<span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$args</span> <span class="keyword">as</span> <span class="variable">$x</span>) &#123;</span><br><span class="line">            (<span class="keyword">new</span> Dumper)-&gt;<span class="title function_ invoke__">dump</span>(<span class="variable">$x</span>-&gt;<span class="title function_ invoke__">toArray</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">die</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è®°ä¸‹è¿™ä¸ªæ–‡ä»¶çš„è·¯å¾„ï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯ï¼š<code>D:/composer/debugHelper.php</code></p>
<h2 id="æ›´æ”¹å…¨å±€-composer-json"><a href="#æ›´æ”¹å…¨å±€-composer-json" class="headerlink" title="æ›´æ”¹å…¨å±€ composer.json"></a>æ›´æ”¹å…¨å±€ composer.json</h2><p>ç„¶åæˆ‘ä»¬æ‰¾åˆ°å…¨å±€çš„ <code>composer.json</code> æ‰€åœ¨çš„ä½ç½®ï¼Œé€šå¸¸åœ¨ç”¨æˆ·æ ¹ç›®å½•ä¸‹ï¼Œåœ¨ autoload ä¸­å¢åŠ è¿™ä¸ªæ–‡ä»¶çš„è·¯å¾„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ....</span><br><span class="line">    &quot;require&quot;: &#123;</span><br><span class="line">        .....</span><br><span class="line">        &quot;symfony/var-dumper&quot;: &quot;2.7.*&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;autoload&quot;: &#123;</span><br><span class="line">        &quot;files&quot;: [</span><br><span class="line">                &quot;D:/composer/debugHelper.php&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åæ›´æ–°ä¸€ä¸‹ï¼Œå°±å¯ä»¥ dd ç”¨èµ·æ¥äº†ï¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ composer global dump-autoload</span><br></pre></td></tr></table></figure>

<div class="note default"><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://laravel-china.org/articles/5075/php-global-uses-the-laravel-helper-function-dd">PHP å…¨å±€ä½¿ç”¨ Laravel è¾…åŠ©å‡½æ•° dd</a> </p>
</div>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Laravel</tag>
        <tag>dd</tag>
      </tags>
  </entry>
  <entry>
    <title>å…­ä¸ªé²œä¸ºäººçŸ¥çš„ Composer å‘½ä»¤</title>
    <url>/Composer/six-lesser-known-composer-commands-you-should-know/</url>
    <content><![CDATA[<p>Composer æ˜¯ PHP çš„ä¸€ä¸ªä¾èµ–ç®¡ç†å·¥å…·ã€‚ å¦‚æœä½ æ˜¯ä¸€å PHP å¼€å‘äººå‘˜ï¼Œé‚£ä¹ˆä½ å¾ˆå¯èƒ½æ¯å¤©éƒ½åœ¨ä½¿ç”¨å®ƒå¹¶ä¸”é¢‘ç¹çš„è¿è¡Œå‘½ä»¤Â <code>require</code>ï¼ŒÂ <code>install</code>Â å’ŒÂ <code>update</code>ã€‚ä¹Ÿè®¸ä½ å¹¶æ²¡æœ‰æ„è¯†åˆ°ï¼Œ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›å…¶ä»–çš„ Composer å‘½ä»¤ï¼Œæ¥æ›´åŠ è½»æ¾çš„ä½¿ç”¨å®ƒã€‚</p>
<p>å®ƒæœ‰è®¸å¤šçš„å‘½ä»¤å¯ä»¥ä½¿ç”¨ï¼Œä½†ä»Šå¤©æˆ‘å°†åˆ†äº«æˆ‘ä½¿ç”¨çš„å¹¶ä¸”æ¯å¤©éƒ½æœ‰å¸®åŠ©çš„ 6 ä¸ªå‘½ä»¤ã€‚</p>
<h2 id="show"><a href="#show" class="headerlink" title="show"></a>show</h2><p>å…ˆè¯´ä¸‹Â <code>show</code>Â å‘½ä»¤ã€‚å®ƒå…è®¸æ‚¨æŸ¥çœ‹é¡¹ç›®çš„æ‰€æœ‰å·²å®‰è£…åŒ…(åŒ…æ‹¬ä¾èµ–é¡¹)ï¼Œä»¥åŠæŸ¥çœ‹ç›¸å…³åŒ…çš„è¯´æ˜ã€‚æ‰€æœ‰è¿™äº›ä¿¡æ¯éƒ½å¯ä»¥åœ¨Composeré”æ–‡ä»¶(composer.lock)ä¸­æ‰¾åˆ°, ä½†æ˜¯ä½¿ç”¨Â <code>show</code>Â å‘½ä»¤ç›¸å¯¹æ¥è¯´æ˜¯ä¸€ç§æ›´ç®€å•ã€æ›´æ–¹ä¾¿çš„ä¸€ç§æŸ¥çœ‹åŒ…ä¿¡æ¯çš„æ–¹æ³•ã€‚</p>
<p>è¦åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„åŒ…åŠå…¶ç‰ˆæœ¬å·å’Œè¯´æ˜ï¼Œåªéœ€ä½¿ç”¨Â <code>show</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer show</span><br></pre></td></tr></table></figure>

<p>æœ‰æ—¶å€™æŠŠè¿™äº›ä¿¡æ¯ç”¨ä¾èµ–å…³ç³»æ ‘çš„å½¢å¼æŸ¥çœ‹ä¼šæ›´å®¹æ˜“ç†è§£ï¼Œ å¯ä»¥é€šè¿‡Â <code>--tree</code>Â orÂ <code>-t</code>Â å‚æ•°:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer show -t</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>å¦‚æœè¦ç­›é€‰è¿”å›çš„åŒ…ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ä¼ é€’ä¸€ä¸ªé¢å¤–çš„å­—ç¬¦ä¸²å‚æ•°Â <code>*</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer show &#x27;symfony/*&#x27;</span><br></pre></td></tr></table></figure>

<p>è¿™å°†è¿”å›æ‰€æœ‰å·²å®‰è£…çš„symfonyåŒ…ã€‚æ³¨æ„è¿™é‡Œçš„å¼•å·, å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ bash shellï¼Œä¸éœ€è¦åŠ è¿™ä¸ªå¼•å·, ä½†æ˜¯å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ zsh ä½ ä¸ç”¨å¼•å·çš„è¯å°±ä¼šæŠ¥ â€˜no matches foundâ€™ é”™è¯¯ã€‚</p>
<p>å¦‚æœè¦æŸ¥çœ‹æœ‰å…³ç‰¹å®šåŒ…çš„ä¿¡æ¯ï¼Œéœ€è¦å®Œæ•´åŒ…å:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer show laravel/framework</span><br></pre></td></tr></table></figure>

<p>è¿™å°†å‘æ‚¨æ˜¾ç¤ºå®‰è£…çš„ç‰ˆæœ¬ã€å®ƒçš„è®¸å¯è¯å’Œä¾èµ–é¡¹ä»¥åŠå®ƒåœ¨æœ¬åœ°å®‰è£…çš„ä½ç½®ç­‰ä¿¡æ¯ã€‚</p>
<h2 id="why"><a href="#why" class="headerlink" title="why"></a>why</h2><p>å¦‚æœæ‚¨æƒ³çŸ¥é“å®‰è£…ç‰¹å®šè½¯ä»¶åŒ…çš„åŸå› ï¼Œå¯ä»¥ä½¿ç”¨ why å‘½ä»¤æ¥ç¡®å®šå“ªäº›ä¾èµ–é¡¹éœ€è¦å®ƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer why vlucas/phpdotenv</span><br></pre></td></tr></table></figure>

<p><code>why</code>  ä¸ºä»€ä¹ˆæ˜¯dependså‘½ä»¤çš„åˆ«åï¼Œä½†å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘å‘ç°ä½¿ç”¨ â€˜whyâ€™ æ›´å®¹æ˜“è®°ä½ã€‚æ‚¨å¯ä»¥ä½¿ç”¨<code>--tree</code>æˆ–<code>-t</code>æ ‡å¿—åœ¨ä¾èµ–æ ‘ä¸­æŸ¥çœ‹æ­¤ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer why vlucas/phpdotenv -t</span><br></pre></td></tr></table></figure>


<h2 id="why-not"><a href="#why-not" class="headerlink" title="why-not"></a>why-not</h2><p>æœ‰æ—¶ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªå·²å®‰è£…çš„è½¯ä»¶åŒ…å°†é˜»æ­¢å®‰è£…æˆ–æ›´æ–°è½¯ä»¶åŒ…ã€‚ ä¸ºäº†æ£€æŸ¥æ˜¯å“ªäº›å®‰è£…åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>why-not</code> å‘½ä»¤ï¼ˆåˆ«åä¸º <code>prohibits</code>ï¼‰ã€‚ ä¾‹å¦‚ï¼ŒLaravel æœ€è¿‘å‘å¸ƒäº†ä¸€ä¸ªæ–°çš„5.8ç‰ˆæœ¬çš„æ¡†æ¶; æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>why-not</code> å‘½ä»¤æ£€æŸ¥ä»»ä½•é˜»æ­¢æˆ‘ä»¬æ›´æ–° <code>laravel/framework</code> åŒ…çš„åŒ…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer why-not laravel/framework 5.8</span><br></pre></td></tr></table></figure>

<p>åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>--tree</code> æˆ– <code>-t</code> æ ‡è®°åœ¨ä¾èµ–å…³ç³»æ ‘ä¸­æŸ¥çœ‹æ­¤ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer why-not laravel/framework 5.8 -t</span><br></pre></td></tr></table></figure>



<h2 id="outdated"><a href="#outdated" class="headerlink" title="outdated"></a>outdated</h2><p>åœ¨ä½¿ç”¨Â <code>composer update</code>Â å‘½ä»¤å‰ï¼Œä½ ä¹Ÿè®¸æƒ³æ£€æµ‹ä¸€ä¸‹å·²å®‰è£…çš„åŒ…ï¼Œå“ªäº›æœ‰å¯ä»¥å‡çº§çš„ã€‚è¿™å¯ä»¥ä½¿ç”¨Â <code>outdated</code>Â å‘½ä»¤ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer outdated</span><br></pre></td></tr></table></figure>

<p>æ­¤å‘½ä»¤æ˜¯Â <code>composer show -lo</code> çš„åˆ«åä¹‹ä¸€ã€‚</p>
<p>æ ¹æ®è¯­ä¹‰åŒ–çš„ç‰ˆæœ¬ï¼Œè¿”å›ç€è‰²çš„ä»£ç ï¼Œæ¥æ ‡æ˜æ¯ä¸ªåŒ…çš„çŠ¶æ€ï¼š</p>
<ul>
<li><strong>Green:</strong> å½“å‰å®‰è£…åŒ…å·²æ˜¯æœ€æ–°ç‰ˆæœ¬</li>
<li><strong>Yellow:</strong>Â æœ‰å¯å‡çº§çš„æ›´æ–°, ä½†å¯èƒ½æœ‰ä¸å…¼å®¹çš„ä¿®æ”¹ã€‚</li>
<li><strong>Red:</strong>Â æœ‰å¯ç”¨çš„å°ç‰ˆæœ¬å‡çº§ (ä¸€èˆ¬æ˜¯bugä¿®å¤)</li>
</ul>
<p>å¦‚æœå¸Œæœ›é«˜äº®æ˜¾ç¤ºå°çš„å‡çº§ç‰ˆæœ¬, å¯ä»¥ä½¿ç”¨ <code>outdated</code>Â å‘½ä»¤ï¼Œä»¥<code>--minor-only</code>Â æˆ–è€…Â <code>-m</code>Â å‚æ•°Â ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer outdated -m</span><br></pre></td></tr></table></figure>


<h2 id="çŠ¶æ€"><a href="#çŠ¶æ€" class="headerlink" title="çŠ¶æ€"></a>çŠ¶æ€</h2><p>æˆ‘å‘ç°è‡ªå·±ç»å¸¸ä¼šä½¿ç”¨ <code>install</code> ã€<code>update</code> å‘½ä»¤çš„å‚æ•° <code>--prefer-source</code> æ¥å¤„ç†æºä»£ç å®‰è£…çš„ä¾èµ–é¡¹ã€‚ ç„¶åï¼Œå¦‚æœæˆ‘ä¿®æ”¹äº†ä»»ä½•è¿™äº›ä¾èµ–é¡¹ï¼Œæˆ‘éœ€è¦ä¸€ç§å¿«é€Ÿæ£€æŸ¥å“ªäº›åŒ…å·²è¢«ä¿®æ”¹çš„æ–¹æ³•ã€‚ <code>status</code> å‘½ä»¤æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•ã€‚</p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>--verbose</code> æˆ– <code>-v</code> å‚æ•°æ¥æŸ¥çœ‹æœ¬åœ°ä¿®æ”¹çš„è½¯ä»¶åŒ…å’Œæ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer status -v</span><br></pre></td></tr></table></figure>

<p>æˆ‘å‘ç°ä½¿ç”¨ verbose æ ‡è®°æ˜¯ä½¿ç”¨æ­¤å‘½ä»¤æœ€æœ‰ç”¨çš„æ–¹æ³•ã€‚</p>
<h2 id="è®¸å¯"><a href="#è®¸å¯" class="headerlink" title="è®¸å¯"></a>è®¸å¯</h2><p>æœ€åï¼ŒçŸ¥é“æ‚¨å®‰è£…çš„æ¯ä¸ªè½¯ä»¶åŒ…çš„è®¸å¯è¯æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ Composer æœ‰ä¸€ä¸ªæ–¹ä¾¿çš„ <code>licenses</code> å‘½ä»¤ï¼Œç”¨äºæŸ¥è¯¢è®¸å¯çš„å®Œæ•´åˆ—è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer licenses</span><br></pre></td></tr></table></figure>

<div class="note default"><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://learnku.com/laravel/t/28678">æ¨èå…­ä¸ªé²œä¸ºäººçŸ¥çš„ Composer å‘½ä»¤</a></p>
</div>]]></content>
      <categories>
        <category>Composer</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Composer</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPStorm å®ç”¨çš„å¿«æ·é”®</title>
    <url>/PhpStorm/phpstorm-useful-shortcuts/</url>
    <content><![CDATA[<h2 id="å¿«æ·é”®"><a href="#å¿«æ·é”®" class="headerlink" title="å¿«æ·é”®"></a>å¿«æ·é”®</h2><h3 id="æ§åˆ¶å…‰æ ‡ä½ç½®"><a href="#æ§åˆ¶å…‰æ ‡ä½ç½®" class="headerlink" title="æ§åˆ¶å…‰æ ‡ä½ç½®"></a>æ§åˆ¶å…‰æ ‡ä½ç½®</h3><ul>
<li><code>ctrl + m</code> å°†å…‰æ ‡å®šä½åˆ°æ–‡ä»¶ä¸­å¿ƒ</li>
<li><code>alt + j</code> å¤šåˆ—æ¨¡å¼è¿›è¡Œé€‰ä¸­,åªä¼šé€‰æ‹©ç›¸åŒçš„å•è¯</li>
<li><code>alt + shift + j</code> å–æ¶ˆå¤šåˆ—æ¨¡å¼</li>
<li><code>home, end</code> ç§»åŠ¨åˆ°è¡Œé¦–æˆ–è¡Œæœ«</li>
<li><code>ctrl + shift + m</code> åŒ¹é…æ‹¬å·çš„ä½ç½®ï¼Œä¼šå°†å…‰æ ‡ç§»åŠ¨åˆ°å¯¹åº”æ­£æ‹¬å·å’Œåæ‹¬å·ä½ç½®</li>
<li><code>ctrl + [ æˆ– ]</code> å…·æœ‰ç›¸ä¼¼åŠŸèƒ½</li>
<li><code>ctrl + shift + [ æˆ– ]</code> å¯å·²é€‰ä¸­å¯¹åº”çš„æ‹¬å·åŒºåŸŸ</li>
<li><code>ctrl + pageup</code> å°†å…‰æ ‡ç§»åŠ¨åˆ°é¡µé¢é¡¶å¤´</li>
<li><code>ctrl + pagedown</code> å°†å…‰æ ‡ç§»åŠ¨åˆ°é¡µé¢åº•éƒ¨</li>
<li><code>ctrl + g</code> è¾“å…¥:è¡Œå·:åˆ—å·å¿«é€Ÿå®šä½æ–‡ä»¶ä½ç½®</li>
</ul>
<h3 id="ç¼–è¾‘æ–‡æ¡£"><a href="#ç¼–è¾‘æ–‡æ¡£" class="headerlink" title="ç¼–è¾‘æ–‡æ¡£"></a>ç¼–è¾‘æ–‡æ¡£</h3><h4 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h4><ul>
<li><code>ctrl + y</code> åˆ é™¤ä¸€è¡Œ</li>
<li><code>ctrl + delete</code> åˆ é™¤å…‰æ ‡åå†…å®¹</li>
<li><code>ctrl + backspace</code> åˆ é™¤å…‰æ ‡å‰ä¸€ä¸ªå­—çš„å†…å®¹</li>
<li><code>ctrl + enter</code> åœ¨è¡Œé¦–ä¼šåœ¨è¯¥è¡Œå‰åˆ›å»ºæ–°è¡Œï¼Œè¡Œæœ«ä¼šåœ¨æ”¹è¡Œååˆ›å»ºæ–°è¡Œ</li>
</ul>
<h4 id="å¤åˆ¶"><a href="#å¤åˆ¶" class="headerlink" title="å¤åˆ¶"></a>å¤åˆ¶</h4><ul>
<li><code>ctrl + d</code> å¤åˆ¶é€‰ä¸­å—ï¼Œè‹¥æ²¡æœ‰åˆ™åªæ˜¯å¤åˆ¶å½“å‰è¡Œ</li>
<li><code>ctrl + shift + v</code> ç²˜è´´æ–‡æ¡£æ—¶å¯ä»¥é€‰æ‹©è¡Œæ•°ï¼Œå¤šé€‰æ—¶æŒ‰ä½ shiftï¼Œä¹Ÿå¯ä»¥æ˜¾ç¤ºå‰ªåˆ‡æ¿å†å²</li>
</ul>
<span id="more"></span>

<h4 id="é€‰æ‹©ç§»åŠ¨"><a href="#é€‰æ‹©ç§»åŠ¨" class="headerlink" title="é€‰æ‹©ç§»åŠ¨"></a>é€‰æ‹©ç§»åŠ¨</h4><ul>
<li><code>ctrl + w</code> è¿›è¡Œé€‰æ‹©æ‰©å±•ï¼ŒåŠ  shift åå‘æ“ä½œæ‰©å±•</li>
<li><code>shift + â†‘ æˆ– â†“</code> å‘ä¸Šæˆ–å‘ä¸‹ç§»åŠ¨ä¸€è¡Œ</li>
<li><code>shift + home æˆ– end</code> é€‰æ‹©å…‰æ ‡åˆ°è¡Œé¦–æˆ–è¡Œæœ«çš„å†…å®¹</li>
<li><code>pageup, pagedown</code> å‘ä¸Šæˆ–å‘ä¸‹ç§»åŠ¨ä¸€é¡µ</li>
<li><code>shift pageup, pagedown</code> å‘ä¸Šæˆ–å‘ä¸‹é€‰æ‹©ä¸€é¡µ</li>
<li><code>ctrl + shift + [ æˆ– ]</code> é€‰æ‹©åŒ¹é…æ‹¬å·çš„å†…å®¹ï¼Œæ³¨æ„ä½¿ç”¨æ—¶å…‰æ ‡è¦æ”¾åœ¨æ‹¬å·å‰åæ‰èµ·ä½œç”¨</li>
<li><code>shift + alt + â†‘ æˆ– â†“</code> å°†å…‰æ ‡å¯¹åº”è¡Œå‘ä¸Šæˆ–å‘ä¸‹ç§»åŠ¨ï¼Œä¹Ÿå¯ä»¥é€‰ä¸­å¤šè¡Œè¿›è¡Œç§»åŠ¨</li>
<li><code>shift + ctrl + â†‘ æˆ– â†“</code> å¯¹äºå‡½æ•°ç­‰å†…å®¹ï¼Œå®ƒæ˜¯å‘ä¸Šæˆ–å‘ä¸‹ç§»åŠ¨æ•´ä¸ªå‡½æ•°</li>
<li><code>ctrl + shift + l</code> æ ¼å¼åŒ–ä»£ç ï¼Œå†åŠ ä¸Š alt å¯ä»¥æ ¼å¼åŒ–å…¨å±€</li>
<li><code>alt + shift + insert</code> å®ç°æŒ‰ç…§çŸ©å½¢æ ¼å¼æ¥é€‰æ‹©æ–‡æœ¬çš„åŠŸèƒ½</li>
</ul>
<h4 id="æ–‡ä»¶æ§åˆ¶"><a href="#æ–‡ä»¶æ§åˆ¶" class="headerlink" title="æ–‡ä»¶æ§åˆ¶"></a>æ–‡ä»¶æ§åˆ¶</h4><ul>
<li><code>ctrl + b</code> è·³è½¬åˆ°å‡½æ•° ï¼Œæˆ–è€…æŒ‰ä½ ctrl ç‚¹å‡»å‡½æ•°ä¹Ÿå¯å®ç°è¯¥æ•ˆæœã€‚</li>
<li><code>ctrl + f12</code> æ˜¾ç¤ºå‡½æ•°ä¹‹é—´çš„ç»“æ„å…³ç³»</li>
<li><code>alt + â†‘ æˆ– â†“</code> å‡½æ•°è·³è½¬çš„ä¸Šä¸‹åˆ‡æ¢</li>
<li><code>ctrl + alt + â† æˆ– â†’</code> å®ç°å‰è¿›å’Œè¿”å›ï¼Œä½†æ˜¯åœ¨ windows ä¸­è¿™ä¸¤ä¸ªå¿«æ·é”®è¢«ç”¨æ¥è½¬æ¢å±å¹•,æ‰€ä»¥å»ºè®®è‡ªå®šä¹‰å¿«æ·é”®</li>
<li><code>ctrl + alt + backspace</code> ä¹Ÿå¯å®ç°è¿”å›çš„åŠŸèƒ½</li>
<li><code>F2</code> å½“å‡ºç°è§„åˆ™æ£€æŸ¥é”™è¯¯æ—¶è¿›è¡Œå¯¼èˆªï¼ŒåŠ  shift ä¸ºåå‘å¯¼èˆªï¼Œåˆ©ç”¨ ctrl+f1 æŸ¥çœ‹é”™è¯¯åŸå› ï¼Œalt+enter æŸ¥çœ‹è§£å†³åŠæ³•</li>
<li><code>F6 å’Œ F5</code> ç§»åŠ¨å’Œå¤åˆ¶æ–‡ä»¶ï¼Œåœ¨å¼¹å‡ºæ¡†ä¸­å†™å…¥è·¯å¾„å³å¯</li>
<li><code>ctrl + alt + shift + t</code> åœ¨é¡¹ç›®æ–‡ä»¶æ ‘ä¸­ä½¿ç”¨ï¼Œä¼šå‡ºç°å¯¹æ–‡ä»¶ç§»åŠ¨ã€å¤åˆ¶ç­‰æ“ä½œ</li>
<li><code>shift + f6</code> é¡¹ç›®çª—å£ä¸­ä½¿ç”¨å¯ä»¥é‡å‘½åæ–‡ä»¶ï¼Œåœ¨ç¼–è¾‘æ¨¡å¼ä¸‹æ²¡æœ‰ä½œç”¨</li>
<li><code>alt + insert</code> æ–°å»ºæ–‡ä»¶</li>
<li><code>ctrl + shift + f</code> åœ¨å·¥ç¨‹ä¸­æŸ¥æ‰¾å†…å®¹</li>
<li><code>ctrl + shift + U</code> æˆ–è€… edit | toggle case ä¿®æ”¹å­—æ¯å¤§å°å†™</li>
</ul>
<h4 id="è®¾ç½®ä¸æŸ¥æ‰¾"><a href="#è®¾ç½®ä¸æŸ¥æ‰¾" class="headerlink" title="è®¾ç½®ä¸æŸ¥æ‰¾"></a>è®¾ç½®ä¸æŸ¥æ‰¾</h4><ul>
<li><code>ctrl + n</code> å…¨å±€æŸ¥æ‰¾ç±»</li>
<li><code>ctrl + f</code> æ–‡ä»¶ä¸­æŸ¥æ‰¾,æ”¯æŒæ­£åˆ™</li>
<li><code>ctrl + shift + f</code> æ”¯æŒåœ¨æ•´ä¸ªé¡¹ç›®ä¸­æŸ¥æ‰¾,ç”šè‡³æ˜¯æ•´ä¸ªç£ç›˜ä¸­</li>
<li><code>ctrl + r</code> æ–‡ä»¶æ›¿æ¢,æ”¯æŒæ­£åˆ™</li>
<li><code>ctrl + shift + r</code> æ”¯æŒåœ¨é¡¹ç›®ä¸­è¿›è¡Œæ‰¹é‡æ›¿æ¢</li>
<li><code>shift + f6</code> å¯ä»¥åˆ©ç”¨è¯¥åŠŸèƒ½å®ç°é¡¹ç›®ä¸­å˜é‡æˆ–æ–‡ä»¶çš„é‡å‘½å</li>
<li><code>ctrl + shift + n</code> å…¨å±€æŸ¥æ‰¾æ–‡ä»¶ï¼Œä½ å¯ä»¥åœ¨æŸ¥æ‰¾æ—¶è¿½åŠ :è¡Œå·:åˆ—å·å¿«é€Ÿå®šä½æ–‡ä»¶ä½ç½®</li>
<li><code>ctrl + shift + n</code> ä½¿ç”¨è¯¥æ–¹æ³•ä¹Ÿå¯ä»¥æŸ¥æ‰¾ç›®å½•ï¼Œåªéœ€è¦åœ¨æœç´¢å…³é”®å­—ååŠ ä¸Š&#x2F;çš„è·¯å¾„ç´¢å¼•ç¬¦å³å¯</li>
<li><code>ctrl + shift + a</code> æŸ¥æ‰¾ PhpStorm å‘½ä»¤çš„åç§°ï¼ŒåŠå¿«æ·é”®ï¼Œå¯ä»¥è¿…é€Ÿæ‰§è¡Œ</li>
<li><code>ctrl + q</code> å¿«é€ŸæŸ¥æ‰¾æ–‡æ¡£å¸®åŠ©åœ¨é˜…è¯»å‡½æ•°æ—¶éå¸¸æœ‰ç”¨</li>
<li><code>ctrl + alt + t</code> åˆ©ç”¨æ­¤å®ç°ç¯ç»•</li>
</ul>
<h4 id="è®¾ç½®æ ‡ç­¾"><a href="#è®¾ç½®æ ‡ç­¾" class="headerlink" title="è®¾ç½®æ ‡ç­¾"></a>è®¾ç½®æ ‡ç­¾</h4><p><code>shift + f11, f11</code> è®¾ç½®å’Œæ¸…é™¤æ ‡ç­¾,åˆ©ç”¨æ ‡ç­¾æ¥è¿›è¡Œæ–‡ä»¶çš„ä¿®æ”¹</p>
<h4 id="æ·»åŠ æ³¨é‡Š"><a href="#æ·»åŠ æ³¨é‡Š" class="headerlink" title="æ·»åŠ æ³¨é‡Š"></a>æ·»åŠ æ³¨é‡Š</h4><ul>
<li><code>ctrl + /</code> æ·»åŠ å•è¡Œæ³¨é‡Š</li>
<li><code>ctrl + shift +\</code> æ·»åŠ å¤šè¡Œæ³¨é‡Š</li>
</ul>
<div class="note success"><p>æ³¨é‡Šæ¨¡å¼ä¼šéšç€ä½¿ç”¨è¯­è¨€è‡ªåŠ¨å˜åŒ–</p>
</div>

<h4 id="é«˜çº§ç¼–è¾‘åŠŸèƒ½"><a href="#é«˜çº§ç¼–è¾‘åŠŸèƒ½" class="headerlink" title="é«˜çº§ç¼–è¾‘åŠŸèƒ½"></a>é«˜çº§ç¼–è¾‘åŠŸèƒ½</h4><ul>
<li><code>alt + enter</code> åœ¨ç¼–è¾‘ php æ—¶ï¼Œè‹¥å­—ç¬¦ä¸²ä¸º HTML ç‰‡æ®µï¼Œå¯ä»¥åˆ©ç”¨è¯¥åŠŸèƒ½å®ç°ç‰‡æ®µä»£ç ç¼–å†™</li>
<li><code>alt + enter</code> è¯¥å‘½ä»¤åœ¨ä¸åŒç¯å¢ƒæœ‰å¤šç§æ“ä½œéå¸¸é‡è¦</li>
<li><code>ctrl + alt + m</code> åœ¨ç¼–ç æ—¶ï¼Œå¯ä»¥å°†é€‰æ‹©çš„å—æ–°å»ºæˆå‡½æ•°</li>
<li><code>shift + F6</code> åœ¨ä¿®æ”¹å‡½æ•°æˆ–æ–‡ä»¶åçš„åŒæ—¶ï¼Œå¼•ç”¨è¯¥å‡½æ•°æˆ–æ–‡ä»¶çš„åœ°æ–¹ä¹Ÿä¼šåŒæ—¶ä¿®æ”¹</li>
<li><code>ctrl + alt + n</code> å½“å…‰æ ‡åœ¨å‡½æ•°å˜é‡é™„è¿‘æ—¶ï¼Œä½¿ç”¨è¯¥å¿«æ·é”®ä¼šå°†å˜é‡å†…å®¹å˜æˆå†…è”æ¨¡å¼</li>
</ul>
<h3 id="å·¥ä½œçª—å£åˆ‡æ¢"><a href="#å·¥ä½œçª—å£åˆ‡æ¢" class="headerlink" title="å·¥ä½œçª—å£åˆ‡æ¢"></a>å·¥ä½œçª—å£åˆ‡æ¢</h3><h4 id="é¡¹ç›®æ ‘å’Œæ–‡ä»¶ä¹‹é—´çš„åˆ‡æ¢"><a href="#é¡¹ç›®æ ‘å’Œæ–‡ä»¶ä¹‹é—´çš„åˆ‡æ¢" class="headerlink" title="é¡¹ç›®æ ‘å’Œæ–‡ä»¶ä¹‹é—´çš„åˆ‡æ¢"></a>é¡¹ç›®æ ‘å’Œæ–‡ä»¶ä¹‹é—´çš„åˆ‡æ¢</h4><ul>
<li><code>alt + f1 + 1</code> åœ¨å…¨å±€æŸ¥æ‰¾åˆ°æ–‡ä»¶ä»¥åï¼Œåˆ©ç”¨è¯¥å¿«æ·é”®è¿…é€Ÿå®šä½åœ¨é¡¹ç›®æ ‘ä¸­çš„çš„ä½ç½®</li>
<li><code>f4</code> å®ç°åœ¨æŸ¥æ‰¾åˆ°çš„æ–‡ä»¶å’Œé¡¹ç›®æ ‘ä¹‹é—´è¿›è¡Œåˆ‡æ¢</li>
<li><code>alt + å·¦å³æ–¹å‘é”®</code> è¿›è¡Œæ–‡ä»¶åˆ‡æ¢</li>
</ul>
<h4 id="å·¥ä½œçª—å£åˆ‡æ¢-1"><a href="#å·¥ä½œçª—å£åˆ‡æ¢-1" class="headerlink" title="å·¥ä½œçª—å£åˆ‡æ¢"></a>å·¥ä½œçª—å£åˆ‡æ¢</h4><ul>
<li><code>ctrl + tab + å·¦å³æ–¹å‘é”®</code> åˆ‡æ¢æ‰€æœ‰å·¥ä½œé€‰é¡¹</li>
<li><code>alt + number</code> ä¾‹å¦‚ alt + 1 æ‰“å¼€å…³é—­å·¥ç¨‹</li>
<li><code>alt + 1</code> æ‰“å¼€å…³é—­å·¥ç¨‹æ–‡ä»¶å¤¹ï¼Œå¯ä»¥ç›´æ¥åœ¨é¡¹ç›®æ ‘ä¸­è¾“å…¥å­—ç¬¦è¿›è¡ŒæŸ¥æ‰¾ï¼Œä¹Ÿå¯åˆ©ç”¨ä¸Šä¸‹å·¦å³é”®è¿›è¡Œå±•å¼€</li>
<li><code>alt + 6</code> æŸ¥çœ‹ todo ä¿¡æ¯</li>
<li><code>alt + 7</code> æ‰“å¼€å‡½æ•°ç»“æ„æ˜¾ç¤º</li>
<li><code>ctrl + tab</code> åˆ‡æ¢æ˜¾ç¤ºå·¥å…·æ </li>
<li><code>alt + f12</code> å¿«é€Ÿæ‰“å¼€æ§åˆ¶å°</li>
<li><code>F12</code> æ‰“å¼€æœ€è¿‘å…³é—­çš„çª—å£</li>
<li><code>shift + esc</code> é€€å‡ºï¼Œesc ä¹Ÿæœ‰é€€å‡ºåŠŸèƒ½ã€‚</li>
<li><code>ctrl + f4</code> åœ¨éç¼–è¾‘çª—å£ä¸‹ä¼šé€€å‡ºï¼Œåœ¨ç¼–è¾‘çª—å£ä¸‹ä¼šå…³é—­å½“å‰çª—å£</li>
<li><code>f4 å’Œ shift + f4</code> æ‰“å¼€å·¥ç¨‹æ–‡ä»¶å¤¹ä¸­æ‰€åœ¨ä½ç½®çš„æ–‡ä»¶ï¼Œåœ¨æ–°çª—å£ä¸­æ‰“å¼€</li>
<li><code>ctrl + shift + e</code> æ‰“å¼€æœ€è¿‘ç¼–è¾‘çš„æ–‡ä»¶åˆ—è¡¨ï¼Œctrl + e ç›¸ä¼¼</li>
<li><code>alt + home</code> è¿…é€Ÿå›åˆ°é¡¶å±‚å¯¼èˆªæ ä½ç½®ï¼Œåˆ©ç”¨ä¸Šä¸‹å·¦å³ç®­å¤´åˆ‡æ¢æ–‡ä»¶ï¼Œè¿™æ˜¯å¯ä»¥åˆ©ç”¨ä¸Šä¸‹å·¦å³é”®è¿›è¡Œåˆ‡æ¢å’Œå±•å¼€</li>
<li><code>f2</code> å¯¼èˆªåˆ°ä¸‹ä¸€ä¸ªé”™è¯¯</li>
<li><code>shift + f2</code> ä¸Šä¸€ä¸ªé”™è¯¯</li>
<li><code>alt + f12</code> æ‰“å¼€ç»ˆç«¯</li>
<li><code>ctrl + shift + t</code> åœ¨æ‰“å¼€ç»ˆç«¯ä¸‹åˆ›å»ºæ–°ç»ˆç«¯</li>
<li><code>ctrl + shift + w</code> åœ¨æ‰“å¼€ç»ˆç«¯ä¸‹å…³é—­ç»ˆç«¯</li>
</ul>
<div class="note success"><p>æ‹–åŠ¨å·¥ä½œè·¯å¾„å’Œæ–‡ä»¶åˆ°ç»ˆç«¯ä¸‹ä¼šåˆ›å»ºä¸€ä¸ªæŒ‡å‘è¯¥è·¯å¾„çš„æ–°ç»ˆç«¯</p>
</div>

<h4 id="æ‚é¡¹"><a href="#æ‚é¡¹" class="headerlink" title="æ‚é¡¹"></a>æ‚é¡¹</h4><ul>
<li><code>ctrl + j</code> æŸ¥è¯¢å½“å‰æ–‡ä»¶æ”¯æŒçš„è‡ªå®šä¹‰æ¨¡æ¿</li>
</ul>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h3><p>PhpStorm æå…¶å ç”¨ç¼“å­˜ï¼Œå½“ç”µè„‘å˜æ…¢æ—¶ï¼Œåˆ©ç”¨ <code>file -&gt; invalidate caches/restart</code> é‡å¯åº”ç”¨</p>
<h3 id="å·¥å…·æ æ¶ˆå¤±"><a href="#å·¥å…·æ æ¶ˆå¤±" class="headerlink" title="å·¥å…·æ æ¶ˆå¤±"></a>å·¥å…·æ æ¶ˆå¤±</h3><p>è¿›å…¥ view èœå•é€‰æ‹© <code>tool bar</code> å’Œ <code>tool button</code> å³å¯</p>
<h3 id="æ¸…é™¤æ— ç”¨çš„-css-æ ·å¼"><a href="#æ¸…é™¤æ— ç”¨çš„-css-æ ·å¼" class="headerlink" title="æ¸…é™¤æ— ç”¨çš„ css æ ·å¼"></a>æ¸…é™¤æ— ç”¨çš„ css æ ·å¼</h3><ol>
<li><code>code -&gt; run inspection by name</code> æˆ–è€…åˆ©ç”¨å¿«æ·é”® <code>alt + ctrl + shift + i</code></li>
<li>è¾“å…¥ <code>unused css</code></li>
<li>é€‰æ‹©åˆ é™¤æ— æ•ˆçš„ css æ ·å¼</li>
</ol>
<h3 id="æ–‡ä»¶æ¢å¤"><a href="#æ–‡ä»¶æ¢å¤" class="headerlink" title="æ–‡ä»¶æ¢å¤"></a>æ–‡ä»¶æ¢å¤</h3><ol>
<li>å³é”®ç‚¹å‡»å·¥ç¨‹æ–‡ä»¶å¤¹</li>
<li>é€‰æ‹© <code>local history</code></li>
<li>é€‰æ‹© <code>show history</code></li>
<li>é€‰ä¸­æƒ³è¦è¿˜åŸçš„çŠ¶æ€ï¼Œç‚¹å‡»è¿”å›ç®­å¤´å³å¯</li>
</ol>
<h3 id="æ–‡æœ¬å¯¹é½"><a href="#æ–‡æœ¬å¯¹é½" class="headerlink" title="æ–‡æœ¬å¯¹é½"></a>æ–‡æœ¬å¯¹é½</h3><ol>
<li>é”®å€¼å¯¹å¯¹é½</li>
</ol>
<p><img src="/images/PhpStorm/phpstorm-useful-shortcuts/bd9f206bgy1fivscil9ydj20sg0ljmz8.png"></p>
<ol start="2">
<li>å˜é‡ç”³æ˜å¯¹é½</li>
</ol>
<p><img src="/images/PhpStorm/phpstorm-useful-shortcuts/bd9f206bgy1fivsdsl1tqj20sg0lhmzp.png"></p>
<div class="note default"><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://segmentfault.com/a/1190000010630844">phpstorm ä½¿ç”¨æŒ‡å—</a></p>
</div>]]></content>
      <categories>
        <category>PhpStorm</category>
      </categories>
      <tags>
        <tag>PhpStorm</tag>
      </tags>
  </entry>
  <entry>
    <title>nginxåŸºæœ¬é…ç½®ä¸å‚æ•°è¯´æ˜</title>
    <url>/Nginx/example-nginx-configuration/</url>
    <content><![CDATA[<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#è¿è¡Œç”¨æˆ·</span><br><span class="line">user nobody;</span><br><span class="line">#å¯åŠ¨è¿›ç¨‹,é€šå¸¸è®¾ç½®æˆå’Œcpuçš„æ•°é‡ç›¸ç­‰</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#å…¨å±€é”™è¯¯æ—¥å¿—åŠPIDæ–‡ä»¶</span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line">#å·¥ä½œæ¨¡å¼åŠè¿æ¥æ•°ä¸Šé™</span><br><span class="line">events &#123;</span><br><span class="line">    #epollæ˜¯å¤šè·¯å¤ç”¨IO(I/O Multiplexing)ä¸­çš„ä¸€ç§æ–¹å¼,</span><br><span class="line">    #ä»…ç”¨äºlinux2.6ä»¥ä¸Šå†…æ ¸,å¯ä»¥å¤§å¤§æé«˜nginxçš„æ€§èƒ½</span><br><span class="line">    use   epoll; </span><br><span class="line"></span><br><span class="line">    #å•ä¸ªåå°worker processè¿›ç¨‹çš„æœ€å¤§å¹¶å‘é“¾æ¥æ•°    </span><br><span class="line">    worker_connections  1024;</span><br><span class="line"></span><br><span class="line">    # å¹¶å‘æ€»æ•°æ˜¯ worker_processes å’Œ worker_connections çš„ä¹˜ç§¯</span><br><span class="line">    # å³ max_clients = worker_processes * worker_connections</span><br><span class="line">    # åœ¨è®¾ç½®äº†åå‘ä»£ç†çš„æƒ…å†µä¸‹ï¼Œmax_clients = worker_processes * worker_connections / 4  ä¸ºä»€ä¹ˆ</span><br><span class="line">    # ä¸ºä»€ä¹ˆä¸Šé¢åå‘ä»£ç†è¦é™¤ä»¥4ï¼Œåº”è¯¥è¯´æ˜¯ä¸€ä¸ªç»éªŒå€¼</span><br><span class="line">    # æ ¹æ®ä»¥ä¸Šæ¡ä»¶ï¼Œæ­£å¸¸æƒ…å†µä¸‹çš„Nginx Serverå¯ä»¥åº”ä»˜çš„æœ€å¤§è¿æ¥æ•°ä¸ºï¼š4 * 8000 = 32000</span><br><span class="line">    # worker_connections å€¼çš„è®¾ç½®è·Ÿç‰©ç†å†…å­˜å¤§å°æœ‰å…³</span><br><span class="line">    # å› ä¸ºå¹¶å‘å—IOçº¦æŸï¼Œmax_clientsçš„å€¼é¡»å°äºç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°</span><br><span class="line">    # è€Œç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°å’Œå†…å­˜å¤§å°æˆæ­£æ¯”ï¼Œä¸€èˆ¬1GBå†…å­˜çš„æœºå™¨ä¸Šå¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æ•°å¤§çº¦æ˜¯10ä¸‡å·¦å³</span><br><span class="line">    # æˆ‘ä»¬æ¥çœ‹çœ‹360Må†…å­˜çš„VPSå¯ä»¥æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„æ•°æ˜¯å¤šå°‘ï¼š</span><br><span class="line">    # $ cat /proc/sys/fs/file-max</span><br><span class="line">    # è¾“å‡º 34336</span><br><span class="line">    # 32000 &lt; 34336ï¼Œå³å¹¶å‘è¿æ¥æ€»æ•°å°äºç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„æ€»æ•°ï¼Œè¿™æ ·å°±åœ¨æ“ä½œç³»ç»Ÿå¯ä»¥æ‰¿å—çš„èŒƒå›´ä¹‹å†…</span><br><span class="line">    # æ‰€ä»¥ï¼Œworker_connections çš„å€¼éœ€æ ¹æ® worker_processes è¿›ç¨‹æ•°ç›®å’Œç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ€»æ•°è¿›è¡Œé€‚å½“åœ°è¿›è¡Œè®¾ç½®</span><br><span class="line">    # ä½¿å¾—å¹¶å‘æ€»æ•°å°äºæ“ä½œç³»ç»Ÿå¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°ç›®</span><br><span class="line">    # å…¶å®è´¨ä¹Ÿå°±æ˜¯æ ¹æ®ä¸»æœºçš„ç‰©ç†CPUå’Œå†…å­˜è¿›è¡Œé…ç½®</span><br><span class="line">    # å½“ç„¶ï¼Œç†è®ºä¸Šçš„å¹¶å‘æ€»æ•°å¯èƒ½ä¼šå’Œå®é™…æœ‰æ‰€åå·®ï¼Œå› ä¸ºä¸»æœºè¿˜æœ‰å…¶ä»–çš„å·¥ä½œè¿›ç¨‹éœ€è¦æ¶ˆè€—ç³»ç»Ÿèµ„æºã€‚</span><br><span class="line">    # ulimit -SHn 65535</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    #è®¾å®šmimeç±»å‹,ç±»å‹ç”±mime.typeæ–‡ä»¶å®šä¹‰</span><br><span class="line">    include    mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    #è®¾å®šæ—¥å¿—æ ¼å¼</span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    #sendfile æŒ‡ä»¤æŒ‡å®š nginx æ˜¯å¦è°ƒç”¨ sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œ</span><br><span class="line">    #å¯¹äºæ™®é€šåº”ç”¨ï¼Œå¿…é¡»è®¾ä¸º on,</span><br><span class="line">    #å¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸º offï¼Œ</span><br><span class="line">    #ä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI/Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„uptime.</span><br><span class="line">    sendfile     on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #è¿æ¥è¶…æ—¶æ—¶é—´</span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    tcp_nodelay     on;</span><br><span class="line"></span><br><span class="line">    #å¼€å¯gzipå‹ç¼©</span><br><span class="line">    gzip  on;</span><br><span class="line">    gzip_disable &quot;MSIE [1-6].&quot;;</span><br><span class="line"></span><br><span class="line">    #è®¾å®šè¯·æ±‚ç¼“å†²</span><br><span class="line">    client_header_buffer_size    128k;</span><br><span class="line">    large_client_header_buffers  4 128k;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    #è®¾å®šè™šæ‹Ÿä¸»æœºé…ç½®</span><br><span class="line">    server &#123;</span><br><span class="line">        #ä¾¦å¬80ç«¯å£</span><br><span class="line">        listen    80;</span><br><span class="line">        #å®šä¹‰ä½¿ç”¨ www.nginx.cnè®¿é—®</span><br><span class="line">        server_name  www.nginx.cn;</span><br><span class="line"></span><br><span class="line">        #å®šä¹‰æœåŠ¡å™¨çš„é»˜è®¤ç½‘ç«™æ ¹ç›®å½•ä½ç½®</span><br><span class="line">        root html;</span><br><span class="line"></span><br><span class="line">        #è®¾å®šæœ¬è™šæ‹Ÿä¸»æœºçš„è®¿é—®æ—¥å¿—</span><br><span class="line">        access_log  logs/nginx.access.log  main;</span><br><span class="line"></span><br><span class="line">        #é»˜è®¤è¯·æ±‚</span><br><span class="line">        location / &#123;</span><br><span class="line">            </span><br><span class="line">            #å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§°</span><br><span class="line">            index index.php index.html index.htm;   </span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # å®šä¹‰é”™è¯¯æç¤ºé¡µé¢</span><br><span class="line">        error_page   500 502 503 504 /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #é™æ€æ–‡ä»¶ï¼Œnginxè‡ªå·±å¤„ç†</span><br><span class="line">        location ~ ^/(images|javascript|js|css|flash|media|static)/ &#123;</span><br><span class="line">            </span><br><span class="line">            #è¿‡æœŸ30å¤©ï¼Œé™æ€æ–‡ä»¶ä¸æ€ä¹ˆæ›´æ–°ï¼Œè¿‡æœŸå¯ä»¥è®¾å¤§ä¸€ç‚¹ï¼Œ</span><br><span class="line">            #å¦‚æœé¢‘ç¹æ›´æ–°ï¼Œåˆ™å¯ä»¥è®¾ç½®å¾—å°ä¸€ç‚¹ã€‚</span><br><span class="line">            expires 30d;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #PHP è„šæœ¬è¯·æ±‚å…¨éƒ¨è½¬å‘åˆ° FastCGIå¤„ç†. ä½¿ç”¨FastCGIé»˜è®¤é…ç½®.</span><br><span class="line">        location ~ .php$ &#123;</span><br><span class="line">            fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">            fastcgi_index index.php;</span><br><span class="line">            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">            include fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #ç¦æ­¢è®¿é—® .htxxx æ–‡ä»¶</span><br><span class="line">            location ~ /.ht &#123;</span><br><span class="line">            deny all;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<div class="note default"><p>åŸæ–‡é“¾æ¥ï¼š<a href="http://www.nginx.cn/76.html">nginxåŸºæœ¬é…ç½®ä¸å‚æ•°è¯´æ˜</a></p>
</div>]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾®ä¿¡é€€æ¬¾å¼‚æ­¥é€šçŸ¥ aes-256-ecb è§£å¯†</title>
    <url>/Weixin/wxpay-refund/</url>
    <content><![CDATA[<h2 id="å®ç°ä»£ç "><a href="#å®ç°ä»£ç " class="headerlink" title="å®ç°ä»£ç "></a>å®ç°ä»£ç </h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯¹å¾®ä¿¡é€€æ¬¾å›è°ƒçš„åŠ å¯†æ•°æ®è¿›è¡Œè§£å¯†</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $encryptData åŸå§‹åŠ å¯†æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $key å•†æˆ· key</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string è§£å¯†åçš„ xml æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">decryptData</span>(<span class="params"> <span class="variable">$encryptData</span>, <span class="variable">$key</span> = <span class="string">&#x27;&#x27;</span> </span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//1. base64_decode</span></span><br><span class="line">    <span class="variable">$encryptData</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$encryptData</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//2. md5 original key</span></span><br><span class="line">    <span class="variable">$md5LowerKey</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$key</span>));</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//3. decrypt AES ECB</span></span><br><span class="line">    <span class="variable">$decrypted</span> = <span class="title function_ invoke__">openssl_decrypt</span>(<span class="variable">$encryptData</span>, <span class="string">&#x27;AES-256-ECB&#x27;</span>, <span class="variable">$md5LowerKey</span>, OPENSSL_RAW_DATA);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$decrypted</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é‡åˆ°çš„å‘"><a href="#é‡åˆ°çš„å‘" class="headerlink" title="é‡åˆ°çš„å‘"></a>é‡åˆ°çš„å‘</h2><ul>
<li><code>openssl_decrypt</code> ç¬¬å››ä¸ªå‚æ•°ä¸€å®šè¦ä½¿ç”¨ <code>OPENSSL_RAW_DATA</code></li>
</ul>
]]></content>
      <categories>
        <category>weixin</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>wxpay</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½ ç”Ÿäº§ç¯å¢ƒçš„ Composer æ˜¯è¿™æ ·å—ï¼Ÿ</title>
    <url>/Composer/introduction-to-composer/</url>
    <content><![CDATA[<h2 id="composer-é…ç½®é¡¹"><a href="#composer-é…ç½®é¡¹" class="headerlink" title="composer é…ç½®é¡¹"></a>composer é…ç½®é¡¹</h2><blockquote>
<p>å…·ä½“çš„æ¯ä¸ªé…ç½®é¡¹ç»†èŠ‚è¯·å‚è€ƒ  <a href="https://docs.phpcomposer.com/04-schema.html">Composer å®˜ç½‘</a></p>
</blockquote>
<h3 id="é…ç½®åˆ—è¡¨"><a href="#é…ç½®åˆ—è¡¨" class="headerlink" title="é…ç½®åˆ—è¡¨"></a>é…ç½®åˆ—è¡¨</h3><table>
<thead>
<tr>
<th>ID</th>
<th>é…ç½®é¡¹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><code>name</code></td>
<td>åŒ…çš„åç§°ï¼Œå®ƒåŒ…æ‹¬ä¾›åº”å•†åç§°å’Œé¡¹ç›®åç§°ï¼Œä½¿ç”¨ &#x2F; åˆ†éš”ã€‚</td>
</tr>
<tr>
<td>2</td>
<td><code>description</code></td>
<td>åŒ…æè¿°</td>
</tr>
<tr>
<td>3</td>
<td><code>version</code></td>
<td>ç‰ˆæœ¬</td>
</tr>
<tr>
<td>4</td>
<td><code>type</code></td>
<td>å®‰è£…ç±»å‹</td>
</tr>
<tr>
<td>5</td>
<td><code>keywords</code></td>
<td>å…³é”®å­—</td>
</tr>
<tr>
<td>6</td>
<td><code>homepage</code></td>
<td>é¡¹ç›®ä¸»é¡µ</td>
</tr>
<tr>
<td>7</td>
<td><code>time</code></td>
<td>ç‰ˆæœ¬å‘å¸ƒæ—¶é—´</td>
</tr>
<tr>
<td>8</td>
<td><code>license</code></td>
<td>è®¸å¯åè®®</td>
</tr>
<tr>
<td>9</td>
<td><code>authors</code></td>
<td>ä½œè€…</td>
</tr>
<tr>
<td>10</td>
<td><code>support</code></td>
<td>æ”¯æŒ,è·å–é¡¹ç›®æ”¯æŒçš„å‘ç›¸å…³ä¿¡æ¯å¯¹è±¡ã€‚</td>
</tr>
<tr>
<td>11</td>
<td><code>require</code></td>
<td>è‡ªåŠ¨åŠ è½½çš„åŒ…</td>
</tr>
<tr>
<td>12</td>
<td><code>require-dev</code></td>
<td>åœ¨DEVä¸‹è‡ªåŠ¨åŠ è½½çš„åŒ…</td>
</tr>
<tr>
<td>13</td>
<td><code>conflict</code></td>
<td>æ­¤åˆ—è¡¨ä¸­çš„åŒ…ä¸å½“å‰åŒ…çš„è¿™ä¸ªç‰ˆæœ¬å†²çªã€‚å®ƒä»¬å°†ä¸å…è®¸åŒæ—¶è¢«å®‰è£…</td>
</tr>
<tr>
<td>14</td>
<td><code>suggest</code></td>
<td>å»ºè®®å®‰è£…çš„åŒ…ï¼Œå®ƒä»¬å¢å¼ºæˆ–èƒ½å¤Ÿä¸å½“å‰åŒ…è‰¯å¥½çš„å·¥ä½œã€‚è¿™äº›åªæ˜¯ä¿¡æ¯ï¼Œå¹¶æ˜¾ç¤ºåœ¨ä¾èµ–åŒ…å®‰è£…å®Œæˆä¹‹åï¼Œç»™ä½ çš„ç”¨æˆ·ä¸€ä¸ªå»ºè®®ï¼Œä»–ä»¬å¯ä»¥æ·»åŠ æ›´å¤šçš„åŒ…ã€‚</td>
</tr>
<tr>
<td>15</td>
<td><code>autoload</code></td>
<td>è‡ªåŠ¨åŠ è½½,åˆ†åˆ«æœ‰å››ç§åŠ è½½æœºåˆ¶ <code>psr-4</code> <code>psr-0</code> <code>classmap</code> <code>file</code></td>
</tr>
<tr>
<td>16</td>
<td><code>include-path</code></td>
<td>ä¿ç•™ä¼ ç»Ÿ,ä¸å»ºè®®ä½¿ç”¨</td>
</tr>
<tr>
<td>17</td>
<td><code>target-dir</code></td>
<td>å®šä¹‰å½“å‰åŒ…å®‰è£…çš„ç›®æ ‡æ–‡ä»¶å¤¹</td>
</tr>
<tr>
<td>18</td>
<td><code>minimum-stability</code></td>
<td>å®‰è£…åŒ…çš„æ—¶å€™é€šè¿‡ç¨³å®šæ€§è¿‡æ»¤åŒ…çš„é»˜è®¤è¡Œä¸º, <code>dev</code> <code>alpha</code> <code>beta</code> <code>RC</code> <code>stable</code> å¯é€‰</td>
</tr>
<tr>
<td>19</td>
<td><code>prefer-stable</code></td>
<td>å®‰è£…åŒ…çš„æ—¶å€™ä¼˜å…ˆä½¿ç”¨æ›´ç¨³å®šçš„åŒ…ç‰ˆæœ¬, <code>&quot;prefer-stable&quot;: true</code></td>
</tr>
<tr>
<td>20</td>
<td><code>repositories</code></td>
<td>ä½¿ç”¨è‡ªå®šä¹‰çš„åŒ…èµ„æºåº“ã€‚é»˜è®¤æƒ…å†µä¸‹ composer åªä½¿ç”¨ packagist ä½œä¸ºåŒ…çš„èµ„æºåº“ã€‚é€šè¿‡æŒ‡å®šèµ„æºåº“ï¼Œä½ å¯ä»¥ä»å…¶ä»–åœ°æ–¹è·å–èµ„æºåŒ…ã€‚</td>
</tr>
<tr>
<td>21</td>
<td><code>config</code></td>
<td>é…ç½®å‚æ•°ï¼Œegï¼š<code>process-timeout</code> <code>vendor-dir</code></td>
</tr>
<tr>
<td>22</td>
<td><code>scripts </code></td>
<td>Composer å…è®¸ä½ åœ¨å®‰è£…è¿‡ç¨‹ä¸­çš„å„ä¸ªé˜¶æ®µæŒ‚æ¥è„šæœ¬ã€‚</td>
</tr>
<tr>
<td>23</td>
<td><code>extra</code></td>
<td>ä»»æ„çš„ï¼Œä¾› <code>scripts</code> ä½¿ç”¨çš„é¢å¤–æ•°æ®ã€‚</td>
</tr>
<tr>
<td>24</td>
<td><code>bin</code></td>
<td>è¯¥å±æ€§ç”¨äºæ ‡æ³¨ä¸€ç»„åº”è¢«è§†ä¸ºäºŒè¿›åˆ¶è„šæœ¬çš„æ–‡ä»¶ï¼Œä»–ä»¬ä¼šè¢«è½¯é“¾æ¥åˆ°ï¼ˆconfig å¯¹è±¡ä¸­çš„ï¼‰bin-dir å±æ€§æ‰€æ ‡æ³¨çš„ç›®å½•ï¼Œä»¥ä¾›å…¶ä»–ä¾èµ–åŒ…è°ƒç”¨ã€‚</td>
</tr>
<tr>
<td>25</td>
<td><code>archive</code></td>
<td>è¿™äº›é€‰é¡¹åœ¨åˆ›å»ºåŒ…å­˜æ¡£æ—¶ä½¿ç”¨ã€‚</td>
</tr>
</tbody></table>
<span id="more"></span>

<h3 id="å¼€å‘ç§é…ç½®è¯¦ç»†è¯´æ˜"><a href="#å¼€å‘ç§é…ç½®è¯¦ç»†è¯´æ˜" class="headerlink" title="å¼€å‘ç§é…ç½®è¯¦ç»†è¯´æ˜"></a>å¼€å‘ç§é…ç½®è¯¦ç»†è¯´æ˜</h3><h4 id="11-require"><a href="#11-require" class="headerlink" title="11. require"></a>11. <code>require</code></h4><table>
<thead>
<tr>
<th>æ ‡è¯†ç¬¦</th>
<th>å«ä¹‰</th>
<th>å®ä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>^</code></td>
<td>å®‰è£…çš„æœ€æ–°ç‰ˆæœ¬</td>
<td><code>&quot;barryvdh/laravel-cors&quot;: &quot;^0.10.0&quot;</code> å®‰è£…laravel-corsæœ€æ–°ç‰ˆæœ¬</td>
</tr>
<tr>
<td><code>~</code></td>
<td>æ ‡è¯†å®‰è£…çš„æœ€åä¸€ä½åŒºé—´ç‰ˆæœ¬</td>
<td><code>&quot;barryvdh/laravel-cors&quot;: &quot;~0.10.0&quot;,</code> å®‰è£…laravel-cors <code>0.10.0-0.10.9</code></td>
</tr>
</tbody></table>
<h4 id="12-require-dev"><a href="#12-require-dev" class="headerlink" title="12. require-dev"></a>12. <code>require-dev</code></h4><ol>
<li><code>composer install</code> ä¼šå®‰è£…<code>require-dev</code>ä¸­çš„åŒ…,<code>require</code>ä¸­çš„åŒ…</li>
<li><code>composer install --no-dev</code> åªä¼šå®‰è£…<code>require</code>ä¸­çš„åŒ…</li>
</ol>
<h4 id="22-scripts"><a href="#22-scripts" class="headerlink" title="22. scripts"></a>22. <code>scripts</code></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;post-root-package-install&quot;: [</span><br><span class="line">        &quot;@php -r \&quot;file_exists(&#x27;.env&#x27;) || copy(&#x27;.env.example&#x27;, &#x27;.env&#x27;);\&quot;&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;post-create-project-cmd&quot;: [</span><br><span class="line">        &quot;@php artisan key:generate&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;post-autoload-dump&quot;: [</span><br><span class="line">        &quot;Illuminate\\Foundation\\ComposerScripts::postAutoloadDump&quot;,</span><br><span class="line">        &quot;@php artisan package:discover&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>scripts</code> æ˜¯è‡ªå®šä¹‰æ‰§è¡ŒSHELLå‘½ä»¤ï¼Œå¦‚ä¸Šä»£ç ä¸­ï¼Œæ‰§è¡Œ<code>post-root-package-install</code> æ‰§è¡Œå¤åˆ¶æ–‡ä»¶ã€‚</p>
<h4 id="15-autoload"><a href="#15-autoload" class="headerlink" title="15 autoload"></a>15 <code>autoload</code></h4><blockquote>
<p>PHP è‡ªåŠ¨åŠ è½½æ–‡ä»¶,åˆ†åˆ«æœ‰å››ç§åŠ è½½æœºåˆ¶ <code>psr-4</code> <code>psr-0</code> <code>classmap</code> <code>file</code></p>
</blockquote>
<blockquote>
<p><strong>ä¿®æ”¹å®Œ autoload çš„å†…å®¹ä¹‹åè¦è®°å¾—æ‰§è¡Œ<code>composer dump-autoload</code> æ¥é‡æ–°ç”ŸæˆåŠ è½½æ–‡ä»¶</strong></p>
</blockquote>
<h5 id="prs-4"><a href="#prs-4" class="headerlink" title="prs-4"></a><code>prs-4</code></h5><ol>
<li>è¯¥ç›®å½•ä¸‹çš„ PHP æ–‡ä»¶ é‡‡ç”¨ PSR-4 è‡ªåŠ¨åŠ è½½æ ‡å‡†</li>
<li><strong>Composerä¼šå°†è¯¥ç»“æ„ä¸‹çš„æ–‡ä»¶æ˜ å°„å…³ç³»å†™å…¥ <code>autoload_classmap.php</code></strong></li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;autoload&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;psr-4&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;App\\&quot;</span><span class="punctuation">:</span> <span class="string">&quot;app/&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">    </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="prs-0"><a href="#prs-0" class="headerlink" title="prs-0"></a><code>prs-0</code></h5><ol>
<li>è¯¥ç›®å½•ä¸‹çš„ PHP æ–‡ä»¶ é‡‡ç”¨ PSR-0 è‡ªåŠ¨åŠ è½½æ ‡å‡†</li>
<li><strong>Composerä¼šå°†è¯¥ç»“æ„ä¸‹çš„æ–‡ä»¶æ˜ å°„å…³ç³»å†™å…¥ <code>autoload_namespaces.php</code></strong></li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;autoload&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;psr-4&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;Cx\\&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prs0/&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">    </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="classmap"><a href="#classmap" class="headerlink" title="classmap"></a><code>classmap</code></h5><ol>
<li><strong>Composer åŠ è½½ <code>lib/</code> ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶,æ”¾å…¥åˆ° <code>autoload_classmap.php</code></strong></li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;classmap&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;lib/&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="file"><a href="#file" class="headerlink" title="file"></a><code>file</code></h5><ol>
<li><strong>Composer åŠ è½½ <code>src/test.php</code> è¯¥æ–‡ä»¶,æ”¾å…¥åˆ° <code>autoload_files.php</code></strong></li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;src/test.php&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>


<hr>
<h2 id="å‘½ä»¤ç¯‡"><a href="#å‘½ä»¤ç¯‡" class="headerlink" title="å‘½ä»¤ç¯‡"></a>å‘½ä»¤ç¯‡</h2><blockquote>
<p>è¯¦ç»†å‘½åè¯·å‚è€ƒ <a href="https://docs.phpcomposer.com/03-cli.html">Composer å‘½ä»¤è¡Œ</a></p>
</blockquote>
<h3 id="composer-install"><a href="#composer-install" class="headerlink" title="composer install"></a><code>composer install</code></h3><p>å…ˆå®‰è£…<code>composer.lock</code> æ–‡ä»¶ä¸­<code>packages</code>ä¸­çš„ç‰ˆæœ¬ï¼›å³ä½¿<code>composer.json</code> ä¸ <code>composer.lock</code> ä¸­ç‰ˆæœ¬ä¸ä¸€è‡´</p>
<p>å®‰è£…æµç¨‹å›¾</p>
<p><img src="/images/Composer/introduction-to-composer/pTpMMsHsDK.png" alt="å®‰è£…æµç¨‹å›¾"></p>
<h3 id="composer-update"><a href="#composer-update" class="headerlink" title="composer update"></a><code>composer update</code></h3><p>å…ˆå®‰è£…<code>composer.json</code>çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”æ›´æ–°<code>composer.lock</code>ä¸­ <code>packages</code> ä¸­çš„ç‰ˆæœ¬ </p>
<p>å®‰è£…æµç¨‹å›¾</p>
<p><img src="/images/Composer/introduction-to-composer/1czjx90v61.png" alt="ä½ ç”Ÿäº§ç¯å¢ƒçš„ composer æ˜¯è¿™æ ·å—ï¼Ÿ"></p>
<h3 id="composer-dump-autoload"><a href="#composer-dump-autoload" class="headerlink" title="composer dump-autoload"></a><code>composer dump-autoload</code></h3><table>
<thead>
<tr>
<th>CMD</th>
<th>è¯´æ˜</th>
<th>åº”ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td><code>composer dump-autoload</code></td>
<td>æ‰“å°è‡ªåŠ¨åŠ è½½ç´¢å¼•,å°±æ˜¯å°† <code>autoload</code> ä¸­çš„å„é¡¹åŠ è½½åˆ°æœ¬è¯¥æŒ‡å®šçš„ç›®å½•ã€‚</td>
<td>å¼€å‘ç¯å¢ƒ ä½ æ›´æ–°äº† <code>autoload</code> ä¸­çš„å„é¡¹,</td>
</tr>
<tr>
<td><code>composer dump-autoload -o</code></td>
<td>è½¬æ¢ PSR-0&#x2F;4 autoloading åˆ° classmap è·å¾—æ›´å¿«çš„è½½å…¥é€Ÿåº¦</td>
<td>é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒ</td>
</tr>
<tr>
<td><code>composer dump-autoload -o --no-dev</code></td>
<td>ç¦ç”¨ autoload-dev è§„åˆ™</td>
<td>é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒ</td>
</tr>
<tr>
<td><code>composer dump-autoload --classmap-authoritative</code></td>
<td>åªåŠ è½½ ClassMapä¸­çš„æ–‡ä»¶ï¼Œå¿…åˆ°ç£ç›˜æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œä»»ä½•æ£€æŸ¥</td>
<td>é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒ</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>å› æ­¤ç”Ÿäº§è¯·ä½¿ç”¨ <code>composer dump-autoload -o --no-dev --classmap-authoritative</code></strong></p>
</blockquote>
<div class="note default"><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://learnku.com/articles/26343">ä½ ç”Ÿäº§ç¯å¢ƒçš„ Composer æ˜¯è¿™æ ·å—ï¼Ÿ</a></p>
</div>]]></content>
      <categories>
        <category>Composer</category>
      </categories>
      <tags>
        <tag>Composer</tag>
      </tags>
  </entry>
  <entry>
    <title>Composer ä¿®æ”¹é¡¹ç›®ä¾èµ–ä¸ºæ–°çš„é•œåƒåœ°å€</title>
    <url>/Composer/modify-the-project-dependency-to-the-new-mirror-address/</url>
    <content><![CDATA[<h2 id="å‰ç½®è¯´æ˜"><a href="#å‰ç½®è¯´æ˜" class="headerlink" title="å‰ç½®è¯´æ˜"></a>å‰ç½®è¯´æ˜</h2><p>æœ¬æ–‡ä»¥ä» <code>https://pkg.phpcomposer.com</code> é•œåƒåˆ‡æ¢åˆ° <code>https://packagist.laravel-china.org</code> ä¸ºä¾‹å­æ¥è®²è§£ã€‚è¯·è‡ªè¡Œä¿®æ”¹å‘½ä»¤è¡Œä¸­å¯¹åº”çš„é“¾æ¥ã€‚</p>
<h2 id="é—®é¢˜è¯´æ˜"><a href="#é—®é¢˜è¯´æ˜" class="headerlink" title="é—®é¢˜è¯´æ˜"></a>é—®é¢˜è¯´æ˜</h2><p>Composer åœ¨å®‰è£…æ—¶ä¼šåœ¨ <code>composer.lock</code> æ–‡ä»¶ä¸­å†™å…¥æ‰©å±•åŒ…ä¸‹è½½åœ°å€ï¼Œå¦‚ï¼š</p>
<p><img src="/images/Composer/modify-the-project-dependency-to-the-new-mirror-address/l5HYA3LOTP.png"></p>
<p>ä¸€äº›å¹´ä»£ä¹…è¿œçš„é¡¹ç›®ä¸­ä½¿ç”¨äº† <code>https://pkg.phpcomposer.com/</code> çš„ä¸­æ–‡åŠ é€Ÿé•œåƒï¼Œç„¶åæœ€è¿‘å› ä¸ºå…¶é•œåƒè®¿é—®å‡ºäº†æ•…éšœï¼š</p>
<span id="more"></span>

<p><img src="/images/Composer/modify-the-project-dependency-to-the-new-mirror-address/RZrFXkZutF.png"></p>
<p>è¿è¡Œ <code>composer install</code> åä¼šå‡ºç° 404 å¹¶ä»æºä»“åº“å¼€å§‹ä¸‹è½½ï¼Œå¯¼è‡´ä¸‹è½½é€Ÿåº¦éå¸¸æ…¢ã€‚è¿™ç§æƒ…å†µå³ä½¿æ˜¯ä½ å…¨å±€é…ç½®äº†åŠ é€Ÿé•œåƒä¹Ÿä¼šå‡ºç°ï¼š</p>
<p><img src="/images/Composer/modify-the-project-dependency-to-the-new-mirror-address/ZgbahVqjwT.png"></p>
<p><strong>é—®é¢˜ï¼š</strong> å¦‚ä½•æŠŠ  <code>composer.lock</code> æ–‡ä»¶é‡Œçš„è¿™äº› <code>&quot;url&quot;: &quot;https://packagist.phpcomposer.com/file...</code>  ä¸‹è½½åœ°å€å˜ä¸ºæ–°çš„åŠ é€Ÿè¿›è¡Œçš„åœ°å€å‘¢ï¼Ÿ</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="1-é…ç½®æ–°é•œåƒ"><a href="#1-é…ç½®æ–°é•œåƒ" class="headerlink" title="1. é…ç½®æ–°é•œåƒ"></a>1. é…ç½®æ–°é•œåƒ</h3><p>é¦–å…ˆé…ç½®ä½ çš„æ–°é•œåƒä¸ºå…¨å±€é•œåƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ composer config -g repo.packagist composer https://packagist.laravel-china.org</span><br></pre></td></tr></table></figure>

<h3 id="2-åˆ·æ–°-composer-lock-æ–‡ä»¶"><a href="#2-åˆ·æ–°-composer-lock-æ–‡ä»¶" class="headerlink" title="2. åˆ·æ–° composer.lock æ–‡ä»¶"></a>2. åˆ·æ–° composer.lock æ–‡ä»¶</h3><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ composer update nothing</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ composer update --lock</span><br></pre></td></tr></table></figure>

<blockquote>
<p>â€“lock: åªå‡çº§ lock æ–‡ä»¶çš„å“ˆå¸Œä»¥æ¶ˆé™¤ lock æ–‡ä»¶è¿‡æœŸçš„è­¦å‘Šã€‚</p>
</blockquote>
<p>æ‰§è¡ŒæˆåŠŸåï¼š</p>
<p><img src="/images/Composer/modify-the-project-dependency-to-the-new-mirror-address/I1rGE9nT8A.png"></p>
<h3 id="3-æµ‹è¯•ä¸€ä¸‹"><a href="#3-æµ‹è¯•ä¸€ä¸‹" class="headerlink" title="3. æµ‹è¯•ä¸€ä¸‹"></a>3. æµ‹è¯•ä¸€ä¸‹</h3><p>æ¸…ç©ºæœ¬åœ°ç¼“å­˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ rm -rf vendor</span><br><span class="line">$ composer clear-cache</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œå®‰è£…å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ composer install -vvv</span><br></pre></td></tr></table></figure>

<p>äº«å—é«˜é€Ÿä¸‹è½½ï¼š</p>
<p><img src="/images/Composer/modify-the-project-dependency-to-the-new-mirror-address/f1bYWcxUp2.png"></p>
<h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><p><strong>é—®ï¼š</strong> æ­¤æ“ä½œæ˜¯å¦ä¼šå‡çº§ä¾èµ–ç‰ˆæœ¬ï¼Ÿ<br><strong>ç­”ï¼š</strong> ä¸ä¼šï¼Œåªä¼šåœ¨ <code>composer.lock</code> ä¸­å°†æ—§çš„ä¾èµ–ä¸‹è½½åœ°å€æ›´æ–°ä¸ºæ–°çš„ï¼Œç‰ˆæœ¬ä¿æŒä¸å˜ã€‚</p>
<p><strong>é—®ï¼š</strong> çº¿ä¸Šç¯å¢ƒé‡Œå·²ç»ä¸‹è½½äº†ä¾èµ–åˆ° <code>vendor</code> æ–‡ä»¶å¤¹ï¼Œæ˜¯å¦éœ€è¦åˆ äº†å†é‡æ–°ä¸‹è½½ï¼Ÿ<br><strong>ç­”ï¼š</strong> ä¸éœ€è¦ï¼Œå¦‚ä¸Šæ‰€è®²ï¼Œåªæ˜¯æ›´æ–°äº†ä¸‹è½½é“¾æ¥ï¼Œä»£ç åŒ…è¿å“ˆå¸Œéƒ½æ˜¯ä¸€æ ·ï¼Œæ— éœ€é‡æ–°ä¸‹è½½ã€‚</p>
<div class="note default"><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://learnku.com/laravel/wikis/16722">Laravel å®‰è£…å’Œå¼€å‘ç¯å¢ƒï¼šä¿®æ”¹é¡¹ç›®ä¾èµ–ä¸ºæ–°çš„é•œåƒåœ°å€</a></p>
</div>]]></content>
      <categories>
        <category>Composer</category>
      </categories>
      <tags>
        <tag>Composer</tag>
      </tags>
  </entry>
  <entry>
    <title>Composer è‡ªåŠ¨åŠ è½½çš„åŸç†</title>
    <url>/Composer/source-code-to-achieve-autoload/</url>
    <content><![CDATA[<blockquote>
<p>å½“ PHP å¼•æ“è¯•å›¾å®ä¾‹åŒ–æœªçŸ¥ç±»çš„æ“ä½œæ—¶ï¼Œå°±ä¼šè°ƒç”¨ <code>__autoload()</code> ,å¹¶å°†ç±»åå½“åšå­—ç¬¦ä¸²ä¼ é€’ç»™å®ƒã€‚ä½† <code>__autoload()</code> æœ‰ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯ ä¸€ä¸ªè¿›ç¨‹ä¸­åªèƒ½å®šä¹‰ä¸€æ¬¡ã€‚å®ƒæ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œå¦‚æœæ¡†æ¶å äº†è¿™ä¸ªåå­—ï¼Œä¾¿ä¼šå¯¼è‡´æ¡†æ¶çš„ç”¨æˆ·ç”¨ä¸äº†å…¶å®ƒçš„ <code>__autoload()</code> äº†ï¼ŒåŒ…æ‹¬ç”¨æˆ·è‡ªå®šä¹‰çš„å’Œå…¶å®ƒç±»åº“å¸¦çš„ã€‚è¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ <code>spl_autoload_register()</code> å‡½æ•°ã€‚å®ƒå¯ä»¥æŠŠå‡½æ•°æ³¨å†Œåˆ° <code>__autoload</code> é˜Ÿåˆ—ä¸­ã€‚ </p>
</blockquote>
<h2 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h2><div class="note info"><p>Composer version 1.5.1 </p>
</div>

<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>ä»¥ Laravel é¡¹ç›®ä¸ºä¾‹ï¼Œ<code>composer.json</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;autoload&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;classmap&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;app/controllers&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;app/models&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>

<p>å½“æˆ‘ä»¬æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">composer dump-autoload</span><br></pre></td></tr></table></figure>

<p>æ–‡ä»¶ <code>/vendor/composer/autoload_clasmap.php</code> ä¼šæŠŠç±»åå’Œç»å¯¹åœ°å€åšä¸ªæ˜ å°„ï¼Œè¿”å›ä¸€ä¸ª <strong>ç±»å &#x3D;&gt; æ–‡ä»¶åœ°å€</strong> è¿™ç§å¯¹åº”å…³ç³»çš„æ•°ç»„ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$vendorDir</span> = <span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>));</span><br><span class="line"><span class="variable">$baseDir</span> = <span class="title function_ invoke__">dirname</span>(<span class="variable">$vendorDir</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;Article&#x27;</span> =&gt; <span class="variable">$baseDir</span> . <span class="string">&#x27;/app/models/Article.php&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;BaseController&#x27;</span> =&gt; <span class="variable">$baseDir</span> . <span class="string">&#x27;/app/controllers/BaseController.php&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;HomeController&#x27;</span> =&gt; <span class="variable">$baseDir</span> . <span class="string">&#x27;/app/controllers/HomeController.php&#x27;</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>é¦–é¡µ <code>index.php</code> è°ƒç”¨ composer çš„ autoload æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">require &#x27;../vendor/autoload.php&#x27;;</span><br></pre></td></tr></table></figure>

<p>ä¼šè°ƒç”¨ <code>ComposerAutoloaderInit</code> ç±»çš„é™æ€æ–¹æ³• <code>getLoader()</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">require_once</span> <span class="keyword">__DIR__</span> . <span class="string">&#x27;/composer&#x27;</span> . <span class="string">&#x27;/autoload_real.php&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="title class_">ComposerAutoloaderInita488c85ce5c077906f9c1829b6492f6b</span>::<span class="title function_ invoke__">getLoader</span>();</span><br></pre></td></tr></table></figure>
<p>verdor&#x2F;composer&#x2F; ç›®å½•ä¸‹æœ‰å››ä¸ªé…ç½®æ–‡ä»¶ï¼š</p>
<ul>
<li>autoload_classmap.php è¦åŠ è½½çš„classæ˜ å°„</li>
<li>autoload_files.php è¦åŠ è½½çš„æ–‡ä»¶</li>
<li>autoload_namespaces.php psr-0æ ‡å‡†</li>
<li>psr4.php psr-4æ ‡å‡†</li>
</ul>
<p><code>getLoader()</code> è¿™ä¸ªæ–¹æ³•ä¼šå…ˆæŠŠè¿™äº›é…ç½®æ–‡ä»¶æ”¾åˆ° <code>ClassLoader</code> çš„ç§æœ‰å±æ€§ä¸­ã€‚</p>
<p>ç„¶åé€šè¿‡ <code>$loader-&gt;register(true)</code> æ¥è°ƒç”¨ <code>spl_autoload_register()</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"><span class="variable">$prepend</span> = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">spl_autoload_register</span>(<span class="keyword">array</span>(<span class="variable language_">$this</span>, <span class="string">&#x27;loadClass&#x27;</span>), <span class="literal">true</span>, <span class="variable">$prepend</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>spl_autoload_register()</code> æŠŠ <code>loadClass()</code> æ–¹æ³•æ³¨å†Œåˆ°äº† autoload é˜Ÿåˆ—ä¸­ï¼Œç„¶åå½“PHPå¼•æ“è¯•å›¾å®ä¾‹åŒ–æœªçŸ¥ç±»çš„æ“ä½œæ—¶ï¼Œå°±ä¼šæ ¹æ®ç±»åå’Œå‘½åç©ºé—´åŠ è½½è¿™ä¸ªç±»æ–‡ä»¶ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loadClass</span>(<span class="params"><span class="variable">$class</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">findFile</span>(<span class="variable">$class</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">includeFile</span>(<span class="variable">$file</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="classmap"><a href="#classmap" class="headerlink" title="classmap"></a>classmap</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;autoload&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;classmap&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;database&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>classmap åšçš„æ˜¯ç±»åå’Œæ–‡ä»¶æ‰€åœ¨ä½ç½®çš„æ˜ å°„</p>
<h2 id="PSR-0-ä¸-PSR-4-çš„ä¸åŒ"><a href="#PSR-0-ä¸-PSR-4-çš„ä¸åŒ" class="headerlink" title="PSR-0 ä¸ PSR-4 çš„ä¸åŒ"></a>PSR-0 ä¸ PSR-4 çš„ä¸åŒ</h2><p>PSR-4 ä¸­ï¼Œåœ¨ç±»åä¸­ä½¿ç”¨ä¸‹åˆ’çº¿æ²¡æœ‰ä»»ä½•ç‰¹æ®Šå«ä¹‰ã€‚è€Œ PSR-0 åˆ™è§„å®šç±»åä¸­çš„ä¸‹åˆ’çº¿_ä¼šè¢«è½¬åŒ–æˆç›®å½•åˆ†éš”ç¬¦ã€‚</p>
<h3 id="PSR-0"><a href="#PSR-0" class="headerlink" title="PSR-0"></a>PSR-0</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;psr-0&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">       <span class="attr">&quot;Foo\\&quot;</span><span class="punctuation">:</span> <span class="string">&quot;src/&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>PSR-0 æœ‰æ­¤é…ç½®ï¼Œé‚£ä¹ˆä¼šå»å¯»æ‰¾ <code>src/Foo/Bar/Baz.php</code></p>
<p>PSR-0 å½“è¯•å›¾è‡ªåŠ¨åŠ è½½ <code>Foo\A_B</code> è¿™ä¸ªclassæ—¶ï¼Œä¼šå»å¯»æ‰¾ <code>src/Foo/A/B.php</code> è¿™ä¸ªæ–‡ä»¶ã€‚</p>
<h3 id="PSR-4"><a href="#PSR-4" class="headerlink" title="PSR-4"></a>PSR-4</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;psr-4&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">       <span class="attr">&quot;Foo\\&quot;</span><span class="punctuation">:</span> <span class="string">&quot;src/&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>æŒ‰ç…§ PSR-4 çš„è§„åˆ™ï¼Œå½“è¯•å›¾è‡ªåŠ¨åŠ è½½ <code>Foo\Bar\Baz</code> è¿™ä¸ª class æ—¶ï¼Œä¼šå»å¯»æ‰¾ <code>src/Bar/Baz.php</code> è¿™ä¸ªæ–‡ä»¶ï¼Œå¦‚æœå®ƒå­˜åœ¨åˆ™è¿›è¡ŒåŠ è½½ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol>
<li>composer çš„ PSR-4 å¸¦æ¥æ›´ç®€æ´çš„æ–‡ä»¶ç»“æ„</li>
<li>å‘½åç©ºé—´å‰ç¼€å¯¹åº”ç›¸åº”çš„æ–‡ä»¶å¤¹</li>
<li>ç±»åå’Œæ–‡ä»¶åç›¸åŒï¼Œæ–‡ä»¶åç¼€ä¸º PHP</li>
</ol>
]]></content>
      <categories>
        <category>Composer</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Composer</tag>
      </tags>
  </entry>
  <entry>
    <title>Golangçš„åç¨‹è°ƒåº¦å™¨åŸç†åŠGMPè®¾è®¡æ€æƒ³</title>
    <url>/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/</url>
    <content><![CDATA[<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/GPM%E5%B0%81%E9%9D%A2.png"></p>
<p>è§†é¢‘é“¾æ¥åœ°å€ï¼š<a href="https://www.bilibili.com/video/BV19r4y1w7Nx">https://www.bilibili.com/video/BV19r4y1w7Nx</a></p>
<h4 id="ä¸€ã€Golangâ€œè°ƒåº¦å™¨â€çš„ç”±æ¥ï¼Ÿ"><a href="#ä¸€ã€Golangâ€œè°ƒåº¦å™¨â€çš„ç”±æ¥ï¼Ÿ" class="headerlink" title="ä¸€ã€Golangâ€œè°ƒåº¦å™¨â€çš„ç”±æ¥ï¼Ÿ"></a>ä¸€ã€Golangâ€œè°ƒåº¦å™¨â€çš„ç”±æ¥ï¼Ÿ</h4><h5 id="1-å•è¿›ç¨‹æ—¶ä»£ä¸éœ€è¦è°ƒåº¦å™¨"><a href="#1-å•è¿›ç¨‹æ—¶ä»£ä¸éœ€è¦è°ƒåº¦å™¨" class="headerlink" title="(1) å•è¿›ç¨‹æ—¶ä»£ä¸éœ€è¦è°ƒåº¦å™¨"></a>(1) å•è¿›ç¨‹æ—¶ä»£ä¸éœ€è¦è°ƒåº¦å™¨</h5><p>æˆ‘ä»¬çŸ¥é“ï¼Œä¸€åˆ‡çš„è½¯ä»¶éƒ½æ˜¯è·‘åœ¨æ“ä½œç³»ç»Ÿä¸Šï¼ŒçœŸæ­£ç”¨æ¥å¹²æ´»(è®¡ç®—)çš„æ˜¯CPUã€‚æ—©æœŸçš„æ“ä½œç³»ç»Ÿæ¯ä¸ªç¨‹åºå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œç›´åˆ°ä¸€ä¸ªç¨‹åºè¿è¡Œå®Œï¼Œæ‰èƒ½è¿›è¡Œä¸‹ä¸€ä¸ªè¿›ç¨‹ï¼Œå°±æ˜¯â€œå•è¿›ç¨‹æ—¶ä»£â€</p>
<p>ä¸€åˆ‡çš„ç¨‹åºåªèƒ½ä¸²è¡Œå‘ç”Ÿã€‚<br><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/5-%E5%8D%95%E8%BF%9B%E7%A8%8B%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.png"></p>
<p>æ—©æœŸçš„å•è¿›ç¨‹æ“ä½œç³»ç»Ÿï¼Œé¢ä¸´2ä¸ªé—®é¢˜ï¼š</p>
<p>1.å•ä¸€çš„æ‰§è¡Œæµç¨‹ï¼Œè®¡ç®—æœºåªèƒ½ä¸€ä¸ªä»»åŠ¡ä¸€ä¸ªä»»åŠ¡å¤„ç†ã€‚</p>
<p>2.è¿›ç¨‹é˜»å¡æ‰€å¸¦æ¥çš„CPUæ—¶é—´æµªè´¹ã€‚</p>
<p>é‚£ä¹ˆèƒ½ä¸èƒ½æœ‰å¤šä¸ªè¿›ç¨‹æ¥å®è§‚ä¸€èµ·æ¥æ‰§è¡Œå¤šä¸ªä»»åŠ¡å‘¢ï¼Ÿ</p>
<p>åæ¥æ“ä½œç³»ç»Ÿå°±å…·æœ‰äº†<strong>æœ€æ—©çš„å¹¶å‘èƒ½åŠ›ï¼šå¤šè¿›ç¨‹å¹¶å‘</strong>ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹é˜»å¡çš„æ—¶å€™ï¼Œåˆ‡æ¢åˆ°å¦å¤–ç­‰å¾…æ‰§è¡Œçš„è¿›ç¨‹ï¼Œè¿™æ ·å°±èƒ½å°½é‡æŠŠCPUåˆ©ç”¨èµ·æ¥ï¼ŒCPUå°±ä¸æµªè´¹äº†ã€‚</p>
<span id="more"></span>

<h5 id="2-å¤šè¿›ç¨‹-x2F-çº¿ç¨‹æ—¶ä»£æœ‰äº†è°ƒåº¦å™¨éœ€æ±‚"><a href="#2-å¤šè¿›ç¨‹-x2F-çº¿ç¨‹æ—¶ä»£æœ‰äº†è°ƒåº¦å™¨éœ€æ±‚" class="headerlink" title="(2)å¤šè¿›ç¨‹&#x2F;çº¿ç¨‹æ—¶ä»£æœ‰äº†è°ƒåº¦å™¨éœ€æ±‚"></a>(2)å¤šè¿›ç¨‹&#x2F;çº¿ç¨‹æ—¶ä»£æœ‰äº†è°ƒåº¦å™¨éœ€æ±‚</h5><p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/6-%E5%A4%9A%E8%BF%9B%E7%A8%8B%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.png"></p>
<p>åœ¨å¤šè¿›ç¨‹&#x2F;å¤šçº¿ç¨‹çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œå°±è§£å†³äº†é˜»å¡çš„é—®é¢˜ï¼Œå› ä¸ºä¸€ä¸ªè¿›ç¨‹é˜»å¡cpuå¯ä»¥ç«‹åˆ»åˆ‡æ¢åˆ°å…¶ä»–è¿›ç¨‹ä¸­å»æ‰§è¡Œï¼Œè€Œä¸”è°ƒåº¦cpuçš„ç®—æ³•å¯ä»¥ä¿è¯åœ¨è¿è¡Œçš„è¿›ç¨‹éƒ½å¯ä»¥è¢«åˆ†é…åˆ°cpuçš„è¿è¡Œæ—¶é—´ç‰‡ã€‚è¿™æ ·ä»å®è§‚æ¥çœ‹ï¼Œä¼¼ä¹å¤šä¸ªè¿›ç¨‹æ˜¯åœ¨åŒæ—¶è¢«è¿è¡Œã€‚</p>
<p>ä½†æ–°çš„é—®é¢˜å°±åˆå‡ºç°äº†ï¼Œè¿›ç¨‹æ‹¥æœ‰å¤ªå¤šçš„èµ„æºï¼Œè¿›ç¨‹çš„åˆ›å»ºã€åˆ‡æ¢ã€é”€æ¯ï¼Œéƒ½ä¼šå ç”¨å¾ˆé•¿çš„æ—¶é—´ï¼ŒCPUè™½ç„¶åˆ©ç”¨èµ·æ¥äº†ï¼Œä½†å¦‚æœè¿›ç¨‹è¿‡å¤šï¼ŒCPUæœ‰å¾ˆå¤§çš„ä¸€éƒ¨åˆ†éƒ½è¢«ç”¨æ¥è¿›è¡Œè¿›ç¨‹è°ƒåº¦äº†ã€‚</p>
<p><strong>æ€ä¹ˆæ‰èƒ½æé«˜CPUçš„åˆ©ç”¨ç‡å‘¢ï¼Ÿ</strong> </p>
<p>ä½†æ˜¯å¯¹äºLinuxæ“ä½œç³»ç»Ÿæ¥è®²ï¼Œcpuå¯¹è¿›ç¨‹çš„æ€åº¦å’Œçº¿ç¨‹çš„æ€åº¦æ˜¯ä¸€æ ·çš„ã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/7-cpu%E5%88%87%E6%8D%A2%E6%B5%AA%E8%B4%B9%E6%88%90%E6%9C%AC.png"></p>
<p>å¾ˆæ˜æ˜¾ï¼ŒCPUè°ƒåº¦åˆ‡æ¢çš„æ˜¯è¿›ç¨‹å’Œçº¿ç¨‹ã€‚å°½ç®¡çº¿ç¨‹çœ‹èµ·æ¥å¾ˆç¾å¥½ï¼Œä½†å®é™…ä¸Šå¤šçº¿ç¨‹å¼€å‘è®¾è®¡ä¼šå˜å¾—æ›´åŠ å¤æ‚ï¼Œè¦è€ƒè™‘å¾ˆå¤šåŒæ­¥ç«äº‰ç­‰é—®é¢˜ï¼Œå¦‚é”ã€ç«äº‰å†²çªç­‰ã€‚</p>
<h5 id="3-åç¨‹æ¥æé«˜CPUåˆ©ç”¨ç‡"><a href="#3-åç¨‹æ¥æé«˜CPUåˆ©ç”¨ç‡" class="headerlink" title="(3)åç¨‹æ¥æé«˜CPUåˆ©ç”¨ç‡"></a>(3)åç¨‹æ¥æé«˜CPUåˆ©ç”¨ç‡</h5><p>å¤šè¿›ç¨‹ã€å¤šçº¿ç¨‹å·²ç»æé«˜äº†ç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›ï¼Œä½†æ˜¯åœ¨å½“ä»Šäº’è”ç½‘é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¸ºæ¯ä¸ªä»»åŠ¡éƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ˜¯ä¸ç°å®çš„ï¼Œå› ä¸ºä¼šæ¶ˆè€—å¤§é‡çš„å†…å­˜(è¿›ç¨‹è™šæ‹Ÿå†…å­˜ä¼šå ç”¨4GB[32ä½æ“ä½œç³»ç»Ÿ], è€Œçº¿ç¨‹ä¹Ÿè¦å¤§çº¦4MB)ã€‚</p>
<p>å¤§é‡çš„è¿›ç¨‹&#x2F;çº¿ç¨‹å‡ºç°äº†æ–°çš„é—®é¢˜</p>
<ul>
<li>é«˜å†…å­˜å ç”¨</li>
<li>è°ƒåº¦çš„é«˜æ¶ˆè€—CPU</li>
</ul>
<p>å¥½äº†ï¼Œç„¶åå·¥ç¨‹å¸ˆä»¬å°±å‘ç°ï¼Œå…¶å®ä¸€ä¸ªçº¿ç¨‹åˆ†ä¸ºâ€œå†…æ ¸æ€â€œçº¿ç¨‹å’Œâ€ç”¨æˆ·æ€â€œçº¿ç¨‹ã€‚</p>
<p>ä¸€ä¸ªâ€œç”¨æˆ·æ€çº¿ç¨‹â€å¿…é¡»è¦ç»‘å®šä¸€ä¸ªâ€œå†…æ ¸æ€çº¿ç¨‹â€ï¼Œä½†æ˜¯CPUå¹¶ä¸çŸ¥é“æœ‰â€œç”¨æˆ·æ€çº¿ç¨‹â€çš„å­˜åœ¨ï¼Œå®ƒåªçŸ¥é“å®ƒè¿è¡Œçš„æ˜¯ä¸€ä¸ªâ€œå†…æ ¸æ€çº¿ç¨‹â€(Linuxçš„PCBè¿›ç¨‹æ§åˆ¶å—)ã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/8-%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%86%85%E6%A0%B8%E5%92%8C%E7%94%A8%E6%88%B7%E6%80%81.png"></p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å†å»ç»†åŒ–å»åˆ†ç±»ä¸€ä¸‹ï¼Œå†…æ ¸çº¿ç¨‹ä¾ç„¶å«â€œçº¿ç¨‹(thread)â€ï¼Œç”¨æˆ·çº¿ç¨‹å«â€œåç¨‹(co-routine)â€.</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/9-%E5%8D%8F%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B.png"></p>
<p>â€‹    çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±è¦å¼€è„‘æ´äº†ï¼Œæ—¢ç„¶ä¸€ä¸ªåç¨‹(co-routine)å¯ä»¥ç»‘å®šä¸€ä¸ªçº¿ç¨‹(thread)ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½å¤šä¸ªåç¨‹(co-routine)ç»‘å®šä¸€ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹(thread)ä¸Šå‘¢ã€‚</p>
<p>â€‹        ä¹‹åï¼Œæˆ‘ä»¬å°±çœ‹åˆ°äº†æœ‰3ä¸­åç¨‹å’Œçº¿ç¨‹çš„æ˜ å°„å…³ç³»ï¼š</p>
<blockquote>
<h4 id="N-1å…³ç³»"><a href="#N-1å…³ç³»" class="headerlink" title="N:1å…³ç³»"></a>N:1å…³ç³»</h4></blockquote>
<p>Nä¸ªåç¨‹ç»‘å®š1ä¸ªçº¿ç¨‹ï¼Œä¼˜ç‚¹å°±æ˜¯<strong>åç¨‹åœ¨ç”¨æˆ·æ€çº¿ç¨‹å³å®Œæˆåˆ‡æ¢ï¼Œä¸ä¼šé™·å…¥åˆ°å†…æ ¸æ€ï¼Œè¿™ç§åˆ‡æ¢éå¸¸çš„è½»é‡å¿«é€Ÿ</strong>ã€‚ä½†ä¹Ÿæœ‰å¾ˆå¤§çš„ç¼ºç‚¹ï¼Œ1ä¸ªè¿›ç¨‹çš„æ‰€æœ‰åç¨‹éƒ½ç»‘å®šåœ¨1ä¸ªçº¿ç¨‹ä¸Š</p>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>æŸä¸ªç¨‹åºç”¨ä¸äº†ç¡¬ä»¶çš„å¤šæ ¸åŠ é€Ÿèƒ½åŠ›</li>
<li>ä¸€æ—¦æŸåç¨‹é˜»å¡ï¼Œé€ æˆçº¿ç¨‹é˜»å¡ï¼Œæœ¬è¿›ç¨‹çš„å…¶ä»–åç¨‹éƒ½æ— æ³•æ‰§è¡Œäº†ï¼Œæ ¹æœ¬å°±æ²¡æœ‰å¹¶å‘çš„èƒ½åŠ›äº†ã€‚</li>
</ul>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/10-N-1%E5%85%B3%E7%B3%BB.png"></p>
<blockquote>
<h4 id="1-1-å…³ç³»"><a href="#1-1-å…³ç³»" class="headerlink" title="1:1 å…³ç³»"></a>1:1 å…³ç³»</h4></blockquote>
<p>1ä¸ªåç¨‹ç»‘å®š1ä¸ªçº¿ç¨‹ï¼Œè¿™ç§æœ€å®¹æ˜“å®ç°ã€‚åç¨‹çš„è°ƒåº¦éƒ½ç”±CPUå®Œæˆäº†ï¼Œä¸å­˜åœ¨N:1ç¼ºç‚¹ï¼Œ</p>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>åç¨‹çš„åˆ›å»ºã€åˆ é™¤å’Œåˆ‡æ¢çš„ä»£ä»·éƒ½ç”±CPUå®Œæˆï¼Œæœ‰ç‚¹ç•¥æ˜¾æ˜‚è´µäº†ã€‚</li>
</ul>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/11-1-1.png"></p>
<blockquote>
<h4 id="M-Nå…³ç³»"><a href="#M-Nå…³ç³»" class="headerlink" title="M:Nå…³ç³»"></a>M:Nå…³ç³»</h4></blockquote>
<p>Mä¸ªåç¨‹ç»‘å®š1ä¸ªçº¿ç¨‹ï¼Œæ˜¯N:1å’Œ1:1ç±»å‹çš„ç»“åˆï¼Œå…‹æœäº†ä»¥ä¸Š2ç§æ¨¡å‹çš„ç¼ºç‚¹ï¼Œä½†å®ç°èµ·æ¥æœ€ä¸ºå¤æ‚ã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/12-m-n.png"></p>
<p>â€‹    åç¨‹è·Ÿçº¿ç¨‹æ˜¯æœ‰åŒºåˆ«çš„ï¼Œçº¿ç¨‹ç”±CPUè°ƒåº¦æ˜¯æŠ¢å å¼çš„ï¼Œ<strong>åç¨‹ç”±ç”¨æˆ·æ€è°ƒåº¦æ˜¯åä½œå¼çš„</strong>ï¼Œä¸€ä¸ªåç¨‹è®©å‡ºCPUåï¼Œæ‰æ‰§è¡Œä¸‹ä¸€ä¸ªåç¨‹ã€‚</p>
<h5 id="4-Goè¯­è¨€çš„åç¨‹goroutine"><a href="#4-Goè¯­è¨€çš„åç¨‹goroutine" class="headerlink" title="(4)Goè¯­è¨€çš„åç¨‹goroutine"></a>(4)Goè¯­è¨€çš„åç¨‹goroutine</h5><p><strong>Goä¸ºäº†æä¾›æ›´å®¹æ˜“ä½¿ç”¨çš„å¹¶å‘æ–¹æ³•ï¼Œä½¿ç”¨äº†goroutineå’Œchannel</strong>ã€‚goroutineæ¥è‡ªåç¨‹çš„æ¦‚å¿µï¼Œè®©ä¸€ç»„å¯å¤ç”¨çš„å‡½æ•°è¿è¡Œåœ¨ä¸€ç»„çº¿ç¨‹ä¹‹ä¸Šï¼Œå³ä½¿æœ‰åç¨‹é˜»å¡ï¼Œè¯¥çº¿ç¨‹çš„å…¶ä»–åç¨‹ä¹Ÿå¯ä»¥è¢«<code>runtime</code>è°ƒåº¦ï¼Œè½¬ç§»åˆ°å…¶ä»–å¯è¿è¡Œçš„çº¿ç¨‹ä¸Šã€‚æœ€å…³é”®çš„æ˜¯ï¼Œç¨‹åºå‘˜çœ‹ä¸åˆ°è¿™äº›åº•å±‚çš„ç»†èŠ‚ï¼Œè¿™å°±é™ä½äº†ç¼–ç¨‹çš„éš¾åº¦ï¼Œæä¾›äº†æ›´å®¹æ˜“çš„å¹¶å‘ã€‚</p>
<p>Goä¸­ï¼Œåç¨‹è¢«ç§°ä¸ºgoroutineï¼Œå®ƒéå¸¸è½»é‡ï¼Œä¸€ä¸ªgoroutineåªå å‡ KBï¼Œå¹¶ä¸”è¿™å‡ KBå°±è¶³å¤Ÿgoroutineè¿è¡Œå®Œï¼Œè¿™å°±èƒ½åœ¨æœ‰é™çš„å†…å­˜ç©ºé—´å†…æ”¯æŒå¤§é‡goroutineï¼Œæ”¯æŒäº†æ›´å¤šçš„å¹¶å‘ã€‚è™½ç„¶ä¸€ä¸ªgoroutineçš„æ ˆåªå å‡ KBï¼Œä½†å®é™…æ˜¯å¯ä¼¸ç¼©çš„ï¼Œå¦‚æœéœ€è¦æ›´å¤šå†…å®¹ï¼Œ<code>runtime</code>ä¼šè‡ªåŠ¨ä¸ºgoroutineåˆ†é…ã€‚</p>
<p>Goroutineç‰¹ç‚¹ï¼š</p>
<ul>
<li>å ç”¨å†…å­˜æ›´å°ï¼ˆå‡ kbï¼‰</li>
<li>è°ƒåº¦æ›´çµæ´»(runtimeè°ƒåº¦)</li>
</ul>
<h5 id="5-è¢«åºŸå¼ƒçš„goroutineè°ƒåº¦å™¨"><a href="#5-è¢«åºŸå¼ƒçš„goroutineè°ƒåº¦å™¨" class="headerlink" title="(5)è¢«åºŸå¼ƒçš„goroutineè°ƒåº¦å™¨"></a>(5)è¢«åºŸå¼ƒçš„goroutineè°ƒåº¦å™¨</h5><p>â€‹    å¥½äº†ï¼Œæ—¢ç„¶æˆ‘ä»¬çŸ¥é“äº†åç¨‹å’Œçº¿ç¨‹çš„å…³ç³»ï¼Œé‚£ä¹ˆæœ€å…³é”®çš„ä¸€ç‚¹å°±æ˜¯è°ƒåº¦åç¨‹çš„è°ƒåº¦å™¨çš„å®ç°äº†ã€‚</p>
<p>Goç›®å‰ä½¿ç”¨çš„è°ƒåº¦å™¨æ˜¯2012å¹´é‡æ–°è®¾è®¡çš„ï¼Œå› ä¸ºä¹‹å‰çš„è°ƒåº¦å™¨æ€§èƒ½å­˜åœ¨é—®é¢˜ï¼Œæ‰€ä»¥ä½¿ç”¨4å¹´å°±è¢«åºŸå¼ƒäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹è¢«åºŸå¼ƒçš„è°ƒåº¦å™¨æ˜¯å¦‚ä½•è¿ä½œçš„ï¼Ÿ</p>
<blockquote>
<p>å¤§éƒ¨åˆ†æ–‡ç« éƒ½æ˜¯ä¼šç”¨Gæ¥è¡¨ç¤ºGoroutineï¼Œç”¨Mæ¥è¡¨ç¤ºçº¿ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿä¼šç”¨è¿™ç§è¡¨è¾¾çš„å¯¹åº”å…³ç³»ã€‚</p>
</blockquote>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/13-gm.png"></p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¢«åºŸå¼ƒçš„golangè°ƒåº¦å™¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/14-old%E8%B0%83%E5%BA%A6%E5%99%A8.png"></p>
<p>Mæƒ³è¦æ‰§è¡Œã€æ”¾å›Géƒ½å¿…é¡»è®¿é—®å…¨å±€Gé˜Ÿåˆ—ï¼Œå¹¶ä¸”Mæœ‰å¤šä¸ªï¼Œå³å¤šçº¿ç¨‹è®¿é—®åŒä¸€èµ„æºéœ€è¦åŠ é”è¿›è¡Œä¿è¯äº’æ–¥&#x2F;åŒæ­¥ï¼Œæ‰€ä»¥å…¨å±€Gé˜Ÿåˆ—æ˜¯æœ‰äº’æ–¥é”è¿›è¡Œä¿æŠ¤çš„ã€‚</p>
<p>è€è°ƒåº¦å™¨æœ‰å‡ ä¸ªç¼ºç‚¹ï¼š</p>
<ol>
<li>åˆ›å»ºã€é”€æ¯ã€è°ƒåº¦Géƒ½éœ€è¦æ¯ä¸ªMè·å–é”ï¼Œè¿™å°±å½¢æˆäº†<strong>æ¿€çƒˆçš„é”ç«äº‰</strong>ã€‚</li>
<li>Mè½¬ç§»Gä¼šé€ æˆ<strong>å»¶è¿Ÿå’Œé¢å¤–çš„ç³»ç»Ÿè´Ÿè½½</strong>ã€‚æ¯”å¦‚å½“Gä¸­åŒ…å«åˆ›å»ºæ–°åç¨‹çš„æ—¶å€™ï¼ŒMåˆ›å»ºäº†Gâ€™ï¼Œä¸ºäº†ç»§ç»­æ‰§è¡ŒGï¼Œéœ€è¦æŠŠGâ€™äº¤ç»™Mâ€™æ‰§è¡Œï¼Œä¹Ÿé€ æˆäº†<strong>å¾ˆå·®çš„å±€éƒ¨æ€§</strong>ï¼Œå› ä¸ºGâ€™å’ŒGæ˜¯ç›¸å…³çš„ï¼Œæœ€å¥½æ”¾åœ¨Mä¸Šæ‰§è¡Œï¼Œè€Œä¸æ˜¯å…¶ä»–Mâ€™ã€‚</li>
<li>ç³»ç»Ÿè°ƒç”¨(CPUåœ¨Mä¹‹é—´çš„åˆ‡æ¢)å¯¼è‡´é¢‘ç¹çš„çº¿ç¨‹é˜»å¡å’Œå–æ¶ˆé˜»å¡æ“ä½œå¢åŠ äº†ç³»ç»Ÿå¼€é”€ã€‚</li>
</ol>
<h4 id="äºŒã€Goroutineè°ƒåº¦å™¨çš„GMPæ¨¡å‹çš„è®¾è®¡æ€æƒ³"><a href="#äºŒã€Goroutineè°ƒåº¦å™¨çš„GMPæ¨¡å‹çš„è®¾è®¡æ€æƒ³" class="headerlink" title="äºŒã€Goroutineè°ƒåº¦å™¨çš„GMPæ¨¡å‹çš„è®¾è®¡æ€æƒ³"></a>äºŒã€Goroutineè°ƒåº¦å™¨çš„GMPæ¨¡å‹çš„è®¾è®¡æ€æƒ³</h4><p>é¢å¯¹ä¹‹å‰è°ƒåº¦å™¨çš„é—®é¢˜ï¼ŒGoè®¾è®¡äº†æ–°çš„è°ƒåº¦å™¨ã€‚</p>
<p>åœ¨æ–°è°ƒåº¦å™¨ä¸­ï¼Œé™¤äº†M(thread)å’ŒG(goroutine)ï¼Œåˆå¼•è¿›äº†P(Processor)ã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/15-gmp.png"></p>
<p><strong>Processorï¼Œå®ƒåŒ…å«äº†è¿è¡Œgoroutineçš„èµ„æº</strong>ï¼Œå¦‚æœçº¿ç¨‹æƒ³è¿è¡Œgoroutineï¼Œå¿…é¡»å…ˆè·å–Pï¼ŒPä¸­è¿˜åŒ…å«äº†å¯è¿è¡Œçš„Gé˜Ÿåˆ—ã€‚</p>
<h5 id="1-GMPæ¨¡å‹"><a href="#1-GMPæ¨¡å‹" class="headerlink" title="(1)GMPæ¨¡å‹"></a>(1)GMPæ¨¡å‹</h5><p>åœ¨Goä¸­ï¼Œ<strong>çº¿ç¨‹æ˜¯è¿è¡Œgoroutineçš„å®ä½“ï¼Œè°ƒåº¦å™¨çš„åŠŸèƒ½æ˜¯æŠŠå¯è¿è¡Œçš„goroutineåˆ†é…åˆ°å·¥ä½œçº¿ç¨‹ä¸Š</strong>ã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/16-GMP-%E8%B0%83%E5%BA%A6.png"></p>
<ol>
<li><strong>å…¨å±€é˜Ÿåˆ—</strong>ï¼ˆGlobal Queueï¼‰ï¼šå­˜æ”¾ç­‰å¾…è¿è¡Œçš„Gã€‚</li>
<li><strong>Pçš„æœ¬åœ°é˜Ÿåˆ—</strong>ï¼šåŒå…¨å±€é˜Ÿåˆ—ç±»ä¼¼ï¼Œå­˜æ”¾çš„ä¹Ÿæ˜¯ç­‰å¾…è¿è¡Œçš„Gï¼Œå­˜çš„æ•°é‡æœ‰é™ï¼Œä¸è¶…è¿‡256ä¸ªã€‚æ–°å»ºGâ€™æ—¶ï¼ŒGâ€™ä¼˜å…ˆåŠ å…¥åˆ°Pçš„æœ¬åœ°é˜Ÿåˆ—ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œåˆ™ä¼šæŠŠæœ¬åœ°é˜Ÿåˆ—ä¸­ä¸€åŠçš„Gç§»åŠ¨åˆ°å…¨å±€é˜Ÿåˆ—ã€‚</li>
<li><strong>Påˆ—è¡¨</strong>ï¼šæ‰€æœ‰çš„Péƒ½åœ¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºï¼Œå¹¶ä¿å­˜åœ¨æ•°ç»„ä¸­ï¼Œæœ€å¤šæœ‰<code>GOMAXPROCS</code>(å¯é…ç½®)ä¸ªã€‚</li>
<li><strong>M</strong>ï¼šçº¿ç¨‹æƒ³è¿è¡Œä»»åŠ¡å°±å¾—è·å–Pï¼Œä»Pçš„æœ¬åœ°é˜Ÿåˆ—è·å–Gï¼ŒPé˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼ŒMä¹Ÿä¼šå°è¯•ä»å…¨å±€é˜Ÿåˆ—<strong>æ‹¿</strong>ä¸€æ‰¹Gæ”¾åˆ°Pçš„æœ¬åœ°é˜Ÿåˆ—ï¼Œæˆ–ä»å…¶ä»–Pçš„æœ¬åœ°é˜Ÿåˆ—<strong>å·</strong>ä¸€åŠæ”¾åˆ°è‡ªå·±Pçš„æœ¬åœ°é˜Ÿåˆ—ã€‚Mè¿è¡ŒGï¼ŒGæ‰§è¡Œä¹‹åï¼ŒMä¼šä»Pè·å–ä¸‹ä¸€ä¸ªGï¼Œä¸æ–­é‡å¤ä¸‹å»ã€‚</li>
</ol>
<p><strong>Goroutineè°ƒåº¦å™¨å’ŒOSè°ƒåº¦å™¨æ˜¯é€šè¿‡Mç»“åˆèµ·æ¥çš„ï¼Œæ¯ä¸ªMéƒ½ä»£è¡¨äº†1ä¸ªå†…æ ¸çº¿ç¨‹ï¼ŒOSè°ƒåº¦å™¨è´Ÿè´£æŠŠå†…æ ¸çº¿ç¨‹åˆ†é…åˆ°CPUçš„æ ¸ä¸Šæ‰§è¡Œ</strong>ã€‚</p>
<blockquote>
<h3 id="æœ‰å…³På’ŒMçš„ä¸ªæ•°é—®é¢˜"><a href="#æœ‰å…³På’ŒMçš„ä¸ªæ•°é—®é¢˜" class="headerlink" title="æœ‰å…³På’ŒMçš„ä¸ªæ•°é—®é¢˜"></a>æœ‰å…³På’ŒMçš„ä¸ªæ•°é—®é¢˜</h3></blockquote>
<p>1ã€Pçš„æ•°é‡ï¼š</p>
<ul>
<li>ç”±å¯åŠ¨æ—¶ç¯å¢ƒå˜é‡<code>$GOMAXPROCS</code>æˆ–è€…æ˜¯ç”±<code>runtime</code>çš„æ–¹æ³•<code>GOMAXPROCS()</code>å†³å®šã€‚è¿™æ„å‘³ç€åœ¨ç¨‹åºæ‰§è¡Œçš„ä»»æ„æ—¶åˆ»éƒ½åªæœ‰<code>$GOMAXPROCS</code>ä¸ªgoroutineåœ¨åŒæ—¶è¿è¡Œã€‚</li>
</ul>
<p>2ã€Mçš„æ•°é‡:</p>
<ul>
<li>goè¯­è¨€æœ¬èº«çš„é™åˆ¶ï¼šgoç¨‹åºå¯åŠ¨æ—¶ï¼Œä¼šè®¾ç½®Mçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤10000.ä½†æ˜¯å†…æ ¸å¾ˆéš¾æ”¯æŒè¿™ä¹ˆå¤šçš„çº¿ç¨‹æ•°ï¼Œæ‰€ä»¥è¿™ä¸ªé™åˆ¶å¯ä»¥å¿½ç•¥ã€‚</li>
<li>runtime&#x2F;debugä¸­çš„SetMaxThreadså‡½æ•°ï¼Œè®¾ç½®Mçš„æœ€å¤§æ•°é‡</li>
<li>ä¸€ä¸ªMé˜»å¡äº†ï¼Œä¼šåˆ›å»ºæ–°çš„Mã€‚</li>
</ul>
<p>Mä¸Pçš„æ•°é‡æ²¡æœ‰ç»å¯¹å…³ç³»ï¼Œä¸€ä¸ªMé˜»å¡ï¼ŒPå°±ä¼šå»åˆ›å»ºæˆ–è€…åˆ‡æ¢å¦ä¸€ä¸ªMï¼Œæ‰€ä»¥ï¼Œå³ä½¿Pçš„é»˜è®¤æ•°é‡æ˜¯1ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šåˆ›å»ºå¾ˆå¤šä¸ªMå‡ºæ¥ã€‚</p>
<blockquote>
<h3 id="På’ŒMä½•æ—¶ä¼šè¢«åˆ›å»º"><a href="#På’ŒMä½•æ—¶ä¼šè¢«åˆ›å»º" class="headerlink" title="På’ŒMä½•æ—¶ä¼šè¢«åˆ›å»º"></a>På’ŒMä½•æ—¶ä¼šè¢«åˆ›å»º</h3></blockquote>
<p>1ã€Pä½•æ—¶åˆ›å»ºï¼šåœ¨ç¡®å®šäº†Pçš„æœ€å¤§æ•°é‡nåï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šæ ¹æ®è¿™ä¸ªæ•°é‡åˆ›å»ºnä¸ªPã€‚</p>
<p>2ã€Mä½•æ—¶åˆ›å»ºï¼šæ²¡æœ‰è¶³å¤Ÿçš„Mæ¥å…³è”På¹¶è¿è¡Œå…¶ä¸­çš„å¯è¿è¡Œçš„Gã€‚æ¯”å¦‚æ‰€æœ‰çš„Mæ­¤æ—¶éƒ½é˜»å¡ä½äº†ï¼Œè€ŒPä¸­è¿˜æœ‰å¾ˆå¤šå°±ç»ªä»»åŠ¡ï¼Œå°±ä¼šå»å¯»æ‰¾ç©ºé—²çš„Mï¼Œè€Œæ²¡æœ‰ç©ºé—²çš„ï¼Œå°±ä¼šå»åˆ›å»ºæ–°çš„Mã€‚</p>
<h5 id="2-è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥"><a href="#2-è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥" class="headerlink" title="(2)è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥"></a>(2)è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥</h5><p><strong>å¤ç”¨çº¿ç¨‹</strong>ï¼šé¿å…é¢‘ç¹çš„åˆ›å»ºã€é”€æ¯çº¿ç¨‹ï¼Œè€Œæ˜¯å¯¹çº¿ç¨‹çš„å¤ç”¨ã€‚</p>
<p>1ï¼‰work stealingæœºåˆ¶</p>
<p>â€‹        å½“æœ¬çº¿ç¨‹æ— å¯è¿è¡Œçš„Gæ—¶ï¼Œå°è¯•ä»å…¶ä»–çº¿ç¨‹ç»‘å®šçš„På·å–Gï¼Œè€Œä¸æ˜¯é”€æ¯çº¿ç¨‹ã€‚</p>
<p>2ï¼‰hand offæœºåˆ¶</p>
<p>â€‹        å½“æœ¬çº¿ç¨‹å› ä¸ºGè¿›è¡Œç³»ç»Ÿè°ƒç”¨é˜»å¡æ—¶ï¼Œçº¿ç¨‹é‡Šæ”¾ç»‘å®šçš„Pï¼ŒæŠŠPè½¬ç§»ç»™å…¶ä»–ç©ºé—²çš„çº¿ç¨‹æ‰§è¡Œã€‚</p>
<p><strong>åˆ©ç”¨å¹¶è¡Œ</strong>ï¼š<code>GOMAXPROCS</code>è®¾ç½®Pçš„æ•°é‡ï¼Œæœ€å¤šæœ‰<code>GOMAXPROCS</code>ä¸ªçº¿ç¨‹åˆ†å¸ƒåœ¨å¤šä¸ªCPUä¸ŠåŒæ—¶è¿è¡Œã€‚<code>GOMAXPROCS</code>ä¹Ÿé™åˆ¶äº†å¹¶å‘çš„ç¨‹åº¦ï¼Œæ¯”å¦‚<code>GOMAXPROCS = æ ¸æ•°/2</code>ï¼Œåˆ™æœ€å¤šåˆ©ç”¨äº†ä¸€åŠçš„CPUæ ¸è¿›è¡Œå¹¶è¡Œã€‚</p>
<p><strong>æŠ¢å </strong>ï¼šåœ¨coroutineä¸­è¦ç­‰å¾…ä¸€ä¸ªåç¨‹ä¸»åŠ¨è®©å‡ºCPUæ‰æ‰§è¡Œä¸‹ä¸€ä¸ªåç¨‹ï¼Œåœ¨Goä¸­ï¼Œä¸€ä¸ªgoroutineæœ€å¤šå ç”¨CPU 10msï¼Œé˜²æ­¢å…¶ä»–goroutineè¢«é¥¿æ­»ï¼Œè¿™å°±æ˜¯goroutineä¸åŒäºcoroutineçš„ä¸€ä¸ªåœ°æ–¹ã€‚</p>
<p><strong>å…¨å±€Gé˜Ÿåˆ—</strong>ï¼šåœ¨æ–°çš„è°ƒåº¦å™¨ä¸­ä¾ç„¶æœ‰å…¨å±€Gé˜Ÿåˆ—ï¼Œä½†åŠŸèƒ½å·²ç»è¢«å¼±åŒ–äº†ï¼Œå½“Mæ‰§è¡Œwork stealingä»å…¶ä»–På·ä¸åˆ°Gæ—¶ï¼Œå®ƒå¯ä»¥ä»å…¨å±€Gé˜Ÿåˆ—è·å–Gã€‚</p>
<h5 id="3-go-func-è°ƒåº¦æµç¨‹"><a href="#3-go-func-è°ƒåº¦æµç¨‹" class="headerlink" title="(3) go func()  è°ƒåº¦æµç¨‹"></a>(3) go func()  è°ƒåº¦æµç¨‹</h5><p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/18-go-func%E8%B0%83%E5%BA%A6%E5%91%A8%E6%9C%9F.jpeg"></p>
<p>ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥åˆ†æå‡ºå‡ ä¸ªç»“è®ºï¼š</p>
<p>â€‹    1ã€æˆ‘ä»¬é€šè¿‡ go func()æ¥åˆ›å»ºä¸€ä¸ªgoroutineï¼›</p>
<p>â€‹    2ã€æœ‰ä¸¤ä¸ªå­˜å‚¨Gçš„é˜Ÿåˆ—ï¼Œä¸€ä¸ªæ˜¯å±€éƒ¨è°ƒåº¦å™¨Pçš„æœ¬åœ°é˜Ÿåˆ—ã€ä¸€ä¸ªæ˜¯å…¨å±€Gé˜Ÿåˆ—ã€‚æ–°åˆ›å»ºçš„Gä¼šå…ˆä¿å­˜åœ¨Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœPçš„æœ¬åœ°é˜Ÿåˆ—å·²ç»æ»¡äº†å°±ä¼šä¿å­˜åœ¨å…¨å±€çš„é˜Ÿåˆ—ä¸­ï¼›</p>
<p>â€‹    3ã€Gåªèƒ½è¿è¡Œåœ¨Mä¸­ï¼Œä¸€ä¸ªMå¿…é¡»æŒæœ‰ä¸€ä¸ªPï¼ŒMä¸Pæ˜¯1ï¼š1çš„å…³ç³»ã€‚Mä¼šä»Pçš„æœ¬åœ°é˜Ÿåˆ—å¼¹å‡ºä¸€ä¸ªå¯æ‰§è¡ŒçŠ¶æ€çš„Gæ¥æ‰§è¡Œï¼Œå¦‚æœPçš„æœ¬åœ°é˜Ÿåˆ—ä¸ºç©ºï¼Œå°±ä¼šæƒ³å…¶ä»–çš„MPç»„åˆå·å–ä¸€ä¸ªå¯æ‰§è¡Œçš„Gæ¥æ‰§è¡Œï¼›</p>
<p>â€‹    4ã€ä¸€ä¸ªMè°ƒåº¦Gæ‰§è¡Œçš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªå¾ªç¯æœºåˆ¶ï¼›</p>
<p>â€‹    5ã€å½“Mæ‰§è¡ŒæŸä¸€ä¸ªGæ—¶å€™å¦‚æœå‘ç”Ÿäº†syscallæˆ–åˆ™å…¶ä½™é˜»å¡æ“ä½œï¼ŒMä¼šé˜»å¡ï¼Œå¦‚æœå½“å‰æœ‰ä¸€äº›Gåœ¨æ‰§è¡Œï¼Œruntimeä¼šæŠŠè¿™ä¸ªçº¿ç¨‹Mä»Pä¸­æ‘˜é™¤(detach)ï¼Œç„¶åå†åˆ›å»ºä¸€ä¸ªæ–°çš„æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹(å¦‚æœæœ‰ç©ºé—²çš„çº¿ç¨‹å¯ç”¨å°±å¤ç”¨ç©ºé—²çº¿ç¨‹)æ¥æœåŠ¡äºè¿™ä¸ªPï¼›</p>
<p>â€‹    6ã€å½“Mç³»ç»Ÿè°ƒç”¨ç»“æŸæ—¶å€™ï¼Œè¿™ä¸ªGä¼šå°è¯•è·å–ä¸€ä¸ªç©ºé—²çš„Pæ‰§è¡Œï¼Œå¹¶æ”¾å…¥åˆ°è¿™ä¸ªPçš„æœ¬åœ°é˜Ÿåˆ—ã€‚å¦‚æœè·å–ä¸åˆ°Pï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹Må˜æˆä¼‘çœ çŠ¶æ€ï¼Œ åŠ å…¥åˆ°ç©ºé—²çº¿ç¨‹ä¸­ï¼Œç„¶åè¿™ä¸ªGä¼šè¢«æ”¾å…¥å…¨å±€é˜Ÿåˆ—ä¸­ã€‚</p>
<h5 id="4-è°ƒåº¦å™¨çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#4-è°ƒåº¦å™¨çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="(4)è°ƒåº¦å™¨çš„ç”Ÿå‘½å‘¨æœŸ"></a>(4)è°ƒåº¦å™¨çš„ç”Ÿå‘½å‘¨æœŸ</h5><p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/17-pic-go%E8%B0%83%E5%BA%A6%E5%99%A8%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png"></p>
<p>ç‰¹æ®Šçš„M0å’ŒG0</p>
<p><strong>M0</strong></p>
<p><code>M0</code>æ˜¯å¯åŠ¨ç¨‹åºåçš„ç¼–å·ä¸º0çš„ä¸»çº¿ç¨‹ï¼Œè¿™ä¸ªMå¯¹åº”çš„å®ä¾‹ä¼šåœ¨å…¨å±€å˜é‡runtime.m0ä¸­ï¼Œä¸éœ€è¦åœ¨heapä¸Šåˆ†é…ï¼ŒM0è´Ÿè´£æ‰§è¡Œåˆå§‹åŒ–æ“ä½œå’Œå¯åŠ¨ç¬¬ä¸€ä¸ªGï¼Œ åœ¨ä¹‹åM0å°±å’Œå…¶ä»–çš„Mä¸€æ ·äº†ã€‚</p>
<p><strong>G0</strong></p>
<p><code>G0</code>æ˜¯æ¯æ¬¡å¯åŠ¨ä¸€ä¸ªMéƒ½ä¼šç¬¬ä¸€ä¸ªåˆ›å»ºçš„ goroutineï¼ŒG0ä»…ç”¨äºè´Ÿè´£è°ƒåº¦çš„Gï¼ŒG0ä¸æŒ‡å‘ä»»ä½•å¯æ‰§è¡Œçš„å‡½æ•°, æ¯ä¸ªMéƒ½ä¼šæœ‰ä¸€ä¸ªè‡ªå·±çš„G0ã€‚åœ¨è°ƒåº¦æˆ–ç³»ç»Ÿè°ƒç”¨æ—¶ä¼šä½¿ç”¨G0çš„æ ˆç©ºé—´, å…¨å±€å˜é‡çš„G0æ˜¯M0çš„G0ã€‚</p>
<p>æˆ‘ä»¬æ¥è·Ÿè¸ªä¸€æ®µä»£ç </p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello world&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥é’ˆå¯¹ä¸Šé¢çš„ä»£ç å¯¹è°ƒåº¦å™¨é‡Œé¢çš„ç»“æ„åšä¸€ä¸ªåˆ†æã€‚</p>
<p>ä¹Ÿä¼šç»å†å¦‚ä¸Šå›¾æ‰€ç¤ºçš„è¿‡ç¨‹ï¼š</p>
<ol>
<li>runtimeåˆ›å»ºæœ€åˆçš„çº¿ç¨‹m0å’Œgoroutine g0ï¼Œå¹¶æŠŠ2è€…å…³è”ã€‚</li>
<li>è°ƒåº¦å™¨åˆå§‹åŒ–ï¼šåˆå§‹åŒ–m0ã€æ ˆã€åƒåœ¾å›æ”¶ï¼Œä»¥åŠåˆ›å»ºå’Œåˆå§‹åŒ–ç”±GOMAXPROCSä¸ªPæ„æˆçš„Påˆ—è¡¨ã€‚</li>
<li>ç¤ºä¾‹ä»£ç ä¸­çš„mainå‡½æ•°æ˜¯<code>main.main</code>ï¼Œ<code>runtime</code>ä¸­ä¹Ÿæœ‰1ä¸ªmainå‡½æ•°â€”â€”<code>runtime.main</code>ï¼Œä»£ç ç»è¿‡ç¼–è¯‘åï¼Œ<code>runtime.main</code>ä¼šè°ƒç”¨<code>main.main</code>ï¼Œç¨‹åºå¯åŠ¨æ—¶ä¼šä¸º<code>runtime.main</code>åˆ›å»ºgoroutineï¼Œç§°å®ƒä¸ºmain goroutineå§ï¼Œç„¶åæŠŠmain goroutineåŠ å…¥åˆ°Pçš„æœ¬åœ°é˜Ÿåˆ—ã€‚</li>
<li>å¯åŠ¨m0ï¼Œm0å·²ç»ç»‘å®šäº†Pï¼Œä¼šä»Pçš„æœ¬åœ°é˜Ÿåˆ—è·å–Gï¼Œè·å–åˆ°main goroutineã€‚</li>
<li>Gæ‹¥æœ‰æ ˆï¼ŒMæ ¹æ®Gä¸­çš„æ ˆä¿¡æ¯å’Œè°ƒåº¦ä¿¡æ¯è®¾ç½®è¿è¡Œç¯å¢ƒ</li>
<li>Mè¿è¡ŒG</li>
<li>Gé€€å‡ºï¼Œå†æ¬¡å›åˆ°Mè·å–å¯è¿è¡Œçš„Gï¼Œè¿™æ ·é‡å¤ä¸‹å»ï¼Œç›´åˆ°<code>main.main</code>é€€å‡ºï¼Œ<code>runtime.main</code>æ‰§è¡ŒDeferå’ŒPanicå¤„ç†ï¼Œæˆ–è°ƒç”¨<code>runtime.exit</code>é€€å‡ºç¨‹åºã€‚</li>
</ol>
<p>è°ƒåº¦å™¨çš„ç”Ÿå‘½å‘¨æœŸå‡ ä¹å æ»¡äº†ä¸€ä¸ªGoç¨‹åºçš„ä¸€ç”Ÿï¼Œ<code>runtime.main</code>çš„goroutineæ‰§è¡Œä¹‹å‰éƒ½æ˜¯ä¸ºè°ƒåº¦å™¨åšå‡†å¤‡å·¥ä½œï¼Œ<code>runtime.main</code>çš„goroutineè¿è¡Œï¼Œæ‰æ˜¯è°ƒåº¦å™¨çš„çœŸæ­£å¼€å§‹ï¼Œç›´åˆ°<code>runtime.main</code>ç»“æŸè€Œç»“æŸã€‚</p>
<h5 id="5-å¯è§†åŒ–GMPç¼–ç¨‹"><a href="#5-å¯è§†åŒ–GMPç¼–ç¨‹" class="headerlink" title="(5)å¯è§†åŒ–GMPç¼–ç¨‹"></a>(5)å¯è§†åŒ–GMPç¼–ç¨‹</h5><p>æœ‰2ç§æ–¹å¼å¯ä»¥æŸ¥çœ‹ä¸€ä¸ªç¨‹åºçš„GMPçš„æ•°æ®ã€‚</p>
<p><strong>æ–¹å¼1ï¼šgo tool trace</strong></p>
<p>traceè®°å½•äº†è¿è¡Œæ—¶çš„ä¿¡æ¯ï¼Œèƒ½æä¾›å¯è§†åŒ–çš„Webé¡µé¢ã€‚</p>
<p>ç®€å•æµ‹è¯•ä»£ç ï¼šmainå‡½æ•°åˆ›å»ºtraceï¼Œtraceä¼šè¿è¡Œåœ¨å•ç‹¬çš„goroutineä¸­ï¼Œç„¶åmainæ‰“å°â€Hello Worldâ€é€€å‡ºã€‚</p>
<blockquote>
<p>trace.go</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;runtime/trace&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºtraceæ–‡ä»¶</span></span><br><span class="line">    f, err := os.Create(<span class="string">&quot;trace.out&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> f.Close()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯åŠ¨trace goroutine</span></span><br><span class="line">    err = trace.Start(f)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> trace.Stop()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//main</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç¨‹åº</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ go run trace.go </span><br><span class="line">Hello World</span><br></pre></td></tr></table></figure>

<p>ä¼šå¾—åˆ°ä¸€ä¸ª<code>trace.out</code>æ–‡ä»¶ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå·¥å…·æ‰“å¼€ï¼Œæ¥åˆ†æè¿™ä¸ªæ–‡ä»¶ã€‚</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line">$ <span class="keyword">go</span> tool trace trace.out </span><br><span class="line"><span class="number">2020</span>/<span class="number">02</span>/<span class="number">23</span> <span class="number">10</span>:<span class="number">44</span>:<span class="number">11</span> Parsing trace...</span><br><span class="line"><span class="number">2020</span>/<span class="number">02</span>/<span class="number">23</span> <span class="number">10</span>:<span class="number">44</span>:<span class="number">11</span> Splitting trace...</span><br><span class="line"><span class="number">2020</span>/<span class="number">02</span>/<span class="number">23</span> <span class="number">10</span>:<span class="number">44</span>:<span class="number">11</span> Opening browser. Trace viewer is listening on http:<span class="comment">//127.0.0.1:33479</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æµè§ˆå™¨æ‰“å¼€<code>http://127.0.0.1:33479</code>ç½‘å€ï¼Œç‚¹å‡»<code>view trace</code> èƒ½å¤Ÿçœ‹è§å¯è§†åŒ–çš„è°ƒåº¦æµç¨‹ã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/19-go-trace1.png"></p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/20-go-trace2.png"></p>
<p><strong>Gä¿¡æ¯</strong></p>
<p>ç‚¹å‡»Goroutinesé‚£ä¸€è¡Œå¯è§†åŒ–çš„æ•°æ®æ¡ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€äº›è¯¦ç»†çš„ä¿¡æ¯ã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/20-go-trace3.png"></p>
<pre><code>  ä¸€å…±æœ‰ä¸¤ä¸ªGåœ¨ç¨‹åºä¸­ï¼Œä¸€ä¸ªæ˜¯ç‰¹æ®Šçš„G0ï¼Œæ˜¯æ¯ä¸ªMå¿…é¡»æœ‰çš„ä¸€ä¸ªåˆå§‹åŒ–çš„Gï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸å¿…è®¨è®ºã€‚
</code></pre>
<p>å…¶ä¸­G1åº”è¯¥å°±æ˜¯main goroutine(æ‰§è¡Œmainå‡½æ•°çš„åç¨‹)ï¼Œåœ¨ä¸€æ®µæ—¶é—´å†…å¤„äºå¯è¿è¡Œå’Œè¿è¡Œçš„çŠ¶æ€ã€‚</p>
<p><strong>Mä¿¡æ¯</strong></p>
<p>ç‚¹å‡»Threadsé‚£ä¸€è¡Œå¯è§†åŒ–çš„æ•°æ®æ¡ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€äº›è¯¦ç»†çš„ä¿¡æ¯ã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/22-go-trace4.png"></p>
<p>ä¸€å…±æœ‰ä¸¤ä¸ªMåœ¨ç¨‹åºä¸­ï¼Œä¸€ä¸ªæ˜¯ç‰¹æ®Šçš„M0ï¼Œç”¨äºåˆå§‹åŒ–ä½¿ç”¨ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸å¿…è®¨è®ºã€‚</p>
<p><strong>Pä¿¡æ¯</strong></p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/23-go-trace5.png"></p>
<p>G1ä¸­è°ƒç”¨äº†<code>main.main</code>ï¼Œåˆ›å»ºäº†<code>trace goroutine g18</code>ã€‚G1è¿è¡Œåœ¨P1ä¸Šï¼ŒG18è¿è¡Œåœ¨P0ä¸Šã€‚</p>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªPï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªPå¿…é¡»ç»‘å®šä¸€ä¸ªMæ‰èƒ½è°ƒåº¦Gã€‚</p>
<p>æˆ‘ä»¬åœ¨æ¥çœ‹çœ‹ä¸Šé¢çš„Mä¿¡æ¯ã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/24-go-trace6.png"></p>
<p>æˆ‘ä»¬ä¼šå‘ç°ï¼Œç¡®å®G18åœ¨P0ä¸Šè¢«è¿è¡Œçš„æ—¶å€™ï¼Œç¡®å®åœ¨Threadsè¡Œå¤šäº†ä¸€ä¸ªMçš„æ•°æ®ï¼Œç‚¹å‡»æŸ¥çœ‹å¦‚ä¸‹ï¼š</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/25-go-trace7.png"></p>
<p>å¤šäº†ä¸€ä¸ªM2åº”è¯¥å°±æ˜¯P0ä¸ºäº†æ‰§è¡ŒG18è€ŒåŠ¨æ€åˆ›å»ºçš„M2.</p>
<p><strong>æ–¹å¼2ï¼šDebug trace</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        time.Sleep(time.Second)</span><br><span class="line">        fmt.Println(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ go build trace2.go</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡Debugæ–¹å¼è¿è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ GODEBUG=schedtrace=1000 ./trace2 </span><br><span class="line">SCHED 0ms: gomaxprocs=2 idleprocs=0 threads=4 spinningthreads=1 idlethreads=1 runqueue=0 [0 0]</span><br><span class="line">Hello World</span><br><span class="line">SCHED 1003ms: gomaxprocs=2 idleprocs=2 threads=4 spinningthreads=0 idlethreads=2 runqueue=0 [0 0]</span><br><span class="line">Hello World</span><br><span class="line">SCHED 2014ms: gomaxprocs=2 idleprocs=2 threads=4 spinningthreads=0 idlethreads=2 runqueue=0 [0 0]</span><br><span class="line">Hello World</span><br><span class="line">SCHED 3015ms: gomaxprocs=2 idleprocs=2 threads=4 spinningthreads=0 idlethreads=2 runqueue=0 [0 0]</span><br><span class="line">Hello World</span><br><span class="line">SCHED 4023ms: gomaxprocs=2 idleprocs=2 threads=4 spinningthreads=0 idlethreads=2 runqueue=0 [0 0]</span><br><span class="line">Hello World</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>SCHED</code>ï¼šè°ƒè¯•ä¿¡æ¯è¾“å‡ºæ ‡å¿—å­—ç¬¦ä¸²ï¼Œä»£è¡¨æœ¬è¡Œæ˜¯goroutineè°ƒåº¦å™¨çš„è¾“å‡ºï¼›</li>
<li><code>0ms</code>ï¼šå³ä»ç¨‹åºå¯åŠ¨åˆ°è¾“å‡ºè¿™è¡Œæ—¥å¿—çš„æ—¶é—´ï¼›</li>
<li><code>gomaxprocs</code>: Pçš„æ•°é‡ï¼Œæœ¬ä¾‹æœ‰2ä¸ªP, å› ä¸ºé»˜è®¤çš„Pçš„å±æ€§æ˜¯å’Œcpuæ ¸å¿ƒæ•°é‡é»˜è®¤ä¸€è‡´ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡GOMAXPROCSæ¥è®¾ç½®ï¼›</li>
<li><code>idleprocs</code>: å¤„äºidleçŠ¶æ€çš„Pçš„æ•°é‡ï¼›é€šè¿‡gomaxprocså’Œidleprocsçš„å·®å€¼ï¼Œæˆ‘ä»¬å°±å¯çŸ¥é“æ‰§è¡Œgoä»£ç çš„Pçš„æ•°é‡ï¼›</li>
<li>t<code>hreads: os threads/M</code>çš„æ•°é‡ï¼ŒåŒ…å«schedulerä½¿ç”¨çš„mæ•°é‡ï¼ŒåŠ ä¸Šruntimeè‡ªç”¨çš„ç±»ä¼¼sysmonè¿™æ ·çš„threadçš„æ•°é‡ï¼›</li>
<li><code>spinningthreads</code>: å¤„äºè‡ªæ—‹çŠ¶æ€çš„os threadæ•°é‡ï¼›</li>
<li><code>idlethread</code>: å¤„äºidleçŠ¶æ€çš„os threadçš„æ•°é‡ï¼›</li>
<li><code>runqueue=0</code>ï¼š Schedulerå…¨å±€é˜Ÿåˆ—ä¸­Gçš„æ•°é‡ï¼›</li>
<li><code>[0 0]</code>: åˆ†åˆ«ä¸º2ä¸ªPçš„local queueä¸­çš„Gçš„æ•°é‡ã€‚</li>
</ul>
<p>ä¸‹ä¸€ç¯‡ï¼Œæˆ‘ä»¬æ¥ç»§ç»­è¯¦ç»†çš„åˆ†æGMPè°ƒåº¦åŸç†çš„ä¸€äº›åœºæ™¯é—®é¢˜ã€‚</p>
<h4 id="ä¸‰ã€Goè°ƒåº¦å™¨è°ƒåº¦åœºæ™¯è¿‡ç¨‹å…¨è§£æ"><a href="#ä¸‰ã€Goè°ƒåº¦å™¨è°ƒåº¦åœºæ™¯è¿‡ç¨‹å…¨è§£æ" class="headerlink" title="ä¸‰ã€Goè°ƒåº¦å™¨è°ƒåº¦åœºæ™¯è¿‡ç¨‹å…¨è§£æ"></a>ä¸‰ã€Goè°ƒåº¦å™¨è°ƒåº¦åœºæ™¯è¿‡ç¨‹å…¨è§£æ</h4><h5 id="1-åœºæ™¯1"><a href="#1-åœºæ™¯1" class="headerlink" title="(1)åœºæ™¯1"></a>(1)åœºæ™¯1</h5><p>Pæ‹¥æœ‰G1ï¼ŒM1è·å–Påå¼€å§‹è¿è¡ŒG1ï¼ŒG1ä½¿ç”¨<code>go func()</code>åˆ›å»ºäº†G2ï¼Œä¸ºäº†å±€éƒ¨æ€§G2ä¼˜å…ˆåŠ å…¥åˆ°P1çš„æœ¬åœ°é˜Ÿåˆ—ã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/26-gmp%E5%9C%BA%E6%99%AF1.png"></p>
<hr>
<h5 id="2-åœºæ™¯2"><a href="#2-åœºæ™¯2" class="headerlink" title="(2)åœºæ™¯2"></a>(2)åœºæ™¯2</h5><p>G1è¿è¡Œå®Œæˆå(å‡½æ•°ï¼š<code>goexit</code>)ï¼ŒMä¸Šè¿è¡Œçš„goroutineåˆ‡æ¢ä¸ºG0ï¼ŒG0è´Ÿè´£è°ƒåº¦æ—¶åç¨‹çš„åˆ‡æ¢ï¼ˆå‡½æ•°ï¼š<code>schedule</code>ï¼‰ã€‚ä»Pçš„æœ¬åœ°é˜Ÿåˆ—å–G2ï¼Œä»G0åˆ‡æ¢åˆ°G2ï¼Œå¹¶å¼€å§‹è¿è¡ŒG2(å‡½æ•°ï¼š<code>execute</code>)ã€‚å®ç°äº†çº¿ç¨‹M1çš„å¤ç”¨ã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/27-gmp%E5%9C%BA%E6%99%AF2.png"></p>
<hr>
<h5 id="3-åœºæ™¯3"><a href="#3-åœºæ™¯3" class="headerlink" title="(3)åœºæ™¯3"></a>(3)åœºæ™¯3</h5><p>å‡è®¾æ¯ä¸ªPçš„æœ¬åœ°é˜Ÿåˆ—åªèƒ½å­˜3ä¸ªGã€‚G2è¦åˆ›å»ºäº†6ä¸ªGï¼Œå‰3ä¸ªGï¼ˆG3, G4, G5ï¼‰å·²ç»åŠ å…¥p1çš„æœ¬åœ°é˜Ÿåˆ—ï¼Œp1æœ¬åœ°é˜Ÿåˆ—æ»¡äº†ã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/28-gmp%E5%9C%BA%E6%99%AF3.png"></p>
<hr>
<h5 id="4-åœºæ™¯4"><a href="#4-åœºæ™¯4" class="headerlink" title="(4)åœºæ™¯4"></a>(4)åœºæ™¯4</h5><p>G2åœ¨åˆ›å»ºG7çš„æ—¶å€™ï¼Œå‘ç°P1çš„æœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œéœ€è¦æ‰§è¡Œ<strong>è´Ÿè½½å‡è¡¡</strong>(æŠŠP1ä¸­æœ¬åœ°é˜Ÿåˆ—ä¸­å‰ä¸€åŠçš„Gï¼Œè¿˜æœ‰æ–°åˆ›å»ºG<strong>è½¬ç§»</strong>åˆ°å…¨å±€é˜Ÿåˆ—)</p>
<blockquote>
<p>ï¼ˆå®ç°ä¸­å¹¶ä¸ä¸€å®šæ˜¯æ–°çš„Gï¼Œå¦‚æœGæ˜¯G2ä¹‹åå°±æ‰§è¡Œçš„ï¼Œä¼šè¢«ä¿å­˜åœ¨æœ¬åœ°é˜Ÿåˆ—ï¼Œåˆ©ç”¨æŸä¸ªè€çš„Gæ›¿æ¢æ–°GåŠ å…¥å…¨å±€é˜Ÿåˆ—ï¼‰</p>
</blockquote>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/29-gmp%E5%9C%BA%E6%99%AF4.png"></p>
<p>è¿™äº›Gè¢«è½¬ç§»åˆ°å…¨å±€é˜Ÿåˆ—æ—¶ï¼Œä¼šè¢«æ‰“ä¹±é¡ºåºã€‚æ‰€ä»¥G3,G4,G7è¢«è½¬ç§»åˆ°å…¨å±€é˜Ÿåˆ—ã€‚</p>
<hr>
<h5 id="5-åœºæ™¯5"><a href="#5-åœºæ™¯5" class="headerlink" title="(5)åœºæ™¯5"></a>(5)åœºæ™¯5</h5><p>G2åˆ›å»ºG8æ—¶ï¼ŒP1çš„æœ¬åœ°é˜Ÿåˆ—æœªæ»¡ï¼Œæ‰€ä»¥G8ä¼šè¢«åŠ å…¥åˆ°P1çš„æœ¬åœ°é˜Ÿåˆ—ã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/30-gmp%E5%9C%BA%E6%99%AF5.png"></p>
<p>G8åŠ å…¥åˆ°P1ç‚¹æœ¬åœ°é˜Ÿåˆ—çš„åŸå› è¿˜æ˜¯å› ä¸ºP1æ­¤æ—¶åœ¨ä¸M1ç»‘å®šï¼Œè€ŒG2æ­¤æ—¶æ˜¯M1åœ¨æ‰§è¡Œã€‚æ‰€ä»¥G2åˆ›å»ºçš„æ–°çš„Gä¼šä¼˜å…ˆæ”¾ç½®åˆ°è‡ªå·±çš„Mç»‘å®šçš„Pä¸Šã€‚</p>
<hr>
<h5 id="6-åœºæ™¯6"><a href="#6-åœºæ™¯6" class="headerlink" title="(6)åœºæ™¯6"></a>(6)åœºæ™¯6</h5><p>è§„å®šï¼š<strong>åœ¨åˆ›å»ºGæ—¶ï¼Œè¿è¡Œçš„Gä¼šå°è¯•å”¤é†’å…¶ä»–ç©ºé—²çš„På’ŒMç»„åˆå»æ‰§è¡Œ</strong>ã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/31-gmp%E5%9C%BA%E6%99%AF6.png"></p>
<p>å‡å®šG2å”¤é†’äº†M2ï¼ŒM2ç»‘å®šäº†P2ï¼Œå¹¶è¿è¡ŒG0ï¼Œä½†P2æœ¬åœ°é˜Ÿåˆ—æ²¡æœ‰Gï¼ŒM2æ­¤æ—¶ä¸ºè‡ªæ—‹çº¿ç¨‹<strong>ï¼ˆæ²¡æœ‰Gä½†ä¸ºè¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹ï¼Œä¸æ–­å¯»æ‰¾Gï¼‰</strong>ã€‚</p>
<hr>
<h5 id="7-åœºæ™¯7"><a href="#7-åœºæ™¯7" class="headerlink" title="(7)åœºæ™¯7"></a>(7)åœºæ™¯7</h5><p>M2å°è¯•ä»å…¨å±€é˜Ÿåˆ—(ç®€ç§°â€œGQâ€)å–ä¸€æ‰¹Gæ”¾åˆ°P2çš„æœ¬åœ°é˜Ÿåˆ—ï¼ˆå‡½æ•°ï¼š<code>findrunnable()</code>ï¼‰ã€‚M2ä»å…¨å±€é˜Ÿåˆ—å–çš„Gæ•°é‡ç¬¦åˆä¸‹é¢çš„å…¬å¼ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">n = min(<span class="built_in">len</span>(GQ)/GOMAXPROCS + <span class="number">1</span>, <span class="built_in">len</span>(GQ/<span class="number">2</span>))</span><br></pre></td></tr></table></figure>

<p>è‡³å°‘ä»å…¨å±€é˜Ÿåˆ—å–1ä¸ªgï¼Œä½†æ¯æ¬¡ä¸è¦ä»å…¨å±€é˜Ÿåˆ—ç§»åŠ¨å¤ªå¤šçš„gåˆ°pæœ¬åœ°é˜Ÿåˆ—ï¼Œç»™å…¶ä»–pç•™ç‚¹ã€‚è¿™æ˜¯<strong>ä»å…¨å±€é˜Ÿåˆ—åˆ°Pæœ¬åœ°é˜Ÿåˆ—çš„è´Ÿè½½å‡è¡¡</strong>ã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/32-gmp%E5%9C%BA%E6%99%AF7.001.jpeg"></p>
<p>å‡å®šæˆ‘ä»¬åœºæ™¯ä¸­ä¸€å…±æœ‰4ä¸ªPï¼ˆGOMAXPROCSè®¾ç½®ä¸º4ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…è®¸æœ€å¤šå°±èƒ½ç”¨4ä¸ªPæ¥ä¾›Mä½¿ç”¨ï¼‰ã€‚æ‰€ä»¥M2åªä»èƒ½ä»å…¨å±€é˜Ÿåˆ—å–1ä¸ªGï¼ˆå³G3ï¼‰ç§»åŠ¨P2æœ¬åœ°é˜Ÿåˆ—ï¼Œç„¶åå®Œæˆä»G0åˆ°G3çš„åˆ‡æ¢ï¼Œè¿è¡ŒG3ã€‚</p>
<hr>
<h5 id="8-åœºæ™¯8"><a href="#8-åœºæ™¯8" class="headerlink" title="(8)åœºæ™¯8"></a>(8)åœºæ™¯8</h5><p>å‡è®¾G2ä¸€ç›´åœ¨M1ä¸Šè¿è¡Œï¼Œç»è¿‡2è½®åï¼ŒM2å·²ç»æŠŠG7ã€G4ä»å…¨å±€é˜Ÿåˆ—è·å–åˆ°äº†P2çš„æœ¬åœ°é˜Ÿåˆ—å¹¶å®Œæˆè¿è¡Œï¼Œå…¨å±€é˜Ÿåˆ—å’ŒP2çš„æœ¬åœ°é˜Ÿåˆ—éƒ½ç©ºäº†,å¦‚åœºæ™¯8å›¾çš„å·¦åŠéƒ¨åˆ†ã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/33-gmp%E5%9C%BA%E6%99%AF8.png"></p>
<p><strong>å…¨å±€é˜Ÿåˆ—å·²ç»æ²¡æœ‰Gï¼Œé‚£må°±è¦æ‰§è¡Œwork stealing(å·å–)ï¼šä»å…¶ä»–æœ‰Gçš„På“ªé‡Œå·å–ä¸€åŠGè¿‡æ¥ï¼Œæ”¾åˆ°è‡ªå·±çš„Pæœ¬åœ°é˜Ÿåˆ—</strong>ã€‚P2ä»P1çš„æœ¬åœ°é˜Ÿåˆ—å°¾éƒ¨å–ä¸€åŠçš„Gï¼Œæœ¬ä¾‹ä¸­ä¸€åŠåˆ™åªæœ‰1ä¸ªG8ï¼Œæ”¾åˆ°P2çš„æœ¬åœ°é˜Ÿåˆ—å¹¶æ‰§è¡Œã€‚</p>
<hr>
<h5 id="9-åœºæ™¯9"><a href="#9-åœºæ™¯9" class="headerlink" title="(9)åœºæ™¯9"></a>(9)åœºæ™¯9</h5><p>G1æœ¬åœ°é˜Ÿåˆ—G5ã€G6å·²ç»è¢«å…¶ä»–Må·èµ°å¹¶è¿è¡Œå®Œæˆï¼Œå½“å‰M1å’ŒM2åˆ†åˆ«åœ¨è¿è¡ŒG2å’ŒG8ï¼ŒM3å’ŒM4æ²¡æœ‰goroutineå¯ä»¥è¿è¡Œï¼ŒM3å’ŒM4å¤„äº<strong>è‡ªæ—‹çŠ¶æ€</strong>ï¼Œå®ƒä»¬ä¸æ–­å¯»æ‰¾goroutineã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/34-gmp%E5%9C%BA%E6%99%AF9.png"></p>
<p>ä¸ºä»€ä¹ˆè¦è®©m3å’Œm4è‡ªæ—‹ï¼Œè‡ªæ—‹æœ¬è´¨æ˜¯åœ¨è¿è¡Œï¼Œçº¿ç¨‹åœ¨è¿è¡Œå´æ²¡æœ‰æ‰§è¡ŒGï¼Œå°±å˜æˆäº†æµªè´¹CPU.  ä¸ºä»€ä¹ˆä¸é”€æ¯ç°åœºï¼Œæ¥èŠ‚çº¦CPUèµ„æºã€‚å› ä¸ºåˆ›å»ºå’Œé”€æ¯CPUä¹Ÿä¼šæµªè´¹æ—¶é—´ï¼Œæˆ‘ä»¬<strong>å¸Œæœ›å½“æœ‰æ–°goroutineåˆ›å»ºæ—¶ï¼Œç«‹åˆ»èƒ½æœ‰Mè¿è¡Œå®ƒ</strong>ï¼Œå¦‚æœé”€æ¯å†æ–°å»ºå°±å¢åŠ äº†æ—¶å»¶ï¼Œé™ä½äº†æ•ˆç‡ã€‚å½“ç„¶ä¹Ÿè€ƒè™‘äº†è¿‡å¤šçš„è‡ªæ—‹çº¿ç¨‹æ˜¯æµªè´¹CPUï¼Œæ‰€ä»¥ç³»ç»Ÿä¸­æœ€å¤šæœ‰<code>GOMAXPROCS</code>ä¸ªè‡ªæ—‹çš„çº¿ç¨‹(å½“å‰ä¾‹å­ä¸­çš„<code>GOMAXPROCS</code>&#x3D;4ï¼Œæ‰€ä»¥ä¸€å…±4ä¸ªP)ï¼Œå¤šä½™çš„æ²¡äº‹åšçº¿ç¨‹ä¼šè®©ä»–ä»¬ä¼‘çœ ã€‚</p>
<hr>
<h5 id="10-åœºæ™¯10"><a href="#10-åœºæ™¯10" class="headerlink" title="(10)åœºæ™¯10"></a>(10)åœºæ™¯10</h5><p>â€‹        å‡å®šå½“å‰é™¤äº†M3å’ŒM4ä¸ºè‡ªæ—‹çº¿ç¨‹ï¼Œè¿˜æœ‰M5å’ŒM6ä¸ºç©ºé—²çš„çº¿ç¨‹(æ²¡æœ‰å¾—åˆ°Pçš„ç»‘å®šï¼Œæ³¨æ„æˆ‘ä»¬è¿™é‡Œæœ€å¤šå°±åªèƒ½å¤Ÿå­˜åœ¨4ä¸ªPï¼Œæ‰€ä»¥Pçš„æ•°é‡åº”è¯¥æ°¸è¿œæ˜¯M&gt;&#x3D;P, å¤§éƒ¨åˆ†éƒ½æ˜¯Måœ¨æŠ¢å éœ€è¦è¿è¡Œçš„P)ï¼ŒG8åˆ›å»ºäº†G9ï¼ŒG8è¿›è¡Œäº†<strong>é˜»å¡çš„ç³»ç»Ÿè°ƒç”¨</strong>ï¼ŒM2å’ŒP2ç«‹å³è§£ç»‘ï¼ŒP2ä¼šæ‰§è¡Œä»¥ä¸‹åˆ¤æ–­ï¼šå¦‚æœP2æœ¬åœ°é˜Ÿåˆ—æœ‰Gã€å…¨å±€é˜Ÿåˆ—æœ‰Gæˆ–æœ‰ç©ºé—²çš„Mï¼ŒP2éƒ½ä¼šç«‹é©¬å”¤é†’1ä¸ªMå’Œå®ƒç»‘å®šï¼Œå¦åˆ™P2åˆ™ä¼šåŠ å…¥åˆ°ç©ºé—²Påˆ—è¡¨ï¼Œç­‰å¾…Mæ¥è·å–å¯ç”¨çš„pã€‚æœ¬åœºæ™¯ä¸­ï¼ŒP2æœ¬åœ°é˜Ÿåˆ—æœ‰G9ï¼Œå¯ä»¥å’Œå…¶ä»–ç©ºé—²çš„çº¿ç¨‹M5ç»‘å®šã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/35-gmp%E5%9C%BA%E6%99%AF10.png"></p>
<h5 id="11-åœºæ™¯11"><a href="#11-åœºæ™¯11" class="headerlink" title="(11)åœºæ™¯11"></a>(11)åœºæ™¯11</h5><p>G8åˆ›å»ºäº†G9ï¼Œå‡å¦‚G8è¿›è¡Œäº†<strong>éé˜»å¡ç³»ç»Ÿè°ƒç”¨</strong>ã€‚</p>
<p><img src="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/36-gmp%E5%9C%BA%E6%99%AF11.png"></p>
<p>â€‹    M2å’ŒP2ä¼šè§£ç»‘ï¼Œä½†M2ä¼šè®°ä½P2ï¼Œç„¶åG8å’ŒM2è¿›å…¥<strong>ç³»ç»Ÿè°ƒç”¨</strong>çŠ¶æ€ã€‚å½“G8å’ŒM2é€€å‡ºç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œä¼šå°è¯•è·å–P2ï¼Œå¦‚æœæ— æ³•è·å–ï¼Œåˆ™è·å–ç©ºé—²çš„Pï¼Œå¦‚æœä¾ç„¶æ²¡æœ‰ï¼ŒG8ä¼šè¢«è®°ä¸ºå¯è¿è¡ŒçŠ¶æ€ï¼Œå¹¶åŠ å…¥åˆ°å…¨å±€é˜Ÿåˆ—,M2å› ä¸ºæ²¡æœ‰Pçš„ç»‘å®šè€Œå˜æˆä¼‘çœ çŠ¶æ€(é•¿æ—¶é—´ä¼‘çœ ç­‰å¾…GCå›æ”¶é”€æ¯)ã€‚</p>
<hr>
<h4 id="å››ã€å°ç»“"><a href="#å››ã€å°ç»“" class="headerlink" title="å››ã€å°ç»“"></a>å››ã€å°ç»“</h4><p>æ€»ç»“ï¼ŒGoè°ƒåº¦å™¨å¾ˆè½»é‡ä¹Ÿå¾ˆç®€å•ï¼Œè¶³ä»¥æ’‘èµ·goroutineçš„è°ƒåº¦å·¥ä½œï¼Œå¹¶ä¸”è®©Goå…·æœ‰äº†åŸç”Ÿï¼ˆå¼ºå¤§ï¼‰å¹¶å‘çš„èƒ½åŠ›ã€‚<strong>Goè°ƒåº¦æœ¬è´¨æ˜¯æŠŠå¤§é‡çš„goroutineåˆ†é…åˆ°å°‘é‡çº¿ç¨‹ä¸Šå»æ‰§è¡Œï¼Œå¹¶åˆ©ç”¨å¤šæ ¸å¹¶è¡Œï¼Œå®ç°æ›´å¼ºå¤§çš„å¹¶å‘ã€‚</strong></p>
<hr>
<h4 id="äº”ã€æ€ç»´å¯¼å›¾ç¬”è®°"><a href="#äº”ã€æ€ç»´å¯¼å›¾ç¬”è®°" class="headerlink" title="äº”ã€æ€ç»´å¯¼å›¾ç¬”è®°"></a>äº”ã€æ€ç»´å¯¼å›¾ç¬”è®°</h4><p><a href="/images/GO/Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/Golang%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E4%B8%8EGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3.pdf">Golangåç¨‹è°ƒåº¦å™¨åŸç†ä¸GMPè®¾è®¡æ€æƒ³.pdf</a></p>
<div class="note default"><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://github.com/aceld/golang/blob/main/2%E3%80%81Golang%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AGMP%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3%EF%BC%9F.md">Golangçš„åç¨‹è°ƒåº¦å™¨åŸç†åŠGMPè®¾è®¡æ€æƒ³ï¼Ÿ</a></p>
</div>
]]></content>
      <categories>
        <category>GO</category>
      </categories>
      <tags>
        <tag>GO</tag>
        <tag>GMP</tag>
      </tags>
  </entry>
</search>
